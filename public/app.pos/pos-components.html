<html><head><meta charset="UTF-8"><script>!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.page=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
  /* globals require, module */

  'use strict';

  /**
   * Module dependencies.
   */

  var pathtoRegexp = require('path-to-regexp');

  /**
   * Module exports.
   */

  module.exports = page;

  /**
   * Detect click event
   */
  var clickEvent = ('undefined' !== typeof document) && document.ontouchstart ? 'touchstart' : 'click';

  /**
   * To work properly with the URL
   * history.location generated polyfill in https://github.com/devote/HTML5-History-API
   */

  var location = ('undefined' !== typeof window) && (window.history.location || window.location);

  /**
   * Perform initial dispatch.
   */

  var dispatch = true;


  /**
   * Decode URL components (query string, pathname, hash).
   * Accommodates both regular percent encoding and x-www-form-urlencoded format.
   */
  var decodeURLComponents = true;

  /**
   * Base path.
   */

  var base = '';

  /**
   * Running flag.
   */

  var running;

  /**
   * HashBang option
   */

  var hashbang = false;

  /**
   * Previous context, for capturing
   * page exit events.
   */

  var prevContext;

  /**
   * Register `path` with callback `fn()`,
   * or route `path`, or redirection,
   * or `page.start()`.
   *
   *   page(fn);
   *   page('*', fn);
   *   page('/user/:id', load, user);
   *   page('/user/' + user.id, { some: 'thing' });
   *   page('/user/' + user.id);
   *   page('/from', '/to')
   *   page();
   *
   * @param {String|Function} path
   * @param {Function} fn...
   * @api public
   */

  function page(path, fn) {
    // <callback>
    if ('function' === typeof path) {
      return page('*', path);
    }

    // route <path> to <callback ...>
    if ('function' === typeof fn) {
      var route = new Route(path);
      for (var i = 1; i < arguments.length; ++i) {
        page.callbacks.push(route.middleware(arguments[i]));
      }
      // show <path> with [state]
    } else if ('string' === typeof path) {
      page['string' === typeof fn ? 'redirect' : 'show'](path, fn);
      // start [options]
    } else {
      page.start(path);
    }
  }

  /**
   * Callback functions.
   */

  page.callbacks = [];
  page.exits = [];

  /**
   * Current path being processed
   * @type {String}
   */
  page.current = '';

  /**
   * Number of pages navigated to.
   * @type {number}
   *
   *     page.len == 0;
   *     page('/login');
   *     page.len == 1;
   */

  page.len = 0;

  /**
   * Get or set basepath to `path`.
   *
   * @param {String} path
   * @api public
   */

  page.base = function(path) {
    if (0 === arguments.length) return base;
    base = path;
  };

  /**
   * Bind with the given `options`.
   *
   * Options:
   *
   *    - `click` bind to click events [true]
   *    - `popstate` bind to popstate [true]
   *    - `dispatch` perform initial dispatch [true]
   *
   * @param {Object} options
   * @api public
   */

  page.start = function(options) {
    options = options || {};
    if (running) return;
    running = true;
    if (false === options.dispatch) dispatch = false;
    if (false === options.decodeURLComponents) decodeURLComponents = false;
    if (false !== options.popstate) window.addEventListener('popstate', onpopstate, false);
    if (false !== options.click) {
      document.addEventListener(clickEvent, onclick, false);
    }
    if (true === options.hashbang) hashbang = true;
    if (!dispatch) return;
    var url = (hashbang && ~location.hash.indexOf('#!')) ? location.hash.substr(2) + location.search : location.pathname + location.search + location.hash;
    page.replace(url, null, true, dispatch);
  };

  /**
   * Unbind click and popstate event handlers.
   *
   * @api public
   */

  page.stop = function() {
    if (!running) return;
    page.current = '';
    page.len = 0;
    running = false;
    document.removeEventListener(clickEvent, onclick, false);
    window.removeEventListener('popstate', onpopstate, false);
  };

  /**
   * Show `path` with optional `state` object.
   *
   * @param {String} path
   * @param {Object} state
   * @param {Boolean} dispatch
   * @return {Context}
   * @api public
   */

  page.show = function(path, state, dispatch, push) {
    var ctx = new Context(path, state);
    page.current = ctx.path;
    if (false !== dispatch) page.dispatch(ctx);
    if (false !== ctx.handled && false !== push) ctx.pushState();
    return ctx;
  };

  /**
   * Goes back in the history
   * Back should always let the current route push state and then go back.
   *
   * @param {String} path - fallback path to go back if no more history exists, if undefined defaults to page.base
   * @param {Object} [state]
   * @api public
   */

  page.back = function(path, state) {
    if (page.len > 0) {
      // this may need more testing to see if all browsers
      // wait for the next tick to go back in history
      history.back();
      page.len--;
    } else if (path) {
      setTimeout(function() {
        page.show(path, state);
      });
    }else{
      setTimeout(function() {
        page.show(base, state);
      });
    }
  };


  /**
   * Register route to redirect from one path to other
   * or just redirect to another route
   *
   * @param {String} from - if param 'to' is undefined redirects to 'from'
   * @param {String} [to]
   * @api public
   */
  page.redirect = function(from, to) {
    // Define route from a path to another
    if ('string' === typeof from && 'string' === typeof to) {
      page(from, function(e) {
        setTimeout(function() {
          page.replace(to);
        }, 0);
      });
    }

    // Wait for the push state and replace it with another
    if ('string' === typeof from && 'undefined' === typeof to) {
      setTimeout(function() {
        page.replace(from);
      }, 0);
    }
  };

  /**
   * Replace `path` with optional `state` object.
   *
   * @param {String} path
   * @param {Object} state
   * @return {Context}
   * @api public
   */


  page.replace = function(path, state, init, dispatch) {
    var ctx = new Context(path, state);
    page.current = ctx.path;
    ctx.init = init;
    ctx.save(); // save before dispatching, which may redirect
    if (false !== dispatch) page.dispatch(ctx);
    return ctx;
  };

  /**
   * Dispatch the given `ctx`.
   *
   * @param {Object} ctx
   * @api private
   */

  page.dispatch = function(ctx) {
    var prev = prevContext,
      i = 0,
      j = 0;

    prevContext = ctx;

    function nextExit() {
      var fn = page.exits[j++];
      if (!fn) return nextEnter();
      fn(prev, nextExit);
    }

    function nextEnter() {
      var fn = page.callbacks[i++];

      if (ctx.path !== page.current) {
        ctx.handled = false;
        return;
      }
      if (!fn) return unhandled(ctx);
      fn(ctx, nextEnter);
    }

    if (prev) {
      nextExit();
    } else {
      nextEnter();
    }
  };

  /**
   * Unhandled `ctx`. When it's not the initial
   * popstate then redirect. If you wish to handle
   * 404s on your own use `page('*', callback)`.
   *
   * @param {Context} ctx
   * @api private
   */

  function unhandled(ctx) {
    if (ctx.handled) return;
    var current;

    if (hashbang) {
      current = base + location.hash.replace('#!', '');
    } else {
      current = location.pathname + location.search;
    }

    if (current === ctx.canonicalPath) return;
    page.stop();
    ctx.handled = false;
    location.href = ctx.canonicalPath;
  }

  /**
   * Register an exit route on `path` with
   * callback `fn()`, which will be called
   * on the previous context when a new
   * page is visited.
   */
  page.exit = function(path, fn) {
    if (typeof path === 'function') {
      return page.exit('*', path);
    }

    var route = new Route(path);
    for (var i = 1; i < arguments.length; ++i) {
      page.exits.push(route.middleware(arguments[i]));
    }
  };

  /**
   * Remove URL encoding from the given `str`.
   * Accommodates whitespace in both x-www-form-urlencoded
   * and regular percent-encoded form.
   *
   * @param {str} URL component to decode
   */
  function decodeURLEncodedURIComponent(val) {
    if (typeof val !== 'string') { return val; }
    return decodeURLComponents ? decodeURIComponent(val.replace(/\+/g, ' ')) : val;
  }

  /**
   * Initialize a new "request" `Context`
   * with the given `path` and optional initial `state`.
   *
   * @param {String} path
   * @param {Object} state
   * @api public
   */

  function Context(path, state) {
    if ('/' === path[0] && 0 !== path.indexOf(base)) path = base + (hashbang ? '#!' : '') + path;
    var i = path.indexOf('?');

    this.canonicalPath = path;
    this.path = path.replace(base, '') || '/';
    if (hashbang) this.path = this.path.replace('#!', '') || '/';

    this.title = document.title;
    this.state = state || {};
    this.state.path = path;
    this.querystring = ~i ? decodeURLEncodedURIComponent(path.slice(i + 1)) : '';
    this.pathname = decodeURLEncodedURIComponent(~i ? path.slice(0, i) : path);
    this.params = {};

    // fragment
    this.hash = '';
    if (!hashbang) {
      if (!~this.path.indexOf('#')) return;
      var parts = this.path.split('#');
      this.path = parts[0];
      this.hash = decodeURLEncodedURIComponent(parts[1]) || '';
      this.querystring = this.querystring.split('#')[0];
    }
  }

  /**
   * Expose `Context`.
   */

  page.Context = Context;

  /**
   * Push state.
   *
   * @api private
   */

  Context.prototype.pushState = function() {
    page.len++;
    history.pushState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);
  };

  /**
   * Save the context state.
   *
   * @api public
   */

  Context.prototype.save = function() {
    history.replaceState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);
  };

  /**
   * Initialize `Route` with the given HTTP `path`,
   * and an array of `callbacks` and `options`.
   *
   * Options:
   *
   *   - `sensitive`    enable case-sensitive routes
   *   - `strict`       enable strict matching for trailing slashes
   *
   * @param {String} path
   * @param {Object} options.
   * @api private
   */

  function Route(path, options) {
    options = options || {};
    this.path = (path === '*') ? '(.*)' : path;
    this.method = 'GET';
    this.regexp = pathtoRegexp(this.path,
      this.keys = [],
      options.sensitive,
      options.strict);
  }

  /**
   * Expose `Route`.
   */

  page.Route = Route;

  /**
   * Return route middleware with
   * the given callback `fn()`.
   *
   * @param {Function} fn
   * @return {Function}
   * @api public
   */

  Route.prototype.middleware = function(fn) {
    var self = this;
    return function(ctx, next) {
      if (self.match(ctx.path, ctx.params)) return fn(ctx, next);
      next();
    };
  };

  /**
   * Check if this route matches `path`, if so
   * populate `params`.
   *
   * @param {String} path
   * @param {Object} params
   * @return {Boolean}
   * @api private
   */

  Route.prototype.match = function(path, params) {
    var keys = this.keys,
      qsIndex = path.indexOf('?'),
      pathname = ~qsIndex ? path.slice(0, qsIndex) : path,
      m = this.regexp.exec(decodeURIComponent(pathname));

    if (!m) return false;

    for (var i = 1, len = m.length; i < len; ++i) {
      var key = keys[i - 1];
      var val = decodeURLEncodedURIComponent(m[i]);
      if (val !== undefined || !(hasOwnProperty.call(params, key.name))) {
        params[key.name] = val;
      }
    }

    return true;
  };


  /**
   * Handle "populate" events.
   */

  var onpopstate = (function () {
    var loaded = false;
    if ('undefined' === typeof window) {
      return;
    }
    if (document.readyState === 'complete') {
      loaded = true;
    } else {
      window.addEventListener('load', function() {
        setTimeout(function() {
          loaded = true;
        }, 0);
      });
    }
    return function onpopstate(e) {
      if (!loaded) return;
      if (e.state) {
        var path = e.state.path;
        page.replace(path, e.state);
      } else {
        page.show(location.pathname + location.hash, undefined, undefined, false);
      }
    };
  })();
  /**
   * Handle "click" events.
   */

  function onclick(e) {

    if (1 !== which(e)) return;

    if (e.metaKey || e.ctrlKey || e.shiftKey) return;
    if (e.defaultPrevented) return;



    // ensure link
    var el = e.target;
    while (el && 'A' !== el.nodeName) el = el.parentNode;
    if (!el || 'A' !== el.nodeName) return;



    // Ignore if tag has
    // 1. "download" attribute
    // 2. rel="external" attribute
    if (el.hasAttribute('download') || el.getAttribute('rel') === 'external') return;

    // ensure non-hash for the same path
    var link = el.getAttribute('href');
    if (!hashbang && el.pathname === location.pathname && (el.hash || '#' === link)) return;



    // Check for mailto: in the href
    if (link && link.indexOf('mailto:') > -1) return;

    // check target
    if (el.target) return;

    // x-origin
    if (!sameOrigin(el.href)) return;



    // rebuild path
    var path = el.pathname + el.search + (el.hash || '');

    // strip leading "/[drive letter]:" on NW.js on Windows
    if (typeof process !== 'undefined' && path.match(/^\/[a-zA-Z]:\//)) {
      path = path.replace(/^\/[a-zA-Z]:\//, '/');
    }

    // same page
    var orig = path;

    if (path.indexOf(base) === 0) {
      path = path.substr(base.length);
    }

    if (hashbang) path = path.replace('#!', '');

    if (base && orig === path) return;

    e.preventDefault();
    page.show(orig);
  }

  /**
   * Event button.
   */

  function which(e) {
    e = e || window.event;
    return null === e.which ? e.button : e.which;
  }

  /**
   * Check if `href` is the same origin.
   */

  function sameOrigin(href) {
    var origin = location.protocol + '//' + location.hostname;
    if (location.port) origin += ':' + location.port;
    return (href && (0 === href.indexOf(origin)));
  }

  page.sameOrigin = sameOrigin;

}).call(this,require('_process'))
},{"_process":2,"path-to-regexp":3}],2:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canMutationObserver = typeof window !== 'undefined'
    && window.MutationObserver;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    var queue = [];

    if (canMutationObserver) {
        var hiddenDiv = document.createElement("div");
        var observer = new MutationObserver(function () {
            var queueList = queue.slice();
            queue.length = 0;
            queueList.forEach(function (fn) {
                fn();
            });
        });

        observer.observe(hiddenDiv, { attributes: true });

        return function nextTick(fn) {
            if (!queue.length) {
                hiddenDiv.setAttribute('yes', 'no');
            }
            queue.push(fn);
        };
    }

    if (canPost) {
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],3:[function(require,module,exports){
var isarray = require('isarray')

/**
 * Expose `pathToRegexp`.
 */
module.exports = pathToRegexp
module.exports.parse = parse
module.exports.compile = compile
module.exports.tokensToFunction = tokensToFunction
module.exports.tokensToRegExp = tokensToRegExp

/**
 * The main path matching regexp utility.
 *
 * @type {RegExp}
 */
var PATH_REGEXP = new RegExp([
  // Match escaped characters that would otherwise appear in future matches.
  // This allows the user to escape special characters that won't transform.
  '(\\\\.)',
  // Match Express-style parameters and un-named parameters with a prefix
  // and optional suffixes. Matches appear as:
  //
  // "/:test(\\d+)?" => ["/", "test", "\d+", undefined, "?", undefined]
  // "/route(\\d+)"  => [undefined, undefined, undefined, "\d+", undefined, undefined]
  // "/*"            => ["/", undefined, undefined, undefined, undefined, "*"]
  '([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))'
].join('|'), 'g')

/**
 * Parse a string for the raw tokens.
 *
 * @param  {String} str
 * @return {Array}
 */
function parse (str) {
  var tokens = []
  var key = 0
  var index = 0
  var path = ''
  var res

  while ((res = PATH_REGEXP.exec(str)) != null) {
    var m = res[0]
    var escaped = res[1]
    var offset = res.index
    path += str.slice(index, offset)
    index = offset + m.length

    // Ignore already escaped sequences.
    if (escaped) {
      path += escaped[1]
      continue
    }

    // Push the current path onto the tokens.
    if (path) {
      tokens.push(path)
      path = ''
    }

    var prefix = res[2]
    var name = res[3]
    var capture = res[4]
    var group = res[5]
    var suffix = res[6]
    var asterisk = res[7]

    var repeat = suffix === '+' || suffix === '*'
    var optional = suffix === '?' || suffix === '*'
    var delimiter = prefix || '/'
    var pattern = capture || group || (asterisk ? '.*' : '[^' + delimiter + ']+?')

    tokens.push({
      name: name || key++,
      prefix: prefix || '',
      delimiter: delimiter,
      optional: optional,
      repeat: repeat,
      pattern: escapeGroup(pattern)
    })
  }

  // Match any characters still remaining.
  if (index < str.length) {
    path += str.substr(index)
  }

  // If the path exists, push it onto the end.
  if (path) {
    tokens.push(path)
  }

  return tokens
}

/**
 * Compile a string to a template function for the path.
 *
 * @param  {String}   str
 * @return {Function}
 */
function compile (str) {
  return tokensToFunction(parse(str))
}

/**
 * Expose a method for transforming tokens into the path function.
 */
function tokensToFunction (tokens) {
  // Compile all the tokens into regexps.
  var matches = new Array(tokens.length)

  // Compile all the patterns before compilation.
  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] === 'object') {
      matches[i] = new RegExp('^' + tokens[i].pattern + '$')
    }
  }

  return function (obj) {
    var path = ''
    var data = obj || {}

    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i]

      if (typeof token === 'string') {
        path += token

        continue
      }

      var value = data[token.name]
      var segment

      if (value == null) {
        if (token.optional) {
          continue
        } else {
          throw new TypeError('Expected "' + token.name + '" to be defined')
        }
      }

      if (isarray(value)) {
        if (!token.repeat) {
          throw new TypeError('Expected "' + token.name + '" to not repeat, but received "' + value + '"')
        }

        if (value.length === 0) {
          if (token.optional) {
            continue
          } else {
            throw new TypeError('Expected "' + token.name + '" to not be empty')
          }
        }

        for (var j = 0; j < value.length; j++) {
          segment = encodeURIComponent(value[j])

          if (!matches[i].test(segment)) {
            throw new TypeError('Expected all "' + token.name + '" to match "' + token.pattern + '", but received "' + segment + '"')
          }

          path += (j === 0 ? token.prefix : token.delimiter) + segment
        }

        continue
      }

      segment = encodeURIComponent(value)

      if (!matches[i].test(segment)) {
        throw new TypeError('Expected "' + token.name + '" to match "' + token.pattern + '", but received "' + segment + '"')
      }

      path += token.prefix + segment
    }

    return path
  }
}

/**
 * Escape a regular expression string.
 *
 * @param  {String} str
 * @return {String}
 */
function escapeString (str) {
  return str.replace(/([.+*?=^!:${}()[\]|\/])/g, '\\$1')
}

/**
 * Escape the capturing group by escaping special characters and meaning.
 *
 * @param  {String} group
 * @return {String}
 */
function escapeGroup (group) {
  return group.replace(/([=!:$\/()])/g, '\\$1')
}

/**
 * Attach the keys as a property of the regexp.
 *
 * @param  {RegExp} re
 * @param  {Array}  keys
 * @return {RegExp}
 */
function attachKeys (re, keys) {
  re.keys = keys
  return re
}

/**
 * Get the flags for a regexp from the options.
 *
 * @param  {Object} options
 * @return {String}
 */
function flags (options) {
  return options.sensitive ? '' : 'i'
}

/**
 * Pull out keys from a regexp.
 *
 * @param  {RegExp} path
 * @param  {Array}  keys
 * @return {RegExp}
 */
function regexpToRegexp (path, keys) {
  // Use a negative lookahead to match only capturing groups.
  var groups = path.source.match(/\((?!\?)/g)

  if (groups) {
    for (var i = 0; i < groups.length; i++) {
      keys.push({
        name: i,
        prefix: null,
        delimiter: null,
        optional: false,
        repeat: false,
        pattern: null
      })
    }
  }

  return attachKeys(path, keys)
}

/**
 * Transform an array into a regexp.
 *
 * @param  {Array}  path
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function arrayToRegexp (path, keys, options) {
  var parts = []

  for (var i = 0; i < path.length; i++) {
    parts.push(pathToRegexp(path[i], keys, options).source)
  }

  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options))

  return attachKeys(regexp, keys)
}

/**
 * Create a path regexp from string input.
 *
 * @param  {String} path
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function stringToRegexp (path, keys, options) {
  var tokens = parse(path)
  var re = tokensToRegExp(tokens, options)

  // Attach keys back to the regexp.
  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] !== 'string') {
      keys.push(tokens[i])
    }
  }

  return attachKeys(re, keys)
}

/**
 * Expose a function for taking tokens and returning a RegExp.
 *
 * @param  {Array}  tokens
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function tokensToRegExp (tokens, options) {
  options = options || {}

  var strict = options.strict
  var end = options.end !== false
  var route = ''
  var lastToken = tokens[tokens.length - 1]
  var endsWithSlash = typeof lastToken === 'string' && /\/$/.test(lastToken)

  // Iterate over the tokens and create our regexp string.
  for (var i = 0; i < tokens.length; i++) {
    var token = tokens[i]

    if (typeof token === 'string') {
      route += escapeString(token)
    } else {
      var prefix = escapeString(token.prefix)
      var capture = token.pattern

      if (token.repeat) {
        capture += '(?:' + prefix + capture + ')*'
      }

      if (token.optional) {
        if (prefix) {
          capture = '(?:' + prefix + '(' + capture + '))?'
        } else {
          capture = '(' + capture + ')?'
        }
      } else {
        capture = prefix + '(' + capture + ')'
      }

      route += capture
    }
  }

  // In non-strict mode we allow a slash at the end of match. If the path to
  // match already ends with a slash, we remove it for consistency. The slash
  // is valid at the end of a path match, not in the middle. This is important
  // in non-ending mode, where "/test/" shouldn't match "/test//route".
  if (!strict) {
    route = (endsWithSlash ? route.slice(0, -2) : route) + '(?:\\/(?=$))?'
  }

  if (end) {
    route += '$'
  } else {
    // In non-ending mode, we need the capturing groups to match as much as
    // possible by using a positive lookahead to the end or next path segment.
    route += strict && endsWithSlash ? '' : '(?=\\/|$)'
  }

  return new RegExp('^' + route, flags(options))
}

/**
 * Normalize the given path string, returning a regular expression.
 *
 * An empty array can be passed in for the keys, which will hold the
 * placeholder key descriptions. For example, using `/user/:id`, `keys` will
 * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.
 *
 * @param  {(String|RegExp|Array)} path
 * @param  {Array}                 [keys]
 * @param  {Object}                [options]
 * @return {RegExp}
 */
function pathToRegexp (path, keys, options) {
  keys = keys || []

  if (!isarray(keys)) {
    options = keys
    keys = []
  } else if (!options) {
    options = {}
  }

  if (path instanceof RegExp) {
    return regexpToRegexp(path, keys, options)
  }

  if (isarray(path)) {
    return arrayToRegexp(path, keys, options)
  }

  return stringToRegexp(path, keys, options)
}

},{"isarray":4}],4:[function(require,module,exports){
module.exports = Array.isArray || function (arr) {
  return Object.prototype.toString.call(arr) == '[object Array]';
};

},{}]},{},[1])(1)
});</script>
<script>
    PubSub.subscribe('App.ready', function () {
        loadPagejs();
    });

    function loadPagejs(){
        console.log('Loading page.js ...');
        // We use Page.js for routing. This is a Micro
        // client-side router inspired by the Express router
        // More info: https://visionmedia.github.io/page.js/

        // Middleware
        function scrollToTop(ctx, next) {
            if(app)
                app.scrollPageToTop();
            next();
        }
        // Routes

        page('/', function (data, next) {
            page.redirect('/open-orders');
        });

        page('/businesses', scrollToTop, function (data, next) {
            app.route = '/businesses';
            PubSub.publish('neonpages.BusinessView');
        });
       
        page('/businesses/:placeid', function (data, next) {
            // TODO:...
        });
        /////////// INVENTORY ////////////////////
        page('/inventory', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Inventory');
        });
        page('/inventory/:placeid/*', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Inventory', data.params.placeid);
        });
        /////////// MENUS ////////////////////////
        page('/menus/*', scrollToTop, function (data, next) {
            app.route = '/menus';
            PubSub.publish('neonpages.Menus', data.params.placeid);
            next();
        });
        page('/menus', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Menus.main');
        });
        page('/menus/:placeid/*', scrollToTop, function (data, next) {
            CommonModule.modules.business.callWhenReady(next, { placeid: data.params.placeid });
        });

        page('/menus/:placeid', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Menus.main', data.params.placeid);
        });
        page('/menus/:placeid/add', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Menus.add', data.params.placeid);
        });
        page('/menus/:placeid/:title', scrollToTop, function (data, next) {
            PubSub.publish('neonpages.Menus.viewedit', [data.params.placeid, data.params.title]);
        });
        /////////// PHOTOS ////////////////////////
        page('/gallery', scrollToTop, function (data, next) {
            app.route = '/gallery';
            PubSub.publish('neonpages.PhotoGallery');
        });
        page('/gallery/:placeid', scrollToTop, function (data, next) {
            app.route = '/gallery';
            PubSub.publish('neonpages.PhotoGallery', data.params.placeid);
        });
        /////////// REVIEWS ////////////////////////
        page('/reviews', scrollToTop, function (data, next) {
            app.route = '/reviews';
            PubSub.publish('neonpages.Reviews');
        });

        page('/reviews/:placeid', scrollToTop, function (data, next) {
            app.route = '/reviews';
            PubSub.publish('neonpages.Reviews', data.params.placeid);
        });
        /////////// MEMBERSHIP ////////////////////////
        page('/membership', scrollToTop, function (data, next) {
            app.route = '/membership';
            PubSub.publish('neonpages.Membership', data.params.placeid);
        });
        /////////// SETTINGS ////////////////////////
        page('/socialmedia', scrollToTop, function (data, next) {
            app.route = '/socialmedia';
            PubSub.publish('neonpages.SocialMedia', data.params.placeid);
        });
        /////////// SETTINGS ////////////////////////
        page('/settings', scrollToTop, function (data, next) {
            app.route = '/settings';
            PubSub.publish('neonpages.Settings', data.params.placeid);
        });
        /////////// LOGOUT ////////////////////////
        page('/logout', function (data, next) {
            CommonModule.modules.user.logOut();
        });


        /////////// ORDERS ////////////////////////
        page('/register', scrollToTop, function () {
            app.route = '/register';
            PubSub.publish('neonpages.Register');
        });
        page('/floormap', scrollToTop, function () {
            app.route = '/register';
            PubSub.publish('neonpages.Floormap');
        });
        page('/open-orders', scrollToTop, function () {
            app.route = '/open-orders';
            PubSub.publish('neonpages.OpenOrders');
        });
        page('/open-orders/:id', scrollToTop, function (data, next) {
            //TODO:
            //posModule.set({ placeid: data.params.id });
            next();
        });
        page('/order-history', scrollToTop, function () {
            app.route = '/order-history';
            PubSub.publish('neonpages.OrderHistory');
        });

        /////////// ACCOUNT ////////////////////////
        page('/account', scrollToTop, function () {
            app.route = '/account';
            PubSub.publish('neonpages.Account');
        });


        // add #! before urls
        page.base('/chefs');
        page({
            hashbang: true,
        });
    }
</script>
<script>
  Polymer({
    is: 'expand-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;

      var height = node.getBoundingClientRect().height;

      this._effect = new KeyframeEffect(node, [{
        height: (height / 2) + 'px'
      }, {
        height: height + 'px'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });
</script>
<style>
body {
  background: #fafafa;
  font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  color: #333;
}

a{
    color:cornflowerblue;
}
a:link, a:visited , a:active, a:hover {
    cursor:pointer;
    text-decoration: none;
    color: blue;
}
div.full{
    width:100%;
}
.nobutton{
    padding:0;
    text-transform:none;
    font-size:0.8em;
    background:none;
    elevation:0;
    text-align:left;
    display:block;
    width:100%;
}

.nobutton paper-icon-item{
    margin:0;
    padding-left: 10px;
}
.nopadding{
    padding:0;
    margin:0;
}
paper-button {
    display: block;
    margin: 10px;
    font-size:0.9em;
    background-size: contain;
}
paper-toast{
    z-index:20;
}

.separator {
    width: 100%;
    margin: 5px 5px;
    height: 5px;
    background: url("/public/images/separator.jpg") no-repeat;
    background-size: 100%;
}

::-webkit-scrollbar {
    width: 6px;
}
 
::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.3);
    border-radius: 4px;
}
 
::-webkit-scrollbar-thumb {
    border-radius: 4px;
    -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
}

.caption {
    font-family: 'Fjalla One', sans-serif;
    font-stretch: ultra-expanded;
    font-size: large;
    text-align: center;
}


.menu-navigation {
    position: relative;
    top: -10px;
    color: white;
}

@media (min-width:641px) {
    .control-icons {
        left: 220px;
    }
}



paper-button.checkout-button {
    padding: 3px;
    display: block;
    width: 100%;
    font-stretch: expanded;
    left: 0;
    right: 0;
    margin: auto;
}

paper-button.standard {
    position:relative;
    display: block;
    width: 100%;
    left:0;
    right:0;
    margin: auto;
}


.smaller-button {
 /*   padding-top: 2px;
    padding-bottom: 2px;
    max-height: 32px;
     */
}

.onload-opacity {
    opacity: 0;
    -moz-transition: opacity 0.5s linear;
    -o-transition: opacity 0.5s linear;
    -webkit-transition: opacity 0.5s linear;
    transition: opacity 0.5s linear;
}

paper-spinner {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
    max-width: 32px;
    max-height: 32px;
    layer-1-color: var(--paper-light-blue-500);
    layer-2-color: var(--paper-light-blue-500);
    layer-3-color: var(--paper-light-blue-500);
    layer-4-color: var(--paper-light-blue-500);
}

paper-slider {
    --paper-slider-active-color: whitesmoke;
}

.divider {
    opacity: 0.5;
    color: #ccc;
    width: 95%;
    margin: 10px auto;
    overflow: hidden;
    text-align: center;
    line-height: 0.8em;
}

    .divider:before, .divider:after {
        content: "";
        vertical-align: top;
        display: inline-block;
        width: 50%;
        height: 0.45em;
        border-bottom: 1px solid #ccc;
        margin: 0 2% 0 -55%;
    }

    .divider:after {
        margin: 0 -55% 0 2%;
    }

.fjalla-caption {
    font-family: 'Fjalla One', sans-serif;
    font-stretch: expanded;
    font-size: x-large;
    text-align: center;
    opacity:0.6;
}

.circular-avatar-big {
    width: 250px;
    height: 250px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
    box-shadow: 5px 5px 2.5px #888888;
}

.circular-avatar-small, .circular-avatar-xsmall, .circular-avatar-xxsmall  {
    min-width: 80px;
    min-height: 80px;
    max-width: 80px;
    max-height: 80px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
    box-shadow: 3px 3px 1.5px #888888;
}

.circular-avatar-xsmall{
    min-width: 40px;
    min-height: 40px;
    max-width: 40px;
    max-height: 40px;
}

.circular-avatar-xxsmall{
    min-width: 25px;
    min-height: 25px;
    max-width: 25px;
    max-height: 25px;
}

.rectangular-avatar-medium {
    min-width: 135px;
    min-height: 160px;
    max-width: 135px;
    max-height: 160px;
    margin:10px;
    -webkit-border-radius: 10%;
    -moz-border-radius: 10%;
    border-radius: 10%;
    box-shadow: 5px 5px 2.5px #888888;
}

#drawerToolbar{
    z-index:2 !important;
}


</style>

</head><body><div hidden="" by-vulcanize=""><dom-module id="yummlet-pos" assetpath="/">
    <template>
        <style>
  /*
   Polymer includes a shim for CSS Custom Properties that we can use for application theming.
   Below, you'll find the default palette for the yummlet layout. Feel free to play
   with changing the colors used or generate your own palette of colours at MaterialPalette.com.

   See https://www.polymer-project.org/1.0/docs/devguide/styling.html#xscope-styling-details
   for further information on custom CSS properties.
   */

  /* Application theme */

  :host {
    --dark-primary-color: #303F9F;
    --default-primary-color: #3F51B5;
    --light-primary-color: #FFE8D0;
    --text-primary-color: #ffffff; /*text/icons*/
    --accent-color: #FF4081;
    --primary-background-color: #FFE8D0;
    --primary-text-color: #212121;
    --secondary-text-color: #727272;
    --disabled-text-color: #bdbdbd;
    --divider-color: #B6B6B6;

    /* Components */

    /* paper-drawer-panel */
    --drawer-menu-color: #ffffff;
    --drawer-border-color: 1px solid #ccc;
    --drawer-toolbar-border-color: 1px solid rgba(0, 0, 0, 0.22);
    --paper-drawer-panel-scrim-opacity: 0.5;
    /* paper-menu */
    --paper-menu-background-color: #fff;
  }
  #drawer{
         z-index: 5;
     }
  /* General styles */

  #drawerToolbar {
    /*color: var(--secondary-text-color);
    /*background-color: var(--drawer-menu-color);
    /*border-bottom: var(--drawer-toolbar-border-color);*/
  }

  paper-scroll-header-panel {
    height: 100%;
  }

  paper-material {
    border-radius: 2px;
    height: 100%;
    padding: 16px 0 16px 0;
    width: calc(98.66% - 16px);
    margin: 16px auto;
    background: white;
  }

  paper-menu iron-icon {
    margin-right: 33px;
    opacity: 0.54;
  }

  
  .iron-selected {
    color: #3F51B5 !important;
  }

  paper-menu a {
    text-decoration: none;
    color: var(--menu-link-color);
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-flex-align: center;
    -webkit-align-items: center;
    align-items: center;
    font-family: 'Roboto', 'Noto', sans-serif;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
    font-size: 14px;
    font-weight: 400;
    line-height: 24px;
    min-height: 48px;
    padding: 0 16px;
  }

  #mainToolbar .bottom {
    margin-left: 48px;
    /* Required for main area's paper-scroll-header-panel custom condensing transformation */
    -webkit-transform-origin: left center;
    transform-origin: left center;
  }

  /* Height of the scroll area */
  .content {
      height:100%;
      width:100%;
  }

  /* Breakpoints */

  /* Small */
  @media (max-width: 600px) {
      paper-input.input-big-screen{
        display:none;
    }
    paper-material {
      --menu-container-display: none;
      width: calc(97.33% - 32px);
      padding-left: 16px;
      padding-right: 16px;
    }

    #drawer .paper-toolbar {
      margin-left: 16px;
    }

    #overlay {
      min-width: 360px;
    }

    .bg {
      background: white;
    }

  }

  /*Tablet+*/ 
  @media (min-width: 601px) {
      paper-material {
      width: calc(98% - 46px);
      margin-bottom: 32px;
      padding-left: 30px;
      padding-right: 30px;
    }
/*
    #drawer.paper-drawer-panel > [drawer] {
      border-right: 1px solid rgba(0, 0, 0, 0.14);
    }
    */
  }
  @media (min-width:800){
      paper-input.input-big-screen{
        display:inline;
    }
  }

  /* Material Design Adaptive Breakpoints */
  /*
    Below you'll find CSS media queries based on the breakpoint guidance
    published by the Material Design team. You can choose to use, customise
    or remove these breakpoints based on your needs.

    http://www.google.com/design/spec/layout/adaptive-ui.html#adaptive-ui-breakpoints
   */

  /* mobile-small */
  @media all and (min-width: 0) and (max-width: 360px) and (orientation: portrait) { }
  /* mobile-large */
  @media all and (min-width: 361px) and (orientation: portrait) { }
  /* mobile-small-landscape */
  @media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) { }
  /* mobile-large-landscape */
  @media all and (min-width: 481px) and (orientation: landscape) { }
  /* tablet-small-landscape */
  @media all and (min-width: 600px) and (max-width: 960px) and (orientation: landscape) { }
  /* tablet-large-landscape */
  @media all and (min-width: 961px) and (orientation: landscape) { }
  /* tablet-small */
  @media all and (min-width: 600px) and (orientation: portrait) { }
  /* tablet-large */
  @media all and (min-width: 601px) and (max-width: 840px) and (orientation : portrait) { }
  /* desktop-x-small-landscape */
  @media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) { }
  /* desktop-x-small */
  @media all and (min-width: 0) and (max-width: 480px) and (max-aspect-ratio: 4/3) { }
  /* desktop-small-landscape */
  @media all and (min-width: 481px) and (max-width: 840px) and (orientation: landscape) { }
  /* desktop-small */
  @media all and (min-width: 481px) and (max-width: 840px) and (max-aspect-ratio: 4/3) { }
  /* desktop-medium-landscape */
  @media all and (min-width: 841px) and (max-width: 1280px) and (orientation: landscape) { }
  /* desktop-medium */
  @media all and (min-width: 841px) and (max-width: 1280px) and (max-aspect-ratio: 4/3) { }
  /* desktop-large */
  @media all and (min-width: 1281px) and (max-width: 1600px) { }
  /* desktop-xlarge */
  @media all and (min-width: 1601px) and (max-width: 1920px) { }


  /* MY STYLES */
  paper-toolbar {
    font-family: 'Fjalla One', sans-serif;
    background-size: 100vw auto;
    background-position-y: center;
    background-position-x: -200px;
    background-repeat: no-repeat;
    background-color: rgb(48,23,10);
    background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url("/public/images/coffee.jpg");
    }

  paper-toolbar#drawerToolbar{
    background-position-x: 0;
  }
    @media (max-width: 600px) {
        paper-toolbar {
            background-size: calc(100vw + 200px) auto;
        }
    }
  .title-bar-fonting{
      margin-right: -10px;
      font-size:large;
      padding-top: 0.8em;
      text-align:right;
      line-height: 90%;
  }
  .guest-check{
      left:0;
      right:0;
      width:90%;
      margin:auto;
  }

  paper-icon-button{
      margin-right: 5px;
      margin-left: 5px;
  }
  paper-input.dark-bg {
    --paper-input-container-focus-color: blue;
    --paper-input-container-invalid-color: red;
    --paper-input-container-input-color: white;
  }

  .flexchild {
    @apply(--layout-flex);
  }
  .flex2child {
    @apply(--layout-flex-2);
  }
  .flex3child {
    @apply(--layout-flex-3);
  }

.yummlet-pos-text{
    font-weight:bolder;
    color:cornflowerblue;
}


.control-buttons paper-icon-button{
    margin:0 0 2px 2px;
}
#businessList {
    z-index: 5;
    max-width: 300px;
    height:auto;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    font-size: xx-small;
    text-transform: uppercase;
    color: darkgray;
    background: white;
    max-height: 400px;
    overflow-y: auto;
    overflow-x: hidden;
    text-align: left;
    padding: 15px;
    position:fixed;
}

.business-for-selection:hover {
    cursor: pointer;
    color: white;
}

</style>
        <style>
ï»¿.control-buttons {
    right: 0;
    position: fixed;
    z-index: 2 !important;
    top: 20%;
    margin:0 !important;
}

.control-buttons paper-icon-button {
    color: white;
    background: black;
    opacity: 0.6;
}

.control-buttons paper-icon-button:hover {
    opacity: 1;
}
</style>
        <style>
            .blurred {
                -webkit-filter: blur(7px);
                -moz-filter: blur(7px);
                -o-filter: blur(7px);
                -ms-filter: blur(7px);
                filter: blur(7px);
            }

            paper-toolbar {
                background-image: linear-gradient(rgba(100, 149, 237,0.3), rgba(100, 149, 237,0.3)), url("/public/images/coffee.jpg");
            }

            paper-checkbox {
                z-index: 2;
            }

            .menu-heading {
                margin-left: 7px;
                font-size: x-small;
                color: lightgray;
                text-transform: uppercase;
                font-weight: bold;
            }
            div .menu-content:nth-child(even){
                background: #fff8ff;
            }
        </style>
        <paper-toast id="toast2"></paper-toast>
        <account-manager backdrop="#backdrop"></account-manager>
        <div id="backdrop">
            <paper-material id="businessList" hidden="" class="business-list layout vertical">
                <template is="dom-repeat" items="{{businesses}}" as="business_from_list">
                    <p class="business-for-selection" style$="{{getBusinessListItemStyle(business_from_list, business)}}" on-click="onBusinessSelect">{{business_from_list.fullname}}</p>
                </template>
            </paper-material>
            <paper-drawer-panel id="paperDrawerPanel" drawer-width="200px" transition="true">
                <paper-header-panel drawer="">
                    <paper-toolbar id="drawerToolbar" shadow="">
                        <div class="title-bar-fonting">
                            <span>yummlet</span> <span class="yummlet-pos-text">TERMINAL</span>
                            <div class="paper-font-subhead" style="font-size:xx-small">EASY TO RUN A PLACE.</div>
                        </div>
                    </paper-toolbar>
                    <!-- Menus go here -->
                    <paper-menu class="list" attr-for-selected="data-route" selected="{{route}}">
                        <paper-submenu>
                            <paper-button class="menu-trigger nobutton" data-route="/businesses" data-leave-drawer-open="" on-click="onRouteClick">
                                <iron-icon icon="communication:business"></iron-icon>
                                <span>My businesses</span>
                            </paper-button>
                            <paper-menu class="menu-content">
                                <template is="dom-repeat" items="{{businesses}}" as="business">
                                    <paper-icon-item on-click="onRouteClick" style="text-align:right">
                                        <span style="text-transform: capitalize; padding:10px">{{business.fullname}}</span>
                                        <template is="dom-if" if="{{business.onLocation}}">
                                            <iron-icon icon="maps:place" item-icon=""></iron-icon>
                                        </template>
                                    </paper-icon-item>
                                </template>
                            </paper-menu>
                        </paper-submenu>
                        <template is="dom-repeat" items="{{menuItems}}">
                            <template is="dom-if" if="{{item.sectionHeader}}">
                                <div class="separator"></div>
                                <p class="menu-heading">{{item.sectionHeader}}</p>
                            </template>
                            <paper-button class="nobutton" data-route="{{item.route}}" on-click="onRouteClick">
                                <paper-icon-item>
                                    <iron-icon id="{{item.id}}" icon="{{item.icon}}" item-icon=""></iron-icon>
                                    <paper-badge id="{{item.badgeid}}" for="{{item.id}}" label="{{item.badgeLabel}}" hidden$="{{!item.badgeLabel}}"></paper-badge>
                                    <span>{{item.label}}</span>
                                </paper-icon-item>
                            </paper-button>
                        </template>
                    </paper-menu>
                </paper-header-panel>
                <paper-header-panel main="" shadow="true">
                    <paper-toolbar id="mainToolbar">
                        <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle=""></paper-icon-button>
                        <span class="flex"></span>
                        <paper-icon-button icon="communication:business" on-click="onBusinessesClick" id="businessListButton"></paper-icon-button>
                        <paper-icon-button icon="account-circle" on-click="onRouteClick" data-route="/account" id="accountButton"></paper-icon-button>
                        <paper-icon-button icon="refresh" on-click="onRefresh"></paper-icon-button>
                    </paper-toolbar>
                    <div class="content">
                        <pos-view businesses="{{businesses}}" business="{{business}}"></pos-view>
                    </div>
                </paper-header-panel>
            </paper-drawer-panel>
            <!-- Uncomment next block to enable Service Worker support (1/2) -->
            <!--
        <paper-toast id="caching-complete"
                     duration="6000"
                     text="Caching complete! This app will work offline.">
        </paper-toast>

        <platinum-sw-register auto-register
                              clients-claim
                              skip-waiting
                              on-service-worker-installed="displayInstalledToast">
          <platinum-sw-cache default-cache-strategy="fastest"
                             cache-config-file="cache-config.json">
          </platinum-sw-cache>
        </platinum-sw-register>
        -->
        </div>
    </template>
    <script>
        Polymer({
            is: "yummlet-pos",
            properties: {
                route: {
                    type: String,
                    notify: true,
                    value: function () { return '/open-orders'; }
                },
                menuItems: {
                    type: Array,
                    notify: true,
                },
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    value: function () { return []; }
                }
            },
            created: function () {
                window.writeToScreen = function (msg) {
                    this.async(function () {
                        this.writeToScreen(msg);
                    }.bind(this));
                }.bind(this);
                PubSub.subscribe('app.scrollToTop', this.async(function () {
                    this.scrollPageToTop();
                }.bind(this)));
            },
            ready: function () {
            },
            attached: function () {
                app = this;
                this.async(function () {
                    this.menuItems = this.populateMenu();
                }.bind(this));
                this.onSessionChange();
                PubSub.subscribe('User.logged', this.onSessionChange.bind(this));

                //initial businesses update:
                PubSub.subscribe('Business.received', this.updateBusinesses.bind(this));
                PubSub.subscribe('Menu.received', this.updateMenu.bind(this));

                this.onTabsChange();
                PubSub.subscribe('Tab', this.onTabsChange.bind(this));
                PubSub.subscribe('Locals', this.onTabsChange.bind(this));
                PubSub.subscribe('Business.received', this.onTabsChange.bind(this));
                PubSub.subscribe('User.logged.in', this.onLoginSuccess.bind(this));
                $('html').click(function (event) { // this is so that menus are closed automatically on click elsewhere
                    this.onClickEvent(event);
                }.bind(this));
                this.businesses = CommonModule.modules.business.getAll();

                PubSub.publish('App.ready');
            },
            onLoginSuccess: function () {
                var name = CommonModule.modules.user.current.profile().name;
                name = name ? ', ' + name : '';
                window.writeToScreen('Welcome to yummlet POS' + name);
            },
            writeToScreen: function (msg) {
                if (!_.isString(msg)) return;
                this.$.toast2.duration = 3000 + msg.length * 50;
                this.$.toast2.text = msg;
                this.$.toast2.show();
            },
            onTabsChange: function () {
                var elem = this.querySelector('#openorders-badge');
                if (!elem)
                    return setTimeout(this.onTabsChange.bind(this), 1000);
                elem.label = CommonModule.modules.tab.getCount();
            },
            onSessionChange: function () {
                var color = CommonModule.modules.user.current.is() ? 'green' : 'white';
                this.$.accountButton.style.color = color;
            },
            updateBusinesses: function (msg, business) {
                if (!this.business || !this.business.placeid || business.locals.selected)
                    this.business = business;
                var index = _.findIndex(this.businesses, function (b) { return b.placeid == business.placeid; });
                if (index < 0)
                    this.push('businesses', business);
                else
                    this.splice('businesses', index, 1, business);
            },
            updateMenu: function (msg, menu) {
                var businessIndex = _.findIndex(this.businesses, function (b) { return b.placeid == menu.placeid; });
                if (businessIndex < 0) return;
                var menuIndex = _.findIndex(this.businesses[businessIndex].menus, function (m) { return m.name == menu.name; });
                var path = 'businesses.' + businessIndex + '.menus';
                console.log('attempting to alter ' + path);
                if (menuIndex > -1)
                    return this.splice(path, menuIndex, 1, menu);
                return this.push(path, menu);
            },
            displayInstalledToast: function () {
                // Check to make sure caching is actually enabledâit won't be in the dev environment.
                if (!document.querySelector('platinum-sw-cache').disabled) {
                    document.querySelector('#caching-complete').show();
                }
            },
            // Close drawer after menu item is selected if drawerPanel is narrow
            onDataRouteClick: function (event) {
                var drawerPanel = document.querySelector('#paperDrawerPanel');
                if (drawerPanel.narrow && (!event || !event.leaveDrawerOpen)) {
                    drawerPanel.closeDrawer();
                }
            },

            // Scroll page to top and expand header
            scrollPageToTop: function () {
                var headerPanel = document.querySelector('paper-header-panel[main]');
                if (headerPanel) {
                    headerPanel.$.mainContainer.scrollTop = 0;
                }
            },
            onRefresh: function () {
                CommonModule.refresh();
            },
            onRouteClick: function (event) {
                if (event.target.id == 'checkboxContainer') return;
                var route, leaveDrawerOpen;
                if (event.model && event.model.business)
                    route = event.model.business.locals.route;
                else if (event.model && event.model.item) {
                    route = event.model.item.route;
                    leaveDrawerOpen = event.model.item.leaveDrawerOpen;
                }
                else
                    route = event.currentTarget.attributes['data-route'].nodeValue;
                leaveDrawerOpen = leaveDrawerOpen || event.currentTarget.attributes['data-leave-drawer-open']
                this.onRouteClickAux(route, leaveDrawerOpen);
            },

            onRouteClickAux: function (route, leaveDrawerOpen) {
                this.onDataRouteClick({ leaveDrawerOpen: leaveDrawerOpen });
                page(route);
            },
            populateMenu: function () {
                return [
                    {
                        label: 'Register',
                        id: 'register',
                        route: '/register',
                        icon: 'maps:local-atm',
                        sectionHeader: 'Orders',
                    },
                    {
                        label: 'Floor map',
                        id: 'floormap',
                        route: '/floormap',
                        icon: 'maps:map',
                    },
                    {
                        label: 'Open orders',
                        id: 'openorders',
                        route: '/open-orders',
                        icon: 'receipt',
                        badgeLabel: '0',
                        badgeid: 'openorders-badge'
                    },
               {
                   label: 'Order history',
                   id: 'orderhistory',
                   route: '/order-history',
                   icon: 'history',
               },

               {
                   label: 'Inventory',
                   id: 'inventory',
                   route: '/inventory',
                   icon: 'assignment',
                   sectionHeader: 'Inventory',
               },
               {
                   label: 'Menus',
                   id: 'menus',
                   route: '/menus',
                   icon: 'chrome-reader-mode',
                   sectionHeader: 'CONTENT MANAGEMENT',
               },
               {
                   label: 'Gallery',
                   id: 'gallery',
                   route: '/gallery',
                   icon: 'image:photo-library',
               },
               {
                   label: 'Reviews',
                   id: 'reviews',
                   route: '/reviews',
                   icon: 'maps:rate-review',
               },
              {
                  label: 'Membership',
                  id: 'membership',
                  route: '/membership',
                  icon: 'card-membership',
              },
                {
                    label: 'Sync social media',
                    id: 'socialmedia',
                    route: '/socialmedia',
                    icon: 'social:share',
                    sectionHeader: 'Account',
                },
               {
                   label: 'Settings',
                   id: 'settings',
                   route: '/settings',
                   icon: 'settings',
               },
                {
                    label: 'Account',
                    id: 'account',
                    route: '/account',
                    icon: 'account-circle',
                },
                {
                    label: 'Log out',
                    id: 'logout',
                    route: '/logout',
                    icon: 'power-settings-new',
                }];
            },
            ///////////////////////////////////
            onBusinessesClick: function (event) {
                if (this.$.businessList.hidden) {
                    var position = $(this.$.businessListButton).offset();
                    var top = position.top + 1.05 * $(this.$.businessListButton).height();
                    
                    this.$.businessList.style.top = top + 'px';
                    this.$.businessList.style.right = '20px';
                    this.$.businessList.hidden = false;

                    event.stopPropagation();
                    event.cancelBubble = true;

                }
            },
            getBusinessListItemStyle: function(business, current_business){
                if (business === current_business)
                    return 'font-weight: bold; color: cornflowerblue';
                return 'font-weight: regular; color: darkgray';
            },
            onBusinessSelect: function (event) {
                this.business = event.model.business_from_list;
                console.log('business ' + this.business.name+ 'selected');

                this.businesses.forEach(function (b) {
                    b.locals.selected = false;
                });
                this.business.locals.selected = true;
            },
            onClickEvent: function (event) {
                this.$.businessList.hidden = true;
            },
        });
    </script>
</dom-module>
<dom-module id="ssn-input" assetpath="../../web.common/elements/">
    <template>
        <style>
            :host {
                display: inline-block;
            }

            input[is="iron-input"] {
                font: inherit;
                outline: none;
                box-shadow: none;
                border: none;
                width: auto;
                text-align: center;
            }
        </style>
        <div class="horizontal layout" on-click="onInputClick">
            <input class="flex" id="ssn1id" style="margin-left:25%" type="text" is="iron-input" mxlength="{{mxlength}}" bind-value="{{ssn1}}" size="{{mxlength}}" on-input="onSSN1Input">
            <span style="margin: auto 15px"> - </span>
            <input class="flex" id="ssn2id" style="margin-right:25%" type="text" is="iron-input" mxlength="{{mxlength}}" bind-value="{{ssn2}}" size="{{mxlength}}" on-input="onSSN2Input">
        </div>
    </template>
    <script>
        Polymer({
            is: 'ssn-input',

            properties: {
                value: {
                    notify: true,
                    type: String
                },

                ssn1: {
                    type: String,
                    notify: true,

                },

                ssn2: {
                    notify: true,
                    type: String
                },
                mxlength: {
                    notify: true,
                    type: Number
                },
            },

            observers: [
              '_computeValue(ssn1,ssn2)'
            ],
            onSSN1Input: function (event) {
                if (this.ssn1.length > this.mxlength) {
                    var p1 = this.ssn1.substring(0, this.mxlength);
                    var p2 = this.ssn1.substring(this.mxlength);
                    this.ssn1 = p1;
                    this.ssn2 = p2;
                    this.$.ssn2id.focus();
                }
            },
            onSSN2Input: function (event) {
                if (this.ssn2.length == 0)
                    this.$.ssn1id.focus();
                else if (this.ssn2.length > this.mxlength)
                    this.ssn2 = this.ssn2.substring(0, this.mxlength);

            },
            onInputClick: function () {
                idInFocus = document.activeElement.id;
                if (idInFocus != 'ssn1id' && idInFocus != 'ssn2id')
                    this.$.ssn1id.focus();
            },
            _computeValue: function (ssn1, ssn2) {
                this.value = ssn1.trim() + ssn2.trim();
            }
        });
    </script>
</dom-module>
<dom-module id="account-login" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            .login-links {
                text-align: center;
                font-size: medium;
                font-stretch:expanded;
            }

            a:link, a:visited {
                color: cornflowerblue;
            }
            paper-material {
                background-image: radial-gradient(rgba(255,255,255,1), rgba(255,255,255,0.9)), url("/public/images/social-media.jpg");
                background-size: cover;
                margin-left:0;
                margin-right:0;
           }
            paper-button#fb-login-button {
                color:white;
                background-color:rgb(58,86,156);
                background-image: url("/public/images/facebook_logo.png");
                background-repeat:no-repeat;
                background-size:32px 32px;
                background-position:5px center;
            }

            paper-button#gsignin2 {
                background-color:white;
                background-image: url("/public/images/google_logo.png");
                background-repeat:no-repeat;
                background-size:32px 32px;
                background-position:5px center;

            }
            paper-button > span {
                margin-left:28px;
            }
            .g-recaptcha {
                left: 0;
                right: 0;
                margin: auto;
            }
            .login-links > span {
                margin: auto 5px;
                font-size: 0.7em;
            }
        </style>
        <paper-toast id="toast1" text="{{toastText}}"></paper-toast>
        <paper-material elevation="1" style="min-width:300px;">
            <iron-pages id="pages" style="width:100%; height:auto" selected="{{mode}}">
                    <div>
                        <form is="iron-form" id="reset" method="post" action="{{getUserTypedUrl(route, '/reset')}}" with-credentials="" on-iron-form-response="onResetResponse" on-iron-form-error="onResetError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">RESET PASSWORD</div>
                            <paper-input id="username" name="username" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="login" method="post" action="{{getUserTypedUrl(route, '/yummlet')}}" with-credentials="" on-iron-form-response="onLoginResponse" on-iron-form-error="onLoginError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">LOGIN</div>
                            <paper-input id="username" name="username" type="email" error-message="Invalid email address or password" required="" label="Email" readonly="{{requireCodeOnLogin}}"></paper-input>
                            <paper-input name="password" required="" label="Password" type="password" readonly="{{requireCodeOnLogin}}"></paper-input>
                            <paper-input-container id="logincode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnLogin}}" required="{{requireCodeOnLogin}}">
                                <label>Verification code</label>
                                <ssn-input class="paper-input-input" mxlength="3" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                            </paper-input-container>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <input name="code" type="hidden" required="" value="{{code}}">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap" hidden$="{{loginOnly}}">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="register" method="post" action="{{getUserTypedUrl(route, '/register')}}" with-credentials="" on-iron-form-response="onRegisterResponse" on-iron-form-error="onRegisterError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">REGISTER</div>
                            <input hidden="" name="userRoute" value="{{userRoute}}">
                            <paper-input-container id="regcode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnRegistration}}" required="{{requireCodeOnRegistration}}">
                                <label>Registration code</label>
                                <ssn-input class="paper-input-input" mxlength="4" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                            </paper-input-container>
                            <input name="code" type="hidden" required="" value="{{code}}">
                            <paper-input name="username" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <paper-input auto-validate="" id="password" name="password" required="" label="Password" type="password" allowedpattern="[a-zA-Z0-9]" prevent-invalid-input=""></paper-input>
                            <paper-input auto-validate="" id="passwordCheck" required="" label="Repeat password" type="password" allowedpattern="[a-zA-Z0-9]" prevent-invalid-input=""></paper-input>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="support" method="post" action="{{getUserTypedUrl(route, '/support')}}" with-credentials="" on-iron-form-response="onSupportResponse" on-iron-form-error="onSupportError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">SUPPORT</div>
                            <input hidden="" name="userRoute" value="{{userRoute}}">
                            <paper-input name="name" label="Name"></paper-input>
                            <paper-input name="email" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <gold-phone-input name="phone" label="Phone #" country-code="972" phone-number-pattern="XXX-XXXXXXX">
                            </gold-phone-input>
                            <paper-textarea max-rows="3" required="" name="message" label="How can we help?"></paper-textarea>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <paper-input-container id="socialLoginCode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnRegistration}}">
                                <label>Registration code</label>
                                <ssn-input class="paper-input-input" mxlength="4" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                        </paper-input-container>
                        <br>
                        <div class="login-links layout horizontal wrap">
                            <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                        </div>
                    </div>
                </iron-pages>
            <div hidden$="{{disableSocialLogin}}">
                <h1 class="divider">OR</h1>
                <paper-button raised="" class="blue-300" id="gsignin2" alt="Google sign-in" on-click="onGoogleClick"><span>Sign in with Google</span></paper-button>
                <paper-button raised="" class="blue-300" id="fb-login-button" alt="Facebook sign-in" on-click="onFbLoginClick"><span>Sign in with Facebook</span></paper-button>
            </div>
        </paper-material>
    </template>
    <script>
        var me;
  //////////////// FACEBOOK //////////////////////////
        const BASIC_FB_SCOPES = ['email', 'public_profile'];
        window.fbAsyncInit = function () {
            var appId = 1717407078479612;
            if (_.includes(location.hostname, 'localhost'))
                appId = 1723458884541098;
            FB.init({
                appId: appId,
                cookie: true,  // enable cookies to allow the server to access
                // the session
                xfbml: false,  // parse social plugins on this page
                version: 'v2.5', // use version 2.5
                oauth: true,
                status: true, // check login status
            });
            window.dispatchEvent(new Event('FacebookAuthenticationReady'));
        };

        function fb_login(silent, scopes) {
            scopes = BASIC_FB_SCOPES.concat(scopes || []).join(', ');
            if (silent)
                FB.getLoginStatus(function (response) {
                    if (response.status === 'connected') {
                        // the user is logged in and has authenticated your
                        // app, and response.authResponse supplies
                        // the user's ID, a valid access token, a signed
                        // request, and the time the access token 
                        // and signed request each expire
                        //var uid = response.authResponse.userID;
                        //var accessToken = response.authResponse.accessToken;
                        FBUserHasLoggedIn(response);
                    } else
                        fb_login_aux();
                });
            else
                fb_login_aux();

            function fb_login_aux(){
                FB.login(function (response) {
                    FBUserHasLoggedIn(response);
                }, {
                    scope: scopes
                });
            }
        }

        function FBUserHasLoggedIn(response) {
            window.dispatchEvent(new Event('FacebookAuthenticationOK'));

            if (response.authResponse && response.status == 'connected') {
                access_token = response.authResponse.accessToken; //get access token
                user_id = response.authResponse.userID; //get FB UID

                FB.api('/me', function (response) {
                    email = response.email; //get user email
                    name = response.name;
                    username = response.id;
                    FB.api(
                        "/" + username + "/picture?type=large",
                        function (response) {
                            if (response && !response.error) {
                                var image = response.data.url;
                            }
                            CommonModule.modules.user.authenticateSocialLogin({
                                token: access_token,
                                username: username,
                                name: name,
                                email: email,
                                image: image,
                                how: 'fb',
                                route: CommonModule.ROUTE(),
                                code: me.code
                            });
                        }
                    );

                });
            }
        }
    </script>
    <script>
 //////////////// GOOGLE //////////////////////////

        function signInCallback(googleUser) {
            var auth2 = gapi.auth2.getAuthInstance();
            // Listen for sign-in state changes.
            auth2.isSignedIn.listen(signinChanged);

            var profile = googleUser.getBasicProfile();
            profile = {
                username: profile.getId(), // Do not send to your backend! Use an ID token instead.
                token: googleUser.getAuthResponse().id_token,
                name: profile.getName(),
                image: profile.getImageUrl(),
                email: profile.getEmail()
            };
            profile.how = 'google';
            profile.route = CommonModule.ROUTE();
            profile.code = me.code;
            CommonModule.modules.user.authenticateSocialLogin(profile);
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            });
        }
        function signinChanged(p1, p2, p3) {
            if (!auth2.isSignedIn.get())
                CommonModule.modules.user.logOutDone();
        }
        function google_login(silent) {
            var options = {};
            if (silent)
                options = { prompt: 'none' };
            auth2.signIn(options).then(function (a) {
                if (auth2.isSignedIn.get()) {
                    var googleUser = auth2.currentUser.get();
                    signInCallback(googleUser);
                }
            });
        }

        function startGoogle() {
            gapi.load('auth2', function () {
                auth2 = gapi.auth2.init({
                    client_id: '910047896261-grc6aga31tgfs50i2h433ubbtt8ijnfa.apps.googleusercontent.com',
                    // Scopes to request in addition to 'profile' and 'email'
                    //scope: 'additional_scope'
                });
                // Listen for sign-in state changes.
                window.dispatchEvent(new Event('GoogleAuthenticationReady'));
            });
        }

        function onFailure(error) {
            console.log(error);
        }
    </script>
    <script>
        //////////// RECAPTCHA ////////////////
        function onRecaptchaLoad() {
            var captchas = document.querySelectorAll('.g-recaptcha');
            _.forEach(captchas, function (captcha) {
                grecaptcha.render(captcha, {
                    sitekey: '6LccpRATAAAAALgLw7C6sFyMjA-3ckACE7ggOEf4',
                    callback: onRecaptchaSuccess,
                    size: getCaptchaSize()
                });
            });
            window.dispatchEvent(new Event('RecaptchaReady'));
        }
        function onRecaptchaSuccess(response) {
            var captchas = document.querySelectorAll('.other-recaptcha');
            _.forEach(captchas, function (captcha) {
                captcha.value = response;
            });

            hideAllRecaptchas();
            var elem = $('account-login');
            elem[0].onSubmit();
        }

        function hideAllRecaptchas() {
            var captchas = document.querySelectorAll('.g-recaptcha');
            _.forEach(captchas, function (captcha) {
                captcha.hidden = true;
            });
        }
        function getCaptchaSize() {
            return window.innerWidth < 500 ? 'compact' : 'normal';
        }
    </script>
    <script>
        var SOCIAL_LOGIN_ATTEMPT = 'Attempting authentication using ';
        var GOOGLE = 'Google';
        var FACEBOOK = 'Facebook';
        var captcha_activated = false;
        var fb_activated = false;
        var google_activated = false;
        Polymer({
            is: "account-login",
            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],
            properties: {
                mode: {
                    type: Number,
                    notify: true,
                    value: function () { return 1; }
                },
                toastText: {
                    type: String,
                    notify: true
                },
                showCaptcha: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false;}
                },
                requireCodeOnRegistration: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false;}
                },
                requireCodeOnLogin: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                code: {
                    type: String,
                    notify:true
                },
                loginOnly: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                disableSocialLogin: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                bg: {
                    type: String,
                    notify: true,
                    value: function () { return null; }
                },
                route: {
                    type: String,
                    notify:true,
                }
            },
            created: function(){
                ////////// SUBSCRIBE TO SOCIAL LOGINS ////////////
                PubSub.subscribe('Activate.google',function(){ 
                    this.async(function () {
                        //TODO: test this
                        this.onGoogleLogin.apply(this, true);
                    }.bind(this));
                }.bind(this));
                PubSub.subscribe('Activate.fb', function(msg, data){ 
                    this.async(function () {
                        // data = [silent, scopes]
                        this.onFbLogin.apply(this, data);
                    }.bind(this));
                }.bind(this));
                PubSub.publish('SocialLogin.listening');
                /////////////////////////////////////////////////

            },
            ready: function () {
                this.$.password.validate = this.validatePassword.bind(this);
                this.$.passwordCheck.validate = this.validatePasswordCheck.bind(this);
                PubSub.subscribe('User.logged.social.fail', this.onSocialLoginFailed.bind(this));
            },
            attached: function () {
                var children = $("form").children();
                _.forEach(children, function (child) {
                    if (_.includes(child.nodeName.toLowerCase(), 'input'))
                        child.onkeypress = function (event) {
                            if (event.which == 13) {
                                event.preventDefault();
                                this.onSubmit();
                            }
                        }.bind(this);
                }.bind(this));

                me = this;

                if (this.bg) {
                    var i,
                        tags = document.querySelectorAll("paper-material");
                    for (i = 0; i < tags.length; i++) {
                        tags[i].style.background = this.bg;
                    }
                }
                if (CommonModule.modules.user.shouldLoad.fb && !fb_activated)
                    this.onFbLogin(true);
                if (CommonModule.modules.user.shouldLoad.google && !google_activated)
                    this.onGoogleLogin(true);

                var links = this.querySelectorAll('.login-links');
                _.forEach(links, function (link) {
                    link.tabIndex = -1;
                });

                this.route = CommonModule.ROUTE();
                PubSub.publish('account-login.ready');
            },
            getUserTypedUrl: function (route, subroute) {
                if (!route) return;
                return '/login' + route + subroute;
            },
            onFbLoginClick: function () {
                this.onFbLogin(false);
            },
            onFbLogin: function (silent, scopes) {
                window.writeToScreen(SOCIAL_LOGIN_ATTEMPT + FACEBOOK);
                if (!fb_activated) {
                    fb_activated = true;
                    var fsignin = document.createElement('script');
                    fsignin.setAttribute("src", "//connect.facebook.net/en_US/sdk.js");
                    this.appendChild(fsignin);
                    window.addEventListener('FacebookAuthenticationReady', this.onFbLogin.bind(this, silent, scopes));
                }
                else
                    fb_login(silent, scopes);
            },
            activateCaptcha: function (callback) {
                if (captcha_activated) return;
                captcha_activated = true;
                var captcha = document.createElement('script');
                captcha.setAttribute("src", "//www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit");
                this.appendChild(captcha);
                window.addEventListener('RecaptchaReady', callback);
            },
            onGoogleClick: function (event, silent) {
                this.onGoogleLogin(false);
            },
            onGoogleLogin: function (silent) {
                window.writeToScreen(SOCIAL_LOGIN_ATTEMPT + GOOGLE);

                if (!google_activated) {
                    google_activated = true;
                    var gsignin = document.createElement('script');
                    gsignin.setAttribute("src", "//apis.google.com/js/client:platform.js?onload=startGoogle");
                    this.appendChild(gsignin);
                    window.addEventListener('GoogleAuthenticationReady', this.onGoogleLogin.bind(this, silent));
                }
                else
                    google_login(silent);
            },
            onRegister: function () {
                this.mode = 2;
            },
            onLogin: function () {
                this.mode = 1;
            },
            onSupport: function(){
                 this.mode = 3
            },
            onReset: function () {
                this.mode = 0;
            },
            onSubmit: function () {
                var formName = (function () {
                    switch (this.mode) {
                        case 0: return 'reset';
                        case 1: return 'login';
                        case 2: return 'register';
                        case 3: return 'support';
                    }
                }.bind(this))();
                if (this.validateCaptcha(formName)) {
                    document.getElementById(formName).submit();
                }
            },
            onSubmitted:function(){
                this.disableAllSubmitButtons(true);
            },
            validateCaptcha: function (formName) {
                if (!this.showCaptcha)
                    return true;

                switch (formName) {
                    case 'support':
                        return true;
                }


                // all values are set at once therefore there is only need to check one of them
                var valid = document.querySelector('.other-recaptcha').value;
                if (!valid)
                {
                    this.toastText = "Please fill out the captcha";
                    this.$.toast1.show();
                }
                return valid;
            },

            disableAllSubmitButtons: function(disable){
                var buttons = document.querySelectorAll('.submit-button');
                _.forEach(buttons, function (b) {
                    b.disabled = disable;
                });
            },
            onLoginResponse: function (event, data) {
                CommonModule.modules.user.loggedIn(data.response);
                this.disableAllSubmitButtons(false);
            },
            onLoginError: function (event, data) {
                var status = this.handleError(event, data);
                if(status == 401)
                    this.$.username.invalid = true;
                else if(status == 449)
                {
                    this.requireCodeOnLogin = true;
                    this.$.logincode.invalid = true;
                }
            },
            onRegisterResponse: function (event, data) {
                this.toastText = "Thank you! A confirmation mail has been sent to your account.";
                this.$.toast1.show(function () {
                    page('/');
                });
                this.disableAllSubmitButtons(false);
            },
            onRegisterError: function (event, data) {
                var status = this.handleError(event, data);
                if (status == 403) {
                    this.toastText = "Sorry, username taken. Please try another one.";
                    this.$.toast1.show();
                }
            },
            onResetResponse: function (event, data) {
                this.toastText = "Check your inbox for further instructions.";
                this.$.toast1.show(function () {
                    page('/');
                });
                this.disableAllSubmitButtons(false);
            },
            onResetError: function (event, data) {
                this.handleError(event, data);
            },
            onSupportResponse: function (event, data) {
                this.toastText = "Thanks, we'll contact you shortly";
                this.$.toast1.show();
                this.disableAllSubmitButtons(false);
            },
            onSupportError: function (event, data) {
                var status = this.handleError(event, data);
            },
            handleError: function (event, data) {
                var status = data.status || parseInt(data.error.message.match(/(\d+).*/)[1]);

                this.disableAllSubmitButtons(false);

                if (status == 500 || status == 503) {
                    this.toastText = "We encountered a problem. Please try again later.";
                    this.$.toast1.show();
                }
                else if (status == 406) {
                    this.toastText = "There was a reCAPTCHA error. Please try again.";
                    this.$.toast1.show();
                }
                else if (status == 429) {
                    this.showCaptcha = true;
                    this.activateCaptcha(function () {
                        this.validateCaptcha();
                    }.bind(this));
                }

                return status;
            },
            onSocialLoginFailed: function (msg, status) {
                var msg = "Sorry, we're experiencing technical difficulties"
                var requireCode = this.requireCodeOnRegistration
                switch (status) {
                    case 412:
                        msg = "Activation is required";
                        break;
                    case 423:
                        msg = "Expecting password change";
                        requireCode=false;
                        break;
                    case 401:
                        msg = "Incorrect username/password";
                        break;
                    case 403:
                        msg = "Account is inactive";
                        requireCode=false;
                        break;
                    default:
                        msg = "Failed to verify authentication."
                }
                if (requireCode) {
                    this.mode = 4;
                    var valid = !this.requireCodeOnRegistration || this.$.socialLoginCode.value;
                    this.$.socialLoginCode.invalid = !valid;
                }
                this.toastText = msg;
                this.$.toast1.show();
            },
            validatePasswordCheck: function () {
                if (this.$.password.invalid) return false;
                this.$.passwordCheck.errorMessage = "Password mismatch";
                this.$.passwordCheck.invalid = this.$.password.value != this.$.passwordCheck.value;
                return !this.$.passwordCheck.invalid;

            },
            validatePassword: function () {
                var numerals = /(?=.*\d+)/;
                var letters = /(?=.*[a-zA-Z]+)/;
                var length = /.{6,18}/;

                var invalid = true;
                var err;
                if (!numerals.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must contain at least one digit';
                else if (!letters.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must contain at least one letter';
                else if (!length.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must be at between 6-18 characters long';
                else
                    invalid = false;
                this.$.password.invalid = invalid;
                this.disableAllSubmitButtons(!invalid);
                return !invalid;
            },
        });

    </script>
</dom-module>
<dom-module id="account-logout" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
        </style>
        <div class="layout vertical center">
            <iron-image class="circular-avatar-big" sizing="cover" preload="" fade="" src="{{profilePicture}}"></iron-image>
            <paper-material>
                <h4>Welcome <span>{{profile.name}}</span>,</h4>
                <p>{{getConnectionMethod(profile)}}</p>
                <paper-button raised="" class="blue-300" on-click="onLogOut" style="display:block">log out</paper-button>
            </paper-material>
        </div>
    </template>
    <script>
        Polymer({
            is: "account-logout",
            properties: {
                profilePicture: {
                    type: String,
                    notify: true,
                    value: function () { return "";}
                },
                profile: {
                    type: Object,
                    notify: true,
                    value: function () { return {}; }
                }
            },
            ready: function () {
            },
            attached: function () {
                PubSub.subscribe('User.logged.in', this.updateValues.bind(this));
                this.updateValues();
            },
            updateValues: function () {
                if (!CommonModule.modules.user.current.is()) return;
                this.profile = CommonModule.modules.user.current.profile();
                this.profilePicture = CommonModule.modules.user.current.image();
                },
            onLogOut: function(){
                CommonModule.modules.user.logOut();
            },
            getConnectionMethod: function () {
                if (!CommonModule.modules) return;
                return "You're currently signed in using " + CommonModule.modules.user.current.friendlyHow();
            }
        });

    </script>
</dom-module>
<dom-module id="account-manager" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
           paper-dialog{
               padding: 0;
               margin:auto 30px;
               max-width: 500px;
               --paper-dialog-background-color:rgba(230,230,230,0.5);
           }
        </style>
        <paper-dialog id="accountDialog" modal="" auto-fit-on-attach="" no-cancel-on-esc-key="" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
            <account-login require-code-on-registration=""></account-login>
        </paper-dialog>
    </template>
    <script>
        Polymer({
            is: "account-manager",
            properties: {
                isLoggedIn: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                backdrop: {
                    type: String,
                    notify: true
                },
                backdropElement: {
                    type: Object,
                    notify: true
                }
            },
            ready: function () {
                PubSub.subscribe('User.logged', this.onSessionChange.bind(this));
                $('body').bind("cut copy paste", function (e) {
                    if (!CommonModule.modules.user.current.is())
                        e.preventDefault();
                }.bind(this));
            },
            attached: function () {
                this.setupBackdrop();
                this.onSessionChange();
            },
            setupBackdrop: function () {
                if (this.backdrop) {
                    this.backdropElement = $(this.backdrop)[0];
                    console.log('BACKDROP After assignment: ' + this.backdropElement);

                    this.backdropElement.ontouchstart = function (e) {
                        if (!CommonModule.modules.user.current.is())
                            e.preventDefault();
                    };
                    this.backdropElement.ontouchmove = function (e) {
                        if (!CommonModule.modules.user.current.is())
                            e.preventDefault();
                    }
                }
                else
                    console.log('BACKDROP NOT SET!!!');
            },
            toggleBackdropState: function(){
                if (this.backdrop) {
                    this.toggleClass('blurred', !this.isLoggedIn, this.backdropElement);
                    this.backdropElement.disabled = !this.isLoggedIn;
                    var dialog = this.$.accountDialog;
                    if (!this.isLoggedIn)
                        dialog.open();
                    else
                        dialog.close();
                }
            },
            onSessionChange: function (msg, value) {
                if (!CommonModule.modules) return;
                this.isLoggedIn = CommonModule.modules.user.current.is();
                this.toggleBackdropState();
            },
        });

    </script>
</dom-module>
<dom-module id="x-select" assetpath="../../web.common/elements/dropdown/">
  <style>
    :host {
      display: block;
      margin: 0;
      padding:0;
      width:100%;
    }
  </style>
  <template>
    <div on-click="open">
      <content select=".dropdown-trigger"></content>
    </div>
    <iron-dropdown id="dropdown" vertical-align="[[verticalAlign]]" horizontal-align="[[horizontalAlign]]" disabled="[[disabled]]" open-animation-config="[[openAnimationConfig]]" close-animation-config="[[closeAnimationConfig]]" on-click="open">
      <content select=".dropdown-content"></content>
    </iron-dropdown>
  </template>
  <script>
    Polymer({
      is: 'x-select',

      properties: {
        verticalAlign: String,
        horizontalAlign: String,
        disabled: Boolean,
        openAnimationConfig: {
          type: Array,
          value: function() {
            return [{
              name: 'fade-in-animation',
              timing: {
                delay: 150,
                duration: 50
              }
            }, {
              name: 'expand-animation',
              timing: {
                delay: 150,
                duration: 200
              }
            }];
          }
        },

        closeAnimationConfig: {
          type: Array,
          value: function() {
            return [{
              name: 'fade-out-animation',
              timing: {
                duration: 200
              }
            }];
          }
        }
      },

      open: function () {
        if(this.$.dropdown.__data__.opened)
            this.$.dropdown.close();
        else
            this.$.dropdown.open();
      }
    });
  </script>
</dom-module>
<dom-module id="guest-check-pos" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
ï»¿.table { 
    position: relative;
    max-width: 100%;
    table-layout: fixed;
    width:100%;
    height:100%;
    display: table;    
    border: 1px solid lightblue;

}
.row {
    width:100%; 
    display: table-row;  
    border: 1px solid lightblue;
}
.cell { 
    display: table-cell;
    border: 1px solid lightblue;
    white-space: nowrap;
    overflow: hidden;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    max-height: 25px;
    min-height: 25px;
    height: 25px;
    vertical-align:middle;
}

.cell:nth-child(2n+1) {
    text-align: center;
    overflow: visible;
    width:25%;
}

</style>
        <style>
ï»¿.check {
    min-width: 100px;
    min-height: 300px;
    height: 92%;
    color: lightblue;
    font-family: 'Times New Roman', Times, serif;
}

.check-body {
    text-align: left;
    background-color: rgb(217,241,225);
}
.check-footer {
    height: 100%;
}

table, tr, td, tfoot {
    border: 1px solid lightblue;
    border-collapse: collapse;
}

.details-table {
    text-align: center;
    width: 95%;
    left: 0;
    right: 0;
    margin: auto;
    font-size: 0.4rem;
}

.serial-number {
    font-size: 2.4em;
    color: red;
    font-family: "Courier New", Courier, monospace;
}

.handwriting {
    text-align: center;
    font-family: 'Fjalla One', sans-serif;
    font-size: 0.8em;
    font-stretch:condensed;
    color:rgb(50,50,50);
    width: 100%;
}

.stam {
    font-size: 0.37em;
    text-align: center;
    width: 100%;
}


table {
    position: relative;
    width: 100%;
    max-width: 100%;
    table-layout: fixed;
}

td {
    display:table-cell;
    white-space: nowrap;
    overflow: hidden;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    max-height: 25px;
    min-height: 25px;
    height: 25px;
    vertical-align:middle;
}

table td > div {
    overflow: visible;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    height: 22px;
}

    tfoot td {
        border: none;
        outline: none;
    }

        tfoot td:nth-child(1) {
            text-align: right;
            font-family: 'Times New Roman', Times, serif;
            font-size: 0.8rem;
            font-weight: bold;
            color: lightblue;
        }

td:nth-child(2n+1) {
    text-align: center;
    overflow: visible;
}

tfoot td:nth-child(2) {
    text-align: center;
    overflow: visible;
}

</style>
        <style>
            iron-icon.small {
                height: 18px;
                width: 18px;
            }

            .check {
                background: white;
                padding: 0;
                height:100%;
            }
        </style>
                <paper-material class="layout vertical check" elevation="1">
                    <paper-spinner id="spinner" hidden=""></paper-spinner>
                    <div class="caption" style="display:block; text-align:center">{{businessName}}</div>
                    <table class="details-table">
                            <tbody><tr>
                                <td>
                                    <div>
                                        Date
                                        <div class="handwriting">{{tab.date}}</div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        Table
                                        <div class="handwriting">{{tab.no}}</div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        Guests
                                        <div class="handwriting">{{tab.dinersCount}}</div>
                                    </div>
                                </td>
                                <td>
                                    <div>
                                        Server
                                        <div class="handwriting">{{tab.server}}</div>
                                    </div>
                                </td>
                                <td colspan="2">
                                    <div>
                                        <div class="serial-number">{{tab.mockSerialNumber}}</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody></table>
                    <div class="stam">
                            APPT-SOUP/SAL-ENTREE-VEG/POT-DESSERT-BEV
                        </div>
                    <div class="flex handwriting check-body layout vertical">
                            <div class="flex" style="position:relative; display:block; max-height: 100%; overflow-y:auto;overflow-x:hidden">
                                <div style="position:absolute;overflow:hidden; max-height:100%">
                                    <div class="table">
                                        <template is="dom-repeat" items="{{DUMMY_ENTRIES}}">
                                            <div class="item-row row">
                                                <div class="cell" width="20%"></div>
                                                <div class="cell" width="60%"></div>
                                                <div class="cell" width="20%"></div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                                <div class="table">
                                    <template is="dom-repeat" items="{{tab.articles}}">
                                        <div class="item-row row">
                                            <div class="cell" width="20%">
                                                <div>
                                                    <iron-icon class="small" style="color:darkgray;cursor:pointer" icon="delete" tag="{{item.uuid}}" on-click="onDeleteArticle"></iron-icon>
                                                </div>
                                            </div>
                                            <div class="cell" width="60%" style="text-align:justify"><div>{{item.name}}</div></div>
                                            <div class="cell" width="20%"><div>{{item.price}}</div></div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div>
                                <table>
                                    <tfoot>
                                        <tr>
                                            <td width="60%">Tax:</td>
                                            <td><div>{{tab.tax}}</div></td>
                                        </tr>
                                        <tr>
                                            <td>Tip:</td>
                                            <td><div>{{tab.tip}}</div></td>
                                        </tr>
                                        <tr>
                                            <td>Total:</td>
                                            <td><div>{{tab.total}}</div></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                    </div>
                </paper-material>
    </template>
    <script>

        Polymer({
            is: "guest-check-pos",
            properties: {
                DUMMY_ENTRIES: {
                    type: Array,
                    readOnly: true,
                    value: function () { return new Array(50); }
                },
                tab: {
                    type: Object,
                    notify: true,
                    observer: 'getBusinessName'
                },
                businessName: {
                    type: String,
                    notify: true,
                }
            },
            ready: function () {
            },
            attached: function () {
            },
            getBusinessName: function (tab) {
                var business = CommonModule.modules.business.get(tab.placeid);
                if (business)
                    this.businessName = business.fullname;
            }
        });

        var computePrice = function (factor, articles) {
            var result = Math.round(_.sum(articles, function (item) {
                return factor * item.price;
            }) * 10) / 10;
            if (!result)
                return "";
            else
                return result;
        }

    </script>
</dom-module>
<dom-module id="business-grid" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
.grid {
    padding: 0;
    -webkit-flex-wrap: wrap; /* Safari 6.1+ */
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-align-content: flex-start;
    -webkit-align-content: flex-start;
    align-content: flex-start;
    justify-content: flex-start;
}

.grid-item-size {
    min-width: 100px;
    width: 100px;
    max-width: 140px;
    min-height: 155px;
    height: 155px;
    max-height: 155px;
}

.grid-item{
        -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
        margin: 1px 1px 5px;
    cursor: pointer;
    -ms-flex: 1 1 100px;
    -webkit-flex: 1 1 100px;
    flex: 1 1 100px;
}



@media (min-width: 641px) {
    .grid-item {
        min-width: 100px;
        margin: 5px;
    }

    .grid {
        padding: 10px;
    }
}

.map-info-window {
    min-width: 150px;
    min-height: 150px;
    max-width: 300px;
    max-height: 300px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}


paper-card {
    text-align: center;
    --paper-card-header-text: {
    text-transform: uppercase;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    font-size: xx-small;
    padding: 5px 0 0;
    margin: 0;
    vertical-align: central;
    font-family: Tahoma;
    font-weight: bold;
    background: linear-gradient(rgba(0,0,0, 0.3),rgba(0,0,0, 0.3));
    width: auto;
    height: 35px;
    bottom: 4px;
    left: 0;
    right: 0;
    color: white;
}

--paper-card-header-image: {
    height: 90px;
    --iron-image-height: 100%;
}

--paper-card-actions: {
    height: 80%;
}

}

.stars, .stars span {
    display: block;
    background: url("../../public/images/small-stars.png") 0 -12px repeat-x;
    width: 60px;
    height: 12px;
}

    .stars span {
        background-position: 0 0;
    }

.stars-div {
    position: absolute;
    top: -0.5px;
}

</style>
        <style>
            div:empty {
                height: 0;
                min-height: 0;
                padding: 0;
                margin-top: 0;
                margin-bottom: 0;
                border: none;
            }
            .big-grid-item{
                min-width: 250px;
                width: 250px;
                max-width: 350px;
                min-height: 315px;
                height: 315px;
                max-height: 330px;
                -ms-flex: 1 1 250px !important;
                -webkit-flex: 1 1 250px !important;
                flex: 1 1 250px !important;
            }
            paper-card#container{
                --paper-card-header-image: {
                    height: 265px;
                    --iron-image-height: 100%;
                }
            }
        </style>
                <div class="grid center center-justified">
                    <template is="dom-repeat" items="{{businesses}}" as="business">
                        <paper-card id="container" class="grid-item big-grid-item" heading="{{getName(business)}}" on-click="_onClick" on-mouseover="onMouseOverCard" on-mouseout="onMouseOutOfCard" image="{{business.photo.thumbnail}}" animated-shadow="" elevation="1">
                            <div class="card-content" style="text-align:justify; font-size:xx-small; margin:0; padding: 2px">
                            </div>
                            <div class="card-actions" style="margin:0; padding: 0; max-height:40px" hidden$="{{hideActions}}">
                                <paper-icon-button icon="favorite" toggles="true" title="mark as favorite" active="true"></paper-icon-button>
                                <paper-icon-button icon="bookmark" title="bookmark for later" active="false"></paper-icon-button>
                            </div>
                        </paper-card>
                    </template>
                    <template is="dom-repeat" items="{{PLACEHOLDERS}}">
                        <div class="grid-item big-grid-item"></div>
                    </template>
                </div>
    </template>
    <script>

        var businessHashTable = {}
        Polymer({

            is: 'business-grid',

            properties: {

                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    value: function () { return []; }

                },
                PLACEHOLDERS: {
                    type: Array,
                    notify: true,
                    value: function () { return new Array(20); }
                }

            },
            ready: function () {
            },
            attached: function () {
            },
            getName: function (business) {
                return business.fullname;
            },
            onMouseOverCard: function (event) {
                event.currentTarget.attributes.elevation.value = CARD_HOVER_ELEVATION;
            },
            onMouseOutOfCard: function (event) {
                event.currentTarget.attributes.elevation.value = CARD_ELEVATION;
            },
            _onClick: function (event) {
                var target = event.target;
                if (target.nodeName == "PAPER-ICON-BUTTON" || target.nodeName == "PAPER-RIPPLE")
                    return;
                while (target !== this && !target._templateInstance) {
                    target = target.parentNode;
                }

                var business = event.model.item
                page('/businesses/' + business.placeid);
            },
        });
    </script>
</dom-module>
<dom-module id="business-view" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
        </style>
        <business-grid businesses="{{businesses}}"></business-grid>
    </template>
    <script>
        Polymer({

            is: 'business-view',

            properties: {
                selected: {
                    type: Number,
                    notify: true,
                    value: function () { return 0; }
                },
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    value: function () { return []; }

                }
            },
            ready: function () {
            },
            attached: function () {
            },
        });

    </script>
</dom-module>
<dom-module id="menu-section-pos" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
ï»¿.menu-image {
    position: absolute;
    cursor: pointer;
    height: 150px;
    width: 120px;
    margin: 0;
    padding: 0;
    border: outset 3px goldenrod;
}


.inset-text {
    position: relative;
    top: 10px;
    color: rgba(0,0,0, 0.8);
    font-size: xx-small;
    text-align: center;
    letter-spacing: 3px;
    font-stretch: extra-expanded;
}

.menu-name {
    margin-top: 5px;
    color: gray;
    font-size: medium;
    text-transform: uppercase;
    font-family: 'Fjalla One', sans-serif;
    text-align: center;
}

.message-in-3d {
    position:absolute;
    -moz-transform: rotateX(-30deg);
    -ms-transform: rotateX(-30deg);
    -o-transform: rotateX(-30deg);
    -webkit-transform: rotateX(-30deg);
    transform: rotateX(-30deg);
    text-transform:uppercase;
    color:white;
    font-size:small;
    font-weight:bold;
    left:0;
    right:0;
    margin:auto;
}

.menu-picture {
    position: relative;
    top: 0;
    left: 0;
    right: 0;
    margin: auto;
    padding: 0;
    text-align: center;
    background-repeat: no-repeat;
    border: 1px solid gold;
    min-width: 100px;
    -webkit-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -moz-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -o-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
}

.animatedmenu {
    -moz-transition: background-color .2s ease-in;
    -o-transition: background-color .2s ease-in;
    -webkit-transition: background-color .2s ease-in;
    transition: background-color .2s ease-in;
}

a:link {
    text-decoration: none;
    color: black;
}

a:visited {
    text-decoration: none;
    color: black;
}

a:hover {
    text-decoration: none;
    color: green;
}

a:active {
    text-decoration: none;
    color: green;
}
</style>
        <style>
ï»¿div.stage {
    -moz-perspective: 600px;
    -ms-perspective: 600px;
    -webkit-perspective: 600px;
    perspective: 600px;
}

.css3d {
    -moz-transition-property: transform;
    -o-transition-property: transform;
    -webkit-transition-property: transform;
    transition-property: transform;
    -moz-transition-duration: 0.7s;
    -o-transition-duration: 0.7s;
    -webkit-transition-duration: 0.7s;
    transition-duration: 0.7s;
    -moz-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -ms-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -o-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -webkit-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
}

    .css3d:hover {
        z-index: 1;
        -moz-transition-property: transform;
        -o-transition-property: transform;
        -webkit-transition-property: transform;
        transition-property: transform;
        -moz-transition-duration: 0.7s;
        -o-transition-duration: 0.7s;
        -webkit-transition-duration: 0.7s;
        transition-duration: 0.7s;
        -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -ms-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -o-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-backface-visibility: hidden;
        -webkit-transform: scale(1);
    }

/*
 * Animation for webkit
*/
@-webkit-keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -webkit-transform: translateY(0);
    }

    40% {
        -webkit-transform: translateY(-30px);
    }

    60% {
        -webkit-transform: translateY(-15px);
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -moz-transform: translateY(0);
        -ms-transform: translateY(0);
        -o-transform: translateY(0);
        -webkit-transform: translateY(0);
        transform: translateY(0);
    }

    40% {
        -moz-transform: translateY(-30px);
        -ms-transform: translateY(-30px);
        -o-transform: translateY(-30px);
        -webkit-transform: translateY(-30px);
        transform: translateY(-30px);
    }

    60% {
        -moz-transform: translateY(-15px);
        -ms-transform: translateY(-15px);
        -o-transform: translateY(-15px);
        -webkit-transform: translateY(-15px);
        transform: translateY(-15px);
    }
}

/*
 * Adding the animation to our element
*/
.bounce {
    -webkit-animation-name: bounce;
    -moz-animation-name: bounce;
    -o-animation-name: bounce;
    animation-name: bounce;
}


.glossy {
    -webkit-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -moz-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 20px;
}

    .glossy:after {
        position: absolute;
        content: ' ';
        width: 100%;
        height: 50%;
        top: 0;
        left: 0;
        -webkit-border-radius: 20px;
        -moz-border-radius: 20px;
        border-radius: 20px;
        background: -moz-linear-gradient(top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,.1) 100%);
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.7)), color-stop(100%,rgba(255,255,255,.1)));
        background: linear-gradient(top, rgba(255,255,255,0.7) 0%,rgba(255,255,255,.1) 100%);
    }

</style>
        <style>
            :host {
                display: block;
                text-align: center;
            }

            paper-button {
                display: inline;
                max-width: 50vw;
            }

            .business-name {
                font-size: xx-small;
                text-transform: uppercase;
                font-stretch: extra-expanded;
            }

            .page-caption {
                height: 100%;
                z-index: -1;
            }

            .business-color {
                top: 130px;
                left: 10px;
                width: 20px;
                height: 20px;
                opacity: 0.5;
                margin: auto;
            }

            .add-menu-button {
                box-shadow: 0 0 5px rgba(81, 203, 238, 1) !important;
                border: 2px solid rgba(81, 203, 238, 1) !important;
                background: url("/public/images/add_menu.png");
                background-size: 100% 100%;
                left: 40%;
            }
        </style>
            <template is="dom-repeat" items="{{businesses}}" as="business" index-as="businessIndex">
                <div id="{{business.placeid}}" class="layout vertical center" style="position:relative; margin:50px 0">
                    <div style="position:absolute">
                        <paper-fab class="business-color" mini="" style$="{{getBusinessStyle(business)}}"></paper-fab>
                    </div>
                    <div id="stage" style="margin-top:10vh; width:90%; max-width:600px; height:130px;position:relative">
                        <template is="dom-repeat" items="{{business.menus}}" as="menu">
                            <div class="menu-image css3d glossy hidden-animation" style$="{{getStyle(businessIndex, index,menu.pages.0.thumbnail, menu)}}" on-click="onMenuClick"></div>
                        </template>
                        <div class="menu-image css3d glossy hidden-animation add-menu-button" style$="{{getStyle(businessIndex, business.menus.length, 0)}}" on-click="onAddMenuClick">
                        </div>
                    </div>
                    <img id="shelfImage" src="/public/images/table.png" style="width:90%; max-width:600px; z-index:auto">
                    <span class="business-name">{{business.fullname}}</span>
                </div>
            </template>
    </template>
    <script>
        Polymer({

            is: 'menu-section-pos',
            properties: {
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                },
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange'
                }
            },
            ready: function () {
            },
            attached: function () {
            },
            getStyle: function (businessIndex, index, imgsrc) {
                if (!this.businesses[businessIndex] || !this.businesses[businessIndex].menus) return;
                var itemCount = this.businesses[businessIndex].menus.length + 1;
                var parentWidth = Math.min(document.querySelector('#mainContainer').clientWidth*0.9, 600);
                var v = CommonModule.modules.menu.visual.getMenuSectionItemPosition(parentWidth, itemCount, index);
                if (imgsrc)
                    v += 'background: url("' + imgsrc + '"); background-size: cover;';
                return v;
            },
            onBusinessChange: function () {
                if (this.business.placeid)
                    this.scrollTo(this.business.placeid);
            },
            onMenuClick: function (event) {
                if (event.model.menu.loading)
                    return window.writeToScreen('Menu processing is ongoing...');
                var placeid = this.businesses[event.model.businessIndex].placeid;
                page('/menus/' + placeid + '/' + event.model.menu.name);
            },
            getBusinessStyle: function (business) {
                return 'background-color: ' + business.locals.color;
            },
            onAddMenuClick: function (event) {
                page('/menus/' + event.model.business.placeid + '/add');
            },
            scrollTo: function (placeid) {
                setTimeout(function () {
                    $('#mainContainer').animate({
                        scrollTop: $('#' + placeid).offset().top
                    }, 1000);
                }.bind(this), 250);
            }
        });

    </script>
</dom-module>
<dom-module id="open-orders-view" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
.grid {
    padding: 0;
    -webkit-flex-wrap: wrap; /* Safari 6.1+ */
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-align-content: flex-start;
    -webkit-align-content: flex-start;
    align-content: flex-start;
    justify-content: flex-start;
}

.grid-item-size {
    min-width: 100px;
    width: 100px;
    max-width: 140px;
    min-height: 155px;
    height: 155px;
    max-height: 155px;
}

.grid-item{
        -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
        margin: 1px 1px 5px;
    cursor: pointer;
    -ms-flex: 1 1 100px;
    -webkit-flex: 1 1 100px;
    flex: 1 1 100px;
}



@media (min-width: 641px) {
    .grid-item {
        min-width: 100px;
        margin: 5px;
    }

    .grid {
        padding: 10px;
    }
}

.map-info-window {
    min-width: 150px;
    min-height: 150px;
    max-width: 300px;
    max-height: 300px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}


paper-card {
    text-align: center;
    --paper-card-header-text: {
    text-transform: uppercase;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    font-size: xx-small;
    padding: 5px 0 0;
    margin: 0;
    vertical-align: central;
    font-family: Tahoma;
    font-weight: bold;
    background: linear-gradient(rgba(0,0,0, 0.3),rgba(0,0,0, 0.3));
    width: auto;
    height: 35px;
    bottom: 4px;
    left: 0;
    right: 0;
    color: white;
}

--paper-card-header-image: {
    height: 90px;
    --iron-image-height: 100%;
}

--paper-card-actions: {
    height: 80%;
}

}

.stars, .stars span {
    display: block;
    background: url("../../public/images/small-stars.png") 0 -12px repeat-x;
    width: 60px;
    height: 12px;
}

    .stars span {
        background-position: 0 0;
    }

.stars-div {
    position: absolute;
    top: -0.5px;
}

</style>
        <style>
ï»¿.draggable {
    -webkit-transform: translate(0, 0);
    -moz-transform: translate(0, 0);
    -ms-transform: translate(0, 0);
    -o-transform: translate(0, 0);
    transform: translate(0, 0);
}

</style>
        <style>
/*! jQuery UI - v1.11.4 - 2015-11-30
* http://jqueryui.com
* Includes: core.css, draggable.css, resizable.css, selectable.css, sortable.css
* Copyright jQuery Foundation and other contributors; Licensed MIT */

.ui-helper-hidden{display:none}.ui-helper-hidden-accessible{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.ui-helper-reset{margin:0;padding:0;border:0;outline:0;line-height:1.3;text-decoration:none;font-size:100%;list-style:none}.ui-helper-clearfix:before,.ui-helper-clearfix:after{content:"";display:table;border-collapse:collapse}.ui-helper-clearfix:after{clear:both}.ui-helper-clearfix{min-height:0}.ui-helper-zfix{width:100%;height:100%;top:0;left:0;position:absolute;opacity:0;filter:Alpha(Opacity=0)}.ui-front{z-index:100}.ui-state-disabled{cursor:default!important}.ui-icon{display:block;text-indent:-99999px;overflow:hidden;background-repeat:no-repeat}.ui-widget-overlay{position:fixed;top:0;left:0;width:100%;height:100%}.ui-draggable-handle{-ms-touch-action:none;touch-action:none}.ui-resizable{position:relative}.ui-resizable-handle{position:absolute;font-size:0.1px;display:block;-ms-touch-action:none;touch-action:none}.ui-resizable-disabled .ui-resizable-handle,.ui-resizable-autohide .ui-resizable-handle{display:none}.ui-resizable-n{cursor:n-resize;height:7px;width:100%;top:-5px;left:0}.ui-resizable-s{cursor:s-resize;height:7px;width:100%;bottom:-5px;left:0}.ui-resizable-e{cursor:e-resize;width:7px;right:-5px;top:0;height:100%}.ui-resizable-w{cursor:w-resize;width:7px;left:-5px;top:0;height:100%}.ui-resizable-se{cursor:se-resize;width:12px;height:12px;right:1px;bottom:1px}.ui-resizable-sw{cursor:sw-resize;width:9px;height:9px;left:-5px;bottom:-5px}.ui-resizable-nw{cursor:nw-resize;width:9px;height:9px;left:-5px;top:-5px}.ui-resizable-ne{cursor:ne-resize;width:9px;height:9px;right:-5px;top:-5px}.ui-selectable{-ms-touch-action:none;touch-action:none}.ui-selectable-helper{position:absolute;z-index:100;border:1px dotted black}.ui-sortable-handle{-ms-touch-action:none;touch-action:none}
</style>
        <style>
            :host {
                display: block;
                width: 100%;
                height: calc(100vh - 64px);

                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -khtml-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            .stage {
                display: block;
                overflow-x:auto;
            }
            @media (max-width: 600px) {
                .stage {
                    height: 100%;
                }

            }

            .grid {
                padding: 0;
                -webkit-flex-wrap:nowrap; /* Safari 6.1+ */
                display: flex;
                -ms-flex-wrap: nowrap;
                flex-wrap:nowrap;
                -ms-flex-direction: row;
                -webkit-flex-direction: row;
                flex-direction: row;
                -ms-align-content: flex-start;
                -webkit-align-content: flex-start;
                align-content: flex-start;
                justify-content: flex-start;
                overflow-x:auto;
            }
            .grid-item {
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
                box-sizing: border-box;
                min-width: 250px;
                width: 80vw;
                max-width: 350px;
                height:80vh;
                max-height:600px;
                margin: 35px;
                cursor: pointer;
                -ms-flex: 1 1 auto;
                -webkit-flex: 1 1 auto;
                flex: 1 1 auto;
            }

        </style>
        <span>{{message}}</span>
        <div id="sortable" class="layout horizontal center grid" style="height:100%">
            <template is="dom-repeat" items="{{tabs}}" as="tab">
                <div class="draggable grid-item">
                    <guest-check-pos tab="{{tab}}"></guest-check-pos>
                </div>
            </template>
        </div>
    </template>
    <!-- This affects performance and therefore removed for now
    <script src="../../public/js/interact.min.js"></script>
        -->
    <script>/*! jQuery UI - v1.11.4 - 2015-11-30
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, draggable.js, droppable.js, resizable.js, selectable.js, sortable.js, effect.js, effect-blind.js, effect-bounce.js, effect-clip.js, effect-drop.js, effect-explode.js, effect-fade.js, effect-fold.js, effect-highlight.js, effect-puff.js, effect-pulsate.js, effect-scale.js, effect-shake.js, effect-size.js, effect-slide.js, effect-transfer.js
* Copyright jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,N=e.extend({},y),M=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?N.left-=d:"center"===n.my[0]&&(N.left-=d/2),"bottom"===n.my[1]?N.top-=c:"center"===n.my[1]&&(N.top-=c/2),N.left+=M[0],N.top+=M[1],a||(N.left=h(N.left),N.top=h(N.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](N,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+M[0],p[1]+M[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-N.left,i=t+m-d,s=v.top-N.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:N.left,top:N.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(N,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n
})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data("ui-resizable-alsoresize"),n={},a=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger("start",t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=e.data(this,"selectable-item");s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,"selectable-item");return n?(s=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a>r&&(i=r,r=a,a=i),o>h&&(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1;
i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||a>i.right||i.top>h||o>i.bottom):"fit"===n.tolerance&&(l=i.left>a&&r>i.right&&i.top>o&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",t,{unselected:s.element})}),e(".ui-selecting",this.element[0]).each(function(){var s=e.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",t,{selected:s.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()<o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<o.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()<o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<o.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===s?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===s?t._createTrPlaceholder(t.currentItem,n):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e("<td>&#160;</td>",s.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}});var o="ui-effects-",r=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0>e?0:e>s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&&a.parse(r),l=a.space||"rgba";return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var a,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&&(n=[n,o,r,h],c="array"),"string"===c?this.parse(s(n)||a._default):"array"===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):"object"===c?(n instanceof l?f(u,function(e,t){n[t.cache]&&(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&&s.to){if("alpha"===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&&0>e.inArray(null,d[a].slice(0,3))&&(d[a][3]=1,s.from&&(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&&(o=n[a.cache]||a.to&&a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l("transparent"):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&&(null===o?h[a]=l:(u.mod&&(l-o>u.mod/2?o+=u.mod:o-l>u.mod/2&&(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&&i.push(~~(255*s)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5>=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&&!this[o]&&(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d="array"===r||"object"===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d["object"===r?e:t.idx];null==s&&(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h="alpha"===t?this._hsla?"hsla":"rgba":s,l=this[h](),u=l[i.idx];return"undefined"===o?u:("function"===o&&(n=n.call(this,u),o=e.type(n)),null==n&&i.empty?this:("string"===o&&(a=r.exec(n),a&&(n=u+parseFloat(a[2])*("+"===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r="";if("transparent"!==n&&("string"!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&&1!==n._rgba[3]){for(o="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&o&&o.style;)try{r=e.css(o,"backgroundColor"),o=o.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))
}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,s){t["border"+s+"Color"]=e}),t}},a=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(r),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&&(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&&(o[s]=a));return o}var s=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(r.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr("class")||"",l=h.children?o.find("*").addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&&o[t+"Class"](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr("class",r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return"boolean"==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=s,s=i,i={}),e.isFunction(s)&&(n=s,s=null),i&&e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:"number"==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(o+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length>s;s++)null!==t[s]&&(i=e.data(o+t[s]),void 0===i&&(i=""),e.css(t[s],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,s;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},s=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),s=t.parent(),"static"===t.css("position")?(s.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&&a.call(n[0]),e.isFunction(t)&&t()}var n=e(this),a=s.complete,r=s.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&&s.complete.call(this)}):a===!1?this.each(i):this.queue(a||"fx",i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||"boolean"==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=["position","top","bottom","left","right","height","width"],u=e.effects.setMode(o,t.mode||"hide"),d=t.direction||"up",c=r.test(d),p=c?"height":"width",f=c?"top":"left",m=h.test(d),g={},v="show"===u;o.parent().is(".ui-effects-wrapper")?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:n+a),v&&(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===u&&o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"effect"),l="hide"===h,u="show"===h,d=t.direction||"up",c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v="up"===d||"down"===d?"top":"left",y="up"===d||"left"===d,b=o.queue(),_=b.length;for((u||l)&&r.push("opacity"),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o["top"===v?"outerHeight":"outerWidth"]()/3),u&&(a={opacity:1},a[v]=0,o.css("opacity",0).css(v,y?2*-c:2*c).animate(a,m,g)),l&&(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p>s;s++)n={},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&&(n={opacity:0},n[v]=(y?"-=":"+=")+c,o.animate(n,m,g)),o.queue(function(){l&&o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_>1&&b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","height","width"],h=e.effects.setMode(o,t.mode||"hide"),l="show"===h,u=t.direction||"vertical",d="vertical"===u,c=d?"height":"width",p=d?"top":"left",f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:"hidden"}),n="IMG"===o[0].tagName?s:o,a=n[c](),l&&(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],o=e.effects.setMode(n,t.mode||"hide"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h?"pos":"neg",d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===u?-s:s),d[l]=(r?"pos"===u?"+=":"-=":"pos"===u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&&n()}function n(){p.css({visibility:"visible"}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d>a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c>o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*v,top:-a*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),h="show"===r,l="hide"===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&&(u=parseInt(d[1],10)/100*n[l?0:1]),h&&s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&&a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(s,t.mode||"show"),o={backgroundColor:s.css("backgroundColor")};"hide"===a&&(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],d=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],c=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(o,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=o.css("position"),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},"toggle"===t.mode&&"show"===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||("show"===p?b:s),o.to=t.to||("hide"===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},("box"===m||"both"===m)&&(a.from.y!==a.to.y&&(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&&(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),("content"===m||"both"===m)&&a.from.y!==a.to.y&&(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css("overflow","hidden").css(o.from),g&&(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),("content"===m||"both"===m)&&(d=d.concat(["marginTop","marginBottom"]).concat(u),c=c.concat(["marginLeft","marginRight"]),l=r.concat(d).concat(c),o.find("*[width]").each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&&o.css("opacity",o.from.opacity),"hide"===p&&o.hide(),e.effects.restore(o,y),f||("static"===v?o.css({position:"relative",top:o.to.top,left:o.to.left}):e.each(["top","left"],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return"auto"===i?n+"px":s+n+"px"})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||"effect"),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===a?0:100),r=t.direction||"both",h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:"horizontal"!==r?o/100:1,x:"vertical"!==r?o/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=h||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||"hide"),a="hide"===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||"show"),o="show"===a,r="hide"===a,h=o||"hide"===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),d=1),s=1;l>s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","height","width"],o=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?"-=":"+=")+h,m[c]=(p?"+=":"-=")+2*h,g[c]=(p?"-=":"+=")+2*h,n.animate(f,d,t.easing),s=1;l>s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=["position","top","bottom","left","right","width","height"],o=e.effects.setMode(n,t.mode||"show"),r="show"===o,h=t.direction||"left",l="up"===h||"down"===h?"top":"left",u="up"===h||"left"===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n["top"===l?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,u?isNaN(s)?"-"+s:-s:s),d[l]=(r?u?"+=":"-=":u?"-=":"+=")+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a="fixed"===n.css("position"),o=e("body"),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?"fixed":"absolute"}).animate(u,t.duration,t.easing,function(){c.remove(),i()})}});</script>
    <script>

        Polymer({
            is: "open-orders-view",
            properties: {
                tabs: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true
                },
                message: {
                    type: String,
                    notify: true
                }
            },
            observers:[
                'onTabsChange(tabs.*)'
            ],
            ready: function () {
                PubSub.subscribe('Tab.placed', this.onIncomingOrder.bind(this));
            },
            attached: function () {
            },
            update:function(){
                this.tabs = CommonModule.modules.tab.getOpen();
            },
            onIncomingOrder: function (msg, tab) {
                this.notifySplices('tabs', [{
                    index: this.tabs.length - 1,
                    addedCount: 1,
                    removed: [],
                    object: tab
                }]);
            },
            onTabsChange: function () {
                $("#sortable").sortable();
                $("#sortable").disableSelection();
            }
        });

    </script>
</dom-module>
<dom-module id="order-history-view" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
        </style>
        <div class="fullbleed layout vertical center">
            ORDER HISTORY
        </div>
    </template>
    <script>
        Polymer({
            is: "order-history-view",
            properties: {
                profilePicture: {
                    type: String,
                    notify: true,
                    value: function () { return "";}
                },
                profile: {
                    type: Object,
                    notify: true,
                    value: function () { return {}; }
                }
            },
            ready: function () {
            },
            attached: function () {
            }
        });

    </script>
</dom-module>
<dom-module id="pay-register" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            :host{
                width:100vw;
                height:calc(100vh - 64px);
            }
        </style>
        <div class="layout vertical center center-justified">
            <form id="form" action="/chefs/access/accept-payment" method="post" enctype="multipart/form-data">
                <div class="layout horizontal">
                    <paper-button id="record" class="red-300" disabled$="{{recorder.recording}}" raised="" on-click="onRecord">record</paper-button>
                    <paper-button id="stop" class="grey-300" disabled$="{{!recorder.recording}}" raised="" on-click="onStop">stop</paper-button>
                </div>
                <paper-button id="submit" class="blue-300" raised="" on-click="onSubmit">submit</paper-button>
            </form>
            <div id="log"></div>
            <div id="recordingslist"></div>
        </div>
    </template>
    <script>(function(window){

  var WORKER_PATH = '/public/js/recorder/workers/recorderWorker.js';
  var encoderWorker = new Worker('/public/js/recorder/workers/mp3Worker.js');

  var Recorder = function(source, cfg){
    var config = cfg || {};
    var bufferLen = config.bufferLen || 4096;
    var numChannels = config.numChannels || 2;
    this.context = source.context;
    this.node = (this.context.createScriptProcessor ||
                 this.context.createJavaScriptNode).call(this.context,
                 bufferLen, numChannels, numChannels);
    var worker = new Worker(config.workerPath || WORKER_PATH);
    worker.postMessage({
      command: 'init',
      config: {
        sampleRate: this.context.sampleRate,
        numChannels: numChannels
      }
    });
    var recording = false,
      currCallback;

    this.node.onaudioprocess = function(e){
      if (!recording) return;
      var buffer = [];
      for (var channel = 0; channel < numChannels; channel++){
          buffer.push(e.inputBuffer.getChannelData(channel));
      }
      worker.postMessage({
        command: 'record',
        buffer: buffer
      });
    }

    this.configure = function(cfg){
      for (var prop in cfg){
        if (cfg.hasOwnProperty(prop)){
          config[prop] = cfg[prop];
        }
      }
    }

    this.record = function(){
      recording = true;
    }

    this.stop = function(){
      recording = false;
    }

    this.clear = function(){
      worker.postMessage({ command: 'clear' });
    }

    this.getBuffer = function(cb) {
      currCallback = cb || config.callback;
      worker.postMessage({ command: 'getBuffer' })
    }

    this.exportWAV = function(cb, type){
      currCallback = cb || config.callback;
      type = type || config.type || 'audio/wav';
      if (!currCallback) throw new Error('Callback not set');
      worker.postMessage({
        command: 'exportWAV',
        type: type
      });
    }

	//Mp3 conversion
    worker.onmessage = function(e){
      var blob = e.data;
	  //console.log("the blob " +  blob + " " + blob.size + " " + blob.type);

	  var arrayBuffer;
	  var fileReader = new FileReader();

	  fileReader.onload = function(){
		arrayBuffer = this.result;
		var buffer = new Uint8Array(arrayBuffer),
        data = parseWav(buffer);

        console.log(data);
		console.log("Converting to Mp3");
		log.innerHTML += "\n" + "Converting to Mp3";

        encoderWorker.postMessage({ cmd: 'init', config:{
            mode : 3,
			channels:1,
			samplerate: data.sampleRate,
			bitrate: data.bitsPerSample
        }});

        encoderWorker.postMessage({ cmd: 'encode', buf: Uint8ArrayToFloat32Array(data.samples) });
        encoderWorker.postMessage({ cmd: 'finish'});
        encoderWorker.onmessage = function(e) {
            if (e.data.cmd == 'data') {

				console.log("Done converting to Mp3");
				log.innerHTML += "\n" + "Done converting to Mp3";

				/*var audio = new Audio();
				audio.src = 'data:audio/mp3;base64,'+encode64(e.data.buf);
				audio.play();*/

				//console.log ("The Mp3 data " + e.data.buf);

				var mp3Blob = new Blob([new Uint8Array(e.data.buf)], {type: 'audio/mp3'});
				uploadAudio(mp3Blob);

				var url = 'data:audio/mp3;base64,'+encode64(e.data.buf);
				var li = document.createElement('li');
				var au = document.createElement('audio');
				var hf = document.createElement('a');

				au.controls = true;
				au.src = url;
				hf.href = url;
				hf.download = 'audio_recording_' + new Date().getTime() + '.mp3';
				hf.innerHTML = hf.download;
				li.appendChild(au);
				li.appendChild(hf);
				recordingslist.appendChild(li);

            }
        };
	  };

	  fileReader.readAsArrayBuffer(blob);

      currCallback(blob);
    }


	function encode64(buffer) {
		var binary = '',
			bytes = new Uint8Array( buffer ),
			len = bytes.byteLength;

		for (var i = 0; i < len; i++) {
			binary += String.fromCharCode( bytes[ i ] );
		}
		return window.btoa( binary );
	}

	function parseWav(wav) {
		function readInt(i, bytes) {
			var ret = 0,
				shft = 0;

			while (bytes) {
				ret += wav[i] << shft;
				shft += 8;
				i++;
				bytes--;
			}
			return ret;
		}
		if (readInt(20, 2) != 1) throw 'Invalid compression code, not PCM';
		if (readInt(22, 2) != 1) throw 'Invalid number of channels, not 1';
		return {
			sampleRate: readInt(24, 4),
			bitsPerSample: readInt(34, 2),
			samples: wav.subarray(44)
		};
	}

	function Uint8ArrayToFloat32Array(u8a){
		var f32Buffer = new Float32Array(u8a.length);
		for (var i = 0; i < u8a.length; i++) {
			var value = u8a[i<<1] + (u8a[(i<<1)+1]<<8);
			if (value >= 0x8000) value |= ~0x7FFF;
			f32Buffer[i] = value / 0x8000;
		}
		return f32Buffer;
	}

	function uploadAudio(mp3Data){
		var reader = new FileReader();
		reader.onload = function(event){
			var fd = new FormData();
			var mp3Name = encodeURIComponent('audio_recording_' + new Date().getTime() + '.mp3');
			console.log("mp3name = " + mp3Name);
			fd.append('fname', mp3Name);
			fd.append('data', event.target.result);
			$.ajax({
				type: 'POST',
				url: 'upload.php',
				data: fd,
				processData: false,
				contentType: false
			}).done(function(data) {
				//console.log(data);
				log.innerHTML += "\n" + data;
			});
		};
		reader.readAsDataURL(mp3Data);
	}

    source.connect(this.node);
    this.node.connect(this.context.destination);    //this should not be necessary
  };

  /*Recorder.forceDownload = function(blob, filename){
	console.log("Force download");
    var url = (window.URL || window.webkitURL).createObjectURL(blob);
    var link = window.document.createElement('a');
    link.href = url;
    link.download = filename || 'output.wav';
    var click = document.createEvent("Event");
    click.initEvent("click", true, true);
    link.dispatchEvent(click);
  }*/

  window.Recorder = Recorder;

})(window);
</script>
    <script>
        var audioContext = new AudioContext;
        var recorder;
        var log, recordingslist;
        Polymer({
            is: "pay-register",
            properties: {
            },
            ready: function () {
            },
            attached: function () {
                log = this.$.log;
                recordingslist = this.$.recordingslist;
                var errorCallback = function (e) {
                    console.log('Reeeejected!', e);
                };

                // Not showing vendor prefixes.
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function (localMediaStream) {
                        console.log('RECORDER: creating input...');
                        var input = audioContext.createMediaStreamSource(localMediaStream);
                        console.log('RECORDER: creating recorder...');
                        recorder = new Recorder(input, {
                            numChannels: 1
                        });
                    })
                    .catch(errorCallback);
            },
            onRecord: function () {
                recorder.record();
            },
            onStop: function () {
                recorder.stop();
            },
            onSubmit: function () {
                recorder.exportWAV(function (blob) {
                    formData = new FormData(form);
                    formData.append("blob", blob);

                    var request = new XMLHttpRequest();
                    request.withCredentials = true;
                    request.open("POST", "/chefs/access/accept-payment", true);
                    request.send(formData);
                });
            },
        });

    </script>
</dom-module>
<dom-module id="menu-editor" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
ï»¿.menu-image {
    position: absolute;
    cursor: pointer;
    height: 150px;
    width: 120px;
    margin: 0;
    padding: 0;
    border: outset 3px goldenrod;
}


.inset-text {
    position: relative;
    top: 10px;
    color: rgba(0,0,0, 0.8);
    font-size: xx-small;
    text-align: center;
    letter-spacing: 3px;
    font-stretch: extra-expanded;
}

.menu-name {
    margin-top: 5px;
    color: gray;
    font-size: medium;
    text-transform: uppercase;
    font-family: 'Fjalla One', sans-serif;
    text-align: center;
}

.message-in-3d {
    position:absolute;
    -moz-transform: rotateX(-30deg);
    -ms-transform: rotateX(-30deg);
    -o-transform: rotateX(-30deg);
    -webkit-transform: rotateX(-30deg);
    transform: rotateX(-30deg);
    text-transform:uppercase;
    color:white;
    font-size:small;
    font-weight:bold;
    left:0;
    right:0;
    margin:auto;
}

.menu-picture {
    position: relative;
    top: 0;
    left: 0;
    right: 0;
    margin: auto;
    padding: 0;
    text-align: center;
    background-repeat: no-repeat;
    border: 1px solid gold;
    min-width: 100px;
    -webkit-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -moz-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -o-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
}

.animatedmenu {
    -moz-transition: background-color .2s ease-in;
    -o-transition: background-color .2s ease-in;
    -webkit-transition: background-color .2s ease-in;
    transition: background-color .2s ease-in;
}

a:link {
    text-decoration: none;
    color: black;
}

a:visited {
    text-decoration: none;
    color: black;
}

a:hover {
    text-decoration: none;
    color: green;
}

a:active {
    text-decoration: none;
    color: green;
}
</style>
        <style>
ï»¿div.stage {
    -moz-perspective: 600px;
    -ms-perspective: 600px;
    -webkit-perspective: 600px;
    perspective: 600px;
}

.css3d {
    -moz-transition-property: transform;
    -o-transition-property: transform;
    -webkit-transition-property: transform;
    transition-property: transform;
    -moz-transition-duration: 0.7s;
    -o-transition-duration: 0.7s;
    -webkit-transition-duration: 0.7s;
    transition-duration: 0.7s;
    -moz-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -ms-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -o-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -webkit-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
}

    .css3d:hover {
        z-index: 1;
        -moz-transition-property: transform;
        -o-transition-property: transform;
        -webkit-transition-property: transform;
        transition-property: transform;
        -moz-transition-duration: 0.7s;
        -o-transition-duration: 0.7s;
        -webkit-transition-duration: 0.7s;
        transition-duration: 0.7s;
        -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -ms-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -o-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-backface-visibility: hidden;
        -webkit-transform: scale(1);
    }

/*
 * Animation for webkit
*/
@-webkit-keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -webkit-transform: translateY(0);
    }

    40% {
        -webkit-transform: translateY(-30px);
    }

    60% {
        -webkit-transform: translateY(-15px);
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -moz-transform: translateY(0);
        -ms-transform: translateY(0);
        -o-transform: translateY(0);
        -webkit-transform: translateY(0);
        transform: translateY(0);
    }

    40% {
        -moz-transform: translateY(-30px);
        -ms-transform: translateY(-30px);
        -o-transform: translateY(-30px);
        -webkit-transform: translateY(-30px);
        transform: translateY(-30px);
    }

    60% {
        -moz-transform: translateY(-15px);
        -ms-transform: translateY(-15px);
        -o-transform: translateY(-15px);
        -webkit-transform: translateY(-15px);
        transform: translateY(-15px);
    }
}

/*
 * Adding the animation to our element
*/
.bounce {
    -webkit-animation-name: bounce;
    -moz-animation-name: bounce;
    -o-animation-name: bounce;
    animation-name: bounce;
}


.glossy {
    -webkit-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -moz-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 20px;
}

    .glossy:after {
        position: absolute;
        content: ' ';
        width: 100%;
        height: 50%;
        top: 0;
        left: 0;
        -webkit-border-radius: 20px;
        -moz-border-radius: 20px;
        border-radius: 20px;
        background: -moz-linear-gradient(top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,.1) 100%);
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.7)), color-stop(100%,rgba(255,255,255,.1)));
        background: linear-gradient(top, rgba(255,255,255,0.7) 0%,rgba(255,255,255,.1) 100%);
    }

</style>
        <style>
            #container {
                height: calc( 100vh - 64px );
                overflow: hidden;
                width: 100%;
            }

            .canvas {
                margin-bottom: 20px;
                position: absolute;
            }

            paper-icon-button {
                margin: 25px;
            }

            #subcontainer {
                width: 100%;
                height: 100%;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
                position: relative;
            }

            #pictureContainer {
                position: relative;
                overflow-y: auto;
            }

            #description {
                width: 100%;
                max-width: 600px;
                margin: 10px;
            }

            .no-margin {
                margin: 0;
            }

            .no-padding {
                padding: 0;
            }

            .short {
                width: 150px;
            }
        </style>
        <div id="container">
            <div id="subcontainer" class="vertical layout">
                <div id="header" class="fullbleed layout horizontal center center-justified">
                    <div>
                        <paper-icon-button id="before" icon="image:navigate-before" on-click="onNavigateBefore" disabled$="{{getNavBeforeDisabledState(page)}}"></paper-icon-button>
                        <paper-tooltip for="before">Previous page</paper-tooltip>
                    </div>
                    <span class="flex"></span>
                    <div>
                        <paper-icon-button id="back" icon="zoom-out" on-click="onBackClick" disabled$="{{!section.parent_id}}"></paper-icon-button>
                        <paper-tooltip for="back">Go back a section</paper-tooltip>
                    </div>
                    <div>
                        <paper-icon-button id="section-select" toggles="" icon="image:crop-free" style$="{{getSectionIconStyle(sectionCropSelected)}}" on-click="onSectionCropToggle"></paper-icon-button>
                        <paper-tooltip for="section-select">Select section - sections represent a group of related products or other sections</paper-tooltip>
                    </div>
                    <div>
                        <paper-icon-button id="article-select" toggles="" src="/public/images/ic_format_shapes_black_24px.svg" style$="{{getArticleIconStyle(articleCropSelected)}}" on-click="onArticleCropToggle"></paper-icon-button>
                        <paper-tooltip for="article-select">Select item - items represent products and cannot be zoomed in further</paper-tooltip>
                    </div>
                    <span class="flex"></span>
                    <div>
                        <paper-icon-button id="next" icon="image:navigate-next" on-click="onNavigateNext" disabled$="{{getNavNextDisabledState(page)}}"></paper-icon-button>
                        <paper-tooltip for="next">Next page</paper-tooltip>
                    </div>
                </div>
                <div class="fullbleed layout vertical center center-justified" hidden$="{{!articleCropSelected}}">
                    <span>Description</span>
                    <iron-autogrow-textarea id="description" bind-value="{{details.description}}" max-rows="4" rows="4"></iron-autogrow-textarea>
                    <div class="layout horizontal center around-justified" style="width:70%">
                        <paper-input class="short" label="Name" type="text" id="name" value="{{details.name}}"></paper-input>
                        <paper-input class="short" label="Price" type="number" id="price" value="{{details.price}}">
                            <div suffix=""> âª </div>
                        </paper-input>
                        <paper-input class="short" label="SKU" type="text" id="sku" value="{{details.sku}}">
                            <iron-icon src="/public/images/barcode.png" suffix=""></iron-icon>
                        </paper-input>
                    </div>
                </div>
                <div id="pictureContainer" class="flex">
                    <div id="menuPicture" class="menu-picture canvas" style$="{{getPictureSizeAndBG(section, sizeChange)}}">
                        <template is="dom-repeat" items="{{section.sections}}" as="subsection">
                            <div class="no-margin no-padding layout horizontal center-justified" style$="{{getSubsectionStyle(subsection, size.*)}}">
                                <paper-icon-button class="no-margin" icon="{{getSubsectionActionIcon(subsection)}}" style="display:block; background-color:rgba(0,255,0, 0.4);color: white;" on-click="onSectionDivShow"></paper-icon-button>
                                <paper-icon-button class="no-margin" icon="close" style="display:block; background-color:rgba(255,255,255, 0.4);" on-click="onSectionDivRemove"></paper-icon-button>
                            </div>
                        </template>
                    </div>
                    <img-crop id="menuPictureCropper" hidden$="{{!isCropMode(sectionCropSelected,articleCropSelected)}}" class="menu-picture canvas" on-complete="onSelectComplete" on-ok="onSelectApprove" on-cancel="onSelectCancel" style$="{{getPictureSize(section)}}"></img-crop>
                    <paper-spinner id="spinner" hidden=""></paper-spinner>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "menu-editor",
            behaviors: [
                Polymer.IronResizableBehavior
            ],
            properties: {
                business: {
                    type: Object,
                    notify: true
                },
                menu: {
                    type: Object,
                    notify: true
                },
                page: {
                    type: Object,
                    notify: true,
                    value: function () { return { width: '600px', height: '800px' } },
                    observer: 'onPageChange'
                },
                section: {
                    type: Object,
                    notify: true,
                    observer: 'onSectionChange'
                },
                details: {
                    type: Object,
                    notify: true,
                    value: function () { return {} },
                },
                sectionCropSelected: {
                    type: Boolean,
                    notify: true,
                    observer: 'onSectionCropSelected'
                },
                articleCropSelected: {
                    type: Boolean,
                    notify: true,
                },
                size: {
                    type: Object,
                    notify: true
                },
                sizeChange: {
                    type: Boolean,
                    notify: true,
                    value: function () { return true; }
                },
            },
            listeners: {
                'iron-resize': 'onResize'
            },
            ready: function () {
            },
            attached: function () {
                this.async(function () {
                    this.page = this.menu.pages[0];
                    this.sectionCropSelected = false;
                    this.articleCropSelected = false;
                    this.notifyResize();

                    $(window).resize(function (e) {
                        this.onResize(e);
                    }.bind(this));

                    PubSub.subscribe('Menu.getArticleData', function (msg, data) {
                        this.set('details.description', data.description);
                        this.set('details.name', data.name);
                        this.set('details.price', data.price);
                    }.bind(this));

                    PubSub.subscribe('Menu.addSection', function (msg, new_section) {
                        this.pushNewSection(new_section);
                        this.section = new_section;
                    }.bind(this));

                    PubSub.subscribe('Menu.addArticle', function (msg, new_section) {
                        this.pushNewSection(new_section);
                        this.articleCropSelected = false;
                    }.bind(this));

                }.bind(this), 1);
            },
            getPictureSize: function () {
                return CommonModule.modules.menu.visual.getPictureStyle(this.section, this.page, $('#mainContainer').width()).size.text;
            },
            getPictureSizeAndBG: function () {
                var value = CommonModule.modules.menu.visual.getPictureStyle(this.section, this.page, $('#mainContainer').width());
                this.size = value.size;
                return value.size.text + value.bg;
            },
            getSubsectionStyle: function (subsection) {
                var position = this.getSubsectionPosition(subsection);
                var style = 'position: absolute; top: ' + position.top + 'px; left: ' + position.left + 'px; width: ' + position.width + 'px; height: ' + position.height + 'px;';
                if (subsection.final) {
                    return 'background-color: rgba(0,0,255, 0.2); border: dashed 1px black;' + style;
                }
                else {
                    return 'background-color: rgba(0,255,0, 0.2); border: solid 1px gray; ' + style;
                }
            },
            getSubsectionPosition: function (subsection) {
                return {
                    left: (subsection.start[0] - this.section.start[0]) * this.section.zoom.x * this.size.width,
                    top: (subsection.start[1] - this.section.start[1]) * this.section.zoom.y * this.size.height,
                    width: subsection.width * this.size.width,
                    height: subsection.height * this.size.height
                };
            },
            getSubsectionActionIcon: function (subsection) {
                return subsection.final ? 'image:edit' : 'visibility';
            },
            onPageChange: function () {
                if (!this.page.jpg)
                    return;
                this.section = this.page;
            },
            onSectionChange: function () {
                this.sectionCropSelected = this.articleCropSelected = false;
            },
            onSaveDebouncer: function (section) {
                if (section.sections.length)
                    this.debounce('onSaveDebouncer', this.onSave.bind(this), 3000);
            },
            onSave: function () {
                CommonModule.modules.menu.savePage(this.page);
            },
            onSectionCropToggle: function (event) {
                this.sectionCropSelected = event.currentTarget.active;
            },
            onArticleCropToggle: function (event) {
                this.articleCropSelected = event.currentTarget.active;
                this.onArticleCropSelected();
            },
            onBackClick: function () {
                if (this.section && this.section.parent_id)
                    this.section = CommonModule.modules.menu.findParentSection(this.page, this.section.parent_id);
            },
            onResize: function (event) {
                this.sizeChange = !this.sizeChange;
            },
            onSectionCropSelected: function () {
                this.$["section-select"].active = this.sectionCropSelected;
                if (this.sectionCropSelected) {
                    this.$.menuPictureCropper.color = 'black';
                    this.articleCropSelected = false;
                    this.$.menuPictureCropper._setSize(this.$.menuPicture.clientWidth, this.$.menuPicture.clientHeight);
                }
            },
            onArticleCropSelected: function (section) {
                this.details = {};
                this.articleCropSelected = this.articleCropSelected || !!section;
                this.$["article-select"].active = this.articleCropSelected;
                if (this.articleCropSelected) {
                    this.$.menuPictureCropper.color = 'blue';
                    this.sectionCropSelected = false;
                    this.$.menuPictureCropper._setSize(this.$.menuPicture.clientWidth, this.$.menuPicture.clientHeight);
                    if (section) {
                        this.removeSubsection(section);
                        this.details = {
                            price: section.price || 0,
                            name: section.name || "",
                            description: section.description || "",
                            sku: section.sku || "",
                            id: section.id
                        };
                        this.$.menuPictureCropper.editSection(this.getSubsectionPosition(section));
                    }
                }
            },
            removeSubsection: function (subsection) {
                var index = _.findIndex(this.section.sections, function (s) { return s.id == subsection.id });
                this.splice('section.sections', index, 1);
            },
            isCropMode: function (sectionMode, articleMode) {
                return sectionMode || articleMode;
            },
            getSectionIconStyle: function (value) {
                return value ? 'background-color: lightblue' : '';
            },
            getArticleIconStyle: function (value) {
                return value ? 'background-color: lightblue' : '';
            },
            onSelectComplete: function (event, unprocessedSelection) {
                if (!this.articleCropSelected) return;

                var selection = this.processSelection(unprocessedSelection);
                CommonModule.modules.menu.getArticleDescription(this, selection);
            },
            onSelectApprove: function (event, unprocessedSelection) {
                var selection = this.processSelection(unprocessedSelection);

                if (this.sectionCropSelected) {
                    CommonModule.modules.menu.addSection(this.section, selection);
                }
                else if (this.articleCropSelected) {
                    this.saveArticle(selection)
                }
            },
            onSelectCancel: function () {
                this.articleCropSelected = this.sectionCropSelected = false;
            },
            saveArticle: function (selection) {
                this.details.placeid = this.business.placeid;
                CommonModule.modules.menu.addArticle(this.section, selection, this.details);
            },
            pushNewSection: function (new_section) {
                var index = _.findIndex(this.section.sections, function (s) { return s.id == new_section.id; });
                if (index > -1)
                    this.splice('section.sections', index, 1, new_section);
                else
                    this.push('section.sections', new_section);
                this.onSaveDebouncer(this.section);
            },
            processSelection: function (selection) {
                selection.t /= this.$.menuPictureCropper.clientHeight;
                selection.h /= this.$.menuPictureCropper.clientHeight;
                selection.l /= this.$.menuPictureCropper.clientWidth;
                selection.w /= this.$.menuPictureCropper.clientWidth;

                return selection;
            },
            onSectionDivShow: function (event) {
                var subsection = event.model.subsection;
                if (subsection.final) {
                    this.onArticleCropSelected(subsection);
                }
                else
                    this.section = subsection;
            },
            onSectionDivRemove: function (event) {
                this.splice('section.sections', event.model.index, 1);
                this.onSaveDebouncer(this.section);
            },
            getNavNextDisabledState: function (page) {
                if (_.isUndefined(page.page_number)) return;
                return page.page_number == this.menu.pages.length - 1;
            },
            getNavBeforeDisabledState: function (page) {
                if (_.isUndefined(page.page_number)) return;
                if (!page.page_number)
                    this.$.before.icon = 'chrome-reader-mode';
                else
                    this.$.before.icon = 'image:navigate-before';

                return false; // im trying out best way for user to navigate. if icon-change is decided upon, disabled$= is redundant
            },
            onNavigateBefore: function (event) {
                if (_.isUndefined(this.page.page_number)) return;
                if (!this.page.page_number)
                    page('/menus');
                else
                    this.page = this.menu.pages[this.page.page_number - 1];
            },
            onNavigateNext: function (event) {
                if (_.isUndefined(this.page.page_number)) return;
                this.page = this.menu.pages[this.page.page_number + 1];
            }
        });
    </script>
</dom-module>
<dom-module id="floor-map" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
            :host {
                height: calc(100vh - 64px);
                margin: 0;
                padding: 0;
            }

            .floormap-layer, .floormap-base {
                width: 100%;
                height: 100%;
                position: absolute;
            }

            .floormap-layer {
                pointer-events: none;
            }

            .circular-avatar-small {
                opacity: 0.6;
            }

                .circular-avatar-small:hover {
                    opacity: 1;
                }

            .selected {
                opacity:1;
                border: 2px black !important;
                box-shadow: 0 0 12px white !important;
            }

            .floormap-button {
                border: solid 2px black;
            }

            .floormap-view {
                position: absolute;
                top: 5%;
                right: 5%;
            }
            .layer-dialog{
                width:50vw;
                height:50vh;
                background:whitesmoke;
            }
            paper-button {
                display:block;
                text-align:left;
                background:white;
            }
            .layer-tooltip{
                z-index:1;
                pointer-events: none;
                opacity:0.8;
                border:green 2px;
                box-shadow: 0 0 10px white;
                text-transform:uppercase;
                position:absolute;
                -moz-transition: all 0.2s ease;
                -o-transition: all 0.2s ease;
                -webkit-transition: all 0.2s ease;
                transition: all 0.2s ease;
            }
        </style>
        <style>
ï»¿.control-buttons {
    right: 0;
    position: fixed;
    z-index: 2 !important;
    top: 20%;
    margin:0 !important;
}

.control-buttons paper-icon-button {
    color: white;
    background: black;
    opacity: 0.6;
}

.control-buttons paper-icon-button:hover {
    opacity: 1;
}
</style>

        <div id="main" class="fullbleed" style="position:relative; height:100%; overflow: hidden">
            <paper-dialog id="layerDialog" class="layer-dialog" auto-fit-on-attach="" entry-animation="scale-up-animation" exit-animation="scale-down-animation">
                <div class="fullbleed layout vertical center" style="height:90%">
                    <div class="flex center center-justified">
                        INFO ABOUT <span id="tableNo" style="text-transform:uppercase"></span>
                    </div>
                    <div class="layout horizontal">
                        <paper-button raised="" on-click="onLayerNewTabClick">
                            <iron-icon src="/public/images/ic_fiber_new_black_24px.svg"></iron-icon>
                            new tab
                        </paper-button>
                        <paper-button raised="" on-click="onLayerAddToTabClick">
                            <iron-icon icon="add-box"></iron-icon>
                            add to tab
                        </paper-button>
                        <paper-button raised="" on-click="onLayerPayTabClick">
                            <iron-icon icon="done"></iron-icon>
                            pay tab
                        </paper-button>
                    </div>
                </div>
            </paper-dialog>
            <img class="floormap-base" src="{{floormap.png}}" usemap="#layermap" style="z-index:0">
            <map name="layermap">
                <template is="dom-repeat" items="{{floormap.layers}}" as="layer">
                    <area alt="{{layer.name}}" title="{{layer.name}}" shape="poly" coords="{{calcCoords(layer.coords, layer, sizeChange)}}" on-mouseover="onMouseOver" on-mouseout="onMouseOut" on-click="onLayerClick">
                </template>
            </map>
            <template is="dom-repeat" items="{{floormap.layers}}" as="layer">
                <div hidden$="{{layer.hide}}">
                    <img class="floormap-layer" src="{{layer.png}}">
                </div>
            </template>
            <template is="dom-repeat" items="{{tooltips}}">
                <paper-material class="circular-avatar-xxsmall layer-tooltip" style$="{{item.position}}">{{item.text}}</paper-material>
            </template>
            <div class="control-buttons layout vertical">
                <paper-icon-button style="position:absolute; top: 42px; right:0" icon="editor:mode-edit"></paper-icon-button>
            </div>
            <div class="floormap-view layout horizontal center">
                <template is="dom-repeat" items="{{business.floormaps}}" as="floormap">
                    <paper-button class="circular-avatar-small floormap-button" raised="" style$="{{getImageStyle(floormap.png)}}" on-click="onFloormapSelect"></paper-button>
                </template>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "floor-map",
            behaviors: [
                 Polymer.IronResizableBehavior
            ],
            listeners: {
                'iron-resize': 'onResize'
            },
            properties: {
                tooltips: {
                    type: Array,
                    notify: true,
                    value: function () { return [];}
                },
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange',
                    value: function () { return { floormaps: [] }; }
                },
                floormap: {
                    type: Object,
                    notify: true,
                    observer: 'onFloormapChange'
                },
                sizeChange: {
                    type: Boolean,
                    notify: true,
                    value: function () { return true; }
                }
            },
            ready: function () {
            },
            attached: function () {
                this.async(this.notifyResize, 1);
            },
            onBusinessChange: function () {
                if (!this.business) return;
                this.set('business.floormaps', floormaps);
                this.onFloormapSelect({ model: { floormap: floormaps[0] } });
            },
            onFloormapChange: function () {
                this.calibrateTooltips();
            },
            calibrateTooltips: function(){
                var tooltips = _.map(this.floormap.layers, function (layer) {
                    return { text: layer.number, position: 'top: ' + layer.center.y + 'px; left: ' + layer.center.x + 'px;' };
                });

                this.splice.apply(this, ['tooltips', 0, this.tooltips.length].concat(tooltips));
            },
            onMouseOver: function (event) {
                this.set('floormap.layers.' + event.model.index + '.hide', false);
            },
            onMouseOut: function (event) {
                this.set('floormap.layers.' + event.model.index + '.hide', true);
            },
            getMapId: function (id) {
                return '#' + id;
            },
            onResize: function (event) {
                console.log('in onResize');
                this.sizeChange = !this.sizeChange;
            },
            getImageStyle: function (image) {
                return 'background: center center /cover no-repeat url(' + image + ');';
            },
            calcCoords: function (coords, layer) {
                var wf = this.clientWidth / this.floormap.width;
                var hf = this.clientHeight / this.floormap.height;
                var result = coords.split(',').map(function (coord, index) {
                    return parseInt(coord) * (index % 2 ? hf : wf);
                }).join(',');
                layer.center = CommonModule.modules.business.recalcCenter(result);
                this.debounce('calibrateTooltips', this.calibrateTooltips.bind(this), 200);

                return result;
            },
            onFloormapSelect: function (event) {
                this.floormap = event.model.floormap;
                var buttons = this.querySelectorAll('.floormap-button');
                _.forEach(buttons, function (button) {
                    var toggleOn = button.dataHost.floormap === event.model.floormap;
                    this.toggleClass('selected', toggleOn, button);
                }.bind(this));
            },
            onLayerClick: function (event) {
                this.$.tableNo.innerHTML = event.model.layer.name;
                this.$.layerDialog.open();
            },
            onLayerPayTabClick: function (event) {

            },
            onLayerAddToTabClick: function (event) {

            },
            onLayerNewTabClick: function (event) {

            }
        });

        var floormaps = [
        {
            width: 981,
            height: 654,
            png: '/public/images/cafes/floormap/1/Background.png',
            name: 'Front',
            id: 'main',
            layers: [
        {
            coords: "15,543,32,518,74,506,105,486,195,478,196,528",
            png: '/public/images/cafes/floormap/1/Layer-1.png',
            name: 'Table 1',
            id: 'm1'
        },
        {
            coords: "101,431,131,413,204,413,205,437,104,438",
            png: '/public/images/cafes/floormap/1/Layer-2.png',
            name: 'Table 2',
            id: 'm2'
        },
        {
            coords: "762,442,859,432,890,448,925,445,978,467,980,493,942,496,765,453",
            png: '/public/images/cafes/floormap/1/Layer-3.png',
            name: 'Table 3',
            id: 'm3'
        },
        {
            coords: "620,407,713,403,741,413,787,422,786,434,704,439,620,420",
            png: '/public/images/cafes/floormap/1/Layer-4.png',
            name: 'Table 4',
            id: 'm4'
        },
        {
            coords: "449,479,515,446,674,458,641,507,453,491",
            png: '/public/images/cafes/floormap/1/Layer-5.png',
            name: 'Table 5',
            id: 'm5'
        },
        {
            coords: "347,422,417,406,504,417,449,438,348,431",
            png: '/public/images/cafes/floormap/1/Layer-6.png',
            name: 'Table 6',
            id: 'm6'
        },
        {
            coords: "668,652,629,620,960,565,978,575,980,653",
            png: '/public/images/cafes/floormap/1/Layer-7.png',
            name: 'Table 7',
            id: 'm7'
        }
            ]
        },
        {
            width: 1300,
            height: 866,
            png: '/public/images/cafes/floormap/2/Background.png',
            name: 'Front',
            id: 'main',
            layers: [
        {
            coords: "330,435,415,352,509,420,426,504",
            png: '/public/images/cafes/floormap/2/Layer-1.png',
            name: 'Table 1',
            id: 'm1'
        },
        {
            coords: "722,349,783,279,896,350,841,421",
            png: '/public/images/cafes/floormap/2/Layer-2.png',
            name: 'Table 2',
            id: 'm2'
        },
        {
            coords: "354,175,428,111,511,169,439,232",
            png: '/public/images/cafes/floormap/2/Layer-3.png',
            name: 'Table 3',
            id: 'm3'
        },
        {
            coords: "435,806,527,700,636,788,574,864,506,864",
            png: '/public/images/cafes/floormap/2/Layer-4.png',
            name: 'Table 4',
            id: 'm4'
        },
        {
            coords: "839,865,888,793,983,865",
            png: '/public/images/cafes/floormap/2/Layer-5.png',
            name: 'Table 5',
            id: 'm5'
        },
        {
            coords: "1020,600,1082,499,1192,565,1130,670",
            png: '/public/images/cafes/floormap/2/Layer-6.png',
            name: 'Table 6',
            id: 'm6'
        }
            ]
        }
        ];

        floormaps.forEach(function (floormap) {
            CommonModule.modules.business.setupMissingFieldsInFloormap(floormap);
        });
    </script>
</dom-module>
<dom-module id="inventory-section" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
.tablesorter-ice{width:100%;background-color:#fff;margin:10px 0 15px;text-align:left;border-spacing:0;border:1px solid #ccc;border-width:1px 0 0 1px}.tablesorter-ice td,.tablesorter-ice th{border:1px solid #ccc;border-width:0 1px 1px 0}.tablesorter-ice th,.tablesorter-ice thead td{font:12px/18px Arial,Sans-serif;color:#555;background-color:#f6f8f9;border-collapse:collapse;padding:4px;text-shadow:0 1px 0 rgba(255,255,255,.7)}.tablesorter-ice tbody td,.tablesorter-ice tfoot td,.tablesorter-ice tfoot th{padding:4px;vertical-align:top}.tablesorter-ice .header,.tablesorter-ice .tablesorter-header{background-color:#f6f8f9;background-position:center right;background-repeat:no-repeat;background-image:url("data:image/gif;base64,R0lGODlhDAAMAMQAAAJEjAJCiwJBigJAiANFjgNGjgNEjQRIkQRHkANIkAVMlAVQmAZWnQZUnAdYoAhdpAhZoAlhqQlepQliqQppsApmrQxutgtutQtutAxwtwxwtg1yug1zugxtsw1yuP8A/yH5BAEAAB8ALAAAAAAMAAwAAAUx4Cd+3GiOW4ado2d9VMVm1xg9ptadTsP+QNZEcjoQTBDGCAFgLRSfQgCYMAiCn8EvBAA7");padding:4px 20px 4px 4px;white-space:normal;cursor:pointer}.tablesorter-ice .headerSortUp,.tablesorter-ice .tablesorter-headerAsc,.tablesorter-ice .tablesorter-headerSortUp{color:#333;background-color:#ebedee;background-position:center right;background-repeat:no-repeat;background-image:url("data:image/gif;base64,R0lGODlhDAAMANUAAAJCiwNHkANFjgNEjQRIkQNJkQRMlARKkwRKkgVPlwZSmgdaogdYnwhfpghcowlhqgliqglgqAlgpwljqwporwpmrQplrAtsswtqsgtrsgtqsQxttAtvtQtttAxyuQxwtwxxtwxvtg10uw1zuQ1xuP8A/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACUALAAAAAAMAAwAAAY6wJKwJBoahyNQ6Dj0fDoZCpPEuWgqk4jxs8FQLI+Gg8Esm5kQydFQMC7IwkOAqUiUCAIzIjA4lwBlQQA7")}.tablesorter-ice .headerSortDown,.tablesorter-ice .tablesorter-headerDesc,.tablesorter-ice .tablesorter-headerSortDown{color:#333;background-color:#ebedee;background-position:center right;background-repeat:no-repeat;background-image:url("data:image/gif;base64,R0lGODlhDAAMANUAAAE/iAJBigNFjgNEjQNFjQNDiwRHkQRHjwNHjwROlgRMlQRMlARJkgRKkgZQmAVPlgZWnQZSmgZRmAdXoAdXnwdUnAdbogdZoQhbowlhqAlepglkrAliqQtstAtqsQxyugxyuQxwuAxxuAxxtwxwtgxvtQ10vA12vA10u/8A/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACkALAAAAAAMAAwAAAY6wJQwdRoah6bP6DhEiVIdDxNEGm4yxlDpiJkwv2AmR2OhVCSJBsJ4gUQeCwOB6VAwBAXwYRAIpwBfQQA7")}.tablesorter-ice thead .sorter-false{background-image:none;cursor:default;padding:4px}.tablesorter-ice tfoot .tablesorter-headerAsc,.tablesorter-ice tfoot .tablesorter-headerDesc,.tablesorter-ice tfoot .tablesorter-headerSortDown,.tablesorter-ice tfoot .tablesorter-headerSortUp{background-color:#ebedee}.tablesorter-ice td{color:#333}.tablesorter-ice tbody>tr.even:hover>td,.tablesorter-ice tbody>tr.hover>td,.tablesorter-ice tbody>tr.odd:hover>td,.tablesorter-ice tbody>tr:hover>td{background-color:#ebf2fa}.tablesorter-ice .tablesorter-processing{background-position:center center!important;background-repeat:no-repeat!important;background-image:url("data:image/gif;base64,R0lGODlhFAAUAKEAAO7u7lpaWgAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQBCgACACwAAAAAFAAUAAACQZRvoIDtu1wLQUAlqKTVxqwhXIiBnDg6Y4eyx4lKW5XK7wrLeK3vbq8J2W4T4e1nMhpWrZCTt3xKZ8kgsggdJmUFACH5BAEKAAIALAcAAAALAAcAAAIUVB6ii7jajgCAuUmtovxtXnmdUAAAIfkEAQoAAgAsDQACAAcACwAAAhRUIpmHy/3gUVQAQO9NetuugCFWAAAh+QQBCgACACwNAAcABwALAAACE5QVcZjKbVo6ck2AF95m5/6BSwEAIfkEAQoAAgAsBwANAAsABwAAAhOUH3kr6QaAcSrGWe1VQl+mMUIBACH5BAEKAAIALAIADQALAAcAAAIUlICmh7ncTAgqijkruDiv7n2YUAAAIfkEAQoAAgAsAAAHAAcACwAAAhQUIGmHyedehIoqFXLKfPOAaZdWAAAh+QQFCgACACwAAAIABwALAAACFJQFcJiXb15zLYRl7cla8OtlGGgUADs=")!important}.tablesorter-ice tr.odd>td{background-color:#dfdfdf}.tablesorter-ice tr.even>td{background-color:#efefef}.tablesorter-ice td.primary,.tablesorter-ice tr.odd td.primary{background-color:#9ae5e5}.tablesorter-ice td.secondary,.tablesorter-ice tr.even td.primary,.tablesorter-ice tr.odd td.secondary{background-color:#c2f0f0}.tablesorter-ice td.tertiary,.tablesorter-ice tr.even td.secondary,.tablesorter-ice tr.odd td.tertiary{background-color:#d5f5f5}.tablesorter-ice tr.even td.tertiary{background-color:#ebfafa}.tablesorter-ice.containsStickyHeaders thead tr:nth-child(1) td,.tablesorter-ice.containsStickyHeaders thead tr:nth-child(1) th{border-top:#ccc 1px solid}caption{background-color:#fff}.tablesorter-ice .tablesorter-filter-row{background-color:#eee}.tablesorter-ice .tablesorter-filter-row td{background-color:#eee;line-height:normal;text-align:center;-webkit-transition:line-height .1s ease;-moz-transition:line-height .1s ease;-o-transition:line-height .1s ease;transition:line-height .1s ease}.tablesorter-ice .tablesorter-filter-row .disabled{opacity:.5;filter:alpha(opacity=50);cursor:not-allowed}.tablesorter-ice .tablesorter-filter-row.hideme td{padding:2px;margin:0;line-height:0;cursor:pointer}.tablesorter-ice .tablesorter-filter-row.hideme *{height:1px;min-height:0;border:0;padding:0;margin:0;opacity:0;filter:alpha(opacity=0)}.tablesorter-ice input.tablesorter-filter,.tablesorter-ice select.tablesorter-filter{width:98%;height:auto;margin:0;padding:4px;background-color:#fff;border:1px solid #bbb;color:#333;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition:height .1s ease;-moz-transition:height .1s ease;-o-transition:height .1s ease;transition:height .1s ease}.tablesorter .filtered{display:none}.tablesorter .tablesorter-errorRow td{text-align:center;cursor:pointer;background-color:#e6bf99}
</style>

        <style>
            :host {
                display: block;
                width: 100%;
            }

            search-bar {
                width: 50%;
                float: right;
            }

            .table-item {
                width: 200px;
            }

            .header {
                font-weight: bolder;
                text-align: center;
            }

            input:focus {
                box-shadow: 2.5px 2.5px rgb(200, 200, 255);
            }
        </style>
        <paper-material class="with-margins">
            <div class="full layout vertical center-justified">
                <div class="layout horizontal">
                    <paper-icon-button icon="communication:import-export" on-click="onImport"></paper-icon-button>
                    <search-bar max-suggestions="5" data="{{data}}"></search-bar>
                </div>
            </div>
            <table id="myTable" class="tablesorter">
                <thead>
                    <tr>
                        <th>Last Name</th>
                        <th>First Name</th>
                        <th>Email</th>
                        <th>Due</th>
                        <th>Web Site</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Smith</td>
                        <td>John</td>
                        <td>jsmith@gmail.com</td>
                        <td>$50.00</td>
                        <td>http://www.jsmith.com</td>
                    </tr>
                    <tr>
                        <td>Bach</td>
                        <td>Frank</td>
                        <td>fbach@yahoo.com</td>
                        <td>$50.00</td>
                        <td>http://www.frank.com</td>
                    </tr>
                    <tr>
                        <td>Doe</td>
                        <td>Jason</td>
                        <td>jdoe@hotmail.com</td>
                        <td>$100.00</td>
                        <td>http://www.jdoe.com</td>
                    </tr>
                    <tr>
                        <td>Conway</td>
                        <td>Tim</td>
                        <td>tconway@earthlink.net</td>
                        <td>$50.00</td>
                        <td>http://www.timconway.com</td>
                    </tr>
                </tbody>
            </table>
        </paper-material>
    </template>
    <script>!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){return function(a){"use strict";var b=a.tablesorter={version:"2.25.0",parsers:[],widgets:[],defaults:{theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,resort:!0,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",duplicateSpan:!0,textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,widgets:[],widgetOptions:{zebra:["even","odd"]},initWidgets:!0,widgetClass:"widget-{name}",initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssInfoBlock:"tablesorter-infoOnly",cssNoSort:"tablesorter-noSort",cssIgnoreRow:"tablesorter-ignoreRow",cssIcon:"tablesorter-icon",cssIconNone:"",cssIconAsc:"",cssIconDesc:"",pointerClick:"click",pointerDown:"mousedown",pointerUp:"mouseup",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]},css:{table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",colgroup:"tablesorter-colgroup",header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"},language:{sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",sortDisabled:"sorting is disabled",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"},regex:{templateContent:/\{content\}/g,templateIcon:/\{icon\}/g,templateName:/\{name\}/i,spaces:/\s+/g,nonWord:/\W/g,formElements:/(input|select|button|textarea)/i,chunk:/(^([+\-]?(?:\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i,comma:/,/g,digitNonUS:/[\s|\.]/g,digitNegativeTest:/^\s*\([.\d]+\)/,digitNegativeReplace:/^\s*\(([.\d]+)\)/,digitTest:/^[\-+(]?\d+[)]?$/,digitReplace:/[,.'"\s]/g},string:{max:1,min:-1,emptymin:1,emptymax:-1,zero:0,none:0,"null":0,top:!0,bottom:!1},dates:{},instanceMethods:{},setup:function(c,d){if(!c||!c.tHead||0===c.tBodies.length||c.hasInitialized===!0)return void(d.debug&&(c.hasInitialized?console.warn("Stopping initialization. Tablesorter has already been initialized"):console.error("Stopping initialization! No table, thead or tbody",c)));var e="",f=a(c),g=a.metadata;c.hasInitialized=!1,c.isProcessing=!0,c.config=d,a.data(c,"tablesorter",d),d.debug&&(console[console.group?"group":"log"]("Initializing tablesorter"),a.data(c,"startoveralltimer",new Date)),d.supportsDataObject=function(a){return a[0]=parseInt(a[0],10),a[0]>1||1===a[0]&&parseInt(a[1],10)>=4}(a.fn.jquery.split(".")),d.emptyTo=d.emptyTo.toLowerCase(),d.stringTo=d.stringTo.toLowerCase(),d.last={sortList:[],clickedIndex:-1},/tablesorter\-/.test(f.attr("class"))||(e=""!==d.theme?" tablesorter-"+d.theme:""),d.table=c,d.$table=f.addClass(b.css.table+" "+d.tableClass+e).attr("role","grid"),d.$headers=f.find(d.selectorHeaders),d.namespace?d.namespace="."+d.namespace.replace(b.regex.nonWord,""):d.namespace=".tablesorter"+Math.random().toString(16).slice(2),d.$table.children().children("tr").attr("role","row"),d.$tbodies=f.children("tbody:not(."+d.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"}),d.$table.children("caption").length&&(e=d.$table.children("caption")[0],e.id||(e.id=d.namespace.slice(1)+"caption"),d.$table.attr("aria-labelledby",e.id)),d.widgetInit={},d.textExtraction=d.$table.attr("data-text-extraction")||d.textExtraction||"basic",b.buildHeaders(d),b.fixColumnWidth(c),b.addWidgetFromClass(c),b.applyWidgetOptions(c),b.setupParsers(d),d.totalRows=0,d.delayInit||b.buildCache(d),b.bindEvents(c,d.$headers,!0),b.bindMethods(d),d.supportsDataObject&&"undefined"!=typeof f.data().sortlist?d.sortList=f.data().sortlist:g&&f.metadata()&&f.metadata().sortlist&&(d.sortList=f.metadata().sortlist),b.applyWidget(c,!0),d.sortList.length>0?b.sortOn(d,d.sortList,{},!d.initWidgets):(b.setHeadersCss(d),d.initWidgets&&b.applyWidget(c,!1)),d.showProcessing&&f.unbind("sortBegin"+d.namespace+" sortEnd"+d.namespace).bind("sortBegin"+d.namespace+" sortEnd"+d.namespace,function(a){clearTimeout(d.timerProcessing),b.isProcessing(c),"sortBegin"===a.type&&(d.timerProcessing=setTimeout(function(){b.isProcessing(c,!0)},500))}),c.hasInitialized=!0,c.isProcessing=!1,d.debug&&(console.log("Overall initialization time: "+b.benchmark(a.data(c,"startoveralltimer"))),d.debug&&console.groupEnd&&console.groupEnd()),f.triggerHandler("tablesorter-initialized",c),"function"==typeof d.initialized&&d.initialized(c)},bindMethods:function(c){var d=c.$table,e=c.namespace,f="sortReset update updateRows updateAll updateHeaders addRows updateCell updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(e+" ");d.unbind(f.replace(b.regex.spaces," ")).bind("sortReset"+e,function(a,c){a.stopPropagation(),b.sortReset(this.config,c)}).bind("updateAll"+e,function(a,c,d){a.stopPropagation(),b.updateAll(this.config,c,d)}).bind("update"+e+" updateRows"+e,function(a,c,d){a.stopPropagation(),b.update(this.config,c,d)}).bind("updateHeaders"+e,function(a,c){a.stopPropagation(),b.updateHeaders(this.config,c)}).bind("updateCell"+e,function(a,c,d,e){a.stopPropagation(),b.updateCell(this.config,c,d,e)}).bind("addRows"+e,function(a,c,d,e){a.stopPropagation(),b.addRows(this.config,c,d,e)}).bind("updateComplete"+e,function(){this.isUpdating=!1}).bind("sorton"+e,function(a,c,d,e){a.stopPropagation(),b.sortOn(this.config,c,d,e)}).bind("appendCache"+e,function(c,d,e){c.stopPropagation(),b.appendCache(this.config,e),a.isFunction(d)&&d(this)}).bind("updateCache"+e,function(a,c,d){a.stopPropagation(),b.updateCache(this.config,c,d)}).bind("applyWidgetId"+e,function(a,c){a.stopPropagation(),b.applyWidgetId(this,c)}).bind("applyWidgets"+e,function(a,c){a.stopPropagation(),b.applyWidget(this,c)}).bind("refreshWidgets"+e,function(a,c,d){a.stopPropagation(),b.refreshWidgets(this,c,d)}).bind("removeWidget"+e,function(a,c,d){a.stopPropagation(),b.removeWidget(this,c,d)}).bind("destroy"+e,function(a,c,d){a.stopPropagation(),b.destroy(this,c,d)}).bind("resetToLoadState"+e,function(d){d.stopPropagation(),b.removeWidget(this,!0,!1),c=a.extend(!0,b.defaults,c.originalSettings),this.hasInitialized=!1,b.setup(this,c)})},bindEvents:function(c,d,e){c=a(c)[0];var f,g=c.config,h=g.namespace,i=null;e!==!0&&(d.addClass(h.slice(1)+"_extra_headers"),f=a.fn.closest?d.closest("table")[0]:d.parents("table")[0],f&&"TABLE"===f.nodeName&&f!==c&&a(f).addClass(h.slice(1)+"_extra_table")),f=(g.pointerDown+" "+g.pointerUp+" "+g.pointerClick+" sort keyup ").replace(b.regex.spaces," ").split(" ").join(h+" "),d.find(g.selectorSort).add(d.filter(g.selectorSort)).unbind(f).bind(f,function(c,e){var f,h,j,k=a(c.target),l=" "+c.type+" ";if(!(1!==(c.which||c.button)&&!l.match(" "+g.pointerClick+" | sort | keyup ")||" keyup "===l&&13!==c.which||l.match(" "+g.pointerClick+" ")&&"undefined"!=typeof c.which||l.match(" "+g.pointerUp+" ")&&i!==c.target&&e!==!0)){if(l.match(" "+g.pointerDown+" "))return i=c.target,j=k.jquery.split("."),void("1"===j[0]&&j[1]<4&&c.preventDefault());if(i=null,b.regex.formElements.test(c.target.nodeName)||k.hasClass(g.cssNoSort)||k.parents("."+g.cssNoSort).length>0||k.parents("button").length>0)return!g.cancelSelection;g.delayInit&&b.isEmptyObject(g.cache)&&b.buildCache(g),f=a.fn.closest?a(this).closest("th, td"):/TH|TD/.test(this.nodeName)?a(this):a(this).parents("th, td"),j=d.index(f),g.last.clickedIndex=0>j?f.attr("data-column"):j,h=g.$headers[g.last.clickedIndex],h&&!h.sortDisabled&&b.initSort(g,h,c)}}),g.cancelSelection&&d.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})},buildHeaders:function(c){var d,e,f,g;for(c.headerList=[],c.headerContent=[],c.sortVars=[],c.debug&&(f=new Date),c.columns=b.computeColumnIndex(c.$table.children("thead, tfoot").children("tr")),e=c.cssIcon?'<i class="'+(c.cssIcon===b.css.icon?b.css.icon:c.cssIcon+" "+b.css.icon)+'"></i>':"",c.$headers=a(a.map(c.$table.find(c.selectorHeaders),function(d,f){var g,h,i,j,k,l=a(d);if(!l.parent().hasClass(c.cssIgnoreRow))return g=b.getColumnData(c.table,c.headers,f,!0),c.headerContent[f]=l.html(),""===c.headerTemplate||l.find("."+b.css.headerIn).length||(j=c.headerTemplate.replace(b.regex.templateContent,l.html()).replace(b.regex.templateIcon,l.find("."+b.css.icon).length?"":e),c.onRenderTemplate&&(h=c.onRenderTemplate.apply(l,[f,j]),h&&"string"==typeof h&&(j=h)),l.html('<div class="'+b.css.headerIn+'">'+j+"</div>")),c.onRenderHeader&&c.onRenderHeader.apply(l,[f,c,c.$table]),i=parseInt(l.attr("data-column"),10),d.column=i,k=b.getData(l,g,"sortInitialOrder")||c.sortInitialOrder,c.sortVars[i]={count:-1,order:b.getOrder(k)?[1,0,2]:[0,1,2],lockedOrder:!1},k=b.getData(l,g,"lockedOrder")||!1,"undefined"!=typeof k&&k!==!1&&(c.sortVars[i].lockedOrder=!0,c.sortVars[i].order=b.getOrder(k)?[1,1,1]:[0,0,0]),c.headerList[f]=d,l.addClass(b.css.header+" "+c.cssHeader).parent().addClass(b.css.headerRow+" "+c.cssHeaderRow).attr("role","row"),c.tabIndex&&l.attr("tabindex",0),d})),c.$headerIndexed=[],g=0;g<c.columns;g++)b.isEmptyObject(c.sortVars[g])&&(c.sortVars[g]={}),d=c.$headers.filter('[data-column="'+g+'"]'),c.$headerIndexed[g]=d.length?d.not(".sorter-false").length?d.not(".sorter-false").filter(":last"):d.filter(":last"):a();c.$table.find(c.selectorHeaders).attr({scope:"col",role:"columnheader"}),b.updateHeader(c),c.debug&&(console.log("Built headers:"+b.benchmark(f)),console.log(c.$headers))},addInstanceMethods:function(c){a.extend(b.instanceMethods,c)},setupParsers:function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=a.table,s=0,t={};if(a.$tbodies=a.$table.children("tbody:not(."+a.cssInfoBlock+")"),p="undefined"==typeof c?a.$tbodies:c,q=p.length,0===q)return a.debug?console.warn("Warning: *Empty table!* Not building a parser cache"):"";for(a.debug&&(o=new Date,console[console.group?"group":"log"]("Detecting parsers for each column")),e={extractors:[],parsers:[]};q>s;){if(d=p[s].rows,d.length)for(h=0,g=a.columns,i=0;g>i;i++){if(j=a.$headerIndexed[h],j&&j.length&&(k=b.getColumnData(r,a.headers,h),n=b.getParserById(b.getData(j,k,"extractor")),m=b.getParserById(b.getData(j,k,"sorter")),l="false"===b.getData(j,k,"parser"),a.empties[h]=(b.getData(j,k,"empty")||a.emptyTo||(a.emptyToBottom?"bottom":"top")).toLowerCase(),a.strings[h]=(b.getData(j,k,"string")||a.stringTo||"max").toLowerCase(),l&&(m=b.getParserById("no-parser")),n||(n=!1),m||(m=b.detectParserForColumn(a,d,-1,h)),a.debug&&(t["("+h+") "+j.text()]={parser:m.id,extractor:n?n.id:"none",string:a.strings[h],empty:a.empties[h]}),e.parsers[h]=m,e.extractors[h]=n,f=j[0].colSpan-1,f>0))for(h+=f,g+=f;f+1>0;)e.parsers[h-f]=m,e.extractors[h-f]=n,f--;h++}s+=e.parsers.length?q:1}a.debug&&(b.isEmptyObject(t)?console.warn("  No parsers detected!"):console[console.table?"table":"log"](t),console.log("Completed detecting parsers"+b.benchmark(o)),console.groupEnd&&console.groupEnd()),a.parsers=e.parsers,a.extractors=e.extractors},addParser:function(a){var c,d=b.parsers.length,e=!0;for(c=0;d>c;c++)b.parsers[c].id.toLowerCase()===a.id.toLowerCase()&&(e=!1);e&&b.parsers.push(a)},getParserById:function(a){if("false"==a)return!1;var c,d=b.parsers.length;for(c=0;d>c;c++)if(b.parsers[c].id.toLowerCase()===a.toString().toLowerCase())return b.parsers[c];return!1},detectParserForColumn:function(c,d,e,f){for(var g,h,i,j=b.parsers.length,k=!1,l="",m=!0;""===l&&m;)e++,i=d[e],i&&50>e?i.className.indexOf(b.cssIgnoreRow)<0&&(k=d[e].cells[f],l=b.getElementText(c,k,f),h=a(k),c.debug&&console.log("Checking if value was empty on row "+e+", column: "+f+': "'+l+'"')):m=!1;for(;--j>=0;)if(g=b.parsers[j],g&&"text"!==g.id&&g.is&&g.is(l,c.table,k,h))return g;return b.getParserById("text")},getElementText:function(c,d,e){if(!d)return"";var f,g=c.textExtraction||"",h=d.jquery?d:a(d);return"string"==typeof g?"basic"===g&&"undefined"!=typeof(f=h.attr(c.textAttribute))?a.trim(f):a.trim(d.textContent||h.text()):"function"==typeof g?a.trim(g(h[0],c.table,e)):"function"==typeof(f=b.getColumnData(c.table,g,e))?a.trim(f(h[0],c.table,e)):a.trim(h[0].textContent||h.text())},getParsedText:function(a,c,d,e){"undefined"==typeof e&&(e=b.getElementText(a,c,d));var f=""+e,g=a.parsers[d],h=a.extractors[d];return g&&(h&&"function"==typeof h.format&&(e=h.format(e,a.table,c,d)),f="no-parser"===g.id?"":g.format(""+e,a.table,c,d),a.ignoreCase&&"string"==typeof f&&(f=f.toLowerCase())),f},buildCache:function(c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=c.table,C=c.parsers;if(c.$tbodies=c.$table.children("tbody:not(."+c.cssInfoBlock+")"),l="undefined"==typeof e?c.$tbodies:e,c.cache={},c.totalRows=0,!C)return c.debug?console.warn("Warning: *Empty table!* Not building a cache"):"";for(c.debug&&(q=new Date),c.showProcessing&&b.isProcessing(B,!0),k=0;k<l.length;k++){for(u=[],f=c.cache[k]={normalized:[]},r=l[k]&&l[k].rows.length||0,i=0;r>i;++i)if(s={child:[],raw:[]},m=a(l[k].rows[i]),n=[],m.hasClass(c.cssChildRow)&&0!==i)for(z=f.normalized.length-1,t=f.normalized[z][c.columns],t.$row=t.$row.add(m),m.prev().hasClass(c.cssChildRow)||m.prev().addClass(b.css.cssHasChild),o=m.children("th, td"),z=t.child.length,t.child[z]=[],w=0,y=c.columns,j=0;y>j;j++)p=o[j],p&&(t.child[z][j]=b.getParsedText(c,p,j),v=o[j].colSpan-1,v>0&&(w+=v,y+=v)),w++;else{for(s.$row=m,s.order=i,w=0,y=c.columns,j=0;y>j;++j){if(p=m[0].cells[j],p&&w<c.columns&&(x="undefined"!=typeof C[w],!x&&c.debug&&console.warn("No parser found for row: "+i+", column: "+j+'; cell containing: "'+a(p).text()+'"; does it have a header?'),g=b.getElementText(c,p,w),s.raw[w]=g,h=b.getParsedText(c,p,w,g),n[w]=h,x&&"numeric"===(C[w].type||"").toLowerCase()&&(u[w]=Math.max(Math.abs(h)||0,u[w]||0)),v=p.colSpan-1,v>0)){for(A=0;v>=A;)s.raw[w+A]=c.duplicateSpan||0===A?g:"",n[w+A]=c.duplicateSpan||0===A?g:"",A++;w+=v,y+=v}w++}n[c.columns]=s,f.normalized.push(n)}f.colMax=u,c.totalRows+=f.normalized.length}if(c.showProcessing&&b.isProcessing(B),c.debug){for(z=Math.min(5,c.cache[0].normalized.length),console[console.group?"group":"log"]("Building cache for "+c.totalRows+" rows (showing "+z+" rows in log)"+b.benchmark(q)),g={},j=0;j<c.columns;j++)for(w=0;z>w;w++)g["row: "+w]||(g["row: "+w]={}),g["row: "+w][c.$headerIndexed[j].text()]=c.cache[0].normalized[w][j];console[console.table?"table":"log"](g),console.groupEnd&&console.groupEnd()}a.isFunction(d)&&d(B)},getColumnText:function(c,d,e,f){c=a(c)[0];var g,h,i,j,k,l,m,n,o,p,q="function"==typeof e,r="all"===d,s={raw:[],parsed:[],$cell:[]},t=c.config;if(!b.isEmptyObject(t)){for(k=t.$tbodies.length,g=0;k>g;g++)for(i=t.cache[g].normalized,l=i.length,h=0;l>h;h++)j=i[h],(!f||j[t.columns].$row.is(f))&&(p=!0,n=r?j.slice(0,t.columns):j[d],j=j[t.columns],m=r?j.raw:j.raw[d],o=r?j.$row.children():j.$row.children().eq(d),q&&(p=e({tbodyIndex:g,rowIndex:h,parsed:n,raw:m,$row:j.$row,$cell:o})),p!==!1&&(s.parsed.push(n),s.raw.push(m),s.$cell.push(o)));return s}t.debug&&console.warn("No cache found - aborting getColumnText function!")},setHeadersCss:function(c){var d,e,f,g=c.sortList,h=g.length,i=b.css.sortNone+" "+c.cssNone,j=[b.css.sortAsc+" "+c.cssAsc,b.css.sortDesc+" "+c.cssDesc],k=[c.cssIconAsc,c.cssIconDesc,c.cssIconNone],l=["ascending","descending"],m=c.$table.find("tfoot tr").children().add(a(c.namespace+"_extra_headers")).removeClass(j.join(" "));for(c.$headers.removeClass(j.join(" ")).addClass(i).attr("aria-sort","none").find("."+b.css.icon).removeClass(k.join(" ")).addClass(k[2]),e=0;h>e;e++)if(2!==g[e][1]&&(d=c.$headers.filter(function(a){for(var d=!0,e=c.$headers.eq(a),f=parseInt(e.attr("data-column"),10),g=f+c.$headers[a].colSpan;g>f;f++)d=d?d||b.isValueInArray(f,c.sortList)>-1:!1;return d}),d=d.not(".sorter-false").filter('[data-column="'+g[e][0]+'"]'+(1===h?":last":"")),d.length)){for(f=0;f<d.length;f++)d[f].sortDisabled||d.eq(f).removeClass(i).addClass(j[g[e][1]]).attr("aria-sort",l[g[e][1]]).find("."+b.css.icon).removeClass(k[2]).addClass(k[g[e][1]]);m.length&&m.filter('[data-column="'+g[e][0]+'"]').removeClass(i).addClass(j[g[e][1]])}for(h=c.$headers.length,e=0;h>e;e++)b.setColumnAriaLabel(c,c.$headers.eq(e))},setColumnAriaLabel:function(c,d,e){if(d.length){var f=parseInt(d.attr("data-column"),10),g=d.hasClass(b.css.sortAsc)?"sortAsc":d.hasClass(b.css.sortDesc)?"sortDesc":"sortNone",h=a.trim(d.text())+": "+b.language[g];d.hasClass("sorter-false")||e===!1?h+=b.language.sortDisabled:(e=c.sortVars[f].order[(c.sortVars[f].count+1)%(c.sortReset?3:2)],h+=b.language[0===e?"nextAsc":1===e?"nextDesc":"nextNone"]),d.attr("aria-label",h)}},updateHeader:function(a){var c,d,e,f,g=a.table,h=a.$headers.length;for(c=0;h>c;c++)e=a.$headers.eq(c),f=b.getColumnData(g,a.headers,c,!0),d="false"===b.getData(e,f,"sorter")||"false"===b.getData(e,f,"parser"),b.setColumnSort(a,e,d)},setColumnSort:function(a,b,c){var d=a.table.id;b[0].sortDisabled=c,b[c?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+c),a.tabIndex&&(c?b.removeAttr("tabindex"):b.attr("tabindex","0")),d&&(c?b.removeAttr("aria-controls"):b.attr("aria-controls",d))},updateHeaderSortCount:function(c,d){var e,f,g,h,i,j,k,l,m=d||c.sortList,n=m.length;for(c.sortList=[],h=0;n>h;h++)if(k=m[h],e=parseInt(k[0],10),e<c.columns){switch(c.sortVars[e].order||(l=c.sortVars[e].order=b.getOrder(c.sortInitialOrder)?[1,0,2]:[0,1,2],c.sortVars[e].count=0),l=c.sortVars[e].order,f=(""+k[1]).match(/^(1|d|s|o|n)/),f=f?f[0]:""){case"1":case"d":f=1;break;case"s":f=i||0;break;case"o":j=l[(i||0)%(c.sortReset?3:2)],f=0===j?1:1===j?0:2;break;case"n":f=l[++c.sortVars[e].count%(c.sortReset?3:2)];break;default:f=0}i=0===h?f:i,g=[e,parseInt(f,10)||0],c.sortList.push(g),f=a.inArray(g[1],l),c.sortVars[e].count=f>=0?f:g[1]%(c.sortReset?3:2)}},updateAll:function(a,c,d){var e=a.table;e.isUpdating=!0,b.refreshWidgets(e,!0,!0),b.buildHeaders(a),b.bindEvents(e,a.$headers,!0),b.bindMethods(a),b.commonUpdate(a,c,d)},update:function(a,c,d){var e=a.table;e.isUpdating=!0,b.updateHeader(a),b.commonUpdate(a,c,d)},updateHeaders:function(a,c){a.table.isUpdating=!0,b.buildHeaders(a),b.bindEvents(a.table,a.$headers,!0),b.resortComplete(a,c)},updateCell:function(c,d,e,f){if(b.isEmptyObject(c.cache))return b.updateHeader(c),void b.commonUpdate(c,e,f);c.table.isUpdating=!0,c.$table.find(c.selectorRemove).remove();var g,h,i,j,k,l,m=c.$tbodies,n=a(d),o=m.index(a.fn.closest?n.closest("tbody"):n.parents("tbody").filter(":first")),p=c.cache[o],q=a.fn.closest?n.closest("tr"):n.parents("tr").filter(":first");if(d=n[0],m.length&&o>=0){if(i=m.eq(o).find("tr").index(q),k=p.normalized[i],l=q[0].cells.length,l!==c.columns)for(j=0,g=!1,h=0;l>h;h++)g||q[0].cells[h]===d?g=!0:j+=q[0].cells[h].colSpan;else j=n.index();g=b.getElementText(c,d,j),k[c.columns].raw[j]=g,g=b.getParsedText(c,d,j,g),k[j]=g,k[c.columns].$row=q,"numeric"===(c.parsers[j].type||"").toLowerCase()&&(p.colMax[j]=Math.max(Math.abs(g)||0,p.colMax[j]||0)),g="undefined"!==e?e:c.resort,g!==!1?b.checkResort(c,g,f):b.resortComplete(c,f)}else c.debug&&console.error("updateCell aborted, tbody missing or not within the indicated table"),c.table.isUpdating=!1},addRows:function(c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s="string"==typeof d&&1===c.$tbodies.length&&/<tr/.test(d||""),t=c.table;if(s)d=a(d),c.$tbodies.append(d);else if(!(d&&d instanceof jQuery&&(a.fn.closest?d.closest("table")[0]:d.parents("table")[0])===c.table))return c.debug&&console.error("addRows method requires (1) a jQuery selector reference to rows that have already been added to the table, or (2) row HTML string to be added to a table with only one tbody"),!1;if(t.isUpdating=!0,b.isEmptyObject(c.cache))b.updateHeader(c),b.commonUpdate(c,e,f);else{for(k=d.filter("tr").attr("role","row").length,i=c.$tbodies.index(d.parents("tbody").filter(":first")),c.parsers&&c.parsers.length||b.setupParsers(c),j=0;k>j;j++){for(n=0,m=d[j].cells.length,p=[],o={child:[],raw:[],$row:d.eq(j),order:c.cache[i].normalized.length},l=0;m>l;l++)q=d[j].cells[l],g=b.getElementText(c,q,n),o.raw[n]=g,h=b.getParsedText(c,q,n,g),p[n]=h,"numeric"===(c.parsers[n].type||"").toLowerCase()&&(c.cache[i].colMax[n]=Math.max(Math.abs(h)||0,c.cache[i].colMax[n]||0)),r=q.colSpan-1,r>0&&(n+=r),n++;p[c.columns]=o,c.cache[i].normalized.push(p)}b.checkResort(c,e,f)}},updateCache:function(a,c,d){a.parsers&&a.parsers.length||b.setupParsers(a,d),b.buildCache(a,c,d)},appendCache:function(a,c){var d,e,f,g,h,i,j,k=a.table,l=a.widgetOptions,m=a.$tbodies,n=[],o=a.cache;if(b.isEmptyObject(o))return a.appender?a.appender(k,n):k.isUpdating?a.$table.triggerHandler("updateComplete",k):"";for(a.debug&&(j=new Date),i=0;i<m.length;i++)if(f=m.eq(i),f.length){for(g=b.processTbody(k,f,!0),d=o[i].normalized,e=d.length,h=0;e>h;h++)n.push(d[h][a.columns].$row),a.appender&&(!a.pager||a.pager.removeRows&&l.pager_removeRows||a.pager.ajax)||g.append(d[h][a.columns].$row);b.processTbody(k,g,!1)}a.appender&&a.appender(k,n),a.debug&&console.log("Rebuilt table"+b.benchmark(j)),c||a.appender||b.applyWidget(k),k.isUpdating&&a.$table.triggerHandler("updateComplete",k)},commonUpdate:function(a,c,d){a.$table.find(a.selectorRemove).remove(),b.setupParsers(a),b.buildCache(a),b.checkResort(a,c,d)},initSort:function(c,d,e){if(c.table.isUpdating)return setTimeout(function(){b.initSort(c,d,e)},50);var f,g,h,i,j,k,l,m=!e[c.sortMultiSortKey],n=c.table,o=c.$headers.length,p=parseInt(a(d).attr("data-column"),10),q=c.sortVars[p].order;if(c.$table.triggerHandler("sortStart",n),c.sortVars[p].count=e[c.sortResetKey]?2:(c.sortVars[p].count+1)%(c.sortReset?3:2),c.sortRestart)for(h=0;o>h;h++)l=c.$headers.eq(h),k=parseInt(l.attr("data-column"),10),p!==k&&(m||l.hasClass(b.css.sortNone))&&(c.sortVars[k].count=-1);if(m){if(c.sortList=[],c.last.sortList=[],null!==c.sortForce)for(f=c.sortForce,g=0;g<f.length;g++)f[g][0]!==p&&c.sortList.push(f[g]);if(i=q[c.sortVars[p].count],2>i&&(c.sortList.push([p,i]),d.colSpan>1))for(g=1;g<d.colSpan;g++)c.sortList.push([p+g,i]),c.sortVars[p+g].count=a.inArray(i,q)}else if(c.sortList=a.extend([],c.last.sortList),b.isValueInArray(p,c.sortList)>=0)for(g=0;g<c.sortList.length;g++)k=c.sortList[g],k[0]===p&&(k[1]=q[c.sortVars[p].count],2===k[1]&&(c.sortList.splice(g,1),c.sortVars[p].count=-1));else if(i=q[c.sortVars[p].count],2>i&&(c.sortList.push([p,i]),d.colSpan>1))for(g=1;g<d.colSpan;g++)c.sortList.push([p+g,i]),c.sortVars[p+g].count=a.inArray(i,q);if(c.last.sortList=a.extend([],c.sortList),c.sortList.length&&c.sortAppend&&(f=a.isArray(c.sortAppend)?c.sortAppend:c.sortAppend[c.sortList[0][0]],!b.isEmptyObject(f)))for(g=0;g<f.length;g++)if(f[g][0]!==p&&b.isValueInArray(f[g][0],c.sortList)<0){if(i=f[g][1],j=(""+i).match(/^(a|d|s|o|n)/))switch(k=c.sortList[0][1],j[0]){case"d":i=1;break;case"s":i=k;break;case"o":i=0===k?1:0;break;case"n":i=(k+1)%(c.sortReset?3:2);break;default:i=0}c.sortList.push([f[g][0],i])}c.$table.triggerHandler("sortBegin",n),setTimeout(function(){b.setHeadersCss(c),b.multisort(c),b.appendCache(c),c.$table.triggerHandler("sortBeforeEnd",n),c.$table.triggerHandler("sortEnd",n)},1)},multisort:function(a){var c,d,e,f,g=a.table,h=0,i=a.textSorter||"",j=a.sortList,k=j.length,l=a.$tbodies.length;if(!a.serverSideSorting&&!b.isEmptyObject(a.cache)){for(a.debug&&(d=new Date),c=0;l>c;c++)e=a.cache[c].colMax,f=a.cache[c].normalized,f.sort(function(c,d){var f,l,m,n,o,p,q;for(f=0;k>f;f++){if(m=j[f][0],n=j[f][1],h=0===n,a.sortStable&&c[m]===d[m]&&1===k)return c[a.columns].order-d[a.columns].order;if(l=/n/i.test(b.getSortType(a.parsers,m)),l&&a.strings[m]?(l="boolean"==typeof b.string[a.strings[m]]?(h?1:-1)*(b.string[a.strings[m]]?-1:1):a.strings[m]?b.string[a.strings[m]]||0:0,o=a.numberSorter?a.numberSorter(c[m],d[m],h,e[m],g):b["sortNumeric"+(h?"Asc":"Desc")](c[m],d[m],l,e[m],m,a)):(p=h?c:d,q=h?d:c,o="function"==typeof i?i(p[m],q[m],h,m,g):"object"==typeof i&&i.hasOwnProperty(m)?i[m](p[m],q[m],h,m,g):b["sortNatural"+(h?"Asc":"Desc")](c[m],d[m],m,a)),o)return o}return c[a.columns].order-d[a.columns].order});a.debug&&console.log("Applying sort "+j.toString()+b.benchmark(d))}},resortComplete:function(b,c){b.table.isUpdating&&b.$table.triggerHandler("updateComplete",b.table),a.isFunction(c)&&c(b.table)},checkResort:function(c,d,e){var f=a.isArray(d)?d:c.sortList,g="undefined"==typeof d?c.resort:d;g===!1||c.serverSideSorting||c.table.isProcessing?(b.resortComplete(c,e),b.applyWidget(c.table,!1)):f.length?b.sortOn(c,f,function(){b.resortComplete(c,e)},!0):b.sortReset(c,function(){b.resortComplete(c,e),b.applyWidget(c.table,!1)})},sortOn:function(c,d,e,f){var g=c.table;c.$table.triggerHandler("sortStart",g),b.updateHeaderSortCount(c,d),b.setHeadersCss(c),c.delayInit&&b.isEmptyObject(c.cache)&&b.buildCache(c),c.$table.triggerHandler("sortBegin",g),b.multisort(c),b.appendCache(c,f),c.$table.triggerHandler("sortBeforeEnd",g),c.$table.triggerHandler("sortEnd",g),b.applyWidget(g),a.isFunction(e)&&e(g)},sortReset:function(c,d){c.sortList=[],b.setHeadersCss(c),b.multisort(c),b.appendCache(c),a.isFunction(d)&&d(c.table)},getSortType:function(a,b){return a&&a[b]?a[b].type||"":""},getOrder:function(a){return/^d/i.test(a)||1===a},sortNatural:function(a,c){if(a===c)return 0;var d,e,f,g,h,i,j=b.regex;if(j.hex.test(c)){if(d=parseInt(a.match(j.hex),16),e=parseInt(c.match(j.hex),16),e>d)return-1;if(d>e)return 1}for(d=a.replace(j.chunk,"\\0$1\\0").replace(j.chunks,"").split("\\0"),e=c.replace(j.chunk,"\\0$1\\0").replace(j.chunks,"").split("\\0"),i=Math.max(d.length,e.length),h=0;i>h;h++){if(f=isNaN(d[h])?d[h]||0:parseFloat(d[h])||0,g=isNaN(e[h])?e[h]||0:parseFloat(e[h])||0,isNaN(f)!==isNaN(g))return isNaN(f)?1:-1;if(typeof f!=typeof g&&(f+="",g+=""),g>f)return-1;if(f>g)return 1}return 0},sortNaturalAsc:function(a,c,d,e){if(a===c)return 0;var f=b.string[e.empties[d]||e.emptyTo];return""===a&&0!==f?"boolean"==typeof f?f?-1:1:-f||-1:""===c&&0!==f?"boolean"==typeof f?f?1:-1:f||1:b.sortNatural(a,c)},sortNaturalDesc:function(a,c,d,e){if(a===c)return 0;var f=b.string[e.empties[d]||e.emptyTo];return""===a&&0!==f?"boolean"==typeof f?f?-1:1:f||1:""===c&&0!==f?"boolean"==typeof f?f?1:-1:-f||-1:b.sortNatural(c,a)},sortText:function(a,b){return a>b?1:b>a?-1:0},getTextValue:function(a,b,c){if(c){var d,e=a?a.length:0,f=c+b;for(d=0;e>d;d++)f+=a.charCodeAt(d);return b*f}return 0},sortNumericAsc:function(a,c,d,e,f,g){if(a===c)return 0;var h=b.string[g.empties[f]||g.emptyTo];return""===a&&0!==h?"boolean"==typeof h?h?-1:1:-h||-1:""===c&&0!==h?"boolean"==typeof h?h?1:-1:h||1:(isNaN(a)&&(a=b.getTextValue(a,d,e)),isNaN(c)&&(c=b.getTextValue(c,d,e)),a-c)},sortNumericDesc:function(a,c,d,e,f,g){if(a===c)return 0;var h=b.string[g.empties[f]||g.emptyTo];return""===a&&0!==h?"boolean"==typeof h?h?-1:1:h||1:""===c&&0!==h?"boolean"==typeof h?h?1:-1:-h||-1:(isNaN(a)&&(a=b.getTextValue(a,d,e)),isNaN(c)&&(c=b.getTextValue(c,d,e)),c-a)},sortNumeric:function(a,b){return a-b},addWidget:function(a){b.widgets.push(a)},hasWidget:function(b,c){return b=a(b),b.length&&b[0].config&&b[0].config.widgetInit[c]||!1},getWidgetById:function(a){var c,d,e=b.widgets.length;for(c=0;e>c;c++)if(d=b.widgets[c],d&&d.id&&d.id.toLowerCase()===a.toLowerCase())return d},applyWidgetOptions:function(c){var d,e,f=c.config,g=f.widgets.length;if(g)for(d=0;g>d;d++)e=b.getWidgetById(f.widgets[d]),e&&e.options&&(f.widgetOptions=a.extend(!0,{},e.options,f.widgetOptions))},addWidgetFromClass:function(a){var c,d,e=a.config,f="\\s"+e.widgetClass.replace(b.regex.templateName,"([\\w-]+)")+"\\s",g=new RegExp(f,"g"),h=(" "+e.table.className+" ").match(g);if(h)for(c=h.length,d=0;c>d;d++)e.widgets.push(h[d].replace(g,"$1"))},applyWidgetId:function(c,d,e){var f,g,h,i=c.config,j=i.widgetOptions,k=b.getWidgetById(d);k&&(h=k.id,f=!1,a.inArray(h,i.widgets)<0&&i.widgets.push(h),i.debug&&(g=new Date),(e||!i.widgetInit[h])&&(i.widgetInit[h]=!0,c.hasInitialized&&b.applyWidgetOptions(c),"function"==typeof k.init&&(f=!0,i.debug&&console[console.group?"group":"log"]("Initializing "+h+" widget"),k.init(c,k,i,j))),e||"function"!=typeof k.format||(f=!0,i.debug&&console[console.group?"group":"log"]("Updating "+h+" widget"),k.format(c,i,j,!1)),i.debug&&f&&(console.log("Completed "+(e?"initializing ":"applying ")+h+" widget"+b.benchmark(g)),console.groupEnd&&console.groupEnd()))},applyWidget:function(c,d,e){c=a(c)[0];var f,g,h,i,j,k=c.config,l=[];if(d===!1||!c.hasInitialized||!c.isApplyingWidgets&&!c.isUpdating){if(k.debug&&(j=new Date),b.addWidgetFromClass(c),clearTimeout(k.timerReady),k.widgets.length){for(c.isApplyingWidgets=!0,k.widgets=a.grep(k.widgets,function(b,c){return a.inArray(b,k.widgets)===c}),h=k.widgets||[],g=h.length,f=0;g>f;f++)i=b.getWidgetById(h[f]),i&&i.id&&(i.priority||(i.priority=10),l[f]=i);for(l.sort(function(a,b){return a.priority<b.priority?-1:a.priority===b.priority?0:1}),g=l.length,k.debug&&console[console.group?"group":"log"]("Start "+(d?"initializing":"applying")+" widgets"),f=0;g>f;f++)i=l[f],i&&i.id&&b.applyWidgetId(c,i.id,d);k.debug&&console.groupEnd&&console.groupEnd(),d||"function"!=typeof e||e(c)}k.timerReady=setTimeout(function(){c.isApplyingWidgets=!1,a.data(c,"lastWidgetApplication",new Date),k.$table.triggerHandler("tablesorter-ready")},10),k.debug&&(i=k.widgets.length,console.log("Completed "+(d===!0?"initializing ":"applying ")+i+" widget"+(1!==i?"s":"")+b.benchmark(j)))}},removeWidget:function(c,d,e){c=a(c)[0];var f,g,h,i,j=c.config;if(d===!0)for(d=[],i=b.widgets.length,h=0;i>h;h++)g=b.widgets[h],g&&g.id&&d.push(g.id);else d=(a.isArray(d)?d.join(","):d||"").toLowerCase().split(/[\s,]+/);for(i=d.length,f=0;i>f;f++)g=b.getWidgetById(d[f]),h=a.inArray(d[f],j.widgets),g&&g.remove&&(j.debug&&console.log((e?"Refreshing":"Removing")+' "'+d[f]+'" widget'),g.remove(c,j,j.widgetOptions,e),j.widgetInit[d[f]]=!1),h>=0&&e!==!0&&j.widgets.splice(h,1)},refreshWidgets:function(c,d,e){c=a(c)[0];var f,g,h=c.config,i=h.widgets,j=b.widgets,k=j.length,l=[],m=function(b){a(b).triggerHandler("refreshComplete")};for(f=0;k>f;f++)g=j[f],g&&g.id&&(d||a.inArray(g.id,i)<0)&&l.push(g.id);b.removeWidget(c,l.join(","),!0),e!==!0?(b.applyWidget(c,d||!1,m),d&&b.applyWidget(c,!1,m)):m(c)},benchmark:function(a){return" ( "+((new Date).getTime()-a.getTime())+"ms )"},log:function(){console.log(arguments)},isEmptyObject:function(a){for(var b in a)return!1;return!0},isValueInArray:function(a,b){var c,d=b&&b.length||0;for(c=0;d>c;c++)if(b[c][0]===a)return c;return-1},formatFloat:function(c,d){if("string"!=typeof c||""===c)return c;var e,f=d&&d.config?d.config.usNumberFormat!==!1:"undefined"!=typeof d?d:!0;return c=f?c.replace(b.regex.comma,""):c.replace(b.regex.digitNonUS,"").replace(b.regex.comma,"."),b.regex.digitNegativeTest.test(c)&&(c=c.replace(b.regex.digitNegativeReplace,"-$1")),e=parseFloat(c),isNaN(e)?a.trim(c):e},isDigit:function(a){return isNaN(a)?b.regex.digitTest.test(a.toString().replace(b.regex.digitReplace,"")):""!==a},computeColumnIndex:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=c&&c.columns||0,o=[],p=new Array(n);for(d=0;d<b.length;d++)for(i=b[d].cells,e=0;e<i.length;e++){for(h=i[e],j=h.parentNode.rowIndex,k=h.rowSpan||1,l=h.colSpan||1,"undefined"==typeof o[j]&&(o[j]=[]),f=0;f<o[j].length+1;f++)if("undefined"==typeof o[j][f]){m=f;break}for(n&&h.cellIndex===m||(h.setAttribute?h.setAttribute("data-column",m):a(h).attr("data-column",m)),f=j;j+k>f;f++)for("undefined"==typeof o[f]&&(o[f]=[]),p=o[f],g=m;m+l>g;g++)p[g]="x"}return p.length;
},fixColumnWidth:function(c){c=a(c)[0];var d,e,f,g,h,i=c.config,j=i.$table.children("colgroup");if(j.length&&j.hasClass(b.css.colgroup)&&j.remove(),i.widthFixed&&0===i.$table.children("colgroup").length){for(j=a('<colgroup class="'+b.css.colgroup+'">'),d=i.$table.width(),f=i.$tbodies.find("tr:first").children(":visible"),g=f.length,h=0;g>h;h++)e=parseInt(f.eq(h).width()/d*1e3,10)/10+"%",j.append(a("<col>").css("width",e));i.$table.prepend(j)}},getData:function(b,c,d){var e,f,g="",h=a(b);return h.length?(e=a.metadata?h.metadata():!1,f=" "+(h.attr("class")||""),"undefined"!=typeof h.data(d)||"undefined"!=typeof h.data(d.toLowerCase())?g+=h.data(d)||h.data(d.toLowerCase()):e&&"undefined"!=typeof e[d]?g+=e[d]:c&&"undefined"!=typeof c[d]?g+=c[d]:" "!==f&&f.match(" "+d+"-")&&(g=f.match(new RegExp("\\s"+d+"-([\\w-]+)"))[1]||""),a.trim(g)):""},getColumnData:function(b,c,d,e,f){if("undefined"!=typeof c&&null!==c){b=a(b)[0];var g,h,i=b.config,j=f||i.$headers,k=i.$headerIndexed&&i.$headerIndexed[d]||j.filter('[data-column="'+d+'"]:last');if(c[d])return e?c[d]:c[j.index(k)];for(h in c)if("string"==typeof h&&(g=k.filter(h).add(k.find(h)),g.length))return c[h]}},isProcessing:function(c,d,e){c=a(c);var f=c[0].config,g=e||c.find("."+b.css.header);d?("undefined"!=typeof e&&f.sortList.length>0&&(g=g.filter(function(){return this.sortDisabled?!1:b.isValueInArray(parseFloat(a(this).attr("data-column")),f.sortList)>=0})),c.add(g).addClass(b.css.processing+" "+f.cssProcessing)):c.add(g).removeClass(b.css.processing+" "+f.cssProcessing)},processTbody:function(b,c,d){if(b=a(b)[0],d)return b.isProcessing=!0,c.before('<colgroup class="tablesorter-savemyplace"/>'),a.fn.detach?c.detach():c.remove();var e=a(b).find("colgroup.tablesorter-savemyplace");c.insertAfter(e),e.remove(),b.isProcessing=!1},clearTableBody:function(b){a(b)[0].config.$tbodies.children().detach()},characterEquivalents:{a:"Ã¡Ã Ã¢Ã£Ã¤ÄÃ¥",A:"ÃÃÃÃÃÄÃ",c:"Ã§ÄÄ",C:"ÃÄÄ",e:"Ã©Ã¨ÃªÃ«ÄÄ",E:"ÃÃÃÃÄÄ",i:"Ã­Ã¬Ä°Ã®Ã¯Ä±",I:"ÃÃÄ°ÃÃ",o:"Ã³Ã²Ã´ÃµÃ¶Å",O:"ÃÃÃÃÃÅ",ss:"Ã",SS:"áº",u:"ÃºÃ¹Ã»Ã¼Å¯",U:"ÃÃÃÃÅ®"},replaceAccents:function(a){var c,d="[",e=b.characterEquivalents;if(!b.characterRegex){b.characterRegexArray={};for(c in e)"string"==typeof c&&(d+=e[c],b.characterRegexArray[c]=new RegExp("["+e[c]+"]","g"));b.characterRegex=new RegExp(d+"]")}if(b.characterRegex.test(a))for(c in e)"string"==typeof c&&(a=a.replace(b.characterRegexArray[c],c));return a},restoreHeaders:function(c){var d,e,f=a(c)[0].config,g=f.$table.find(f.selectorHeaders),h=g.length;for(d=0;h>d;d++)e=g.eq(d),e.find("."+b.css.headerIn).length&&e.html(f.headerContent[d])},destroy:function(c,d,e){if(c=a(c)[0],c.hasInitialized){b.removeWidget(c,!0,!1);var f,g=a(c),h=c.config,i=h.debug,j=g.find("thead:first"),k=j.find("tr."+b.css.headerRow).removeClass(b.css.headerRow+" "+h.cssHeaderRow),l=g.find("tfoot:first > tr").children("th, td");d===!1&&a.inArray("uitheme",h.widgets)>=0&&(g.triggerHandler("applyWidgetId",["uitheme"]),g.triggerHandler("applyWidgetId",["zebra"])),j.find("tr").not(k).remove(),f="sortReset update updateRows updateAll updateHeaders updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets removeWidget destroy mouseup mouseleave "+"keypress sortBegin sortEnd resetToLoadState ".split(" ").join(h.namespace+" "),g.removeData("tablesorter").unbind(f.replace(b.regex.spaces," ")),h.$headers.add(l).removeClass([b.css.header,h.cssHeader,h.cssAsc,h.cssDesc,b.css.sortAsc,b.css.sortDesc,b.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true"),k.find(h.selectorSort).unbind("mousedown mouseup keypress ".split(" ").join(h.namespace+" ").replace(b.regex.spaces," ")),b.restoreHeaders(c),g.toggleClass(b.css.table+" "+h.tableClass+" tablesorter-"+h.theme,d===!1),c.hasInitialized=!1,delete c.config.cache,"function"==typeof e&&e(c),i&&console.log("tablesorter has been removed")}}};a.fn.tablesorter=function(c){return this.each(function(){var d=this,e=a.extend(!0,{},b.defaults,c,b.instanceMethods);e.originalSettings=c,!d.hasInitialized&&b.buildTable&&"TABLE"!==this.nodeName?b.buildTable(d,e):b.setup(d,e)})},window.console&&window.console.log||(b.logs=[],console={},console.log=console.warn=console.error=console.table=function(){var a=arguments.length>1?arguments:arguments[0];b.logs.push({date:Date.now(),log:a})}),b.addParser({id:"no-parser",is:function(){return!1},format:function(){return""},type:"text"}),b.addParser({id:"text",is:function(){return!0},format:function(c,d){var e=d.config;return c&&(c=a.trim(e.ignoreCase?c.toLocaleLowerCase():c),c=e.sortLocaleCompare?b.replaceAccents(c):c),c},type:"text"}),b.regex.nondigit=/[^\w,. \-()]/g,b.addParser({id:"digit",is:function(a){return b.isDigit(a)},format:function(c,d){var e=b.formatFloat((c||"").replace(b.regex.nondigit,""),d);return c&&"number"==typeof e?e:c?a.trim(c&&d.config.ignoreCase?c.toLocaleLowerCase():c):c},type:"numeric"}),b.regex.currencyReplace=/[+\-,. ]/g,b.regex.currencyTest=/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/,b.addParser({id:"currency",is:function(a){return a=(a||"").replace(b.regex.currencyReplace,""),b.regex.currencyTest.test(a)},format:function(c,d){var e=b.formatFloat((c||"").replace(b.regex.nondigit,""),d);return c&&"number"==typeof e?e:c?a.trim(c&&d.config.ignoreCase?c.toLocaleLowerCase():c):c},type:"numeric"}),b.regex.urlProtocolTest=/^(https?|ftp|file):\/\//,b.regex.urlProtocolReplace=/(https?|ftp|file):\/\//,b.addParser({id:"url",is:function(a){return b.regex.urlProtocolTest.test(a)},format:function(c){return c?a.trim(c.replace(b.regex.urlProtocolReplace,"")):c},parsed:!0,type:"text"}),b.regex.dash=/-/g,b.regex.isoDate=/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/,b.addParser({id:"isoDate",is:function(a){return b.regex.isoDate.test(a)},format:function(a,c){var d=a?new Date(a.replace(b.regex.dash,"/")):a;return d instanceof Date&&isFinite(d)?d.getTime():a},type:"numeric"}),b.regex.percent=/%/g,b.regex.percentTest=/(\d\s*?%|%\s*?\d)/,b.addParser({id:"percent",is:function(a){return b.regex.percentTest.test(a)&&a.length<15},format:function(a,c){return a?b.formatFloat(a.replace(b.regex.percent,""),c):a},type:"numeric"}),b.addParser({id:"image",is:function(a,b,c,d){return d.find("img").length>0},format:function(b,c,d){return a(d).find("img").attr(c.config.imgAttr||"alt")||b},parsed:!0,type:"text"}),b.regex.dateReplace=/(\S)([AP]M)$/i,b.regex.usLongDateTest1=/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i,b.regex.usLongDateTest2=/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i,b.addParser({id:"usLongDate",is:function(a){return b.regex.usLongDateTest1.test(a)||b.regex.usLongDateTest2.test(a)},format:function(a,c){var d=a?new Date(a.replace(b.regex.dateReplace,"$1 $2")):a;return d instanceof Date&&isFinite(d)?d.getTime():a},type:"numeric"}),b.regex.shortDateTest=/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/,b.regex.shortDateReplace=/[\-.,]/g,b.regex.shortDateXXY=/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,b.regex.shortDateYMD=/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,b.convertFormat=function(a,c){a=(a||"").replace(b.regex.spaces," ").replace(b.regex.shortDateReplace,"/"),"mmddyyyy"===c?a=a.replace(b.regex.shortDateXXY,"$3/$1/$2"):"ddmmyyyy"===c?a=a.replace(b.regex.shortDateXXY,"$3/$2/$1"):"yyyymmdd"===c&&(a=a.replace(b.regex.shortDateYMD,"$1/$2/$3"));var d=new Date(a);return d instanceof Date&&isFinite(d)?d.getTime():""},b.addParser({id:"shortDate",is:function(a){return a=(a||"").replace(b.regex.spaces," ").replace(b.regex.shortDateReplace,"/"),b.regex.shortDateTest.test(a)},format:function(a,c,d,e){if(a){var f=c.config,g=f.$headerIndexed[e],h=g.length&&g.data("dateFormat")||b.getData(g,b.getColumnData(c,f.headers,e),"dateFormat")||f.dateFormat;return g.length&&g.data("dateFormat",h),b.convertFormat(a,h)||a}return a},type:"numeric"}),b.regex.timeTest=/^([1-9]|1[0-2]):([0-5]\d)(\s[AP]M)|((?:[01]\d|[2][0-4]):[0-5]\d)$/i,b.regex.timeMatch=/([1-9]|1[0-2]):([0-5]\d)(\s[AP]M)|((?:[01]\d|[2][0-4]):[0-5]\d)/i,b.addParser({id:"time",is:function(a){return b.regex.timeTest.test(a)},format:function(a,c){var d,e=(a||"").match(b.regex.timeMatch),f=new Date(a),g=a&&(null!==e?e[0]:"00:00 AM"),h=g?new Date("2000/01/01 "+g.replace(b.regex.dateReplace,"$1 $2")):g;return h instanceof Date&&isFinite(h)?(d=f instanceof Date&&isFinite(f)?f.getTime():0,d?parseFloat(h.getTime()+"."+f.getTime()):h.getTime()):a},type:"numeric"}),b.addParser({id:"metadata",is:function(){return!1},format:function(b,c,d){var e=c.config,f=e.parserMetadataName?e.parserMetadataName:"sortValue";return a(d).metadata()[f]},type:"numeric"}),b.addWidget({id:"zebra",priority:90,format:function(b,c,d){var e,f,g,h,i,j,k,l=new RegExp(c.cssChildRow,"i"),m=c.$tbodies.add(a(c.namespace+"_extra_table").children("tbody:not(."+c.cssInfoBlock+")"));for(i=0;i<m.length;i++)for(g=0,e=m.eq(i).children("tr:visible").not(c.selectorRemove),k=e.length,j=0;k>j;j++)f=e.eq(j),l.test(f[0].className)||g++,h=g%2===0,f.removeClass(d.zebra[h?1:0]).addClass(d.zebra[h?0:1])},remove:function(a,c,d,e){if(!e){var f,g,h=c.$tbodies,i=(d.zebra||["even","odd"]).join(" ");for(f=0;f<h.length;f++)g=b.processTbody(a,h.eq(f),!0),g.children().removeClass(i),b.processTbody(a,g,!1)}}})}(jQuery),a.tablesorter});</script>
    <script>/*! tablesorter (FORK) - updated 12-13-2015 (v2.25.0)*/
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){return function(a,b,c){"use strict";var d=a.tablesorter||{};d.storage=function(d,e,f,g){d=a(d)[0];var h,i,j,k=!1,l={},m=d.config,n=m&&m.widgetOptions,o=g&&g.useSessionStorage||n&&n.storage_useSessionStorage?"sessionStorage":"localStorage",p=a(d),q=g&&g.id||p.attr(g&&g.group||n&&n.storage_group||"data-table-group")||n&&n.storage_tableId||d.id||a(".tablesorter").index(p),r=g&&g.url||p.attr(g&&g.page||n&&n.storage_page||"data-table-page")||n&&n.storage_fixedUrl||m&&m.fixedUrl||b.location.pathname;if(o in b)try{b[o].setItem("_tmptest","temp"),k=!0,b[o].removeItem("_tmptest")}catch(s){m&&m.debug&&console.warn(o+" is not supported in this browser")}return a.parseJSON&&(k?l=a.parseJSON(b[o][e]||"null")||{}:(i=c.cookie.split(/[;\s|=]/),h=a.inArray(e,i)+1,l=0!==h?a.parseJSON(i[h]||"null")||{}:{})),(f||""===f)&&b.JSON&&JSON.hasOwnProperty("stringify")?(l[r]||(l[r]={}),l[r][q]=f,k?b[o][e]=JSON.stringify(l):(j=new Date,j.setTime(j.getTime()+31536e6),c.cookie=e+"="+JSON.stringify(l).replace(/\"/g,'"')+"; expires="+j.toGMTString()+"; path=/"),void 0):l&&l[r]?l[r][q]:""}}(jQuery,window,document),function(a){"use strict";var b=a.tablesorter||{};b.themes={bootstrap:{table:"table table-bordered table-striped",caption:"caption",header:"bootstrap-header",sortNone:"",sortAsc:"",sortDesc:"",active:"",hover:"",icons:"",iconSortNone:"bootstrap-icon-unsorted",iconSortAsc:"icon-chevron-up glyphicon glyphicon-chevron-up",iconSortDesc:"icon-chevron-down glyphicon glyphicon-chevron-down",filterRow:"",footerRow:"",footerCells:"",even:"",odd:""},jui:{table:"ui-widget ui-widget-content ui-corner-all",caption:"ui-widget-content",header:"ui-widget-header ui-corner-all ui-state-default",sortNone:"",sortAsc:"",sortDesc:"",active:"ui-state-active",hover:"ui-state-hover",icons:"ui-icon",iconSortNone:"ui-icon-carat-2-n-s",iconSortAsc:"ui-icon-carat-1-n",iconSortDesc:"ui-icon-carat-1-s",filterRow:"",footerRow:"",footerCells:"",even:"ui-widget-content",odd:"ui-state-default"}},a.extend(b.css,{wrapper:"tablesorter-wrapper"}),b.addWidget({id:"uitheme",priority:10,format:function(c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r=b.themes,s=d.$table.add(a(d.namespace+"_extra_table")),t=d.$headers.add(a(d.namespace+"_extra_headers")),u=d.theme||"jui",v=r[u]||{},w=a.trim([v.sortNone,v.sortDesc,v.sortAsc,v.active].join(" ")),x=a.trim([v.iconSortNone,v.iconSortDesc,v.iconSortAsc].join(" "));for(d.debug&&(i=new Date),s.hasClass("tablesorter-"+u)&&d.theme===d.appliedTheme&&e.uitheme_applied||(e.uitheme_applied=!0,n=r[d.appliedTheme]||{},q=!a.isEmptyObject(n),o=q?[n.sortNone,n.sortDesc,n.sortAsc,n.active].join(" "):"",p=q?[n.iconSortNone,n.iconSortDesc,n.iconSortAsc].join(" "):"",q&&(e.zebra[0]=a.trim(" "+e.zebra[0].replace(" "+n.even,"")),e.zebra[1]=a.trim(" "+e.zebra[1].replace(" "+n.odd,"")),d.$tbodies.children().removeClass([n.even,n.odd].join(" "))),v.even&&(e.zebra[0]+=" "+v.even),v.odd&&(e.zebra[1]+=" "+v.odd),s.children("caption").removeClass(n.caption||"").addClass(v.caption),l=s.removeClass((d.appliedTheme?"tablesorter-"+(d.appliedTheme||""):"")+" "+(n.table||"")).addClass("tablesorter-"+u+" "+(v.table||"")).children("tfoot"),d.appliedTheme=d.theme,l.length&&l.children("tr").removeClass(n.footerRow||"").addClass(v.footerRow).children("th, td").removeClass(n.footerCells||"").addClass(v.footerCells),t.removeClass((q?[n.header,n.hover,o].join(" "):"")||"").addClass(v.header).not(".sorter-false").unbind("mouseenter.tsuitheme mouseleave.tsuitheme").bind("mouseenter.tsuitheme mouseleave.tsuitheme",function(b){a(this)["mouseenter"===b.type?"addClass":"removeClass"](v.hover||"")}),t.each(function(){var c=a(this);c.find("."+b.css.wrapper).length||c.wrapInner('<div class="'+b.css.wrapper+'" style="position:relative;height:100%;width:100%"></div>')}),d.cssIcon&&t.find("."+b.css.icon).removeClass(q?[n.icons,p].join(" "):"").addClass(v.icons||""),s.hasClass("hasFilters")&&s.children("thead").children("."+b.css.filterRow).removeClass(q?n.filterRow||"":"").addClass(v.filterRow||"")),f=0;f<d.columns;f++)j=d.$headers.add(a(d.namespace+"_extra_headers")).not(".sorter-false").filter('[data-column="'+f+'"]'),k=b.css.icon?j.find("."+b.css.icon):a(),m=t.not(".sorter-false").filter('[data-column="'+f+'"]:last'),m.length&&(j.removeClass(w),k.removeClass(x),m[0].sortDisabled?k.removeClass(v.icons||""):(g=v.sortNone,h=v.iconSortNone,m.hasClass(b.css.sortAsc)?(g=[v.sortAsc,v.active].join(" "),h=v.iconSortAsc):m.hasClass(b.css.sortDesc)&&(g=[v.sortDesc,v.active].join(" "),h=v.iconSortDesc),j.addClass(g),k.addClass(h||"")));d.debug&&console.log("Applying "+u+" theme"+b.benchmark(i))},remove:function(a,c,d,e){if(d.uitheme_applied){var f=c.$table,g=c.appliedTheme||"jui",h=b.themes[g]||b.themes.jui,i=f.children("thead").children(),j=h.sortNone+" "+h.sortDesc+" "+h.sortAsc,k=h.iconSortNone+" "+h.iconSortDesc+" "+h.iconSortAsc;f.removeClass("tablesorter-"+g+" "+h.table),d.uitheme_applied=!1,e||(f.find(b.css.header).removeClass(h.header),i.unbind("mouseenter.tsuitheme mouseleave.tsuitheme").removeClass(h.hover+" "+j+" "+h.active).filter("."+b.css.filterRow).removeClass(h.filterRow),i.find("."+b.css.icon).removeClass(h.icons+" "+k))}}})}(jQuery),function(a){"use strict";var b=a.tablesorter||{};b.addWidget({id:"columns",priority:30,options:{columns:["primary","secondary","tertiary"]},format:function(c,d,e){var f,g,h,i,j,k,l,m,n=d.$table,o=d.$tbodies,p=d.sortList,q=p.length,r=e&&e.columns||["primary","secondary","tertiary"],s=r.length-1;for(l=r.join(" "),g=0;g<o.length;g++)f=b.processTbody(c,o.eq(g),!0),h=f.children("tr"),h.each(function(){if(j=a(this),"none"!==this.style.display&&(k=j.children().removeClass(l),p&&p[0]&&(k.eq(p[0][0]).addClass(r[0]),q>1)))for(m=1;q>m;m++)k.eq(p[m][0]).addClass(r[m]||r[s])}),b.processTbody(c,f,!1);if(i=e.columns_thead!==!1?["thead tr"]:[],e.columns_tfoot!==!1&&i.push("tfoot tr"),i.length&&(h=n.find(i.join(",")).children().removeClass(l),q))for(m=0;q>m;m++)h.filter('[data-column="'+p[m][0]+'"]').addClass(r[m]||r[s])},remove:function(c,d,e){var f,g,h=d.$tbodies,i=(e.columns||["primary","secondary","tertiary"]).join(" ");for(d.$headers.removeClass(i),d.$table.children("tfoot").children("tr").children("th, td").removeClass(i),f=0;f<h.length;f++)g=b.processTbody(c,h.eq(f),!0),g.children("tr").each(function(){a(this).children().removeClass(i)}),b.processTbody(c,g,!1)}})}(jQuery),function(a){"use strict";var b,c,d=a.tablesorter||{},e=d.css;a.extend(e,{filterRow:"tablesorter-filter-row",filter:"tablesorter-filter",filterDisabled:"disabled",filterRowHide:"hideme"}),d.addWidget({id:"filter",priority:50,options:{filter_childRows:!1,filter_childByColumn:!1,filter_childWithSibs:!0,filter_columnFilters:!0,filter_columnAnyMatch:!0,filter_cellFilter:"",filter_cssFilter:"",filter_defaultFilter:{},filter_excludeFilter:{},filter_external:"",filter_filteredRow:"filtered",filter_formatter:null,filter_functions:null,filter_hideEmpty:!0,filter_hideFilters:!1,filter_ignoreCase:!0,filter_liveSearch:!0,filter_onlyAvail:"filter-onlyAvail",filter_placeholder:{search:"",select:""},filter_reset:null,filter_saveFilters:!1,filter_searchDelay:300,filter_searchFiltered:!0,filter_selectSource:null,filter_startsWith:!1,filter_useParsedData:!1,filter_serversideFiltering:!1,filter_defaultAttrib:"data-value",filter_selectSourceSeparator:"|"},format:function(a,c,d){c.$table.hasClass("hasFilters")||b.init(a,c,d)},remove:function(b,c,f,g){var h,i,j=c.$table,k=c.$tbodies,l="addRows updateCell update updateRows updateComplete appendCache filterReset filterEnd search ".split(" ").join(c.namespace+"filter ");if(j.removeClass("hasFilters").unbind(l.replace(d.regex.spaces," ")).find("."+e.filterRow).remove(),!g){for(h=0;h<k.length;h++)i=d.processTbody(b,k.eq(h),!0),i.children().removeClass(f.filter_filteredRow).show(),d.processTbody(b,i,!1);f.filter_reset&&a(document).undelegate(f.filter_reset,"click"+c.namespace+"filter")}}}),b=d.filter={regex:{regex:/^\/((?:\\\/|[^\/])+)\/([mig]{0,3})?$/,child:/tablesorter-childRow/,filtered:/filtered/,type:/undefined|number/,exact:/(^[\"\'=]+)|([\"\'=]+$)/g,operators:/[<>=]/g,query:"(q|query)",wild01:/\?/g,wild0More:/\*/g,quote:/\"/g,isNeg1:/(>=?\s*-\d)/,isNeg2:/(<=?\s*\d)/},types:{or:function(d,e,f){if((c.orTest.test(e.iFilter)||c.orSplit.test(e.filter))&&!c.regex.test(e.filter)){var g,h,i,j,k=a.extend({},e),l=e.filter.split(c.orSplit),m=e.iFilter.split(c.orSplit),n=l.length;for(g=0;n>g;g++){k.nestedFilters=!0,k.filter=""+(b.parseFilter(d,l[g],e)||""),k.iFilter=""+(b.parseFilter(d,m[g],e)||""),i="("+(b.parseFilter(d,k.filter,e)||"")+")";try{if(j=new RegExp(e.isMatch?i:"^"+i+"$",d.widgetOptions.filter_ignoreCase?"i":""),h=j.test(k.exact)||b.processTypes(d,k,f))return h}catch(o){return null}}return h||!1}return null},and:function(d,e,f){if(c.andTest.test(e.filter)){var g,h,i,j,k,l=a.extend({},e),m=e.filter.split(c.andSplit),n=e.iFilter.split(c.andSplit),o=m.length;for(g=0;o>g;g++){l.nestedFilters=!0,l.filter=""+(b.parseFilter(d,m[g],e)||""),l.iFilter=""+(b.parseFilter(d,n[g],e)||""),j=("("+(b.parseFilter(d,l.filter,e)||"")+")").replace(c.wild01,"\\S{1}").replace(c.wild0More,"\\S*");try{k=new RegExp(e.isMatch?j:"^"+j+"$",d.widgetOptions.filter_ignoreCase?"i":""),i=k.test(l.exact)||b.processTypes(d,l,f),h=0===g?i:h&&i}catch(p){return null}}return h||!1}return null},regex:function(a,b){if(c.regex.test(b.filter)){var d,e=b.filter_regexCache[b.index]||c.regex.exec(b.filter),f=e instanceof RegExp;try{f||(b.filter_regexCache[b.index]=e=new RegExp(e[1],e[2])),d=e.test(b.exact)}catch(g){d=!1}return d}return null},operators:function(e,f){if(c.operTest.test(f.iFilter)&&""!==f.iExact){var g,h,i,j=e.table,k=f.parsed[f.index],l=d.formatFloat(f.iFilter.replace(c.operators,""),j),m=e.parsers[f.index]||{},n=l;return(k||"numeric"===m.type)&&(i=a.trim(""+f.iFilter.replace(c.operators,"")),h=b.parseFilter(e,i,f,!0),l="number"!=typeof h||""===h||isNaN(h)?l:h),!k&&"numeric"!==m.type||isNaN(l)||"undefined"==typeof f.cache?(i=isNaN(f.iExact)?f.iExact.replace(d.regex.nondigit,""):f.iExact,g=d.formatFloat(i,j)):g=f.cache,c.gtTest.test(f.iFilter)?h=c.gteTest.test(f.iFilter)?g>=l:g>l:c.ltTest.test(f.iFilter)&&(h=c.lteTest.test(f.iFilter)?l>=g:l>g),h||""!==n||(h=!0),h}return null},notMatch:function(d,e){if(c.notTest.test(e.iFilter)){var f,g=e.iFilter.replace("!",""),h=b.parseFilter(d,g,e)||"";return c.exact.test(h)?(h=h.replace(c.exact,""),""===h?!0:a.trim(h)!==e.iExact):(f=e.iExact.search(a.trim(h)),""===h?!0:!(d.widgetOptions.filter_startsWith?0===f:f>=0))}return null},exact:function(d,e){if(c.exact.test(e.iFilter)){var f=e.iFilter.replace(c.exact,""),g=b.parseFilter(d,f,e)||"";return e.anyMatch?a.inArray(g,e.rowArray)>=0:g==e.iExact}return null},range:function(a,e){if(c.toTest.test(e.iFilter)){var f,g,h,i,j=a.table,k=e.index,l=e.parsed[k],m=e.iFilter.split(c.toSplit);return g=m[0].replace(d.regex.nondigit,"")||"",h=d.formatFloat(b.parseFilter(a,g,e),j),g=m[1].replace(d.regex.nondigit,"")||"",i=d.formatFloat(b.parseFilter(a,g,e),j),(l||"numeric"===a.parsers[k].type)&&(f=a.parsers[k].format(""+m[0],j,a.$headers.eq(k),k),h=""===f||isNaN(f)?h:f,f=a.parsers[k].format(""+m[1],j,a.$headers.eq(k),k),i=""===f||isNaN(f)?i:f),!l&&"numeric"!==a.parsers[k].type||isNaN(h)||isNaN(i)?(g=isNaN(e.iExact)?e.iExact.replace(d.regex.nondigit,""):e.iExact,f=d.formatFloat(g,j)):f=e.cache,h>i&&(g=h,h=i,i=g),f>=h&&i>=f||""===h||""===i}return null},wild:function(a,d){if(c.wildOrTest.test(d.iFilter)){var e=""+(b.parseFilter(a,d.iFilter,d)||"");!c.wildTest.test(e)&&d.nestedFilters&&(e=d.isMatch?e:"^("+e+")$");try{return new RegExp(e.replace(c.wild01,"\\S{1}").replace(c.wild0More,"\\S*"),a.widgetOptions.filter_ignoreCase?"i":"").test(d.exact)}catch(f){return null}}return null},fuzzy:function(a,d){if(c.fuzzyTest.test(d.iFilter)){var e,f=0,g=d.iExact.length,h=d.iFilter.slice(1),i=b.parseFilter(a,h,d)||"";for(e=0;g>e;e++)d.iExact[e]===i[f]&&(f+=1);return f===i.length}return null}},init:function(f,g,h){d.language=a.extend(!0,{},{to:"to",or:"or",and:"and"},d.language);var i,j,k,l,m,n,o,p,q;if(g.$table.addClass("hasFilters"),g.lastSearch=[],h.filter_searchTimer=null,h.filter_initTimer=null,h.filter_formatterCount=0,h.filter_formatterInit=[],h.filter_anyColumnSelector='[data-column="all"],[data-column="any"]',h.filter_multipleColumnSelector='[data-column*="-"],[data-column*=","]',o="\\{"+c.query+"\\}",a.extend(c,{child:new RegExp(g.cssChildRow),filtered:new RegExp(h.filter_filteredRow),alreadyFiltered:new RegExp("(\\s+("+d.language.or+"|-|"+d.language.to+")\\s+)","i"),toTest:new RegExp("\\s+(-|"+d.language.to+")\\s+","i"),toSplit:new RegExp("(?:\\s+(?:-|"+d.language.to+")\\s+)","gi"),andTest:new RegExp("\\s+("+d.language.and+"|&&)\\s+","i"),andSplit:new RegExp("(?:\\s+(?:"+d.language.and+"|&&)\\s+)","gi"),orTest:/\|/,orSplit:new RegExp("(?:\\s+(?:"+d.language.or+")\\s+|\\|)","gi"),iQuery:new RegExp(o,"i"),igQuery:new RegExp(o,"ig"),operTest:/^[<>]=?/,gtTest:/>/,gteTest:/>=/,ltTest:/</,lteTest:/<=/,notTest:/^\!/,wildOrTest:/[\?\*\|]/,wildTest:/\?\*/,fuzzyTest:/^~/,exactTest:/[=\"\|!]/}),o=g.$headers.filter(".filter-false, .parser-false").length,h.filter_columnFilters!==!1&&o!==g.$headers.length&&b.buildRow(f,g,h),k="addRows updateCell update updateRows updateComplete appendCache filterReset filterEnd search ".split(" ").join(g.namespace+"filter "),g.$table.bind(k,function(c,d){return o=h.filter_hideEmpty&&a.isEmptyObject(g.cache)&&!(g.delayInit&&"appendCache"===c.type),g.$table.find("."+e.filterRow).toggleClass(h.filter_filteredRow,o),/(search|filter)/.test(c.type)||(c.stopPropagation(),b.buildDefault(f,!0)),"filterReset"===c.type?(g.$table.find("."+e.filter).add(h.filter_$externalFilters).val(""),b.searching(f,[])):"filterEnd"===c.type?b.buildDefault(f,!0):(d="search"===c.type?d:"updateComplete"===c.type?g.$table.data("lastSearch"):"",/(update|add)/.test(c.type)&&"updateComplete"!==c.type&&(g.lastCombinedFilter=null,g.lastSearch=[]),b.searching(f,d,!0)),!1}),h.filter_reset&&(h.filter_reset instanceof a?h.filter_reset.click(function(){g.$table.triggerHandler("filterReset")}):a(h.filter_reset).length&&a(document).undelegate(h.filter_reset,"click"+g.namespace+"filter").delegate(h.filter_reset,"click"+g.namespace+"filter",function(){g.$table.triggerHandler("filterReset")})),h.filter_functions)for(m=0;m<g.columns;m++)if(p=d.getColumnData(f,h.filter_functions,m))if(l=g.$headerIndexed[m].removeClass("filter-select"),q=!(l.hasClass("filter-false")||l.hasClass("parser-false")),i="",p===!0&&q)b.buildSelect(f,m);else if("object"==typeof p&&q){for(j in p)"string"==typeof j&&(i+=""===i?'<option value="">'+(l.data("placeholder")||l.attr("data-placeholder")||h.filter_placeholder.select||"")+"</option>":"",o=j,k=j,j.indexOf(h.filter_selectSourceSeparator)>=0&&(o=j.split(h.filter_selectSourceSeparator),k=o[1],o=o[0]),i+="<option "+(k===o?"":'data-function-name="'+j+'" ')+'value="'+o+'">'+k+"</option>");g.$table.find("thead").find("select."+e.filter+'[data-column="'+m+'"]').append(i),k=h.filter_selectSource,p="function"==typeof k?!0:d.getColumnData(f,k,m),p&&b.buildSelect(g.table,m,"",!0,l.hasClass(h.filter_onlyAvail))}b.buildDefault(f,!0),b.bindSearch(f,g.$table.find("."+e.filter),!0),h.filter_external&&b.bindSearch(f,h.filter_external),h.filter_hideFilters&&b.hideFilters(g),g.showProcessing&&(k="filterStart filterEnd ".split(" ").join(g.namespace+"filter "),g.$table.unbind(k.replace(d.regex.spaces," ")).bind(k,function(b,c){l=c?g.$table.find("."+e.header).filter("[data-column]").filter(function(){return""!==c[a(this).data("column")]}):"",d.isProcessing(f,"filterStart"===b.type,c?l:"")})),g.filteredRows=g.totalRows,k="tablesorter-initialized pagerBeforeInitialized ".split(" ").join(g.namespace+"filter "),g.$table.unbind(k.replace(d.regex.spaces," ")).bind(k,function(){var a=this.config.widgetOptions;n=b.setDefaults(f,g,a)||[],n.length&&(g.delayInit&&""===n.join("")||d.setFilters(f,n,!0)),g.$table.triggerHandler("filterFomatterUpdate"),setTimeout(function(){a.filter_initialized||b.filterInitComplete(g)},100)}),g.pager&&g.pager.initialized&&!h.filter_initialized&&(g.$table.triggerHandler("filterFomatterUpdate"),setTimeout(function(){b.filterInitComplete(g)},100))},formatterUpdated:function(a,b){var c=a&&a.closest("table")[0].config.widgetOptions;c&&!c.filter_initialized&&(c.filter_formatterInit[b]=1)},filterInitComplete:function(c){var d,e,f=c.widgetOptions,g=0,h=function(){f.filter_initialized=!0,c.$table.triggerHandler("filterInit",c),b.findRows(c.table,c.$table.data("lastSearch")||[])};if(a.isEmptyObject(f.filter_formatter))h();else{for(e=f.filter_formatterInit.length,d=0;e>d;d++)1===f.filter_formatterInit[d]&&g++;clearTimeout(f.filter_initTimer),f.filter_initialized||g!==f.filter_formatterCount?f.filter_initialized||(f.filter_initTimer=setTimeout(function(){h()},500)):h()}},processFilters:function(a,b){var c,d=b?encodeURIComponent:decodeURIComponent,e=a.length;for(c=0;e>c;c++)a[c]=d(a[c]);return a},setDefaults:function(c,e,f){var g,h,i,j,k,l=d.getFilters(c)||[];if(f.filter_saveFilters&&d.storage&&(h=d.storage(c,"tablesorter-filters")||[],g=a.isArray(h),g&&""===h.join("")||!g||(l=b.processFilters(h))),""===l.join(""))for(k=e.$headers.add(f.filter_$externalFilters).filter("["+f.filter_defaultAttrib+"]"),i=0;i<=e.columns;i++)j=i===e.columns?"all":i,l[i]=k.filter('[data-column="'+j+'"]').attr(f.filter_defaultAttrib)||l[i]||"";return e.$table.data("lastSearch",l),l},parseFilter:function(a,b,c,d){return d||c.parsed[c.index]?a.parsers[c.index].format(b,a.table,[],c.index):b},buildRow:function(c,f,g){var h,i,j,k,l,m,n,o,p,q=g.filter_cellFilter,r=f.columns,s=a.isArray(q),t='<tr role="row" class="'+e.filterRow+" "+f.cssIgnoreRow+'">';for(j=0;r>j;j++)f.$headerIndexed[j].length&&(p=f.$headerIndexed[j]&&f.$headerIndexed[j][0].colSpan||0,t+=p>1?'<td data-column="'+j+"-"+(j+p-1)+'" colspan="'+p+'"':'<td data-column="'+j+'"',t+=s?q[j]?' class="'+q[j]+'"':"":""!==q?' class="'+q+'"':"",t+="></td>");for(f.$filters=a(t+="</tr>").appendTo(f.$table.children("thead").eq(0)).children("td"),j=0;r>j;j++)m=!1,k=f.$headerIndexed[j],k&&k.length&&(h=b.getColumnElm(f,f.$filters,j),o=d.getColumnData(c,g.filter_functions,j),l=g.filter_functions&&o&&"function"!=typeof o||k.hasClass("filter-select"),i=d.getColumnData(c,f.headers,j),m="false"===d.getData(k[0],i,"filter")||"false"===d.getData(k[0],i,"parser"),l?t=a("<select>").appendTo(h):(o=d.getColumnData(c,g.filter_formatter,j),o?(g.filter_formatterCount++,t=o(h,j),t&&0===t.length&&(t=h.children("input")),t&&(0===t.parent().length||t.parent().length&&t.parent()[0]!==h[0])&&h.append(t)):t=a('<input type="search">').appendTo(h),t&&(p=k.data("placeholder")||k.attr("data-placeholder")||g.filter_placeholder.search||"",t.attr("placeholder",p))),t&&(n=(a.isArray(g.filter_cssFilter)?"undefined"!=typeof g.filter_cssFilter[j]?g.filter_cssFilter[j]||"":"":g.filter_cssFilter)||"",t.addClass(e.filter+" "+n).attr("data-column",h.attr("data-column")),m&&(t.attr("placeholder","").addClass(e.filterDisabled)[0].disabled=!0)))},bindSearch:function(c,e,f){if(c=a(c)[0],e=a(e),e.length){var g,h=c.config,i=h.widgetOptions,j=h.namespace+"filter",k=i.filter_$externalFilters;f!==!0&&(g=i.filter_anyColumnSelector+","+i.filter_multipleColumnSelector,i.filter_$anyMatch=e.filter(g),k&&k.length?i.filter_$externalFilters=i.filter_$externalFilters.add(e):i.filter_$externalFilters=e,d.setFilters(c,h.$table.data("lastSearch")||[],f===!1)),g="keypress keyup search change ".split(" ").join(j+" "),e.attr("data-lastSearchTime",(new Date).getTime()).unbind(g.replace(d.regex.spaces," ")).bind("keyup"+j,function(d){if(a(this).attr("data-lastSearchTime",(new Date).getTime()),27===d.which)this.value="";else{if(i.filter_liveSearch===!1)return;if(""!==this.value&&("number"==typeof i.filter_liveSearch&&this.value.length<i.filter_liveSearch||13!==d.which&&8!==d.which&&(d.which<32||d.which>=37&&d.which<=40)))return}b.searching(c,!0,!0)}).bind("search change keypress ".split(" ").join(j+" "),function(d){var e=parseInt(a(this).attr("data-column"),10);i.filter_initialized&&(13===d.which||"search"===d.type||"change"===d.type&&this.value!==h.lastSearch[e])&&(d.preventDefault(),a(this).attr("data-lastSearchTime",(new Date).getTime()),b.searching(c,!1,!0))})}},searching:function(a,c,d){var e=a.config.widgetOptions;clearTimeout(e.filter_searchTimer),"undefined"==typeof c||c===!0?e.filter_searchTimer=setTimeout(function(){b.checkFilters(a,c,d)},e.filter_liveSearch?e.filter_searchDelay:10):b.checkFilters(a,c,d)},checkFilters:function(c,f,g){var h=c.config,i=h.widgetOptions,j=a.isArray(f),k=j?f:d.getFilters(c,!0),l=(k||[]).join("");return a.isEmptyObject(h.cache)?void(h.delayInit&&h.pager&&h.pager.initialized&&d.updateCache(h,function(){b.checkFilters(c,!1,g)})):(j&&(d.setFilters(c,k,!1,g!==!0),i.filter_initialized||(h.lastCombinedFilter="")),i.filter_hideFilters&&h.$table.find("."+e.filterRow).triggerHandler(""===l?"mouseleave":"mouseenter"),h.lastCombinedFilter!==l||f===!1?(f===!1&&(h.lastCombinedFilter=null,h.lastSearch=[]),k=k||[],k=Array.prototype.map?k.map(String):k.join("\x00").split("\x00"),i.filter_initialized&&h.$table.triggerHandler("filterStart",[k]),h.showProcessing?void setTimeout(function(){return b.findRows(c,k,l),!1},30):(b.findRows(c,k,l),!1)):void 0)},hideFilters:function(b,c){var f,g=(c||b.$table).find("."+e.filterRow).addClass(e.filterRowHide);g.bind("mouseenter mouseleave",function(c){var d=c,g=a(this);clearTimeout(f),f=setTimeout(function(){/enter|over/.test(d.type)?g.removeClass(e.filterRowHide):a(document.activeElement).closest("tr")[0]!==g[0]&&""===b.lastCombinedFilter&&g.addClass(e.filterRowHide)},200)}).find("input, select").bind("focus blur",function(c){var g=c,h=a(this).closest("tr");clearTimeout(f),f=setTimeout(function(){clearTimeout(f),""===d.getFilters(b.$table).join("")&&h.toggleClass(e.filterRowHide,"focus"!==g.type)},200)})},defaultFilter:function(b,d){if(""===b)return b;var e=c.iQuery,f=d.match(c.igQuery).length,g=f>1?a.trim(b).split(/\s/):[a.trim(b)],h=g.length-1,i=0,j=d;for(1>h&&f>1&&(g[1]=g[0]);e.test(j);)j=j.replace(e,g[i++]||""),e.test(j)&&h>i&&""!==(g[i]||"")&&(j=d.replace(e,j));return j},getLatestSearch:function(b){return b?b.sort(function(b,c){return a(c).attr("data-lastSearchTime")-a(b).attr("data-lastSearchTime")}):b||a()},findRange:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(/^[0-9]+$/.test(b))return[parseInt(b,10)];if(!c&&/-/.test(b))for(e=b.match(/(\d+)\s*-\s*(\d+)/g),l=e?e.length:0,k=0;l>k;k++){for(f=e[k].split(/\s*-\s*/),g=parseInt(f[0],10)||0,h=parseInt(f[1],10)||a.columns-1,g>h&&(d=g,g=h,h=d),h>=a.columns&&(h=a.columns-1);h>=g;g++)m.push(g);b=b.replace(e[k],"")}if(!c&&/,/.test(b))for(i=b.split(/\s*,\s*/),l=i.length,j=0;l>j;j++)""!==i[j]&&(k=parseInt(i[j],10),k<a.columns&&m.push(k));if(!m.length)for(k=0;k<a.columns;k++)m.push(k);return m},getColumnElm:function(c,d,e){return d.filter(function(){var d=b.findRange(c,a(this).attr("data-column"));return a.inArray(e,d)>-1})},multipleColumns:function(c,d){var e=c.widgetOptions,f=e.filter_initialized||!d.filter(e.filter_anyColumnSelector).length,g=a.trim(b.getLatestSearch(d).attr("data-column")||"");return b.findRange(c,g,!f)},processTypes:function(c,d,e){var f,g=null,h=null;for(f in b.types)a.inArray(f,e.excludeMatch)<0&&null===h&&(h=b.types[f](c,d,e),null!==h&&(g=h));return g},processRow:function(e,f,g){var h,i,j,k,l,m=e.widgetOptions,n=!0,o=m.filter_$anyMatch&&m.filter_$anyMatch.length?b.multipleColumns(e,m.filter_$anyMatch):[];if(f.$cells=f.$row.children(),f.anyMatchFlag&&o.length>1){if(f.anyMatch=!0,f.isMatch=!0,f.rowArray=f.$cells.map(function(b){return a.inArray(b,o)>-1?(f.parsed[b]?l=f.cacheArray[b]:(l=f.rawArray[b],l=a.trim(m.filter_ignoreCase?l.toLowerCase():l),e.sortLocaleCompare&&(l=d.replaceAccents(l))),l):void 0}).get(),f.filter=f.anyMatchFilter,f.iFilter=f.iAnyMatchFilter,f.exact=f.rowArray.join(" "),f.iExact=m.filter_ignoreCase?f.exact.toLowerCase():f.exact,f.cache=f.cacheArray.slice(0,-1).join(" "),g.excludeMatch=g.noAnyMatch,i=b.processTypes(e,f,g),null!==i)n=i;else if(m.filter_startsWith)for(n=!1,o=Math.min(e.columns,f.rowArray.length);!n&&o>0;)o--,n=n||0===f.rowArray[o].indexOf(f.iFilter);else n=(f.iExact+f.childRowText).indexOf(f.iFilter)>=0;if(f.anyMatch=!1,f.filters.join("")===f.filter)return n}for(o=0;o<e.columns;o++)f.filter=f.filters[o],f.index=o,g.excludeMatch=g.excludeFilter[o],f.filter&&(f.cache=f.cacheArray[o],m.filter_useParsedData||f.parsed[o]?f.exact=f.cache:(h=f.rawArray[o]||"",f.exact=e.sortLocaleCompare?d.replaceAccents(h):h),f.iExact=!c.type.test(typeof f.exact)&&m.filter_ignoreCase?f.exact.toLowerCase():f.exact,f.isMatch=e.$headerIndexed[f.index].hasClass("filter-match"),h=n,k=m.filter_columnFilters?e.$filters.add(e.$externalFilters).filter('[data-column="'+o+'"]').find("select option:selected").attr("data-function-name")||"":"",e.sortLocaleCompare&&(f.filter=d.replaceAccents(f.filter)),m.filter_defaultFilter&&c.iQuery.test(g.defaultColFilter[o])&&(f.filter=b.defaultFilter(f.filter,g.defaultColFilter[o])),f.iFilter=m.filter_ignoreCase?(f.filter||"").toLowerCase():f.filter,j=g.functions[o],i=null,j&&(j===!0?i=f.isMatch?(""+f.iExact).search(f.iFilter)>=0:f.filter===f.exact:"function"==typeof j?i=j(f.exact,f.cache,f.filter,o,f.$row,e,f):"function"==typeof j[k||f.filter]&&(l=k||f.filter,i=j[l](f.exact,f.cache,f.filter,o,f.$row,e,f))),null===i?(i=b.processTypes(e,f,g),null!==i?h=i:(l=(f.iExact+f.childRowText).indexOf(b.parseFilter(e,f.iFilter,f)),h=!m.filter_startsWith&&l>=0||m.filter_startsWith&&0===l)):h=i,n=h?n:!1);return n},findRows:function(e,f,g){if(e.config.lastCombinedFilter!==g&&e.config.widgetOptions.filter_initialized){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=a.extend([],f),G=e.config,H=G.widgetOptions,I={anyMatch:!1,filters:f,filter_regexCache:[]},J={noAnyMatch:["range","notMatch","operators"],functions:[],excludeFilter:[],defaultColFilter:[],defaultAnyFilter:d.getColumnData(e,H.filter_defaultFilter,G.columns,!0)||""};for(I.parsed=G.$headers.map(function(b){return G.parsers&&G.parsers[b]&&G.parsers[b].parsed||d.getData&&"parsed"===d.getData(G.$headerIndexed[b],d.getColumnData(e,G.headers,b),"filter")||a(this).hasClass("filter-parsed")}).get(),p=0;p<G.columns;p++)J.functions[p]=d.getColumnData(e,H.filter_functions,p),J.defaultColFilter[p]=d.getColumnData(e,H.filter_defaultFilter,p)||"",J.excludeFilter[p]=(d.getColumnData(e,H.filter_excludeFilter,p,!0)||"").split(/\s+/);for(G.debug&&(console.log("Filter: Starting filter widget search",f),v=new Date),G.filteredRows=0,G.totalRows=0,g=(F||[]).join(""),n=0;n<G.$tbodies.length;n++){if(o=d.processTbody(e,G.$tbodies.eq(n),!0),p=G.columns,i=G.cache[n].normalized,k=a(a.map(i,function(a){return a[p].$row.get()})),""===g||H.filter_serversideFiltering)k.removeClass(H.filter_filteredRow).not("."+G.cssChildRow).css("display","");else{if(k=k.not("."+G.cssChildRow),h=k.length,(H.filter_$anyMatch&&H.filter_$anyMatch.length||"undefined"!=typeof f[G.columns])&&(I.anyMatchFlag=!0,I.anyMatchFilter=""+(f[G.columns]||H.filter_$anyMatch&&b.getLatestSearch(H.filter_$anyMatch).val()||""),H.filter_columnAnyMatch)){for(A=I.anyMatchFilter.split(c.andSplit),B=!1,x=0;x<A.length;x++)C=A[x].split(":"),C.length>1&&(D=parseInt(C[0],10)-1,D>=0&&D<G.columns&&(f[D]=C[1],A.splice(x,1),x--,B=!0));B&&(I.anyMatchFilter=A.join(" && "))}if(z=H.filter_searchFiltered,s=G.lastSearch||G.$table.data("lastSearch")||[],z)for(x=0;p+1>x;x++)w=f[x]||"",z||(x=p),z=z&&s.length&&0===w.indexOf(s[x]||"")&&!c.alreadyFiltered.test(w)&&!c.exactTest.test(w)&&!(c.isNeg1.test(w)||c.isNeg2.test(w))&&!(""!==w&&G.$filters&&G.$filters.filter('[data-column="'+x+'"]').find("select").length&&!G.$headerIndexed[x].hasClass("filter-match"));for(y=k.not("."+H.filter_filteredRow).length,z&&0===y&&(z=!1),G.debug&&console.log("Filter: Searching through "+(z&&h>y?y:"all")+" rows"),I.anyMatchFlag&&(G.sortLocaleCompare&&(I.anyMatchFilter=d.replaceAccents(I.anyMatchFilter)),H.filter_defaultFilter&&c.iQuery.test(J.defaultAnyFilter)&&(I.anyMatchFilter=b.defaultFilter(I.anyMatchFilter,J.defaultAnyFilter),z=!1),I.iAnyMatchFilter=H.filter_ignoreCase&&G.ignoreCase?I.anyMatchFilter.toLowerCase():I.anyMatchFilter),m=0;h>m;m++)if(E=k[m].className,q=m&&c.child.test(E),!(q||z&&c.filtered.test(E))){if(I.$row=k.eq(m),I.cacheArray=i[m],j=I.cacheArray[G.columns],I.rawArray=j.raw,I.childRowText="",!H.filter_childByColumn){for(E="",r=j.child,x=0;x<r.length;x++)E+=" "+r[x].join(" ")||"";I.childRowText=H.filter_childRows?H.filter_ignoreCase?E.toLowerCase():E:""}if(t=!1,u=b.processRow(G,I,J),l=j.$row,w=u?!0:!1,r=j.$row.filter(":gt( 0 )"),H.filter_childRows&&r.length){if(H.filter_childByColumn)for(H.filter_childWithSibs||(r.addClass(H.filter_filteredRow),l=l.eq(0)),x=0;x<r.length;x++)I.$row=r.eq(x),I.cacheArray=j.child[x],I.rawArray=I.cacheArray,w=b.processRow(G,I,J),t=t||w,!H.filter_childWithSibs&&w&&r.eq(x).removeClass(H.filter_filteredRow);t=t||u}else t=w;l.toggleClass(H.filter_filteredRow,!t)[0].display=t?"":"none"}}G.filteredRows+=k.not("."+H.filter_filteredRow).length,G.totalRows+=k.length,d.processTbody(e,o,!1)}G.lastCombinedFilter=g,G.lastSearch=F,G.$table.data("lastSearch",F),H.filter_saveFilters&&d.storage&&d.storage(e,"tablesorter-filters",b.processFilters(F,!0)),G.debug&&console.log("Completed filter widget search"+d.benchmark(v)),H.filter_initialized&&(G.$table.triggerHandler("filterBeforeEnd",G),G.$table.triggerHandler("filterEnd",G)),setTimeout(function(){d.applyWidget(G.table)},0)}},getOptionSource:function(c,e,f){c=a(c)[0];var g=c.config,h=g.widgetOptions,i=!1,j=h.filter_selectSource,k=g.$table.data("lastSearch")||[],l="function"==typeof j?!0:d.getColumnData(c,j,e);if(f&&""!==k[e]&&(f=!1),l===!0)i=j(c,e,f);else{if(l instanceof a||"string"===a.type(l)&&l.indexOf("</option>")>=0)return l;a.isArray(l)?i=l:"object"===a.type(j)&&l&&(i=l(c,e,f))}return i===!1&&(i=b.getOptions(c,e,f)),b.processOptions(c,e,i)},processOptions:function(b,c,e){if(!a.isArray(e))return!1;b=a(b)[0];var f,g,h,i,j,k,l=b.config,m="undefined"!=typeof c&&null!==c&&c>=0&&c<l.columns,n=[];if(e=a.grep(e,function(b,c){return b.text?!0:a.inArray(b,e)===c}),m&&l.$headerIndexed[c].hasClass("filter-select-nosort"))return e;for(i=e.length,h=0;i>h;h++)g=e[h],k=g.text?g.text:g,j=(m&&l.parsers&&l.parsers.length&&l.parsers[c].format(k,b,[],c)||k).toString(),j=l.widgetOptions.filter_ignoreCase?j.toLowerCase():j,g.text?(g.parsed=j,n.push(g)):n.push({text:g,parsed:j});for(f=l.textSorter||"",n.sort(function(a,e){var g=a.parsed,h=e.parsed;return m&&"function"==typeof f?f(g,h,!0,c,b):m&&"object"==typeof f&&f.hasOwnProperty(c)?f[c](g,h,!0,c,b):d.sortNatural?d.sortNatural(g,h):!0}),e=[],i=n.length,h=0;i>h;h++)e.push(n[h]);return e},getOptions:function(b,c,e){b=a(b)[0];var f,g,h,i,j,k,l,m,n=b.config,o=n.widgetOptions,p=[];for(g=0;g<n.$tbodies.length;g++)for(j=n.cache[g],h=n.cache[g].normalized.length,f=0;h>f;f++)if(i=j.row?j.row[f]:j.normalized[f][n.columns].$row[0],!e||!i.className.match(o.filter_filteredRow))if(o.filter_useParsedData||n.parsers[c].parsed||n.$headerIndexed[c].hasClass("filter-parsed")){if(p.push(""+j.normalized[f][c]),o.filter_childRows&&o.filter_childByColumn)for(m=j.normalized[f][n.columns].$row.length-1,k=0;m>k;k++)p.push(""+j.normalized[f][n.columns].child[k][c])}else if(p.push(j.normalized[f][n.columns].raw[c]),o.filter_childRows&&o.filter_childByColumn)for(m=j.normalized[f][n.columns].$row.length,k=1;m>k;k++)l=j.normalized[f][n.columns].$row.eq(k).children().eq(c),p.push(""+d.getElementText(n,l,c));return p},buildSelect:function(d,f,g,h,i){if(d=a(d)[0],f=parseInt(f,10),d.config.cache&&!a.isEmptyObject(d.config.cache)){var j,k,l,m,n,o,p,q=d.config,r=q.widgetOptions,s=q.$headerIndexed[f],t='<option value="">'+(s.data("placeholder")||s.attr("data-placeholder")||r.filter_placeholder.select||"")+"</option>",u=q.$table.find("thead").find("select."+e.filter+'[data-column="'+f+'"]').val();if(("undefined"==typeof g||""===g)&&(g=b.getOptionSource(d,f,i)),
a.isArray(g)){for(j=0;j<g.length;j++)if(p=g[j],p.text){p["data-function-name"]="undefined"==typeof p.value?p.text:p.value,t+="<option";for(k in p)p.hasOwnProperty(k)&&"text"!==k&&(t+=" "+k+'="'+p[k]+'"');p.value||(t+=' value="'+p.text+'"'),t+=">"+p.text+"</option>"}else""+p!="[object Object]"&&(l=p=(""+p).replace(c.quote,"&quot;"),k=l,l.indexOf(r.filter_selectSourceSeparator)>=0&&(m=l.split(r.filter_selectSourceSeparator),k=m[0],l=m[1]),t+=""!==p?"<option "+(k===l?"":'data-function-name="'+p+'" ')+'value="'+k+'">'+l+"</option>":"");g=[]}n=(q.$filters?q.$filters:q.$table.children("thead")).find("."+e.filter),r.filter_$externalFilters&&(n=n&&n.length?n.add(r.filter_$externalFilters):r.filter_$externalFilters),o=n.filter('select[data-column="'+f+'"]'),o.length&&(o[h?"html":"append"](t),a.isArray(g)||o.append(g).val(u),o.val(u))}},buildDefault:function(a,c){var e,f,g,h=a.config,i=h.widgetOptions,j=h.columns;for(e=0;j>e;e++)f=h.$headerIndexed[e],g=!(f.hasClass("filter-false")||f.hasClass("parser-false")),(f.hasClass("filter-select")||d.getColumnData(a,i.filter_functions,e)===!0)&&g&&b.buildSelect(a,e,"",c,f.hasClass(i.filter_onlyAvail))}},c=b.regex,d.getFilters=function(c,d,f,g){var h,i,j,k,l=!1,m=c?a(c)[0].config:"",n=m?m.widgetOptions:"";if(d!==!0&&n&&!n.filter_columnFilters||a.isArray(f)&&f.join("")===m.lastCombinedFilter)return a(c).data("lastSearch");if(m&&(m.$filters&&(i=m.$filters.find("."+e.filter)),n.filter_$externalFilters&&(i=i&&i.length?i.add(n.filter_$externalFilters):n.filter_$externalFilters),i&&i.length))for(l=f||[],h=0;h<m.columns+1;h++)k=h===m.columns?n.filter_anyColumnSelector+","+n.filter_multipleColumnSelector:'[data-column="'+h+'"]',j=i.filter(k),j.length&&(j=b.getLatestSearch(j),a.isArray(f)?(g&&j.length>1&&(j=j.slice(1)),h===m.columns&&(k=j.filter(n.filter_anyColumnSelector),j=k.length?k:j),j.val(f[h]).trigger("change"+m.namespace)):(l[h]=j.val()||"",h===m.columns?j.slice(1).filter('[data-column*="'+j.attr("data-column")+'"]').val(l[h]):j.slice(1).val(l[h])),h===m.columns&&j.length&&(n.filter_$anyMatch=j));return 0===l.length&&(l=!1),l},d.setFilters=function(c,e,f,g){var h=c?a(c)[0].config:"",i=d.getFilters(c,!0,e,g);return"undefined"==typeof f&&(f=!0),h&&f&&(h.lastCombinedFilter=null,h.lastSearch=[],b.searching(h.table,e,g),h.$table.triggerHandler("filterFomatterUpdate")),!!i}}(jQuery),function(a,b){"use strict";var c=a.tablesorter||{};a.extend(c.css,{sticky:"tablesorter-stickyHeader",stickyVis:"tablesorter-sticky-visible",stickyHide:"tablesorter-sticky-hidden",stickyWrap:"tablesorter-sticky-wrapper"}),c.addHeaderResizeEvent=function(b,c,d){if(b=a(b)[0],b.config){var e={timer:250},f=a.extend({},e,d),g=b.config,h=g.widgetOptions,i=function(a){var b,c,d,e,f,i,j=g.$headers.length;for(h.resize_flag=!0,c=[],b=0;j>b;b++)d=g.$headers.eq(b),e=d.data("savedSizes")||[0,0],f=d[0].offsetWidth,i=d[0].offsetHeight,(f!==e[0]||i!==e[1])&&(d.data("savedSizes",[f,i]),c.push(d[0]));c.length&&a!==!1&&g.$table.triggerHandler("resize",[c]),h.resize_flag=!1};return i(!1),clearInterval(h.resize_timer),c?(h.resize_flag=!1,!1):void(h.resize_timer=setInterval(function(){h.resize_flag||i()},f.timer))}},c.addWidget({id:"stickyHeaders",priority:60,options:{stickyHeaders:"",stickyHeaders_attachTo:null,stickyHeaders_xScroll:null,stickyHeaders_yScroll:null,stickyHeaders_offset:0,stickyHeaders_filteredToTop:!0,stickyHeaders_cloneId:"-sticky",stickyHeaders_addResizeEvent:!0,stickyHeaders_includeCaption:!0,stickyHeaders_zIndex:2},format:function(d,e,f){if(!(e.$table.hasClass("hasStickyHeaders")||a.inArray("filter",e.widgets)>=0&&!e.$table.hasClass("hasFilters"))){var g,h,i,j,k=e.$table,l=a(f.stickyHeaders_attachTo),m=e.namespace+"stickyheaders ",n=a(f.stickyHeaders_yScroll||f.stickyHeaders_attachTo||b),o=a(f.stickyHeaders_xScroll||f.stickyHeaders_attachTo||b),p=k.children("thead:first"),q=p.children("tr").not(".sticky-false").children(),r=k.children("tfoot"),s=isNaN(f.stickyHeaders_offset)?a(f.stickyHeaders_offset):"",t=s.length?s.height()||0:parseInt(f.stickyHeaders_offset,10)||0,u=k.parent().closest("."+c.css.table).hasClass("hasStickyHeaders")?k.parent().closest("table.tablesorter")[0].config.widgetOptions.$sticky.parent():[],v=u.length?u.height():0,w=f.$sticky=k.clone().addClass("containsStickyHeaders "+c.css.sticky+" "+f.stickyHeaders+" "+e.namespace.slice(1)+"_extra_table").wrap('<div class="'+c.css.stickyWrap+'">'),x=w.parent().addClass(c.css.stickyHide).css({position:l.length?"absolute":"fixed",padding:parseInt(w.parent().parent().css("padding-left"),10),top:t+v,left:0,visibility:"hidden",zIndex:f.stickyHeaders_zIndex||2}),y=w.children("thead:first"),z="",A=0,B=function(a,c){var d,e,f,g,h,i=a.filter(":visible"),j=i.length;for(d=0;j>d;d++)g=c.filter(":visible").eq(d),h=i.eq(d),"border-box"===h.css("box-sizing")?e=h.outerWidth():"collapse"===g.css("border-collapse")?b.getComputedStyle?e=parseFloat(b.getComputedStyle(h[0],null).width):(f=parseFloat(h.css("border-width")),e=h.outerWidth()-parseFloat(h.css("padding-left"))-parseFloat(h.css("padding-right"))-f):e=h.width(),g.css({width:e,"min-width":e,"max-width":e})},C=function(){t=s.length?s.height()||0:parseInt(f.stickyHeaders_offset,10)||0,A=0,x.css({left:l.length?parseInt(l.css("padding-left"),10)||0:k.offset().left-parseInt(k.css("margin-left"),10)-o.scrollLeft()-A,width:k.outerWidth()}),B(k,w),B(q,j)},D=function(b){if(k.is(":visible")){v=u.length?u.offset().top-n.scrollTop()+u.height():0;var d=k.offset(),e=a.isWindow(n[0]),f=a.isWindow(o[0]),g=(l.length?e?n.scrollTop():n.offset().top:n.scrollTop())+t+v,h=k.height()-(x.height()+(r.height()||0)),i=g>d.top&&g<d.top+h?"visible":"hidden",j={visibility:i};l.length&&(j.top=e?g-l.offset().top:l.scrollTop()),f&&(j.left=k.offset().left-parseInt(k.css("margin-left"),10)-o.scrollLeft()-A),u.length&&(j.top=(j.top||0)+t+v),x.removeClass(c.css.stickyVis+" "+c.css.stickyHide).addClass("visible"===i?c.css.stickyVis:c.css.stickyHide).css(j),(i!==z||b)&&(C(),z=i)}};if(l.length&&!l.css("position")&&l.css("position","relative"),w.attr("id")&&(w[0].id+=f.stickyHeaders_cloneId),w.find("thead:gt(0), tr.sticky-false").hide(),w.find("tbody, tfoot").remove(),w.find("caption").toggle(f.stickyHeaders_includeCaption),j=y.children().children(),w.css({height:0,width:0,margin:0}),j.find("."+c.css.resizer).remove(),k.addClass("hasStickyHeaders").bind("pagerComplete"+m,function(){C()}),c.bindEvents(d,y.children().children("."+c.css.header)),k.after(x),e.onRenderHeader)for(i=y.children("tr").children(),h=i.length,g=0;h>g;g++)e.onRenderHeader.apply(i.eq(g),[g,e,w]);o.add(n).unbind("scroll resize ".split(" ").join(m).replace(/\s+/g," ")).bind("scroll resize ".split(" ").join(m),function(a){D("resize"===a.type)}),e.$table.unbind("stickyHeadersUpdate"+m).bind("stickyHeadersUpdate"+m,function(){D(!0)}),f.stickyHeaders_addResizeEvent&&c.addHeaderResizeEvent(d),k.hasClass("hasFilters")&&f.filter_columnFilters&&(k.bind("filterEnd"+m,function(){var d=a(document.activeElement).closest("td"),g=d.parent().children().index(d);x.hasClass(c.css.stickyVis)&&f.stickyHeaders_filteredToTop&&(b.scrollTo(0,k.position().top),g>=0&&e.$filters&&e.$filters.eq(g).find("a, select, input").filter(":visible").focus())}),c.filter.bindSearch(k,j.find("."+c.css.filter)),f.filter_hideFilters&&c.filter.hideFilters(e,w)),k.triggerHandler("stickyHeadersInit")}},remove:function(d,e,f){var g=e.namespace+"stickyheaders ";e.$table.removeClass("hasStickyHeaders").unbind("pagerComplete filterEnd stickyHeadersUpdate ".split(" ").join(g).replace(/\s+/g," ")).next("."+c.css.stickyWrap).remove(),f.$sticky&&f.$sticky.length&&f.$sticky.remove(),a(b).add(f.stickyHeaders_xScroll).add(f.stickyHeaders_yScroll).add(f.stickyHeaders_attachTo).unbind("scroll resize ".split(" ").join(g).replace(/\s+/g," ")),c.addHeaderResizeEvent(d,!1)}})}(jQuery,window),function(a,b){"use strict";var c=a.tablesorter||{};a.extend(c.css,{resizableContainer:"tablesorter-resizable-container",resizableHandle:"tablesorter-resizable-handle",resizableNoSelect:"tablesorter-disableSelection",resizableStorage:"tablesorter-resizable"}),a(function(){var b="<style>body."+c.css.resizableNoSelect+" { -ms-user-select: none; -moz-user-select: -moz-none;-khtml-user-select: none; -webkit-user-select: none; user-select: none; }."+c.css.resizableContainer+" { position: relative; height: 1px; }."+c.css.resizableHandle+" { position: absolute; display: inline-block; width: 8px;top: 1px; cursor: ew-resize; z-index: 3; user-select: none; -moz-user-select: none; }</style>";a(b).appendTo("body")}),c.resizable={init:function(b,d){if(!b.$table.hasClass("hasResizable")){b.$table.addClass("hasResizable");var e,f,g,h,i,j=b.$table,k=j.parent(),l=parseInt(j.css("margin-top"),10),m=d.resizable_vars={useStorage:c.storage&&d.resizable!==!1,$wrap:k,mouseXPosition:0,$target:null,$next:null,overflow:"auto"===k.css("overflow")||"scroll"===k.css("overflow")||"auto"===k.css("overflow-x")||"scroll"===k.css("overflow-x"),storedSizes:[]};for(c.resizableReset(b.table,!0),m.tableWidth=j.width(),m.fullWidth=Math.abs(k.width()-m.tableWidth)<20,m.useStorage&&m.overflow&&(c.storage(b.table,"tablesorter-table-original-css-width",m.tableWidth),i=c.storage(b.table,"tablesorter-table-resized-width")||"auto",c.resizable.setWidth(j,i,!0)),d.resizable_vars.storedSizes=h=(m.useStorage?c.storage(b.table,c.css.resizableStorage):[])||[],c.resizable.setWidths(b,d,h),c.resizable.updateStoredSizes(b,d),d.$resizable_container=a('<div class="'+c.css.resizableContainer+'">').css({top:l}).insertBefore(j),g=0;g<b.columns;g++)f=b.$headerIndexed[g],i=c.getColumnData(b.table,b.headers,g),e="false"===c.getData(f,i,"resizable"),e||a('<div class="'+c.css.resizableHandle+'">').appendTo(d.$resizable_container).attr({"data-column":g,unselectable:"on"}).data("header",f).bind("selectstart",!1);c.resizable.setHandlePosition(b,d),c.resizable.bindings(b,d)}},updateStoredSizes:function(a,b){var c,d,e=a.columns,f=b.resizable_vars;for(f.storedSizes=[],c=0;e>c;c++)d=a.$headerIndexed[c],f.storedSizes[c]=d.is(":visible")?d.width():0},setWidth:function(a,b,c){a.css({width:b,"min-width":c?b:"","max-width":c?b:""})},setWidths:function(b,d,e){var f,g,h=d.resizable_vars,i=a(b.namespace+"_extra_headers"),j=b.$table.children("colgroup").children("col");if(e=e||h.storedSizes||[],e.length){for(f=0;f<b.columns;f++)c.resizable.setWidth(b.$headerIndexed[f],e[f],h.overflow),i.length&&(g=i.eq(f).add(j.eq(f)),c.resizable.setWidth(g,e[f],h.overflow));g=a(b.namespace+"_extra_table"),g.length&&!c.hasWidget(b.table,"scroller")&&c.resizable.setWidth(g,b.$table.outerWidth(),h.overflow)}},setHandlePosition:function(b,d){var e,f=c.hasWidget(b.table,"scroller"),g=b.$table.height(),h=d.$resizable_container.children(),i=Math.floor(h.width()/2);f&&(g=0,b.$table.closest("."+c.css.scrollerWrap).children().each(function(){var b=a(this);g+=b.filter('[style*="height"]').length?b.height():b.children("table").height()})),e=b.$table.position().left,h.each(function(){var c=a(this),f=parseInt(c.attr("data-column"),10),h=b.columns-1,j=c.data("header");j&&(j.is(":visible")?(h>f||f===h&&d.resizable_addLastColumn)&&c.css({display:"inline-block",height:g,left:j.position().left-e+j.outerWidth()-i}):c.hide())})},toggleTextSelection:function(b,d,e){var f=b.namespace+"tsresize";d.resizable_vars.disabled=e,a("body").toggleClass(c.css.resizableNoSelect,e),e?a("body").attr("unselectable","on").bind("selectstart"+f,!1):a("body").removeAttr("unselectable").unbind("selectstart"+f)},bindings:function(d,e){var f=d.namespace+"tsresize";e.$resizable_container.children().bind("mousedown",function(b){var f,g=e.resizable_vars,h=a(d.namespace+"_extra_headers"),i=a(b.target).data("header");f=parseInt(i.attr("data-column"),10),g.$target=i=i.add(h.filter('[data-column="'+f+'"]')),g.target=f,g.$next=b.shiftKey||e.resizable_targetLast?i.parent().children().not(".resizable-false").filter(":last"):i.nextAll(":not(.resizable-false)").eq(0),f=parseInt(g.$next.attr("data-column"),10),g.$next=g.$next.add(h.filter('[data-column="'+f+'"]')),g.next=f,g.mouseXPosition=b.pageX,c.resizable.updateStoredSizes(d,e),c.resizable.toggleTextSelection(d,e,!0)}),a(document).bind("mousemove"+f,function(a){var b=e.resizable_vars;b.disabled&&0!==b.mouseXPosition&&b.$target&&(e.resizable_throttle?(clearTimeout(b.timer),b.timer=setTimeout(function(){c.resizable.mouseMove(d,e,a)},isNaN(e.resizable_throttle)?5:e.resizable_throttle)):c.resizable.mouseMove(d,e,a))}).bind("mouseup"+f,function(){e.resizable_vars.disabled&&(c.resizable.toggleTextSelection(d,e,!1),c.resizable.stopResize(d,e),c.resizable.setHandlePosition(d,e))}),a(b).bind("resize"+f+" resizeEnd"+f,function(){c.resizable.setHandlePosition(d,e)}),d.$table.bind("columnUpdate"+f,function(){c.resizable.setHandlePosition(d,e)}).find("thead:first").add(a(d.namespace+"_extra_table").find("thead:first")).bind("contextmenu"+f,function(){var a=0===e.resizable_vars.storedSizes.length;return c.resizableReset(d.table),c.resizable.setHandlePosition(d,e),e.resizable_vars.storedSizes=[],a})},mouseMove:function(b,d,e){if(0!==d.resizable_vars.mouseXPosition&&d.resizable_vars.$target){var f,g=0,h=d.resizable_vars,i=h.$next,j=h.storedSizes[h.target],k=e.pageX-h.mouseXPosition;if(h.overflow){if(j+k>0){for(h.storedSizes[h.target]+=k,c.resizable.setWidth(h.$target,h.storedSizes[h.target],!0),f=0;f<b.columns;f++)g+=h.storedSizes[f];c.resizable.setWidth(b.$table.add(a(b.namespace+"_extra_table")),g)}i.length||(h.$wrap[0].scrollLeft=b.$table.width())}else h.fullWidth?(h.storedSizes[h.target]+=k,h.storedSizes[h.next]-=k,c.resizable.setWidths(b,d)):(h.storedSizes[h.target]+=k,c.resizable.setWidths(b,d));h.mouseXPosition=e.pageX,b.$table.triggerHandler("stickyHeadersUpdate")}},stopResize:function(a,b){var d=b.resizable_vars;c.resizable.updateStoredSizes(a,b),d.useStorage&&(c.storage(a.table,c.css.resizableStorage,d.storedSizes),c.storage(a.table,"tablesorter-table-resized-width",a.$table.width())),d.mouseXPosition=0,d.$target=d.$next=null,a.$table.triggerHandler("stickyHeadersUpdate")}},c.addWidget({id:"resizable",priority:40,options:{resizable:!0,resizable_addLastColumn:!1,resizable_widths:[],resizable_throttle:!1,resizable_targetLast:!1,resizable_fullWidth:null},init:function(a,b,d,e){c.resizable.init(d,e)},remove:function(b,d,e,f){if(e.$resizable_container){var g=d.namespace+"tsresize";d.$table.add(a(d.namespace+"_extra_table")).removeClass("hasResizable").children("thead").unbind("contextmenu"+g),e.$resizable_container.remove(),c.resizable.toggleTextSelection(d,e,!1),c.resizableReset(b,f),a(document).unbind("mousemove"+g+" mouseup"+g)}}}),c.resizableReset=function(b,d){a(b).each(function(){var a,e,f=this.config,g=f&&f.widgetOptions,h=g.resizable_vars;if(b&&f&&f.$headerIndexed.length){for(h.overflow&&h.tableWidth&&(c.resizable.setWidth(f.$table,h.tableWidth,!0),h.useStorage&&c.storage(b,"tablesorter-table-resized-width","auto")),a=0;a<f.columns;a++)e=f.$headerIndexed[a],g.resizable_widths&&g.resizable_widths[a]?c.resizable.setWidth(e,g.resizable_widths[a],h.overflow):e.hasClass("resizable-false")||c.resizable.setWidth(e,"",h.overflow);f.$table.triggerHandler("stickyHeadersUpdate"),c.storage&&!d&&c.storage(this,c.css.resizableStorage,{})}})}}(jQuery,window),function(a){"use strict";var b=a.tablesorter||{};b.addWidget({id:"saveSort",priority:20,options:{saveSort:!0},init:function(a,b,c,d){b.format(a,c,d,!0)},format:function(c,d,e,f){var g,h,i=d.$table,j=e.saveSort!==!1,k={sortList:d.sortList};d.debug&&(h=new Date),i.hasClass("hasSaveSort")?j&&c.hasInitialized&&b.storage&&(b.storage(c,"tablesorter-savesort",k),d.debug&&console.log("saveSort widget: Saving last sort: "+d.sortList+b.benchmark(h))):(i.addClass("hasSaveSort"),k="",b.storage&&(g=b.storage(c,"tablesorter-savesort"),k=g&&g.hasOwnProperty("sortList")&&a.isArray(g.sortList)?g.sortList:"",d.debug&&console.log('saveSort: Last sort loaded: "'+k+'"'+b.benchmark(h)),i.bind("saveSortReset",function(a){a.stopPropagation(),b.storage(c,"tablesorter-savesort","")})),f&&k&&k.length>0?d.sortList=k:c.hasInitialized&&k&&k.length>0&&b.sortOn(d,k))},remove:function(a,c){c.$table.removeClass("hasSaveSort"),b.storage&&b.storage(a,"tablesorter-savesort","")}})}(jQuery),a.tablesorter});</script>
    <script>
        Polymer({
            is: "inventory-section",
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true
                },
                headers: {
                    type: Array,
                    notify: true,

                },
                data: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onDataChange'
                }
            },
            ready: function () {
            },
            attached: function () {
                this.async(function () {
                    var data = [
                        {
                            title: 'title1',
                            price: '1',
                            description: 'This is the first title'
                        },
                        {
                            title: 'title2',
                            price: '2',
                            description: 'This is the second title'
                        }
                    ];

                    data.forEach(function (d) {
                        d.fullname = d.title.concat(' ', d.description, ' ', d.price);
                    });

                    this.data = data;

                    $("#myTable").tablesorter();
                }.bind(this));
            },
            onDataChange: function () {
                //this.$.inventoryTable.data = this.data;
            }
        });

    </script>
</dom-module>
<dom-module id="search-bar" assetpath="../../web.common/elements/">
    <style>
        :host {
            display: block;
        }
    </style>
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
            .suggestionBg{
                position:absolute; 
                z-index:1; 
                width:100%; 
                background:rgba(200, 200, 255, 0.6);
                font-size:xx-small;
            }
            #searchInput{
                display:block; font-size:medium; height:35px;width:100%;
            }
            #searchInput:hover{
                background:lightblue;
            }
        </style>
        <input id="searchInput" type="search" on-blur="onSearchBlur" on-input="onSearchInput">
        <div class="suggestionBg">
            <template is="dom-repeat" items="{{suggestions}}" as="suggestion">
                <paper-item class="suggestion" on-click="onSuggestionSelect">{{suggestion.fullname}}</paper-item>
            </template>
        </div>
    </template>
    <script>

        Polymer({

            is: 'search-bar',

            properties: {
                data: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true
                },
                maxSuggestions: {
                    type: Number,
                    notify: true,
                    relfectToAttribute: true
                },
                suggestions: {
                    type: Array,
                    notify: true
                }
            },
            ready:function(){
            },
            attached:function(){
            },
            onSearchBlur: function (event) {
                if (event.relatedTarget && _.includes(event.relatedTarget.className, 'suggestion')) return;
                this.suggestions = [];
                this.fire('lost-focus');
            },
            onSuggestionSelect: function (event, data) {
                this.suggestions = [];
                this.fire('selected', event.model.suggestion);
            },
            onSearchInput: function (event) {
                this.debounce('onSearchInput', function () {
                    var results = [];
                    var i = 1;
                    _.forEach(this.data, function (d) {
                        if (i++ > this.maxSuggestions) return false;
                        if (_.includes(d.fullname, event.srcElement.value))
                            results.push(d);
                    });
                    this.suggestions = results;
                }.bind(this), 50);
            },
        });

    </script>
</dom-module>
<dom-module id="social-media-facebook" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            .header{
                font-size:medium;
                font-weight:bold;
                color:darkgray;
            }
        </style>
        <paper-material class="with-margins">
            <div class="header">
                FACEBOOK
            </div>
            <paper-button raised="" on-click="onSocialLink">link account</paper-button>
                <!--
            <div class="full layout horizontal">
                <paper-material class="circular-avatar-xsmall" style$="{{getImageStyle(review.avatar)}}"></paper-material>
                <div class="full layout vertical">
                    <div class="full layout horizontal">
                        <a href="{{review.author_url}}" target="_blank">{{review.author_name}}</a>
                        <span class="flex"></span>
                        <div class="layout vertical" style="float:right">
                            <div class="review-info layout horizontal">
                                <iron-icon icon="device:access-time"></iron-icon>
                                <span>{{formatTime(review.time)}}</span>
                            </div>
                            <div class="review-info layout horizontal">
                                <iron-icon icon="language"></iron-icon>
                                <span>{{formatLanguage(review.language)}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="full" style="padding-left:30px">
                        <span>{{review.text}}</span>
                    </div>
                </div>
            </div>
                    -->
        </paper-material>
    </template>
    <script>
        Polymer({
            is: "social-media-facebook",
            properties: {

            },
            ready: function () {
            },
            attached: function () {
            },
            onSocialLink: function () {
                CommonModule.modules.social.linkPage();
            }
        });

    </script>
</dom-module>
<dom-module id="review-section" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            .review-info{
                color:gray;
            }

            .review-info span{
                margin: auto 10px;
                font-size:xx-small;
            }
            .star{
                --iron-icon-stroke-color: darkgray;
                --iron-icon-fill-color: gold;
            }
        </style>
        <div style="display:block; width:100%; text-align:center">
            <template is="dom-repeat" items="{{getStars(business.rating)}}" as="star">
                <iron-icon class="star" icon="{{star}}" style="width:50px; height:50px"></iron-icon>
            </template>
        </div>
        <template is="dom-repeat" items="{{reviews}}" as="review">
            <paper-material class="with-margins">
                <div style="display:block; text-align:center;margin-bottom:20px;">
                    <template is="dom-repeat" items="{{getStars(review.rating)}}" as="star">
                        <iron-icon class="star" icon="{{star}}"></iron-icon>
                    </template>
                </div>
                <div class="full layout horizontal">
                    <paper-material class="circular-avatar-xsmall" style$="{{getImageStyle(review.avatar)}}"></paper-material>
                    <div class="full layout vertical">
                        <div class="full layout horizontal">
                            <a href="{{review.author_url}}" target="_blank">{{review.author_name}}</a>
                            <span class="flex"></span>
                            <div class="layout vertical" style="float:right">
                                <div class="review-info layout horizontal">
                                    <iron-icon icon="device:access-time"></iron-icon>
                                    <span>{{formatTime(review.time)}}</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 10px 10px 10px 30px">{{review.text}}</div>
                    </div>
                </div>
            </paper-material>
        </template>
    </template>
    <script>
        var MAX_RATING = 5;
        Polymer({
            is: "review-section",
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange'
                },
                reviews: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true
                }
            },
            ready: function () {
            },
            attached: function () {
            },
            onBusinessChange: function () {
                this.populateReviews();
            },
            getImageStyle: function (avatar) {
                avatar = avatar || '/public/images/unknown_user.png';
                return 'background: center center /cover no-repeat url(' + avatar + ');';
            },
            getStars: function (rating) {
                var result = [];
                for (var i = 0; i < ~~rating; i++)
                    result.push('star');
                if (rating % 1) //fraction
                    result.push('star-half');
                while (result.length < MAX_RATING)
                    result.push('star-border');
                return result;
            },
            populateReviews: function () {
                this.reviews = [].concat(this.business.googleReviews || [], this.business.reviews || []);
            },
            formatTime: function (time) {
                return (new Date(time)).toDateString();
            },
            formatLanguage: function (lang) {
                return lang.toUpperCase();
            }
        });

    </script>
</dom-module>
<dom-module id="photo-gallery" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
ï»¿            .image {
                min-width: 200px;
                max-width: 300px;
                width: 200px;
                position: relative;
                -ms-flex: 1 1 auto;
                -webkit-flex: 1 1 auto;
                flex: 1 1 auto;
            }
            
            paper-material.image {
                margin: 10px 5px;
                display: inline;
                min-width: 0;
                border-radius: 10px;
                max-width: 230px;
            }

                paper-material.image:hover {
                    box-shadow: 0 0 10px blue;
                }

            .chip {
                font-size: xx-small;
                height: 40px;
                width: auto;
                margin: 1px 0 !important;
                text-align: right;
                border-radius: 10px;
                font-weight: bolder;
                min-width: 80px;
                -webkit-flex: 1 1 auto;
                -ms-flex: 1 1 auto;
                flex: 1 1 auto;
            }

            
            paper-fab{
                color:white;
                background:cornflowerblue;
            }
            .badge{
                cursor:pointer;
            }
</style>
        <style>
ï»¿paper-fab {
    width:10vw;
    height:10vw;
    max-width:50px;
    max-height:50px;
    margin:40px 0 0;
    position:relative;
    pointer-events:all;
}

.menu{
    background-color:rgba(129,199,132,0.6);
}
.gallery{
    background-color:rgba(79,195,247,0.6);
}
.review{
    background-color:rgba(77,208,225,0.6);
}

.friend{
    background-color:rgba(77,182,172,0.6);
}

.menu-button{
    background-color:rgb(129,199,132);
}
.gallery-button{
    background-color:rgb(79,195,247);
}
.review-button{
    background-color:rgb(77,208,225);
}

.friend-button{
    background-color:rgb(77,182,172);
}

.page-caption {
    pointer-events:none;
    color: white;
    position: fixed;
    top: 0;
    left: 1%;
    width: 10vw;
    max-width: 50px;
    top:64px;
    height: 100vh;
    z-index: 4;
    -moz-transition: all 1.5s ease;
    -o-transition: all 1.5s ease;
    -webkit-transition: all 1.5s ease;
    transition: all 1.5s ease;
}

@media (min-width: 601px){
    .page-caption{
        left: 210px !important;
    }
}
.vertical-text {
    position: absolute;
    left:0;
    right:0;
    margin:auto;
    top: 80vh;
    text-transform:uppercase;
    -moz-transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -o-transform: rotate(-90deg);
    -webkit-transform: rotate(-90deg);
    transform: rotate(-90deg);
}
</style>

        <style>
            :host {
                overflow: hidden;
                position: relative;
            }

            paper-button {
                display: block;
                width: 100%;
                text-align: left;
            }

            .section-name {
                margin-left: 50px;
                font-size: large;
                color: darkgray;
                font-weight: bolder;
            }


            .context-menu {
                background-color: whitesmoke;
                position: fixed;
                z-index: 2;
                visibility: hidden;
                box-shadow: 5px 5px 2.5px #888888;
                -moz-transition: visibility .2s ease-in-out;
                -o-transition: visibility .2s ease-in-out;
                -webkit-transition: visibility .2s ease-in-out;
                transition: visibility .2s ease-in-out;
            }

                .context-menu paper-icon-item {
                    font-size: xx-small;
                }

            .selectable {
                cursor: pointer;
            }

                .selectable:hover {
                    background: rgba(0,0,255,0.2);
                }
            .leaveContextMenuOpen {
            }
        </style>
        <div style="position:relative; overflow-y:auto">
            <template is="dom-repeat" items="{{sections}}" as="section">
                <template is="dom-if" if="{{!client}}">
                    <paper-button on-click="onToggle">
                        <iron-icon icon="{{getSectionIcon(section.open)}}"></iron-icon>
                        <span class="section-name">{{section.name}}</span>
                    </paper-button>
                </template>
                <iron-collapse opened="{{section.open}}">
                    <template is="dom-if" if="{{!section.photos.length}}">
                    </template>
                    <div class="layout horizontal center-justified wrap">
                        <template is="dom-repeat" items="{{section.photos}}" as="photo">
                            <template is="dom-if" if="{{isImageValid(photo.type, photo.removed)}}">
                                <paper-material class="image layout vertical center" on-contextmenu="onRightClick" style$="{{getPhotoStyle(photo.visible)}}">
                                    <iron-image src="{{photo.image}}" width="200" height$="{{getPhotoHeight(photo)}}" placeholder="/public/images/loading-small.gif" preload="" fade="" on-click="onPictureClick" sizing="cover"></iron-image>
                                    <paper-textarea label="Photo label" readonly$="{{canEdit(photo)}}" max-rows="3" value="{{photo.title}}" style="display:block; width:100%"></paper-textarea>
                                    <div class="layout horizontal wrap">
                                        <template is="dom-repeat" items="{{photo.tags}}" as="tagtext">
                                            <div class="chip layout horizontal center center-justified" style$="{{getRandomColor(tagtext)}}">
                                                <div style="white-space:nowrap; margin:2px 0">{{tagtext}}</div>
                                                <paper-icon-button icon="remove-circle" hidden$="{{canEdit(photo)}}" on-click="onDeleteTag" style="color:hotpink"></paper-icon-button>
                                            </div>
                                        </template>
                                    </div>
                                </paper-material>
                                <template is="dom-if" if="{{!photo.visible}}">
                                    <iron-icon icon="visibility-off" style="position:absolute; top:10%; left:10%"></iron-icon>
                                </template>
                            </template>
                        </template>
                    </div>
                    <template is="dom-if" if="{{canUpload(section)}}">
                        <div class="fullbleed layout vertical">
                            <div class="layout horizontal center-justified wrap">
                                <template is="dom-repeat" items="{{previews}}" as="preview">
                                    <div>
                                        <paper-material class="image layout vertical center" style="background:cornflowerblue">
                                            <iron-image src="{{preview.image}}" placeholder="/public/images/loading-small.gif" preload="" width="200" height$="{{getPhotoHeight(preview.image)}}" sizing="cover" fade="" style="margin:20px"></iron-image>
                                            <paper-badge class="badge" label="X" on-click="removeFile"></paper-badge>
                                        </paper-material>
                                    </div>
                                </template>
                            </div>
                            <div id="uploadControls" class="layout horizontal center-justified">
                                <paper-fab id="addPhotos" style="margin:10px" src="/public/images/ic_add_a_photo_white_24px.svg" on-click="onAddPhotosClick"></paper-fab>
                                <paper-fab id="uploadPhotos" disabled="{{!files.length}}" style="margin:10px" icon="file-upload" on-click="onUploadPhotosClick"></paper-fab>
                            </div>
                        </div>
                    </template>
                </iron-collapse>
            </template>
        </div>
        <paper-menu id="contextMenu" class="context-menu" selectable=".selectable">
            <paper-icon-item class="selectable">
                <iron-icon icon="add" item-icon=""></iron-icon>
                Add tag
            </paper-icon-item>
            <paper-icon-item hidden$="{{client}}" class="selectable" on-click="onChangeVisibility">
                <iron-icon icon="{{getPhotoVisibilityIcon(selectedPhoto.visible)}}" item-icon=""></iron-icon>
                <span>{{getPhotoVisibilityText(selectedPhoto.visible)}}</span>
            </paper-icon-item>
            <paper-icon-item hidden$="{{!canDelete(photo}}" class="selectable" on-click="onDeletePhoto">
                <iron-icon icon="remove-circle" item-icon=""></iron-icon>
                Delete
            </paper-icon-item>
            <template is="dom-if" if="{{!client}}">
                <div class="separator" style="width:80%;left:0;right:0; margin:auto"></div>
                <paper-icon-item class="leaveContextMenuOpen">
                    <paper-checkbox id="facebook-check"></paper-checkbox>
                    <iron-icon src="/public/images/facebook_icon_small.jpg" item-icon=""></iron-icon>
                    Upload to Facebook
                </paper-icon-item>
            </template>
        </paper-menu>
        <input id="uglyinput2" type="file" name="files" multiple="" accept="image/*" hidden="" on-change="handleFiles">
        <paper-dialog id="bigPicture" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
            <div style="position:relative">
                <img id="bigPictureImage" style="max-width:100%">
            </div>
        </paper-dialog>
    </template>
    <script>
        function getIndexByRoute(route) {
            switch(route)
            {
                case '/chefs':
                    return 1;
                case '/diners':
                    return 0;
                default:
                    return undefined;
            }
        }
        Polymer({
            is: "photo-gallery",
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange'
                },
                sections: {
                    type: Array,
                    notify: true,
                    observer: 'onSectionsChange'
                },
                previews: {
                    type: Array,
                    notify: true,
                    value: function () { return [] }
                },
                files: {
                    type: Array,
                    notify: true,
                    value: function () { return [] }
                },
                client: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; },
                    observer: 'onClientToggle'
                },
                selectedPhoto: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                }
            },
            ready: function () {
            },
            attached: function () {
                $('html').click(function (event) { // this is so that menus are closed automatically on click elsewhere
                    this.onClickEvent(event);
                }.bind(this));

            },
            onBusinessChange: function () {
                if(this.business.placeid)
                this.sections = this.getSections(this.business);
            },
            onSectionsChange: function () {
                //if (this.sections && this.sections.length)
            },
            onClientToggle: function () {
                this.style.marginLeft = '50px';
            },
            getSections: function (business) {
                var sections = [
                    {
                        name: 'User photos',
                        photos: business.media.client.photoLinks || [],
                        upload: this.client
                    },
                    {
                        name: 'My photos',
                        photos: business.media.pos.photoLinks || [],
                        upload: !this.client
                    },
                    {
                        name: 'Photos from across the web',
                        photos: (business.googlePhotos || []).concat(business.webPhotos || [])
                    },
                    {
                        name: 'Pdfs from across the web',
                        photos: business.webPdfs || []
                    },
                ];

                sections.forEach(function (s) {
                    s.photos.forEach(defineMissingPhotoProperties);
                    s.open = !!s.photos.length || s.upload;
                });

                return sections;
            },
            onToggle: function (event) {
                var index = _.findIndex(this.sections, function (s) {
                    return s.name == event.model.section.name;
                });
                this.set('sections.' + index + '.open', !event.model.section.open);
            },
            getPhotoHeight: function (photo) {
                return (300 + ~~(Math.random() * 200));
            },
            isImageValid: function (type, removed) {
                return type != 'PDF' && !removed;
            },
            getSectionIcon: function (open) {
                return open ? "arrow-drop-up" : "arrow-drop-down-circle";
            },
            getRandomColor: function (tagtext) {
                var letters = '0123456789ABCDEF'.split('');
                var color = '#';
                for (var i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                var fgColor = parseInt(color, 16) > Math.pow(16, 3) / 2 ? 'black' : 'white';
                var width = (60 + 5 * tagtext.length);
                return 'background-color: ' + color + '; color: ' + fgColor + '; width: ' + width + 'px; max-width: ' + width + 'px;';
            },
            onDeleteTag: function (event) {

            },
            onRightClick: function (event) {
                var photo = event.model.photo;
                if (!this.canEdit(photo))
                    return;

                event.preventDefault();

                defineMissingPhotoProperties(photo); // define missing visible property

                this.selectedPhoto = photo;
                this.$.contextMenu.style.top = event.clientY + 'px';
                this.$.contextMenu.style.left = event.clientX + 'px';
                this.$.contextMenu.style.visibility = 'visible';
            },
            onClickEvent: function (event) {
                if (_.findIndex(event.originalEvent.path, function (elem) {
                    return _.includes(elem.className, 'leaveContextMenuOpen');
                }) > -1) return;
                if (!this.$.bigPicture.opened)
                    this.$.bigPicture.close();
                this.$.contextMenu.style.visibility = 'hidden';
            },
            onPictureClick: function (event) {
                event.preventDefault();
                event.stopPropagation();
                this.$.bigPictureImage.src = event.model.photo.image;
                if (!this.$.bigPicture.opened)
                    this.$.bigPicture.open();
            },
            onChangeVisibility: function (event) {
                var sectionIndex, photoIndex;
                var photo = this.$.contextMenu.dataPhoto;
                sectionIndex = _.findIndex(this.sections, function (s) {
                    photoIndex = _.findIndex(s.photos, function (p) {
                        return p === photo;
                    });
                    return photoIndex > -1;
                });
                if (sectionIndex < 0) return;

                this.set('sections.' + sectionIndex + '.photos.' + photoIndex + '.visible', !photo.visible);
            },
            getPhotoStyle: function (visible) {
                return 'opacity: ' + (visible ? 1 : 0.3);
            },
            getPhotoVisibilityIcon: function (photo) {
                return photo.visible ? 'visibility-off' : 'visibility';
            },
            getPhotoVisibilityText: function (photo) {
                return photo.visible ? 'Hide' : 'Show';
            },
            onAddPhotosClick: function (event) {
                if (this.$.uglyinput2) {
                    this.$.uglyinput2.click();
                }
            },
            onUploadPhotosClick: function (event) {
                if (!CommonModule.utils.validateFiles(this.files)) return false;

                this.disableControls(true);

                var form = this.$.addMenuForm;
                var formData = new FormData(form);

                _.forEach(this.files, function (file) {
                    formData.append('files', file, file.name);
                });
                formData.append('placeid', this.business.placeid);
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                var base = this.client ? '/diners' : '/chefs';
                xhr.open('POST', base + '/access/add/photos', true);
                xhr.onload = function () {
                    this.disableControls(false);

                    if (xhr.status === 200) {
                        // File(s) uploaded.
                        window.writeToScreen('Files uploaded successfully');
                        var responsePhotos = JSON.parse(xhr.response);
                        _.forEach(responsePhotos, defineMissingPhotoProperties);
                        var photos = responsePhotos;
                        var index = getIndexByRoute(photos[0].route);
                        this.splice.apply(this, ['sections.' + index + '.photos', this.sections[index].photos.length, 0].concat(photos))
                        this.clearAll();
                    }
                    else if (xhr.status === 401) {
                        // File(s) uploaded.
                        window.writeToScreen('You must be registered to upload files.', 'Login here', '/account');
                    } else {
                        window.writeToScreen('Service is currently unavailable. Please try again later.');
                    }
                }.bind(this);
                xhr.send(formData);
                return true;
            },
            handleFiles: function (event) {
                var files = _.filter(event.target.files, function (file) {
                    return file.type.startsWith('image/') && !_.find(this.files, function (f) {
                        return f.name == file.name;
                    });
                }.bind(this));

                _.forEach(files, function (file) {
                    file.id = 'id' + Math.random().toString(36).substr(5);
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        this.push('previews', { image: e.target.result, browserId: Math.random(), file: file });
                    }.bind(this);

                    reader.readAsDataURL(file);
                }.bind(this));
                if (files.length)
                    this.splice.apply(this, ['files', this.files.length, 0].concat(files));
            },
            removeFile: function (event) {
                this.$.uglyinput2.value = ""; //deletes everything but we don't need it anyway
                var fileIndex = _.findIndex(this.files, function (file) { return file === this.previews[event.model.index].file }.bind(this));
                this.splice('previews', event.model.index, 1);
                this.splice('files', fileIndex, 1);
                this.updateFileBadgePosition();
            },
            clearAll: function () {
                this.$.uglyinput2.value = "";
                this.splice('previews', 0);
                this.splice('files', 0);
            },
            canUpload: function (section) {
                return section && section.upload;
            },
            canDelete: function(photo){
                return this.canEdit(photo, true) || (!this.client && photo.placeid == this.business.placeid);
            },
            updateFileBadgePosition: function () {
                setTimeout(function () {
                    console.log('in updateFileBadgePosition');
                    var elems = this.querySelectorAll('.badge');
                    _.forEach(elems, function (elem) {
                        if (elem.updatePosition)
                            elem.updatePosition();
                    });
                }.bind(this), 50);
            },
            disableControls: function (disable) {
                _.forEach(this.querySelectorAll('paper-fab'), function (node) {
                    node.disabled = disable;
                });
            },
            canEdit: function (photo, ignoreClient) { //ignoreClient basically nullifies the !this.client condition
                return (!this.client && !ignoreClient) ||
                    (photo.username && CommonModule.modules.user.current.is() && photo.username == CommonModule.modules.user.current.profile().username);
            },
            onDeletePhoto: function () {
                $.ajax({
                    type: "POST",
                    url: '/diners/access/delete/photo',
                    data: {photo: JSON.stringify(this.selectedPhoto)},
                    success: function (a) {
                        console.log('success');
                        this.set('selectedPhoto.removed', true);
                    }.bind(this)
                });
            }
        });

        function defineMissingPhotoProperties(photo) {
            if (_.isUndefined(photo.visible))
                photo.visible = true;
            if (_.isUndefined(photo.removed))
                photo.removed = false;
        }
    </script>
</dom-module>
<dom-module id="img-crop" assetpath="../../web.common/elements/">
    <template>
        <style>
            :host {
            }

            #cropperContainer {
            }
            .previews {
                margin-left: 0;
            }

            .previewSmall {
                border: 1px solid #ccc;
                width: 100px;
                height: 100px;
                display: block;
                margin: auto;
            }

            #previewThumb {
                width: 48px;
                height: 48px;
                margin-top: 7px;
                margin-left: 8px;
            }

            .blue {
                background-color: #5677fc;
                color: white;
            }

            ::content img {
                max-width:100%;
                max-height:100%;
                margin: auto 0;
                /*position: absolute;*/
                z-index: 1;
                /*width: 100%;*/
            }

            ::content .icropper {
                position: relative;
            }

            ::content .no-select {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            ::content .icropper .crop-node {
                border: 1px dotted #999;
                position: absolute;
                z-index: 8;
                left: 10px;
                top: 10px;
                cursor: move;
            }

            ::content .crop-node {
                border: 1px dotted #999;
                position: absolute;
                z-index: 8;
                left: 10px;
                top: 10px;
                cursor: move;
            }

            ::content .icropper .anchor {
                width: 9px;
                height: 9px;
                border: 2px solid #ccc;
                border-radius: 50%;
                position: absolute;
                z-index: 11;
            }

            ::content .icropper .anchor-lt {
                cursor: nw-resize;
                left: -8px;
                top: -8px;
            }

            ::content .icropper .anchor-t {
                cursor: n-resize;
                top: -8px;
            }

            ::content .icropper .anchor-rt {
                cursor: ne-resize;
                right: -4px;
                top: -8px;
            }

            ::content .icropper .anchor-r {
                cursor: e-resize;
                right: -8px;
            }

            ::content .icropper .anchor-rb {
                cursor: se-resize;
                right: -8px;
                bottom: -8px;
            }

            ::content .icropper .anchor-b {
                cursor: s-resize;
                bottom: -8px;
            }

            ::content .icropper .anchor-lb {
                cursor: sw-resize;
                left: -8px;
                bottom: -8px;
            }

            ::content .icropper .anchor-l {
                cursor: w-resize;
                left: -8px;
            }

            ::content .icropper .block {
                position: absolute;
                opacity: 0.5;
                z-index: 5;
                background-color: #000;
                /* IE 8 */
                -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
                /* IE 5-7 */
                filter: alpha(opacity=50);
            }

            ::content .icropper .block-l {
                left: 0;
            }

            ::content .icropper .block-t {
                top: 0;
                width: 100%;
            }

            ::content .icropper .block-r {
                right: 0;
            }

            ::content .icropper .block-b {
                bottom: 0;
                width: 100%;
            }

            ::content .icropper img {
                /*position: absolute;*/
                z-index: 1;
                left: 0;
                top: 0;
            }
            paper-icon-button.dismissbutton{
                background-color:rgba(255,255,255, 0.6); 
            }
        </style>
        <div class="flex_ cropperContainer" id="cropperContainer"> </div>
    </template>
    <script>
        var imgCropRef;
    Polymer({
      is: 'img-crop',
      properties: {
          image: {
              type: String,
              notify: true,
          },
          color: {
              type: String,
              notify: true,
              value:function(){return 'black';},
              observer: 'onOutlineColorChange'
          }
      },
      observers:[
          'setImage(image)'
      ],
      attached: function () {
          imgCropRef = this;
          // console.log('ready')
          this.gap = 10;
          this.minWidth = 20;
          this.minHeight = 20;
          this.ratio = 0;
          this.initialSize = 0;
          this.domNode = this.$.cropperContainer;
          this.domNode.classList.add('icropper');
          // this.preview = ['previewSmall']
          // this.preview = ['previewThumb']
          var self = this;
          setTimeout(function () {
              self._init();
          }, 100);
          // this.imgNode = document.createElement('img')
      },
      _init: function () {
          this.domNode.classList.add('icropper');
          this._buildRendering();
          this._updateUI();
          // util.connect(this.cropNode, 'mousedown', this, '_onMouseDown');
          // util.connect(document, 'mouseup', this, '_onMouseUp');
          // util.connect(document, 'mousemove', this, '_onMouseMove');
          util.connect(this.cropNode, 'down', this, '_onDown');
          // util.connect(document, 'track', this, '_onTrack');
          util.connect(this.cropNode, 'track', this, '_onTrack');
          util.connect(this.cropNode, 'up', this, '_onUp');
          // this.image && this.setImage(this.image);
          // if (this.preview) {
          //   var self = this;
          //   util.each(this.preview, function(node) {
          //     self.bindPreview(node)
          //   })
          // }
      },
      onOutlineColorChange: function () {
          $('.block').css('background-color', this.color);
          if(this.cropNode)
            this._updateUI();
      },
      setImage: function (size) {
          return;
          // summary:
          //  Set the image to be cropped. The container size will fit the image.
          var img = new Image();
          img.src = url;
          if (!this.imageNode) {
              this.imageNode = util.create('img');
              this.imageNode.style.opacity = 0;
              this.domNode.appendChild(this.imageNode);
              var self = this;
              //TODO: onerror?
              this.imageNode.onload = function () {
                  self._setSize(this.offsetWidth, this.offsetHeight);
              };
          }
          this.imageNode.src = url;
      },
      onChange: function () {
          //Event:
          //    When the cropping size is changed.
      },
      onComplete: function (info) {
          //Event:
          //    When mouseup.
          this.fire('complete', info);
      },
      onOK:function(){
          this.fire('ok', this.getInfo());
      },
      onDismiss: function(){
          this.fire('cancel');
      },
      forceApproveSelection: function(){
          this.onOK();
      },
      getInfo: function () {
          // summary:
          //  Get the cropping infomation. Such as being used by server side for real cropping.
          return {
              w: this.cropNode.offsetWidth - 2,   //2 is hard code border width
              h: this.cropNode.offsetHeight - 2,
              l: parseInt(util.style(this.cropNode, 'left')),
              t: parseInt(util.style(this.cropNode, 'top')),
              cw: this.domNode.offsetWidth, //container width
              ch: this.domNode.offsetHeight, //container height
          };
      },
      bindPreview: function (node) {
          node = util.byId(node);
          util.style(node, { overflow: 'hidden' });
          var old = util.byId('previewimg');
          if (old) {
              old.remove();
          }
          var width = parseInt(util.style(node, 'width')),
              height = parseInt(util.style(node, 'height'));
          var previewImage = util.create('img', { src: this.imageNode.src, id: 'previewimg' });
          node.appendChild(previewImage);
          var _oldOnChange = this.onChange;
          this.onChange = function (info) {
              _oldOnChange.call(this, info);
              var r = info.w / info.h,
                  w2 = height * r,
                  h2 = width / r;
              if (w2 >= width) { w2 = width; }
              if (h2 >= height) { h2 = height; }
              util.style(node, { width: w2 + 'px', height: h2 + 'px' });
              var rateX = w2 / info.w,
                  rateY = h2 / info.h;
              util.style(previewImage, {
                  width: info.cw * rateX + 'px',
                  height: info.ch * rateY + 'px',
                  marginLeft: -info.l * rateX + 'px',
                  marginTop: -info.t * rateY + 'px'
              });
          };
      },
      editSection: function(position){
          this.cropNode.style.left = position.left + 'px';
          this.cropNode.style.top = position.top + 'px';
          this.cropNode.style.width = position.width + 'px';
          this.cropNode.style.height = position.height + 'px';
          this._updateUI();
      },
      _updateUI: function () {
          this._posAnchors();
          this._posBlocks();
      },
      _buildRendering: function () {
          this._anchors = {};
          this._blockNodes = {};
          this.cropNode = util.create('div', { className: 'crop-node no-select layout horizontal center-justified' });
          this.cropNode.innerHTML = '<paper-icon-button style="display:block; background-color:rgba(0,255,0, 0.4);color: white;" icon="check" onclick="onOKAux()"></paper-icon-button>'
              + '<paper-icon-button style="display:block; background-color:rgba(255,255,255, 0.4);" icon="close" onclick="onDismissAux()"></paper-icon-button>'
          this.domNode.appendChild(this.cropNode);
          //Create anchors
          var arr = ['lt', 't', 'rt', 'r', 'rb', 'b', 'lb', 'l'];
          var i, n;
          for (i = 0; i < 8; i++) {
              n = util.create('div', { className: 'anchor anchor-' + arr[i] });
              this.cropNode.appendChild(n);
              this._anchors[arr[i]] = n;
          }
          //Create blocks for showing dark areas
          arr = ['l', 't', 'r', 'b'];
          for (i = 0; i < 4; i++) {
              n = util.create('div', { className: 'block block-' + arr[i] });
              this.domNode.appendChild(n);
              this._blockNodes[arr[i]] = n;
          }
      },
      _posAnchors: function () {
          var a = this._anchors,
              w = this.cropNode.offsetWidth,
              h = this.cropNode.offsetHeight;
          w = w / 2 - 4 + 'px';
          h = h / 2 - 4 + 'px';
          a.t.style.left = a.b.style.left = w;
          a.l.style.top = a.r.style.top = h;
      },
      _posBlocks: function () {
          // var p = this.startedPos,
          var b = this._blockNodes;
          var l = parseInt(util.style(this.cropNode, 'left'));
          var t = parseInt(util.style(this.cropNode, 'top'));
          var w = this.cropNode.offsetWidth;
          var ww = this.domNode.offsetWidth;
          var h = this.cropNode.offsetHeight;
          var hh = this.domNode.offsetHeight;
          b = this._blockNodes;
          b.t.style.height = b.l.style.top = b.r.style.top = t + 'px';
          b.l.style.height = b.r.style.height = h + 'px';
          b.l.style.width = l + 'px';
          w = ww - w - l;
          h = hh - h - t;
          //fix IE
          if (w < 0) { w = 0; }
          if (h < 0) { h = 0; }
          b.r.style.width = w + 'px';
          b.b.style.height = h + 'px';
      },
      _setSize: function (w, h) {
          this.domNode.style.width = w + 'px';
          this.domNode.style.height = h + 'px';
          var w2, h2;
          if (this.initialSize) {
              var m = Math.min(w, h, this.initialSize);
              w2 = h2 = m - 2 + 'px';
          } else {
              w2 = w - this.gap * 2 - 2;
              h2 = h - this.gap * 2 - 2;
              if (this.ratio) {
                  var _w2 = h2 * this.ratio, _h2 = w2 / this.ratio;
                  if (w2 > _w2) { w2 = _w2; }
                  if (h2 > _h2) { h2 = _h2; }
              }
              w2 += 'px';
              h2 += 'px';
          }
          var s = this.cropNode.style;
          s.width = w2;
          s.height = h2;
          var l = (w - this.cropNode.offsetWidth) / 2,
              t = (h - this.cropNode.offsetHeight) / 2;
          if (l < 0) { l = 0; }
          if (t < 0) { t = 0; }
          s.left = l + 'px';
          s.top = t + 'px';
          this._posAnchors();
          this._posBlocks();
          this.onChange(this.getInfo());
      },
      _onDown: function (e) {
          var n = this.cropNode;//, s = n.style;
          this.dragging = (e.target === n) ? 'move' : e.target.className;
          if (this.dragging !== 'move') {
              var arr = this.dragging.split(' ');
              this.dragging = arr.pop().split('-')[1];
          }
          this.startedPos = {
              x: e.detail.x,
              y: e.detail.y,
              h: n.offsetHeight - 2, //2 is border width
              w: n.offsetWidth - 2,
              l: parseInt(util.style(n, 'left')),
              t: parseInt(util.style(n, 'top'))
          };
          var c = util.style(e.target, 'cursor');
          util.style(document.body, {
              cursor: c
          });
          util.style(this.cropNode, {
              cursor: c
          });
          util.addCss(document.body, 'no-select');
          util.addCss(document.body, 'unselectable');//for IE
          // e.preventDefault();
      },
      _onUp: function () {
          this.dragging = false;
          util.style(document.body, {
              cursor: 'default'
          });
          util.style(this.cropNode, {
              cursor: 'move'
          });
          util.rmCss(document.body, 'no-select');
          util.rmCss(document.body, 'unselectable');
          // this.onComplete && this.onComplete(this.getInfo());
          this.onComplete(this.getInfo());
      },
      _onTrack: function (e) {
          if (!this.dragging) { return; }
          if (this.dragging === 'move') { this._doTrack(e); }
          else { this._doTrackResize(e); }
          this._updateUI();
          // this.onChange && this.onChange(this.getInfo());
          this.onChange(this.getInfo());
          e.preventDefault();
      },
      _doTrack: function (e) {
          var s = this.cropNode.style,
              p0 = this.startedPos;
          var l = p0.l + e.detail.x - p0.x;
          var t = p0.t + e.detail.y - p0.y;
          if (l < 0) { l = 0; }
          if (t < 0) { t = 0; }
          var maxL = this.domNode.offsetWidth - this.cropNode.offsetWidth;
          var maxT = this.domNode.offsetHeight - this.cropNode.offsetHeight;
          if (l > maxL) { l = maxL; }
          if (t > maxT) { t = maxT; }
          s.left = l + 'px';
          s.top = t + 'px';
      },
      _doTrackResize: function (e) {
          var m = this.dragging,
              s = this.cropNode.style,
              // cw = this.cropNode.offsetWidth,
              // ch = this.cropNode.offsetHeight,
              p0 = this.startedPos;
          //delta x and delta y
          var dx = e.detail.x - p0.x,
              dy = e.detail.y - p0.y;
          var ratio = this.ratio;
          if (!ratio && e.shiftKey) { ratio = 1; }//Shiftkey is only available when there's no ratio set.
          if (ratio) {
              if (m === 'l') {
                  dy = dx / ratio;
                  if (p0.l + dx < 0) { dx = -p0.l; dy = dx / ratio; }
                  if (p0.t + dy < 0) { dy = -p0.t; dx = dy * ratio; }
                  m = 'lt';
              } else if (m === 'r') {
                  dy = dx / ratio;
                  m = 'rb';
              } else if (m === 'b') {
                  dx = dy * ratio;
                  m = 'rb';
              } else if (m === 'lt') {
                  dx = Math.abs(dx) > Math.abs(dy) ? dx : dy;
                  dy = dx / ratio;
                  if (p0.l + dx < 0) { dx = -p0.l; dy = dx / ratio; }
                  if (p0.t + dy < 0) { dy = -p0.t; dx = dy * ratio; }
              } else if (m === 'lb') {
                  dx = Math.abs(dx) > Math.abs(dy) ? dx : -dy;
                  dy = -dx / ratio;
                  if (p0.l + dx < 0) {
                      dx = -p0.l;
                      dy = p0.l;
                  }
              } else if (m === 'rt' || m === 't') {
                  dx = -dy * ratio;
                  m = 'rt';
                  if (p0.t + dy < 0) {
                      dy = -p0.t;
                      dx = -dy;
                  }
              }
          }
          if (/l/.test(m)) {
              dx = Math.min(dx, p0.w - this.minWidth);
              if (p0.l + dx >= 0) {
                  s.left = p0.l + dx + 'px';
                  s.width = p0.w - dx + 'px';
              } else {
                  s.left = 0;
                  s.width = p0.l + p0.w + 'px';
              }
          }
          if (/t/.test(m)) {
              dy = Math.min(dy, p0.h - this.minHeight);
              if (p0.t + dy >= 0) {
                  s.top = p0.t + dy + 'px';
                  s.height = p0.h - dy + 'px';
              } else {
                  s.top = 0;
                  s.height = p0.t + p0.h + 'px';
              }
          }
          if (/r/.test(m)) {
              dx = Math.max(dx, this.minWidth - p0.w);
              if (p0.l + p0.w + dx <= this.domNode.offsetWidth) {
                  s.width = p0.w + dx + 'px';
              } else {
                  s.width = this.domNode.offsetWidth - p0.l - 2 + 'px';
              }
          }
          if (/b/.test(m)) {
              dy = Math.max(dy, this.minHeight - p0.h);
              if (p0.t + p0.h + dy <= this.domNode.offsetHeight) {
                  s.height = p0.h + dy + 'px';
              } else {
                  s.height = this.domNode.offsetHeight - p0.t - 2 + 'px';
              }
          }
          if (ratio) {
              var w = parseInt(s.width), h = parseInt(s.height);
              var w2 = h * ratio, h2 = w / ratio;
              if (w2 < w) {
                  if (/l/.test(m)) {
                      s.left = parseInt(s.left) + w - w2 + 'px';
                  }
                  w = w2;
              }
              if (h2 < h) {
                  if (/t/.test(m)) {
                      s.top = parseInt(s.top) + h - h2 + 'px';
                  }
                  h = h2;
              }
              s.width = w + 'px';
              s.height = h + 'px';
          }
      }
    });
  var util = {
      mixin: function (dest, src) {
          for (var p in src) { dest[p] = src[p]; }
      },
      byId: function (id) {
          if (typeof id === 'string') { return document.getElementById(id); }
          else { return id; }
      },
      create: function (tag, attrs) {
          var node = document.createElement(tag);
          this.mixin(node, attrs);
          return node;
      },
      connect: function (node, evtType, context, callback) {
          //TODO: use event listeners instead
          // var self = this;
          function handler(evt) {
              // evt = self.fixEvent(evt);
              context[callback](evt);
          }
          if (node.attachEvent) { node.attachEvent('on' + evtType, handler); }
          else { node.addEventListener(evtType, handler, false); }
      },
      style: function (node, args) {
          if (typeof args === 'string') {
              var value = node.style[args];
              if (!value) {
                  var s = window.getComputedStyle ? getComputedStyle(node) : node.currentStyle;
                  value = s[args];
              }
              return value;
          } else { this.mixin(node.style, args); }
      },
      each: function (arr, callback) {
          for (var i = 0; i < arr.length; i++) {
              callback(arr[i], i);
          }
      },
      indexOf: function (arr, value) {
          for (var i = 0; i < arr.length; i++) {
              if (value === arr[i]) { return i; }
          }
          return -1;
      },
      addCss: function (node, css) {
          if (!node) { return; }
          var cn = node.className || '', arr = cn.split(' '), i = util.indexOf(arr, css);
          if (i < 0) { arr.push(css); }
          node.className = arr.join(' ');
      },
      rmCss: function (node, css) {
          if (!node) { return; }
          var cn = node.className || '', arr = cn.split(' '), i = util.indexOf(arr, css);
          if (i >= 0) { arr.splice(i, 1); }
          node.className = arr.join(' ');
      },
      fixEvent: function (evt) {
          evt = evt || event;
          if (!evt.target) { evt.target = evt.srcElement; }
          if (!evt.keyCode) { evt.keyCode = evt.which || evt.charCode; }
          if (!evt.pageX) {//only for IE
              evt.pageX = evt.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
              evt.pageY = evt.clientY + document.body.scrollTop + document.documentElement.scrollTop;
          }
          return evt;
      }
  };
  function dataURItoBlob(dataURI) {
      // convert base64/URLEncoded data component to raw binary data held in a string
      var byteString;
      if (dataURI.split(',')[0].indexOf('base64') >= 0) {
          byteString = atob(dataURI.split(',')[1]);
      } else {
          byteString = decodeURI(dataURI.split(',')[1]);
      }
      // separate out the mime component
      var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      // write the bytes of the string to a typed array
      var ia = new Uint8Array(byteString.length);
      for (var i = 0; i < byteString.length; i++) {
          ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ia], { type: mimeString });
  }
  function onOKAux() {
      imgCropRef.onOK();
  }
  function onDismissAux() {
      imgCropRef.onDismiss();
  }

    </script>
</dom-module><dom-module id="business-grid-item" assetpath="../../web.common/elements/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
.grid {
    padding: 0;
    -webkit-flex-wrap: wrap; /* Safari 6.1+ */
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-align-content: flex-start;
    -webkit-align-content: flex-start;
    align-content: flex-start;
    justify-content: flex-start;
}

.grid-item-size {
    min-width: 100px;
    width: 100px;
    max-width: 140px;
    min-height: 155px;
    height: 155px;
    max-height: 155px;
}

.grid-item{
        -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
        margin: 1px 1px 5px;
    cursor: pointer;
    -ms-flex: 1 1 100px;
    -webkit-flex: 1 1 100px;
    flex: 1 1 100px;
}



@media (min-width: 641px) {
    .grid-item {
        min-width: 100px;
        margin: 5px;
    }

    .grid {
        padding: 10px;
    }
}

.map-info-window {
    min-width: 150px;
    min-height: 150px;
    max-width: 300px;
    max-height: 300px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}


paper-card {
    text-align: center;
    --paper-card-header-text: {
    text-transform: uppercase;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    font-size: xx-small;
    padding: 5px 0 0;
    margin: 0;
    vertical-align: central;
    font-family: Tahoma;
    font-weight: bold;
    background: linear-gradient(rgba(0,0,0, 0.3),rgba(0,0,0, 0.3));
    width: auto;
    height: 35px;
    bottom: 4px;
    left: 0;
    right: 0;
    color: white;
}

--paper-card-header-image: {
    height: 90px;
    --iron-image-height: 100%;
}

--paper-card-actions: {
    height: 80%;
}

}

.stars, .stars span {
    display: block;
    background: url("../../public/images/small-stars.png") 0 -12px repeat-x;
    width: 60px;
    height: 12px;
}

    .stars span {
        background-position: 0 0;
    }

.stars-div {
    position: absolute;
    top: -0.5px;
}

</style>
        <style>





            }
        </style>

    </template>
    <script>

        const CARD_HOVER_ELEVATION = 3;
        const CARD_ELEVATION = 1;
        const MAX_WIDTH_STAR_RATING = 60;
        const OUT_OF_TOTAL_STARS = 5;
        const UPPER_THRESHOLD_FOR_SHORT_METER_DISPLAY = 950;
        var businessHashTable = {}
        Polymer({

            is: 'business-grid-item',

            behaviors: [
              Polymer.NeonAnimatableBehavior
            ],

            properties: {
                business: {
                    type: Object,
                    notify: true
                },
                size: {
                    type: String,
                    value: function () { return 'small'; } // other option: big
                },
                shape: {
                    type: String,
                    value: function () { return 'square'; } // other option: round
                },
                fullname:{
                    type: String,
                    readyOnly: true,
                },
                hideActions: {
                    type: Boolean,
                    value: function () { return false; }
                }

            },
            ready: function () {
            },
            attached: function () {
                this.setSize();
                this.setShape();
            },

        });
    </script>
</dom-module>
<dom-module id="error-card" assetpath="../../web.common/elements/">
    <style>
        :host {
            display: block;
        }

        .fixed {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 100vw;
        }

        .card {
            position: relative;
            margin: 200px 100px 0;
            height: 700px;
        }
    </style>
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <paper-material animated="true" elevation="1" id="card" style="width:100%;height:100%">
            <div style="left:20vw; top:20vh">
                <h2 class="page-title">{{title}}</h2>
                <p>{{message}}</p>
            </div>
        </paper-material>
    </template>
    <script>

        Polymer({

            is: 'error-card',

            behaviors: [
              Polymer.NeonAnimatableBehavior
            ],

            properties: {

                title: {
                    type: String,
                    notify: true
                },
                message: {
                    type: String,
                    notify: true
                },
                animationConfig: {
                    type: Object,
                    value: function () {
                        return {
                            'entry': [{
                                name: 'scale-up-animation',
                                node: this.$.card
                            }],
                            'exit': [{
                                name: 'scale-down-animation',
                                node: this.$.card
                            }]
                        };
                    }
                }

            }
        });

    </script>
</dom-module>
<dom-module id="menu-uploader" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
ï»¿
#main {
    min-height: calc(100vh - 64px);
}

.business-title {
    position:absolute;
    width: 100%;
    display:block;
    font-size: x-small;
    font-weight: bold;
    text-transform:uppercase;
    z-index:2;
    opacity:0.5;
    -moz-transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -o-transform: rotate(-90deg);
    -webkit-transform: rotate(-90deg);
    transform: rotate(-90deg);
    -moz-transform-origin: right bottom 0;
    -ms-transform-origin: right bottom 0;
    -o-transform-origin: right bottom 0;
    -webkit-transform-origin: right bottom 0;
	transform-origin: right bottom 0;
}

@keyframes reveal {
    from {
        height: 0;
        padding: 0;
        opacity: 0;
    }

    to {
        height: 100%;
        padding: 20px;
        opacity: 1;
    }
}

paper-material {
    -moz-transition: all 0.5s ease;
    -o-transition: all 0.5s ease;
    -webkit-transition: all 0.5s ease;
    transition: all 0.5s ease;
    -moz-animation-name: reveal;
    -o-animation-name: reveal;
    -webkit-animation-name: reveal;
    animation-name: reveal;
    -moz-animation-duration: 0.5s;
    -o-animation-duration: 0.5s;
    -webkit-animation-duration: 0.5s;
    animation-duration: 0.5s;
    -moz-animation-fill-mode: forwards;
    -o-animation-fill-mode: forwards;
    -webkit-animation-fill-mode: forwards;
    animation-fill-mode: forwards;
    height: 0;
    overflow: hidden;
    padding: 0;
}

#no1 {
    background-color: #1A237E;
    color: #448AFF;
    -moz-animation-delay: 0.5s;
    -o-animation-delay: 0.5s;
    -webkit-animation-delay: 0.5s;
    animation-delay: 0.5s;
}

#no2 {
    background-color: #303F9F;
    color: #9FA8DA;
    -moz-animation-delay: 1s;
    -o-animation-delay: 1s;
    -webkit-animation-delay: 1s;
    animation-delay: 1s;
}

#no3 {
    background-color: #3F51B5;
    color: #E8EAF6;
    -moz-animation-delay: 1.5s;
    -o-animation-delay: 1.5s;
    -webkit-animation-delay: 1.5s;
    animation-delay: 1.5s;
    opacity: 0;
}

#no4 {
    background-color: #E8EAF6;
    color: #1A237E;
    -moz-animation-delay: 2s;
    -o-animation-delay: 2s;
    -webkit-animation-delay: 2s;
    animation-delay: 2s;
}

paper-fab#dropzone {
    -moz-transition: background-color 0.5s ease;
    -o-transition: background-color 0.5s ease;
    -webkit-transition: background-color 0.5s ease;
    transition: background-color 0.5s ease;
    width: 80px;
    height: 80px;
    background-color: rgba(234,246,232,0.5);
    --paper-fab-iron-icon:{pointer-events: none;width: 40px;height: 40px;}
}

paper-input, paper-textarea, paper-dropdown-menu {
    display: block;
    width: 90%;
    max-width: 500px;
    --paper-input-container-input-color: white;
    --paper-dropdown-menu-input: white;
    --paper-input-container-label:{color: lightblue;}
}

paper-button {
    display: block;
    width: 90%;
    max-width: 300px;
}

.file-name {
    font-size: xx-small;
    text-transform: uppercase;
    text-shadow: 1px;
    max-width: 50px;
}

paper-dropdown-menu {
    z-index: 2;
}

</style>

        <style>

        </style>
        <!-- don't want this file input included in the form as it doesn't upload multiple files for some reason :(. instead i'm adding them to FormData manually-->
        <input id="uglyinput1" type="file" name="files" multiple="" accept="application/pdf" hidden="" on-change="handleFiles">
        <span class="fjalla-caption business-title">{{business.fullname}}</span>
        <form is="iron-form" id="addMenuForm" method="post" action="/chefs/access/add/menu" class="hidden-animation">
<!-- this is not used. a separate xhr is sent with the data from this form instead
              with-credentials
              on-iron-form-response="onResponse"
              on-iron-form-error="onError"
              on-iron-form-submit="onSubmitted"
    -->

            <div id="main" class="layout vertical">
                <paper-material id="no1" class="vertical layout center with-margins">
                    <small class="fjalla-caption">STEP 1</small>
                    <div class="caption">UPLOAD THE <strong>PDF</strong> MENU</div>
                    <paper-fab id="dropzone" style="margin:10px" icon="note-add" on-click="onAddMenuClick"></paper-fab>
                    <p style="color:lightgray; font-size:10px">DRAG A FILE OR CLICK THE BUTTON</p>
                    <p style="color:lightgray; font-size:8px">MULTIPLE PDFs ALLOWED</p>
                    <div class="horizontal layout center wrap">
                        <template is="dom-repeat" items="{{files}}" as="file">
                            <div class="vertical layout center" style="margin: 15px">
                                <div>
                                    <img id="{{file.id}}" src="/public/images/pdf.png" width="40" height="53">
                                    <paper-badge class="badge" for="{{file.id}}" label="X" on-click="removeFile"></paper-badge>
                                </div>
                                <span class="file-name">{{getJustName(file.name)}}</span>
                            </div>
                        </template>
                    </div>
                </paper-material>

                <!--  //////////////////////////////////////////////////////////  --->

                <paper-material id="no2" class="vertical layout center with-margins">
                    <small class="fjalla-caption">STEP 2</small>
                    <div class="caption">ADD SOME INFO</div>
                    <paper-dropdown-menu label="What kind of menu?" on-iron-select="onMenuTypeChange">
                        <paper-tabs class="dropdown-content">
                            <template is="dom-repeat" items="{{types}}" as="type">
                                <paper-tab>{{type}}</paper-tab>
                            </template>
                        </paper-tabs>
                    </paper-dropdown-menu>
                    <paper-input required="" hidden$="{{!other}}" label="Menu type" name="menu_type" value="{{menu_type}}"></paper-input>
                    <paper-input required="" hidden="" name="placeid" value="{{getValue(business.placeid)}}"></paper-input>
                    <paper-input id="menuName" required="" name="name" error-message="Menu by that name already exists" label="Menu name (internal use)" style="min-width:150px"></paper-input>
                    <paper-input id="menuTitle" required="" name="title" label="Menu title" style="min-width:150px"></paper-input>
                    <paper-textarea name="description" required="" max-rows="3" label="A few words about the menu" autocapitalize="" char-counter="" maxlength="1500"></paper-textarea>
                </paper-material>

                <paper-material id="no3" class="flex vertical layout center center-justified with-margins">
                    <small class="fjalla-caption">STEP 3</small>
                    <div class="caption">SUBMIT</div>
                    <paper-button class="blue-300" on-click="onSubmit">DONE</paper-button>
                </paper-material>
            </div>
        </form>
    </template>
    <script>
        Polymer({

            is: 'menu-uploader',
            properties: {
                business: {
                    type: Object,
                    notify: true
                },
                types: {
                    type: Array,
                    notify: true,
                    readOnly: true,
                    value: function () { return ['Breakfast', 'Brunch', 'Lunch', 'Dinner', 'Desserts', 'Drinks', 'Other'] }
                },
                other: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                files: {
                    type: Array,
                    notify: true,
                    value: function () { return []; }
                },
                menu_type: {
                    type: String,
                    notify: true,
                }
            },
            observers: [
                'updateFileBadgePosition(files.length)'
            ],
            ready: function () {
            },
            attached: function () {
                this.$.dropzone.addEventListener("dragenter", this.dragenter.bind(this), false);
                this.$.dropzone.addEventListener("dragleave", this.dragleave.bind(this), false);
                this.$.dropzone.addEventListener("dragover", this.dragover.bind(this), false);
                this.$.dropzone.addEventListener("drop", this.drop.bind(this), false);
            },
            dragenter: function (e) {
                e.stopPropagation();
                e.preventDefault();

                this.$.dropzone.style.backgroundColor = "lightgreen";
                console.log('enter');
            },
            dragleave: function (e) {
                e.stopPropagation();
                e.preventDefault();
                this.$.dropzone.style.backgroundColor = "#FF4081";
                console.log('leave');
            },
            dragover: function (e) {
                e.stopPropagation();
                e.preventDefault();
            },
            drop: function (e) {
                e.stopPropagation();
                e.preventDefault();

                var dt = e.dataTransfer;
                var newEvent = { target: { files: dt.files } }; //convert it to the receiving function format

                this.handleFiles(newEvent);

            },
            onAddMenuClick: function (e) {
                if (this.$.uglyinput1) {
                    this.$.uglyinput1.click();
                }
            },
            handleFiles: function (event) {
                var files = _.filter(event.target.files, function (file) {
                    return file.type == 'application/pdf' && !_.find(this.files, function (f) {
                        return f.name == file.name;
                    });
                }.bind(this));

                _.forEach(files, function (file) {
                    file.id = 'id' + Math.random().toString(36).substr(5);
                });
                if (files.length)
                    this.splice.apply(this, ['files', this.files.length, 0].concat(files));
            },
            updateFileBadgePosition: function () {
                setTimeout(function () {
                    console.log('in updateFileBadgePosition');
                    var elems = this.querySelectorAll('.badge');
                    _.forEach(elems, function (elem) {
                        if (elem.updatePosition)
                            elem.updatePosition();
                    });
                }.bind(this), 50);

            },
            getJustName: function (name) {
                return name.substring(0, name.length - 4);
            },
            
            removeFile: function (event) {
                this.splice('files', event.model.index, 1);
            },
            send: function () {
                if (!CommonModule.utils.checkSize(this.files)) return false;

                var form = this.$.addMenuForm;
                var formData = new FormData(form);

                _.forEach(this.files, function (file) {
                    formData.append('files', file, file.name);
                });

                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                xhr.open('POST', '/chefs/access/add/menu', true);
                xhr.onload = function () {
                    if (xhr.status === 200) {
                        // File(s) uploaded.
                        window.writeToScreen('Files uploaded successfully');
                        this.onResponse();
                    }else  if (xhr.status === 403) {
                        // File(s) uploaded.
                        window.writeToScreen('Menu by that name already exists');
                        this.$.menuName.focus();
                        this.$.menuName.invalid = true;
                    } else {
                        window.writeToScreen('Service is currently unavailable. Please try again later.');
                    }
                }.bind(this);
                xhr.send(formData);
                return true;
            },
            onMenuTypeChange: function (event) {
                this.other = this.types.length - 1 == event.target.selected;
                this.menu_type = event.target.selectedItem.innerText;
                if (!this.other) {
                    this.$.menuTitle.value = this.$.menuTitle.value || event.target.selectedItem.innerText;
                    this.$.menuName.value = this.$.menuName.value || event.target.selectedItem.innerText.toLowerCase() + ' v1';
                }
            },
            onSubmit: function () {
                this.querySelector('textarea').name = 'description'; // for some reason name is missing on textarea tho it's set in paper-textarea
                if (CommonModule.utils.validateFiles(this.files) && this.$.addMenuForm.validate())
                    this.send();
            },
            onSubmitted: function () {
                this.disableButtons(true);
            },
            onResponse: function () {
                window.writeToScreen('Menu uploaded successfully. We need a few minutes to process it.');
                page('/menus/' + this.business.placeid);
                this.clear();
            },
            clear: function(){
                this.$.addMenuForm.reset();
                this.$.uglyinput1.value = "";
                this.$.menu_type = "";
                this.$.files = [];
                this.$.other = "";
                this.splice('files', 0);
            },
            onError: function (event) {
                this.disableButtons(false);
                var status_code = /\d+/.exec(event.detail.error.message);
                window.writeToScreen('(' + status_code[0] + ') An error was encountered. Please try again or contact support.');
            },
            disableButtons: function (disable) {
                var buttons = this.querySelectorAll('paper-button');
                _.forEach(buttons, function (button) {
                    button.disabled = disable;
                });
            },
            getBusinessStyle: function (business) {
                return 'background-color: ' + business.locals.color;
            },
            getValue: function (placeid) {
                return placeid; //to keep it readonly
            }
        });
    </script>
</dom-module>
<dom-module id="menu-manager-view" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
        </style>
        <iron-pages id="pages" selected="{{selected}}">
            <menu-section-pos id="menu-section-pos" businesses="{{businesses}}" business="{{business}}"></menu-section-pos>
            <div id="menu-uploader-ph"></div>
            <div id="menu-editor-ph"></div>
        </iron-pages>

    </template>
    <script>
        var i_100 = 0;
        const MENU_MAIN_PAGE = i_100++;
        const MENU_UPLOADER_PAGE = i_100++;
        const MENU_EDITOR_PAGE = i_100++;
        Polymer({

            is: 'menu-manager-view',

            properties: {
                selected: {
                    type: Number,
                    notify: true,
                    value: function () { return 0; }
                },
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                },
                business: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                }
            },
            ready: function () {
            },
            attached: function () {
                PubSub.subscribe('neonpages.Menus.main', this.onSelectionChange.bind(this, MENU_MAIN_PAGE));
                PubSub.subscribe('neonpages.Menus.add', this.onSelectionChange.bind(this, MENU_UPLOADER_PAGE));
                PubSub.subscribe('neonpages.Menus.viewedit', this.onSelectionChange.bind(this, MENU_EDITOR_PAGE));
            },
            onSelectionChange: function (selection, msg, params) {
                if (this.selected == selection && this.$.pages.items[selection].innerHTML) return;

                if (_.isArray(params)) {
                    var placeid = params[0];
                    var menuName = params[1];
                }
                else
                    placeid = params;

                var businessIndex = _.findIndex(this.businesses, function (b) { return b.placeid == placeid });
                this.clearAll();
                switch(selection)
                {
                    case MENU_UPLOADER_PAGE:
                        this.injectMenuUploader(businessIndex);
                        PubSub.publish('app.scrollToTop');
                        break;
                    case MENU_EDITOR_PAGE:
                        this.injectMenuEditor(businessIndex, menuName);
                        PubSub.publish('app.scrollToTop');
                        break;
                    case MENU_MAIN_PAGE:
                        this.$["menu-section-pos"].scrollTo(placeid);
                }
                this.selected = selection;
            },
            injectMenuUploader(businessIndex) {
                var elem = document.createElement("menu-uploader");
                elem.business = this.businesses[businessIndex];
                this.$["menu-uploader-ph"].appendChild(elem);
            },
            injectMenuEditor(businessIndex, menuName) {
                var elem = document.createElement("menu-editor");
                elem.business = this.businesses[businessIndex];
                elem.menu = _.find(this.businesses[businessIndex].menus, function (menu) {
                    return menu.name == menuName;
                });
                this.$["menu-editor-ph"].appendChild(elem);
            },
            clearAll() {
                this.$["menu-uploader-ph"].innerHTML = "";
                this.$["menu-editor-ph"].innerHTML = "";
            }
        });
    </script>
</dom-module>
<dom-module id="pos-view" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            @media (min-width: 601px) {
                .padded {
                    padding: 48px 62px;
                }
            }

            :host {
                display: block;
            }

            .fixed {
                position: relative;
                height: 100%;
                width: 100%;
            }
        </style>
        <neon-animated-pages class="fixed" id="pages" selected="[[selection]]" entry-animation="{{entryAnimation}}" exit-animation="{{exitAnimation}}" on-iron-deselect="onDeselected">
            <error-card class="padded" id="error-card-id"></error-card>
            <open-orders-view id="open-orders-view-id" businesses="{{businesses}}" business="{{business}}"></open-orders-view>
            <order-history-view id="order-history-view-id"></order-history-view>
            <business-view id="business-view-id" businesses="{{businesses}}"></business-view>
            <menu-manager-view businesses="{{businesses}}" business="{{business}}"></menu-manager-view>
            <div id="account-id" class="padded" hidden$="{{!isLoggedIn}}"><account-logout></account-logout></div>
            <pay-register></pay-register>
            <floor-map business="{{business}}"></floor-map>
            <photo-gallery business="{{business}}"></photo-gallery>
            <review-section business="{{business}}"></review-section>
            <social-media-facebook></social-media-facebook>
            <inventory-section business="{{business}}"></inventory-section>
        </neon-animated-pages>
    </template>
    <script>
        var i = 0;
        const ERROR_PAGE = i++;
        const OPEN_ORDERS_PAGE = i++;
        const ORDER_HISTORY_PAGE = i++;
        const BUSINESS_VIEW_PAGE = i++;
        const MENU_MANAGER_PAGE = i++;
        const ACCOUNT_PAGE = i++;
        const PAY_REGISTER_PAGE = i++;
        const FLOOR_MAP_PAGE = i++;
        const PHOTO_GALLERY_PAGE = i++;
        const REVIEWS_PAGE = i++;
        const SOCIAL_MEDIA_PAGE = i++;
        const INVENTORY_PAGE = i++;
        
        const ENTRY = "scale-up-animation";
        const EXIT = "scale-down-animation";
        var wasBackClick = false;
        Polymer({
            is: "pos-view",
            properties: {
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    value: function () { return []; }
                },
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                },
                selection: {
                    type: Number,
                    notify: true,
                    value: function () { return 0; },
                },
                entryAnimation: {
                    type: String,
                    notify: true,
                    value: function () { return ENTRY; }
                },
                exitAnimation: {
                    type: String,
                    notify: true,
                    value: function () { return EXIT; }
                },
                backHistory: {
                    type: Array,
                    notify: true,
                    value: function () { return []; },
                },
                isLoggedIn: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                }
            },
            observers: [
                'isBackEnabled(backHistory.length)'
            ],
            ready: function () {
                PubSub.subscribe('neonpages.OpenOrders', this.onSelectionChange.bind(this, OPEN_ORDERS_PAGE));
                PubSub.subscribe('neonpages.OrderHistory', this.onSelectionChange.bind(this, ORDER_HISTORY_PAGE));
                PubSub.subscribe('neonpages.BusinessView', this.onSelectionChange.bind(this, BUSINESS_VIEW_PAGE));
                PubSub.subscribe('neonpages.Account', this.onSelectionChange.bind(this, ACCOUNT_PAGE));
                PubSub.subscribe('neonpages.Menus', this.onSelectionChange.bind(this, MENU_MANAGER_PAGE));
                PubSub.subscribe('neonpages.Register', this.onSelectionChange.bind(this, PAY_REGISTER_PAGE));
                PubSub.subscribe('neonpages.Floormap', this.onSelectionChange.bind(this, FLOOR_MAP_PAGE));
                PubSub.subscribe('neonpages.PhotoGallery', this.onSelectionChange.bind(this, PHOTO_GALLERY_PAGE));
                PubSub.subscribe('neonpages.Reviews', this.onSelectionChange.bind(this, REVIEWS_PAGE));
                PubSub.subscribe('neonpages.SocialMedia', this.onSelectionChange.bind(this, SOCIAL_MEDIA_PAGE));
                PubSub.subscribe('neonpages.Inventory', this.onSelectionChange.bind(this, INVENTORY_PAGE));
                
                PubSub.subscribe('User.logged', this.onSessionChange.bind(this));
            },
            attached: function () {
                this.async(function () { window.dispatchEvent(new Event('PolymerElementsLoaded')) }.bind(this));
                this.async(function () { this.onSessionChange(); }.bind(this));
            },
            onSessionChange: function (msg, value) {
                this.isLoggedIn = CommonModule.modules.user.current.is();
            },
            onSearchEnded: function () {
                if (this.$['places-id'].places.length < 1) {
                    this.$['error-card-id'].title = 'No nearby places found';
                    this.$['error-card-id'].message = 'Try extending your search radius.';
                    this.selection = ERROR_PAGE;
                }
            },
            onSelectionChange: function (selection, placeid) {
                //TODO: ignoring placeid for now... since im using attribute business which points to the currently selected business
                // I should tho have a mechanism preferrably in routing.html that sets the current business if accessed by link with a placeid in it
                this.selection = selection;
                if (this.$.pages.selectedItem.update)
                    this.$.pages.selectedItem.update();
            },
            isBackEnabled: function (value) {
                //this.$.backButton.hidden = !value;
            },
            onBackClick: function (event) {
                var customBack = this.$.pages.selectedItem.onBackClick;
                if (customBack)
                    return (customBack.bind(this.$.pages.selectedItem.this))();

                this._onBackClick(event);
            },
            _onBackClick: function (event) {
                if (!this.backHistory.length) return;
                this.entryAnimation = BACK_ENTRY;
                this.exitAnimation = BACK_EXIT;

                wasBackClick = true;
                this.selection = this.pop('backHistory');

                setTimeout(function () {
                    this.entryAnimation = ENTRY;
                    this.exitAnimation = EXIT;
                }.bind(this), 500);
            },
            onDeselected: function (event, moreinfo) {
                var prev = event.target._prevSelected;
                if (!prev) return;
                var prevItem = event.target.items[prev];
                if (!wasBackClick)
                    this.push('backHistory', prev);
                wasBackClick = false;
            }
        });


    </script>
</dom-module>
</div></body></html>