<html><head><meta charset="UTF-8"><script>!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.page=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
  /* globals require, module */

  'use strict';

  /**
   * Module dependencies.
   */

  var pathtoRegexp = require('path-to-regexp');

  /**
   * Module exports.
   */

  module.exports = page;

  /**
   * Detect click event
   */
  var clickEvent = ('undefined' !== typeof document) && document.ontouchstart ? 'touchstart' : 'click';

  /**
   * To work properly with the URL
   * history.location generated polyfill in https://github.com/devote/HTML5-History-API
   */

  var location = ('undefined' !== typeof window) && (window.history.location || window.location);

  /**
   * Perform initial dispatch.
   */

  var dispatch = true;


  /**
   * Decode URL components (query string, pathname, hash).
   * Accommodates both regular percent encoding and x-www-form-urlencoded format.
   */
  var decodeURLComponents = true;

  /**
   * Base path.
   */

  var base = '';

  /**
   * Running flag.
   */

  var running;

  /**
   * HashBang option
   */

  var hashbang = false;

  /**
   * Previous context, for capturing
   * page exit events.
   */

  var prevContext;

  /**
   * Register `path` with callback `fn()`,
   * or route `path`, or redirection,
   * or `page.start()`.
   *
   *   page(fn);
   *   page('*', fn);
   *   page('/user/:id', load, user);
   *   page('/user/' + user.id, { some: 'thing' });
   *   page('/user/' + user.id);
   *   page('/from', '/to')
   *   page();
   *
   * @param {String|Function} path
   * @param {Function} fn...
   * @api public
   */

  function page(path, fn) {
    // <callback>
    if ('function' === typeof path) {
      return page('*', path);
    }

    // route <path> to <callback ...>
    if ('function' === typeof fn) {
      var route = new Route(path);
      for (var i = 1; i < arguments.length; ++i) {
        page.callbacks.push(route.middleware(arguments[i]));
      }
      // show <path> with [state]
    } else if ('string' === typeof path) {
      page['string' === typeof fn ? 'redirect' : 'show'](path, fn);
      // start [options]
    } else {
      page.start(path);
    }
  }

  /**
   * Callback functions.
   */

  page.callbacks = [];
  page.exits = [];

  /**
   * Current path being processed
   * @type {String}
   */
  page.current = '';

  /**
   * Number of pages navigated to.
   * @type {number}
   *
   *     page.len == 0;
   *     page('/login');
   *     page.len == 1;
   */

  page.len = 0;

  /**
   * Get or set basepath to `path`.
   *
   * @param {String} path
   * @api public
   */

  page.base = function(path) {
    if (0 === arguments.length) return base;
    base = path;
  };

  /**
   * Bind with the given `options`.
   *
   * Options:
   *
   *    - `click` bind to click events [true]
   *    - `popstate` bind to popstate [true]
   *    - `dispatch` perform initial dispatch [true]
   *
   * @param {Object} options
   * @api public
   */

  page.start = function(options) {
    options = options || {};
    if (running) return;
    running = true;
    if (false === options.dispatch) dispatch = false;
    if (false === options.decodeURLComponents) decodeURLComponents = false;
    if (false !== options.popstate) window.addEventListener('popstate', onpopstate, false);
    if (false !== options.click) {
      document.addEventListener(clickEvent, onclick, false);
    }
    if (true === options.hashbang) hashbang = true;
    if (!dispatch) return;
    var url = (hashbang && ~location.hash.indexOf('#!')) ? location.hash.substr(2) + location.search : location.pathname + location.search + location.hash;
    page.replace(url, null, true, dispatch);
  };

  /**
   * Unbind click and popstate event handlers.
   *
   * @api public
   */

  page.stop = function() {
    if (!running) return;
    page.current = '';
    page.len = 0;
    running = false;
    document.removeEventListener(clickEvent, onclick, false);
    window.removeEventListener('popstate', onpopstate, false);
  };

  /**
   * Show `path` with optional `state` object.
   *
   * @param {String} path
   * @param {Object} state
   * @param {Boolean} dispatch
   * @return {Context}
   * @api public
   */

  page.show = function(path, state, dispatch, push) {
    var ctx = new Context(path, state);
    page.current = ctx.path;
    if (false !== dispatch) page.dispatch(ctx);
    if (false !== ctx.handled && false !== push) ctx.pushState();
    return ctx;
  };

  /**
   * Goes back in the history
   * Back should always let the current route push state and then go back.
   *
   * @param {String} path - fallback path to go back if no more history exists, if undefined defaults to page.base
   * @param {Object} [state]
   * @api public
   */

  page.back = function(path, state) {
    if (page.len > 0) {
      // this may need more testing to see if all browsers
      // wait for the next tick to go back in history
      history.back();
      page.len--;
    } else if (path) {
      setTimeout(function() {
        page.show(path, state);
      });
    }else{
      setTimeout(function() {
        page.show(base, state);
      });
    }
  };


  /**
   * Register route to redirect from one path to other
   * or just redirect to another route
   *
   * @param {String} from - if param 'to' is undefined redirects to 'from'
   * @param {String} [to]
   * @api public
   */
  page.redirect = function(from, to) {
    // Define route from a path to another
    if ('string' === typeof from && 'string' === typeof to) {
      page(from, function(e) {
        setTimeout(function() {
          page.replace(to);
        }, 0);
      });
    }

    // Wait for the push state and replace it with another
    if ('string' === typeof from && 'undefined' === typeof to) {
      setTimeout(function() {
        page.replace(from);
      }, 0);
    }
  };

  /**
   * Replace `path` with optional `state` object.
   *
   * @param {String} path
   * @param {Object} state
   * @return {Context}
   * @api public
   */


  page.replace = function(path, state, init, dispatch) {
    var ctx = new Context(path, state);
    page.current = ctx.path;
    ctx.init = init;
    ctx.save(); // save before dispatching, which may redirect
    if (false !== dispatch) page.dispatch(ctx);
    return ctx;
  };

  /**
   * Dispatch the given `ctx`.
   *
   * @param {Object} ctx
   * @api private
   */

  page.dispatch = function(ctx) {
    var prev = prevContext,
      i = 0,
      j = 0;

    prevContext = ctx;

    function nextExit() {
      var fn = page.exits[j++];
      if (!fn) return nextEnter();
      fn(prev, nextExit);
    }

    function nextEnter() {
      var fn = page.callbacks[i++];

      if (ctx.path !== page.current) {
        ctx.handled = false;
        return;
      }
      if (!fn) return unhandled(ctx);
      fn(ctx, nextEnter);
    }

    if (prev) {
      nextExit();
    } else {
      nextEnter();
    }
  };

  /**
   * Unhandled `ctx`. When it's not the initial
   * popstate then redirect. If you wish to handle
   * 404s on your own use `page('*', callback)`.
   *
   * @param {Context} ctx
   * @api private
   */

  function unhandled(ctx) {
    if (ctx.handled) return;
    var current;

    if (hashbang) {
      current = base + location.hash.replace('#!', '');
    } else {
      current = location.pathname + location.search;
    }

    if (current === ctx.canonicalPath) return;
    page.stop();
    ctx.handled = false;
    location.href = ctx.canonicalPath;
  }

  /**
   * Register an exit route on `path` with
   * callback `fn()`, which will be called
   * on the previous context when a new
   * page is visited.
   */
  page.exit = function(path, fn) {
    if (typeof path === 'function') {
      return page.exit('*', path);
    }

    var route = new Route(path);
    for (var i = 1; i < arguments.length; ++i) {
      page.exits.push(route.middleware(arguments[i]));
    }
  };

  /**
   * Remove URL encoding from the given `str`.
   * Accommodates whitespace in both x-www-form-urlencoded
   * and regular percent-encoded form.
   *
   * @param {str} URL component to decode
   */
  function decodeURLEncodedURIComponent(val) {
    if (typeof val !== 'string') { return val; }
    return decodeURLComponents ? decodeURIComponent(val.replace(/\+/g, ' ')) : val;
  }

  /**
   * Initialize a new "request" `Context`
   * with the given `path` and optional initial `state`.
   *
   * @param {String} path
   * @param {Object} state
   * @api public
   */

  function Context(path, state) {
    if ('/' === path[0] && 0 !== path.indexOf(base)) path = base + (hashbang ? '#!' : '') + path;
    var i = path.indexOf('?');

    this.canonicalPath = path;
    this.path = path.replace(base, '') || '/';
    if (hashbang) this.path = this.path.replace('#!', '') || '/';

    this.title = document.title;
    this.state = state || {};
    this.state.path = path;
    this.querystring = ~i ? decodeURLEncodedURIComponent(path.slice(i + 1)) : '';
    this.pathname = decodeURLEncodedURIComponent(~i ? path.slice(0, i) : path);
    this.params = {};

    // fragment
    this.hash = '';
    if (!hashbang) {
      if (!~this.path.indexOf('#')) return;
      var parts = this.path.split('#');
      this.path = parts[0];
      this.hash = decodeURLEncodedURIComponent(parts[1]) || '';
      this.querystring = this.querystring.split('#')[0];
    }
  }

  /**
   * Expose `Context`.
   */

  page.Context = Context;

  /**
   * Push state.
   *
   * @api private
   */

  Context.prototype.pushState = function() {
    page.len++;
    history.pushState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);
  };

  /**
   * Save the context state.
   *
   * @api public
   */

  Context.prototype.save = function() {
    history.replaceState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);
  };

  /**
   * Initialize `Route` with the given HTTP `path`,
   * and an array of `callbacks` and `options`.
   *
   * Options:
   *
   *   - `sensitive`    enable case-sensitive routes
   *   - `strict`       enable strict matching for trailing slashes
   *
   * @param {String} path
   * @param {Object} options.
   * @api private
   */

  function Route(path, options) {
    options = options || {};
    this.path = (path === '*') ? '(.*)' : path;
    this.method = 'GET';
    this.regexp = pathtoRegexp(this.path,
      this.keys = [],
      options.sensitive,
      options.strict);
  }

  /**
   * Expose `Route`.
   */

  page.Route = Route;

  /**
   * Return route middleware with
   * the given callback `fn()`.
   *
   * @param {Function} fn
   * @return {Function}
   * @api public
   */

  Route.prototype.middleware = function(fn) {
    var self = this;
    return function(ctx, next) {
      if (self.match(ctx.path, ctx.params)) return fn(ctx, next);
      next();
    };
  };

  /**
   * Check if this route matches `path`, if so
   * populate `params`.
   *
   * @param {String} path
   * @param {Object} params
   * @return {Boolean}
   * @api private
   */

  Route.prototype.match = function(path, params) {
    var keys = this.keys,
      qsIndex = path.indexOf('?'),
      pathname = ~qsIndex ? path.slice(0, qsIndex) : path,
      m = this.regexp.exec(decodeURIComponent(pathname));

    if (!m) return false;

    for (var i = 1, len = m.length; i < len; ++i) {
      var key = keys[i - 1];
      var val = decodeURLEncodedURIComponent(m[i]);
      if (val !== undefined || !(hasOwnProperty.call(params, key.name))) {
        params[key.name] = val;
      }
    }

    return true;
  };


  /**
   * Handle "populate" events.
   */

  var onpopstate = (function () {
    var loaded = false;
    if ('undefined' === typeof window) {
      return;
    }
    if (document.readyState === 'complete') {
      loaded = true;
    } else {
      window.addEventListener('load', function() {
        setTimeout(function() {
          loaded = true;
        }, 0);
      });
    }
    return function onpopstate(e) {
      if (!loaded) return;
      if (e.state) {
        var path = e.state.path;
        page.replace(path, e.state);
      } else {
        page.show(location.pathname + location.hash, undefined, undefined, false);
      }
    };
  })();
  /**
   * Handle "click" events.
   */

  function onclick(e) {

    if (1 !== which(e)) return;

    if (e.metaKey || e.ctrlKey || e.shiftKey) return;
    if (e.defaultPrevented) return;



    // ensure link
    var el = e.target;
    while (el && 'A' !== el.nodeName) el = el.parentNode;
    if (!el || 'A' !== el.nodeName) return;



    // Ignore if tag has
    // 1. "download" attribute
    // 2. rel="external" attribute
    if (el.hasAttribute('download') || el.getAttribute('rel') === 'external') return;

    // ensure non-hash for the same path
    var link = el.getAttribute('href');
    if (!hashbang && el.pathname === location.pathname && (el.hash || '#' === link)) return;



    // Check for mailto: in the href
    if (link && link.indexOf('mailto:') > -1) return;

    // check target
    if (el.target) return;

    // x-origin
    if (!sameOrigin(el.href)) return;



    // rebuild path
    var path = el.pathname + el.search + (el.hash || '');

    // strip leading "/[drive letter]:" on NW.js on Windows
    if (typeof process !== 'undefined' && path.match(/^\/[a-zA-Z]:\//)) {
      path = path.replace(/^\/[a-zA-Z]:\//, '/');
    }

    // same page
    var orig = path;

    if (path.indexOf(base) === 0) {
      path = path.substr(base.length);
    }

    if (hashbang) path = path.replace('#!', '');

    if (base && orig === path) return;

    e.preventDefault();
    page.show(orig);
  }

  /**
   * Event button.
   */

  function which(e) {
    e = e || window.event;
    return null === e.which ? e.button : e.which;
  }

  /**
   * Check if `href` is the same origin.
   */

  function sameOrigin(href) {
    var origin = location.protocol + '//' + location.hostname;
    if (location.port) origin += ':' + location.port;
    return (href && (0 === href.indexOf(origin)));
  }

  page.sameOrigin = sameOrigin;

}).call(this,require('_process'))
},{"_process":2,"path-to-regexp":3}],2:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canMutationObserver = typeof window !== 'undefined'
    && window.MutationObserver;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    var queue = [];

    if (canMutationObserver) {
        var hiddenDiv = document.createElement("div");
        var observer = new MutationObserver(function () {
            var queueList = queue.slice();
            queue.length = 0;
            queueList.forEach(function (fn) {
                fn();
            });
        });

        observer.observe(hiddenDiv, { attributes: true });

        return function nextTick(fn) {
            if (!queue.length) {
                hiddenDiv.setAttribute('yes', 'no');
            }
            queue.push(fn);
        };
    }

    if (canPost) {
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],3:[function(require,module,exports){
var isarray = require('isarray')

/**
 * Expose `pathToRegexp`.
 */
module.exports = pathToRegexp
module.exports.parse = parse
module.exports.compile = compile
module.exports.tokensToFunction = tokensToFunction
module.exports.tokensToRegExp = tokensToRegExp

/**
 * The main path matching regexp utility.
 *
 * @type {RegExp}
 */
var PATH_REGEXP = new RegExp([
  // Match escaped characters that would otherwise appear in future matches.
  // This allows the user to escape special characters that won't transform.
  '(\\\\.)',
  // Match Express-style parameters and un-named parameters with a prefix
  // and optional suffixes. Matches appear as:
  //
  // "/:test(\\d+)?" => ["/", "test", "\d+", undefined, "?", undefined]
  // "/route(\\d+)"  => [undefined, undefined, undefined, "\d+", undefined, undefined]
  // "/*"            => ["/", undefined, undefined, undefined, undefined, "*"]
  '([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))'
].join('|'), 'g')

/**
 * Parse a string for the raw tokens.
 *
 * @param  {String} str
 * @return {Array}
 */
function parse (str) {
  var tokens = []
  var key = 0
  var index = 0
  var path = ''
  var res

  while ((res = PATH_REGEXP.exec(str)) != null) {
    var m = res[0]
    var escaped = res[1]
    var offset = res.index
    path += str.slice(index, offset)
    index = offset + m.length

    // Ignore already escaped sequences.
    if (escaped) {
      path += escaped[1]
      continue
    }

    // Push the current path onto the tokens.
    if (path) {
      tokens.push(path)
      path = ''
    }

    var prefix = res[2]
    var name = res[3]
    var capture = res[4]
    var group = res[5]
    var suffix = res[6]
    var asterisk = res[7]

    var repeat = suffix === '+' || suffix === '*'
    var optional = suffix === '?' || suffix === '*'
    var delimiter = prefix || '/'
    var pattern = capture || group || (asterisk ? '.*' : '[^' + delimiter + ']+?')

    tokens.push({
      name: name || key++,
      prefix: prefix || '',
      delimiter: delimiter,
      optional: optional,
      repeat: repeat,
      pattern: escapeGroup(pattern)
    })
  }

  // Match any characters still remaining.
  if (index < str.length) {
    path += str.substr(index)
  }

  // If the path exists, push it onto the end.
  if (path) {
    tokens.push(path)
  }

  return tokens
}

/**
 * Compile a string to a template function for the path.
 *
 * @param  {String}   str
 * @return {Function}
 */
function compile (str) {
  return tokensToFunction(parse(str))
}

/**
 * Expose a method for transforming tokens into the path function.
 */
function tokensToFunction (tokens) {
  // Compile all the tokens into regexps.
  var matches = new Array(tokens.length)

  // Compile all the patterns before compilation.
  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] === 'object') {
      matches[i] = new RegExp('^' + tokens[i].pattern + '$')
    }
  }

  return function (obj) {
    var path = ''
    var data = obj || {}

    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i]

      if (typeof token === 'string') {
        path += token

        continue
      }

      var value = data[token.name]
      var segment

      if (value == null) {
        if (token.optional) {
          continue
        } else {
          throw new TypeError('Expected "' + token.name + '" to be defined')
        }
      }

      if (isarray(value)) {
        if (!token.repeat) {
          throw new TypeError('Expected "' + token.name + '" to not repeat, but received "' + value + '"')
        }

        if (value.length === 0) {
          if (token.optional) {
            continue
          } else {
            throw new TypeError('Expected "' + token.name + '" to not be empty')
          }
        }

        for (var j = 0; j < value.length; j++) {
          segment = encodeURIComponent(value[j])

          if (!matches[i].test(segment)) {
            throw new TypeError('Expected all "' + token.name + '" to match "' + token.pattern + '", but received "' + segment + '"')
          }

          path += (j === 0 ? token.prefix : token.delimiter) + segment
        }

        continue
      }

      segment = encodeURIComponent(value)

      if (!matches[i].test(segment)) {
        throw new TypeError('Expected "' + token.name + '" to match "' + token.pattern + '", but received "' + segment + '"')
      }

      path += token.prefix + segment
    }

    return path
  }
}

/**
 * Escape a regular expression string.
 *
 * @param  {String} str
 * @return {String}
 */
function escapeString (str) {
  return str.replace(/([.+*?=^!:${}()[\]|\/])/g, '\\$1')
}

/**
 * Escape the capturing group by escaping special characters and meaning.
 *
 * @param  {String} group
 * @return {String}
 */
function escapeGroup (group) {
  return group.replace(/([=!:$\/()])/g, '\\$1')
}

/**
 * Attach the keys as a property of the regexp.
 *
 * @param  {RegExp} re
 * @param  {Array}  keys
 * @return {RegExp}
 */
function attachKeys (re, keys) {
  re.keys = keys
  return re
}

/**
 * Get the flags for a regexp from the options.
 *
 * @param  {Object} options
 * @return {String}
 */
function flags (options) {
  return options.sensitive ? '' : 'i'
}

/**
 * Pull out keys from a regexp.
 *
 * @param  {RegExp} path
 * @param  {Array}  keys
 * @return {RegExp}
 */
function regexpToRegexp (path, keys) {
  // Use a negative lookahead to match only capturing groups.
  var groups = path.source.match(/\((?!\?)/g)

  if (groups) {
    for (var i = 0; i < groups.length; i++) {
      keys.push({
        name: i,
        prefix: null,
        delimiter: null,
        optional: false,
        repeat: false,
        pattern: null
      })
    }
  }

  return attachKeys(path, keys)
}

/**
 * Transform an array into a regexp.
 *
 * @param  {Array}  path
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function arrayToRegexp (path, keys, options) {
  var parts = []

  for (var i = 0; i < path.length; i++) {
    parts.push(pathToRegexp(path[i], keys, options).source)
  }

  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options))

  return attachKeys(regexp, keys)
}

/**
 * Create a path regexp from string input.
 *
 * @param  {String} path
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function stringToRegexp (path, keys, options) {
  var tokens = parse(path)
  var re = tokensToRegExp(tokens, options)

  // Attach keys back to the regexp.
  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] !== 'string') {
      keys.push(tokens[i])
    }
  }

  return attachKeys(re, keys)
}

/**
 * Expose a function for taking tokens and returning a RegExp.
 *
 * @param  {Array}  tokens
 * @param  {Array}  keys
 * @param  {Object} options
 * @return {RegExp}
 */
function tokensToRegExp (tokens, options) {
  options = options || {}

  var strict = options.strict
  var end = options.end !== false
  var route = ''
  var lastToken = tokens[tokens.length - 1]
  var endsWithSlash = typeof lastToken === 'string' && /\/$/.test(lastToken)

  // Iterate over the tokens and create our regexp string.
  for (var i = 0; i < tokens.length; i++) {
    var token = tokens[i]

    if (typeof token === 'string') {
      route += escapeString(token)
    } else {
      var prefix = escapeString(token.prefix)
      var capture = token.pattern

      if (token.repeat) {
        capture += '(?:' + prefix + capture + ')*'
      }

      if (token.optional) {
        if (prefix) {
          capture = '(?:' + prefix + '(' + capture + '))?'
        } else {
          capture = '(' + capture + ')?'
        }
      } else {
        capture = prefix + '(' + capture + ')'
      }

      route += capture
    }
  }

  // In non-strict mode we allow a slash at the end of match. If the path to
  // match already ends with a slash, we remove it for consistency. The slash
  // is valid at the end of a path match, not in the middle. This is important
  // in non-ending mode, where "/test/" shouldn't match "/test//route".
  if (!strict) {
    route = (endsWithSlash ? route.slice(0, -2) : route) + '(?:\\/(?=$))?'
  }

  if (end) {
    route += '$'
  } else {
    // In non-ending mode, we need the capturing groups to match as much as
    // possible by using a positive lookahead to the end or next path segment.
    route += strict && endsWithSlash ? '' : '(?=\\/|$)'
  }

  return new RegExp('^' + route, flags(options))
}

/**
 * Normalize the given path string, returning a regular expression.
 *
 * An empty array can be passed in for the keys, which will hold the
 * placeholder key descriptions. For example, using `/user/:id`, `keys` will
 * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.
 *
 * @param  {(String|RegExp|Array)} path
 * @param  {Array}                 [keys]
 * @param  {Object}                [options]
 * @return {RegExp}
 */
function pathToRegexp (path, keys, options) {
  keys = keys || []

  if (!isarray(keys)) {
    options = keys
    keys = []
  } else if (!options) {
    options = {}
  }

  if (path instanceof RegExp) {
    return regexpToRegexp(path, keys, options)
  }

  if (isarray(path)) {
    return arrayToRegexp(path, keys, options)
  }

  return stringToRegexp(path, keys, options)
}

},{"isarray":4}],4:[function(require,module,exports){
module.exports = Array.isArray || function (arr) {
  return Object.prototype.toString.call(arr) == '[object Array]';
};

},{}]},{},[1])(1)
});</script>
<script>
    PubSub.subscribe('App.ready', function () {
        loadPagejs();
    });

    function loadPagejs(){
        console.log('Loading page.js ...');
        function scrollToTop(ctx, next) {
            if (app)
                app.scrollPageToTop();
            next();
        }

        // Routes
        page('/', function () {
            page.redirect('/places');
        });

        page('/places', scrollToTop, function () {
            app.route = '/places';
            PubSub.publish('neonpages.Grid');
        });

        page('/places/:id/*', function (data, next) {
            app.setBusinessRouteStyle(data.params[0]);
            console.log('in /places/:id/' + data.params.id);
            CommonModule.modules.business.current.set(data.params.id);
            next();
        });

        page('/places/:id', scrollToTop, function (data, next) {
            page.redirect('/places/' + data.params.id +'/menus');
        });

        page('/places/:id/menus', scrollToTop, function (data) {
            PubSub.publish('neonpages.MenuSection');
        });

        page('/places/:id/photos', scrollToTop, function (data) {
            PubSub.publish('neonpages.GallerySection');
        });

        page('/places/:id/reviews', scrollToTop, function (data) {
            PubSub.publish('neonpages.ReviewSection');
        });

        page('/places/:id/menus/:name', scrollToTop, function (data) {
            CommonModule.modules.menu.current.set(data.params.id, data.params.name);
            PubSub.publish('neonpages.MenuBrowser');
        });

        page('/checkout', scrollToTop, function () {
            app.route = '/checkout';
            PubSub.publish('neonpages.Checkout');
        });

        page('/account', scrollToTop, function () {
            app.route = '/account';
            PubSub.publish('neonpages.Account');
        });


        // add #! before urls
        page.base('/diners');
        page({
            hashbang: true,
        });

        PubSub.subscribe('Business.received', updateNavigationBar);

        function updateNavigationBar() {
            var business = CommonModule.modules.business.current.get();
            if (business && !business.partial)
                app.selectedBusiness = business;
        }
    }
</script>
<script>
  Polymer({
    is: 'expand-animation',

    behaviors: [
      Polymer.NeonAnimationBehavior
    ],

    configure: function(config) {
      var node = config.node;

      var height = node.getBoundingClientRect().height;

      this._effect = new KeyframeEffect(node, [{
        height: (height / 2) + 'px'
      }, {
        height: height + 'px'
      }], this.timingFromConfig(config));

      return this._effect;
    }
  });
</script>
<style>
body {
  background: #fafafa;
  font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
  color: #333;
}

a{
    color:cornflowerblue;
}
a:link, a:visited , a:active, a:hover {
    cursor:pointer;
    text-decoration: none;
    color: blue;
}
div.full{
    width:100%;
}
.nobutton{
    padding:0;
    text-transform:none;
    font-size:0.8em;
    background:none;
    elevation:0;
    text-align:left;
    display:block;
    width:100%;
}

.nobutton paper-icon-item{
    margin:0;
    padding-left: 10px;
}
.nopadding{
    padding:0;
    margin:0;
}
paper-button {
    display: block;
    margin: 10px;
    font-size:0.9em;
    background-size: contain;
}
paper-toast{
    z-index:20;
}

.separator {
    width: 100%;
    margin: 5px 5px;
    height: 5px;
    background: url("/public/images/separator.jpg") no-repeat;
    background-size: 100%;
}

::-webkit-scrollbar {
    width: 6px;
}
 
::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.3);
    border-radius: 4px;
}
 
::-webkit-scrollbar-thumb {
    border-radius: 4px;
    -webkit-box-shadow: inset 0 0 3px rgba(0,0,0,0.5);
}

.caption {
    font-family: 'Fjalla One', sans-serif;
    font-stretch: ultra-expanded;
    font-size: large;
    text-align: center;
}


.menu-navigation {
    position: relative;
    top: -10px;
    color: white;
}

@media (min-width:641px) {
    .control-icons {
        left: 220px;
    }
}



paper-button.checkout-button {
    padding: 3px;
    display: block;
    width: 100%;
    font-stretch: expanded;
    left: 0;
    right: 0;
    margin: auto;
}

paper-button.standard {
    position:relative;
    display: block;
    width: 100%;
    left:0;
    right:0;
    margin: auto;
}


.smaller-button {
 /*   padding-top: 2px;
    padding-bottom: 2px;
    max-height: 32px;
     */
}

.onload-opacity {
    opacity: 0;
    -moz-transition: opacity 0.5s linear;
    -o-transition: opacity 0.5s linear;
    -webkit-transition: opacity 0.5s linear;
    transition: opacity 0.5s linear;
}

paper-spinner {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
    max-width: 32px;
    max-height: 32px;
    layer-1-color: var(--paper-light-blue-500);
    layer-2-color: var(--paper-light-blue-500);
    layer-3-color: var(--paper-light-blue-500);
    layer-4-color: var(--paper-light-blue-500);
}

paper-slider {
    --paper-slider-active-color: whitesmoke;
}

.divider {
    opacity: 0.5;
    color: #ccc;
    width: 95%;
    margin: 10px auto;
    overflow: hidden;
    text-align: center;
    line-height: 0.8em;
}

    .divider:before, .divider:after {
        content: "";
        vertical-align: top;
        display: inline-block;
        width: 50%;
        height: 0.45em;
        border-bottom: 1px solid #ccc;
        margin: 0 2% 0 -55%;
    }

    .divider:after {
        margin: 0 -55% 0 2%;
    }

.fjalla-caption {
    font-family: 'Fjalla One', sans-serif;
    font-stretch: expanded;
    font-size: x-large;
    text-align: center;
    opacity:0.6;
}

.circular-avatar-big {
    width: 250px;
    height: 250px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
    box-shadow: 5px 5px 2.5px #888888;
}

.circular-avatar-small, .circular-avatar-xsmall, .circular-avatar-xxsmall  {
    min-width: 80px;
    min-height: 80px;
    max-width: 80px;
    max-height: 80px;
    -webkit-border-radius: 50%;
    -moz-border-radius: 50%;
    border-radius: 50%;
    box-shadow: 3px 3px 1.5px #888888;
}

.circular-avatar-xsmall{
    min-width: 40px;
    min-height: 40px;
    max-width: 40px;
    max-height: 40px;
}

.circular-avatar-xxsmall{
    min-width: 25px;
    min-height: 25px;
    max-width: 25px;
    max-height: 25px;
}

.rectangular-avatar-medium {
    min-width: 135px;
    min-height: 160px;
    max-width: 135px;
    max-height: 160px;
    margin:10px;
    -webkit-border-radius: 10%;
    -moz-border-radius: 10%;
    border-radius: 10%;
    box-shadow: 5px 5px 2.5px #888888;
}

#drawerToolbar{
    z-index:2 !important;
}


</style>
</head><body><div hidden="" by-vulcanize=""><dom-module id="yummlet-client" assetpath="/">
    <style>
﻿:host {
    --dark-primary-color: #303F9F;
    --default-primary-color: #3F51B5;
    --light-primary-color: #FFE8D0;
    --text-primary-color: #ffffff; /*text/icons*/
    --accent-color: #FF4081;
    --primary-background-color: #FFE8D0;
    --primary-text-color: #212121;
    --secondary-text-color: #727272;
    --disabled-text-color: #bdbdbd;
    --divider-color: #B6B6B6;
    /* Components */
    /* paper-drawer-panel */
    --drawer-menu-color: #ffffff;
    --drawer-border-color: 1px solid #ccc;
    --drawer-toolbar-border-color: 1px solid rgba(0, 0, 0, 0.22);
    /* paper-menu */
    --paper-menu-background-color: #fff;
    --menu-link-color: #111111;
}

/* General styles */

#drawerToolbar {
    /*color: var(--secondary-text-color);
     /*background-color: var(--drawer-menu-color);
     /*border-bottom: var(--drawer-toolbar-border-color);*/
}

paper-scroll-header-panel {
    height: 100%;
}

paper-material {
    border-radius: 2px;
    height: 100%;
    padding: 16px 0 16px 0;
    width: calc(98.66% - 16px);
    margin: 16px auto;
    background: white;
}

paper-menu iron-icon {
    margin-right: 33px;
    opacity: 0.54;
}

.paper-menu > .iron-selected {
    color: green !important;
}

paper-menu a {
    text-decoration: none;
    color: var(--menu-link-color);
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-flex-align: center;
    -webkit-align-items: center;
    align-items: center;
    font-family: 'Roboto', 'Noto', sans-serif;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
    font-size: 14px;
    font-weight: 400;
    line-height: 24px;
    min-height: 48px;
    padding: 0 16px;
}

#mainToolbar .bottom {
    margin-left: 48px;
    /* Required for main area's paper-scroll-header-panel custom condensing transformation */
    -webkit-transform-origin: left center;
    -moz-transform-origin: left center;
    -ms-transform-origin: left center;
    -o-transform-origin: left center;
    transform-origin: left center;
}

/* Height of the scroll area */
.content {
    height: 100%;
    width: 100%;
}

/* Breakpoints */

/* Small */
@media (max-width: 600px) {
    paper-input.input-big-screen {
        display: none;
    }

    paper-material {
        --menu-container-display: none;
        width: calc(97.33% - 32px);
        padding-left: 16px;
        padding-right: 16px;
    }

    #drawer .paper-toolbar {
        margin-left: 16px;
    }

    #overlay {
        min-width: 360px;
    }

    .bg {
        background: white;
    }
}
/*Tablet+*/
@media (min-width: 601px) {
    paper-material {
        width: calc(98% - 46px);
        margin-bottom: 32px;
        padding-left: 30px;
        padding-right: 30px;
    }
    /*
     #drawer.paper-drawer-panel > [drawer] {
       border-right: 1px solid rgba(0, 0, 0, 0.14);
     }
     */
}

@media (min-width:800) {
    paper-input.input-big-screen {
        display: inline;
    }
}

/* Material Design Adaptive Breakpoints */
/*
     Below you'll find CSS media queries based on the breakpoint guidance
     published by the Material Design team. You can choose to use, customise
     or remove these breakpoints based on your needs.

     http://www.google.com/design/spec/layout/adaptive-ui.html#adaptive-ui-breakpoints
    */

/* mobile-small */
@media all and (min-width: 0) and (max-width: 360px) and (orientation: portrait) {
}
/* mobile-large */
@media all and (min-width: 361px) and (orientation: portrait) {
}
/* mobile-small-landscape */
@media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) {
}
/* mobile-large-landscape */
@media all and (min-width: 481px) and (orientation: landscape) {
}
/* tablet-small-landscape */
@media all and (min-width: 600px) and (max-width: 960px) and (orientation: landscape) {
}
/* tablet-large-landscape */
@media all and (min-width: 961px) and (orientation: landscape) {
}
/* tablet-small */
@media all and (min-width: 600px) and (orientation: portrait) {
}
/* tablet-large */
@media all and (min-width: 601px) and (max-width: 840px) and (orientation : portrait) {
}
/* desktop-x-small-landscape */
@media all and (min-width: 0) and (max-width: 480px) and (orientation: landscape) {
}
/* desktop-x-small */
@media all and (min-width: 0) and (max-width: 480px) and (max-aspect-ratio: 4/3) {
}
/* desktop-small-landscape */
@media all and (min-width: 481px) and (max-width: 840px) and (orientation: landscape) {
}
/* desktop-small */
@media all and (min-width: 481px) and (max-width: 840px) and (max-aspect-ratio: 4/3) {
}
/* desktop-medium-landscape */
@media all and (min-width: 841px) and (max-width: 1280px) and (orientation: landscape) {
}
/* desktop-medium */
@media all and (min-width: 841px) and (max-width: 1280px) and (max-aspect-ratio: 4/3) {
}
/* desktop-large */
@media all and (min-width: 1281px) and (max-width: 1600px) {
}
/* desktop-xlarge */
@media all and (min-width: 1601px) and (max-width: 1920px) {
}


/* MY STYLES */
paper-toolbar {
    font-family: 'Fjalla One', sans-serif;
    background-size: 100vw auto;
    background-position-y: center;
    background-position-x: -200px;
    background-repeat: no-repeat;
    background-color: rgb(48,23,10);
    background-image: linear-gradient(rgba(200,200,200,0.5), rgba(200,200,200,0.5)), url("/public/images/coffee.jpg");
}

@media (max-width: 600px) {
    paper-toolbar {
        background-size: calc(100vw + 200px) auto;
    }
}

paper-toolbar#drawerToolbar {
    background-position-x: 0;
}

paper-toolbar#mainToolbar {
}

.title-bar-fonting {
    margin-right: -10px;
    font-size: larger;
    padding-top: 0.8em;
    text-align: right;
    line-height: 90%;
}

paper-input.dark-bg {
    --paper-input-container-focus-color: blue;
    --paper-input-container-invalid-color: red;
    --paper-input-container-input-color: white;
}

.flexchild {
    @apply(--layout-flex);
}

.flex2child {
    @apply(--layout-flex-2);
}

.flex3child {
    @apply(--layout-flex-3);
}

.blurred {
    -webkit-filter: blur(7px);
    -moz-filter: blur(7px);
    -o-filter: blur(7px);
    -ms-filter: blur(7px);
    filter: blur(7px);
}

.menu-heading {
    margin-left: 7px;
    font-size: x-small;
    color: lightgray;
    text-transform: uppercase;
    font-weight: bold;
}

#watermark {
    color: black;
    font-size: 200pt;
    -webkit-transform: rotate(-45deg);
    -moz-transform: rotate(-45deg);
    -o-transform: rotate(-45deg);
    -ms-transform: rotate(-45deg);
    transform: rotate(-45deg);
    position: absolute;
    width: 100vw;
    height: 100vh;
    z-index: 500;
    pointer-events: none;
    opacity: 0.1;
    overflow: hidden;
}

paper-drawer-panel {
    max-height: 100vh;
    min-height: 100vh;
    --paper-drawer-panel-drawer-container:{ z-index: 5;}
}

.rotate90 {
    -moz-transform: rotate('90deg');
    -ms-transform: rotate('90deg');
    -o-transform: rotate('90deg');
    -webkit-transform: rotate('90deg');
    transform: rotate('90deg');
}

</style>
    <template>
        <style>
            paper-icon-button.selected {
                color: lightgreen;
            }

            paper-icon-button {
                width: 39px;
                height: 39px;
            }
        </style>
        <!--
        <div id="watermark" class="layout vertical center center-justified">DEMO</div>
            -->
        <paper-toast id="toast2">
            <a id="innerToastLink"></a>
        </paper-toast>
        <paper-drawer-panel id="paperDrawerPanel" drawer-width="200px" disable-edge-swipe="" transition="true">
            <paper-header-panel drawer="">
                <paper-toolbar id="drawerToolbar" shadow="">
                    <div class="title-bar-fonting">
                        yummlet
                        <div class="paper-font-subhead" style="font-size:xx-small">VIEW MENU. ORDER. PAY.</div>
                    </div>
                </paper-toolbar>
                <!-- Menus go here -->
                <paper-menu class="list" attr-for-selected="data-route" selected="{{route}}">
                    <template is="dom-repeat" items="{{menuItems}}">
                        <template is="dom-if" if="{{item.sectionHeader}}">
                            <div class="separator"></div>
                            <p class="menu-heading">{{item.sectionHeader}}</p>
                        </template>
                        <paper-button class="nobutton" data-route="{{item.route}}" on-click="onRouteClick">
                            <paper-icon-item>
                                <iron-icon id="{{item.id}}" icon="{{item.icon}}" item-icon=""></iron-icon>
                                <paper-badge id="{{item.badgeid}}" for="{{item.id}}" label="{{item.badgeLabel}}" hidden$="{{!item.badgeLabel}}"></paper-badge>
                                <span>{{item.label}}</span>
                            </paper-icon-item>
                        </paper-button>
                    </template>
                </paper-menu>
            </paper-header-panel>
            <paper-header-panel main="" shadow="true">
                <paper-toolbar id="mainToolbar">
                    <paper-icon-button id="paperToggle" icon="menu" paper-drawer-toggle="" style="margin-right:0"></paper-icon-button>
                    <div hidden$="{{!selectedBusiness}}">
                        <paper-icon-button class="menu-button business-menu-item" data-route="/menus" alt="Menus" icon="chrome-reader-mode" on-click="onBusinessRouteClick"></paper-icon-button>
                        <paper-icon-button class="gallery-button business-menu-item" data-route="/photos" alt="Photos" icon="image:photo-library" on-click="onBusinessRouteClick"></paper-icon-button>
                        <paper-icon-button class="review-button business-menu-item" data-route="/reviews" alt="Reviews" icon="maps:rate-review" on-click="onBusinessRouteClick"></paper-icon-button>
                    </div>
                    <span class="flex"></span>
                    <shopping-basket on-click="onRouteClick" data-route="/checkout"></shopping-basket>
                    <paper-icon-button icon="account-circle" on-click="onRouteClick" data-route="/account" id="accountButton"></paper-icon-button>
                    <!-- dropping refresh button
                        <paper-icon-button icon="refresh" on-click="onRefresh"></paper-icon-button>
                    -->
                </paper-toolbar>
                <div class="content">
                    <cafe-view></cafe-view>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
        <!-- Uncomment next block to enable Service Worker support (1/2) -->
        <!--
        <paper-toast id="caching-complete"
                     duration="6000"
                     text="Caching complete! This app will work offline.">
        </paper-toast>

        <platinum-sw-register auto-register
                              clients-claim
                              skip-waiting
                              on-service-worker-installed="displayInstalledToast">
          <platinum-sw-cache default-cache-strategy="fastest"
                             cache-config-file="cache-config.json">
          </platinum-sw-cache>
        </platinum-sw-register>
        -->
    </template>
    <script>
        Polymer({
            is: "yummlet-client",
            properties: {
                route: {
                    type: String,
                    notify: true,
                    value: function () { return '/open-orders'; }
                },
                menuItems: {
                    type: Array,
                    notify: true,
                },
                businesses: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true,
                    value: function () { return []; }
                },
                selectedBusiness: {
                    type: String,
                    notify: true,
                    value: function () { return ''; }
                },
            },
            created: function () {
                window.writeToScreen = function (msg, linkmsg, link) {
                    this.async(function () {
                        this.writeToScreen(msg, linkmsg, link);
                    }.bind(this));
                }.bind(this);
                PubSub.subscribe('app.scrollToTop', this.async(function () {
                    this.scrollPageToTop();
                }.bind(this)));
            },
            ready: function () {
            },
            attached: function () {
                app = this;
                this.async(function () {
                    this.menuItems = this.populateMenu();
                }.bind(this));
                this.onSessionChange();
                PubSub.subscribe('User.logged', this.onSessionChange.bind(this));

                //initial businesses update:
                PubSub.subscribe('Business.received', this.updateBusinesses.bind(this));

                PubSub.subscribe('User.logged.in', this.onLoginSuccess.bind(this));
                PubSub.publish('App.ready');

                CommonModule.refresh();
                this.async(function () {
                    var containers = this.querySelectorAll('#mainContainer');
                    _.forEach(containers, function (container) {
                        this.preventScrollingOn_iOS(container);
                    }.bind(this));
                }.bind(this));
            },
            preventScrollingOn_iOS: function (element) {
                element.addEventListener('touchstart', function (event) {
                    this.allowUp = (this.scrollTop > 0);
                    this.allowDown = (this.scrollTop < this.scrollHeight - this.clientHeight);
                    this.prevTop = null; this.prevBot = null;
                    this.lastY = event.touches[0].pageY;
                });

                element.addEventListener('touchmove', function (event) {
                    var touch = event.touches[0];
                    var up = (touch.pageY > this.lastY), down = !up;
                    this.lastY = touch.pageY;

                    if ((up && this.allowUp) || (down && this.allowDown)) event.stopPropagation();
                    else if (event.cancelable)
                        event.preventDefault();
                });
            },
            onLoginSuccess: function () {
                var name = CommonModule.modules.user.current.profile().name;
                name = name ? ', ' + name : '';
                window.writeToScreen('Welcome to yummlet' + name);
            },
            writeToScreen: function (msg, link_msg, link) {
                if (!_.isString(msg)) return;
                this.$.toast2.text = msg;
                if (link) {
                    this.$.toast2.duration = 10000;
                    this.$.innerToastLink.onclick = function () { page(link); };
                    this.$.innerToastLink.innerHTML = link_msg;
                }
                else {
                    this.$.toast2.duration = 3000 + msg.length * 50;
                    this.$.innerToastLink.innerHTML = "";
                }
                this.$.toast2.show();
            },
            closeToast: function () {
                this.$.toast2.hide();
            },
            onSessionChange: function () {
                var color = CommonModule.modules.user.current.is() ? 'green' : 'white';
                this.$.accountButton.style.color = color;
            },
            updateBusinesses: function (msg, business) {
                var index = _.findIndex(this.businesses, function (b) { return b.placeid == business.placeid; });
                if (index < 0)
                    this.push('businesses', business);
                else
                    this.splice('businesses', index, 1, business);
            },
            displayInstalledToast: function () {
                // Check to make sure caching is actually enabled—it won't be in the dev environment.
                if (!document.querySelector('platinum-sw-cache').disabled) {
                    document.querySelector('#caching-complete').show();
                }
            },
            isBusinessSelected: function (placeName) {
                return !!this.placeName;
            },
            // Close drawer after menu item is selected if drawerPanel is narrow
            onDataRouteClick: function (event) {
                var drawerPanel = document.querySelector('#paperDrawerPanel');
                if (drawerPanel.narrow && (!event || !event.leaveDrawerOpen)) {
                    drawerPanel.closeDrawer();
                }
            },

            // Scroll page to top and expand header
            scrollPageToTop: function () {
                var headerPanel = document.querySelector('paper-header-panel[main]');
                if (headerPanel) {
                    headerPanel.$.mainContainer.scrollTop = 0;
                }
            },
            onRefresh: function () {
                CommonModule.refresh();
            },
            onRouteClick: function (event) {
                var route, leaveDrawerOpen;
                if (event.model && event.model.business)
                    route = event.model.business.locals.route;
                else if (event.model && event.model.item) {
                    route = event.model.item.route;
                    leaveDrawerOpen = event.model.item.leaveDrawerOpen;
                }
                else
                    route = event.currentTarget.attributes['data-route'].nodeValue;
                leaveDrawerOpen = leaveDrawerOpen || event.currentTarget.attributes['data-leave-drawer-open']
                this.onRouteClickAux(route, leaveDrawerOpen);
            },
            onBusinessRouteClick: function (event) {
                var target = event.currentTarget;
                CommonModule.modules.business.getBusinessUrl(function (url) {
                    if (!url)
                        return;

                    page(url + target.attributes['data-route'].nodeValue);
                }.bind(this));
            },
            setBusinessRouteStyle: function (sectionName) {
                sectionName = '/' + sectionName;
                var buttons = this.querySelectorAll('paper-icon-button[class~="business-menu-item"]');
                _.forEach(buttons, function (button) {
                    var current = button.attributes['data-route'].nodeValue === sectionName;
                    button.disabled = current;
                    this.toggleClass('selected', current, button);
                }.bind(this));
            },
            onRouteClickAux: function (route, leaveDrawerOpen) {
                this.onDataRouteClick({ leaveDrawerOpen: leaveDrawerOpen });
                page(route);
            },
            populateMenu: function () {
                return [
                    {
                        label: 'Places',
                        id: 'places',
                        route: '/places',
                        icon: 'maps:place',
                    },
                    {
                        label: 'Coupons',
                        id: 'membership',
                        route: '/membership',
                        icon: 'card-membership',
                    },
                    {
                        label: 'Checkout',
                        id: 'checkout',
                        route: '/checkout',
                        icon: 'credit-card',
                    },
               {
                   label: 'Open orders',
                   id: 'openorders',
                   route: '/menus',
                   icon: 'receipt',
                   sectionHeader: ' ',
               },
               {
                   label: 'Past orders',
                   id: 'pastorders',
                   route: '/past-orders',
                   icon: 'history',
               },

               {
                   label: 'Settings',
                   id: 'settings',
                   route: '/settings',
                   icon: 'settings',
                   sectionHeader: ' ',
               },
                {
                    label: 'Account',
                    id: 'account',
                    route: '/account',
                    icon: 'account-circle',
                }];
            }
        });
    </script>
</dom-module>
<dom-module id="shared-styles" assetpath="../../web.common/styles/">
  <template>
    <style>
      .page-title {
        @apply(--paper-font-display2);
      }

      @media (max-width: 600px) {
        .page-title {
          font-size: 24px!important;
        }
      }
    </style>
  </template>
</dom-module>
<dom-module id="shopping-basket" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
           paper-badge{
               --paper-badge-opacity: 0.8;
           }
        </style>
        <div style="position:relative">
            <paper-icon-button icon="shopping-basket" alt="Go to shopping basket">
            </paper-icon-button>
            <iron-icon id="shopping-basket" icon="shopping-basket" style="visibility: hidden;position:absolute; top:0; left:0; bottom:0;right:0; margin:auto;"></iron-icon>
            <paper-badge for="shopping-basket" label="{{count}}"></paper-badge>
        </div>
    </template>
    <script>
        
        Polymer({
            is: "shopping-basket",
            properties: {
                count: {
                    type: Number,
                    notify: true,
                    value: function () { return 0;}
                }
            },
            ready: function () {
                PubSub.subscribe('Tab', this.onArticleCountChange.bind(this));
            },
            onArticleCountChange: function () {
                this.count = CommonModule.modules.tab.current.count();
            }
        });
    </script>
</dom-module>
<dom-module id="x-select" assetpath="../../web.common/elements/dropdown/">
  <style>
    :host {
      display: block;
      margin: 0;
      padding:0;
      width:100%;
    }
  </style>
  <template>
    <div on-click="open">
      <content select=".dropdown-trigger"></content>
    </div>
    <iron-dropdown id="dropdown" vertical-align="[[verticalAlign]]" horizontal-align="[[horizontalAlign]]" disabled="[[disabled]]" open-animation-config="[[openAnimationConfig]]" close-animation-config="[[closeAnimationConfig]]" on-click="open">
      <content select=".dropdown-content"></content>
    </iron-dropdown>
  </template>
  <script>
    Polymer({
      is: 'x-select',

      properties: {
        verticalAlign: String,
        horizontalAlign: String,
        disabled: Boolean,
        openAnimationConfig: {
          type: Array,
          value: function() {
            return [{
              name: 'fade-in-animation',
              timing: {
                delay: 150,
                duration: 50
              }
            }, {
              name: 'expand-animation',
              timing: {
                delay: 150,
                duration: 200
              }
            }];
          }
        },

        closeAnimationConfig: {
          type: Array,
          value: function() {
            return [{
              name: 'fade-out-animation',
              timing: {
                duration: 200
              }
            }];
          }
        }
      },

      open: function () {
        if(this.$.dropdown.__data__.opened)
            this.$.dropdown.close();
        else
            this.$.dropdown.open();
      }
    });
  </script>
</dom-module>
<dom-module id="guest-check" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿.table { 
    position: relative;
    max-width: 100%;
    table-layout: fixed;
    width:100%;
    height:100%;
    display: table;    
    border: 1px solid lightblue;

}
.row {
    width:100%; 
    display: table-row;  
    border: 1px solid lightblue;
}
.cell { 
    display: table-cell;
    border: 1px solid lightblue;
    white-space: nowrap;
    overflow: hidden;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    max-height: 25px;
    min-height: 25px;
    height: 25px;
    vertical-align:middle;
}

.cell:nth-child(2n+1) {
    text-align: center;
    overflow: visible;
    width:25%;
}

</style>
        <style>
﻿.check {
    min-width: 100px;
    min-height: 300px;
    height: 92%;
    color: lightblue;
    font-family: 'Times New Roman', Times, serif;
}

.check-body {
    text-align: left;
    background-color: rgb(217,241,225);
}
.check-footer {
    height: 100%;
}

table, tr, td, tfoot {
    border: 1px solid lightblue;
    border-collapse: collapse;
}

.details-table {
    text-align: center;
    width: 95%;
    left: 0;
    right: 0;
    margin: auto;
    font-size: 0.4rem;
}

.serial-number {
    font-size: 2.4em;
    color: red;
    font-family: "Courier New", Courier, monospace;
}

.handwriting {
    text-align: center;
    font-family: 'Fjalla One', sans-serif;
    font-size: 0.8em;
    font-stretch:condensed;
    color:rgb(50,50,50);
    width: 100%;
}

.stam {
    font-size: 0.37em;
    text-align: center;
    width: 100%;
}


table {
    position: relative;
    width: 100%;
    max-width: 100%;
    table-layout: fixed;
}

td {
    display:table-cell;
    white-space: nowrap;
    overflow: hidden;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    max-height: 25px;
    min-height: 25px;
    height: 25px;
    vertical-align:middle;
}

table td > div {
    overflow: visible;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    height: 22px;
}

    tfoot td {
        border: none;
        outline: none;
    }

        tfoot td:nth-child(1) {
            text-align: right;
            font-family: 'Times New Roman', Times, serif;
            font-size: 0.8rem;
            font-weight: bold;
            color: lightblue;
        }

td:nth-child(2n+1) {
    text-align: center;
    overflow: visible;
}

tfoot td:nth-child(2) {
    text-align: center;
    overflow: visible;
}

</style>
        <style>
            ul {
                display: block;
                position: relative;
                background-color: #fff;
                box-shadow: 0 2px 6px #ccc;
                margin: 0.25em 0;
                padding: 0.25em;
                border-radius: 3px;
            }

            [vertical-align="top"] ul {
                margin-top: 0;
            }

            [vertical-align="bottom"] ul {
                margin-bottom: 0;
            }

            li {
                display: block;
                position: relative;
                margin: 0;
                padding: 0;
            }

            a {
                display: block;
                position: relative;
                padding: 1em;
                text-decoration: none;
                color: black;
            }

                a:hover {
                    background: rgba(0,0,255,0.3);
                    text-decoration: none;
                }

            li:not(:last-of-type) {
                border-bottom: 1px solid #eee;
            }

            iron-icon.small {
                height: 18px;
                width: 18px;
            }

            paper-material {
                padding: 0;
            }
            .tip-text{
                display:inline;
                opacity:0.6;
                margin:0;
                font-size: small;
                padding:2px;
            }
            #gccontainer{
                width:95%;
                left:0;
                right:0;
                margin:auto;
            }
        </style>
        <div id="gccontainer">
            <paper-material class="vertical layout check" elevation="1">
                <paper-spinner id="spinner" hidden=""></paper-spinner>
                <div class="caption" style="display:block; text-align:center">{{business.name}}</div>
                <table class="details-table">
                    <tbody><tr>
                        <td>
                            <div>
                                Date
                                <div class="handwriting">{{tab.date}}</div>
                            </div>
                        </td>
                        <td>
                            <div>
                                Table
                                <div class="handwriting">{{tab.no}}</div>
                            </div>
                        </td>
                        <td>
                            <div>
                                Guests
                                <div class="handwriting">{{tab.dinersCount}}</div>
                            </div>
                        </td>
                        <td>
                            <div>
                                Server
                                <div class="handwriting">{{tab.server}}</div>
                            </div>
                        </td>
                        <td colspan="2">
                            <div>
                                <div class="serial-number">{{tab.mockSerialNumber}}</div>
                            </div>
                        </td>
                    </tr>
                </tbody></table>
                <div class="stam">
                    APPT-SOUP/SAL-ENTREE-VEG/POT-DESSERT-BEV
                </div>
                <div class="flex layout vertical handwriting check-body">
                    <div class="flex" style="position:relative;">
                        <div style="position:absolute;overflow:hidden; max-height:100%">
                            <div class="table">
                                <template is="dom-repeat" items="{{DUMMY_ENTRIES}}">
                                    <div class="item-row row">
                                        <div class="cell" width="20%"></div>
                                        <div class="cell" width="60%"></div>
                                        <div class="cell" width="20%"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                        <div class="table">
                            <template is="dom-repeat" items="{{tab.articles}}" as="article">
                                <div class="item-row row">
                                    <div class="cell" width="20%">
                                        <div>
                                            <iron-icon class="small" style="color:darkgray;cursor:pointer" icon="delete" tag="{{article.sku}}" on-click="onDeleteArticle"></iron-icon>
                                        </div>
                                    </div>
                                    <div class="cell" width="60%" style="text-align:justify"><div>{{article.name}}</div></div>
                                    <div class="cell" width="20%"><div>{{article.price}}</div></div>
                                </div>
                            </template>
                        </div>
                    </div>
                    <div>
                        <table>
                            <tfoot>
                                <tr>
                                    <td width="60%">Tax:</td>
                                    <td><div>{{tax}}</div></td>
                                </tr>
                                <tr>
                                    <td>Tip:</td>
                                    <td on-click="stopPropogation">
                                        <div hidden="{{!active}}" style="color:black;cursor:pointer;position:relative">
                                            <x-select vertical-align="bottom">
                                                <paper-button raised="" class="dropdown-trigger tip-text blue-300">{{tip.text}}</paper-button>
                                                <ul class="dropdown-content" tabindex="{{tip.no}}">
                                                    <template is="dom-repeat" items="[[TIPS]]">
                                                        <li><a href="javascript:void(0)" on-click="onTipSelectionChanged">[[item.text]]</a></li>
                                                    </template>
                                                </ul>
                                            </x-select>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total:</td>
                                    <td><div>{{total}}</div></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </paper-material>
        </div>
    </template>
    <script>

        const TAX = 17 / 100;
        const DEFAULT_BUSINESS = {
            name: 'yummlet',
            placeholder: true,
            defaultTip: '10%'
        };
        Polymer({
            is: "guest-check",
            properties: {
                DUMMY_ENTRIES: {
                    type: Array,
                    readOnly: true,
                    value: function () { return new Array(25); }
                },
                TIPS: {
                    type: Array,
                    readOnly: true,
                    value: function () {
                        return [{
                            text: '0%',
                            value: 0,
                            no: 0
                        },
                {
                    text: '5%',
                    value: 5,
                    no: 1
                },
                {
                    text: '10%',
                    value: 10,
                    no: 2
                },
                {
                    text: '12%',
                    value: 12,
                    no: 3
                },
                 {
                     text: '20%',
                     value: 20,
                     no: 4
                 }
                        ];
                    }
                },
                business: {
                    type: Object,
                    notify: true,
                    observer: 'onBusinessChange'
                },
                tab: {
                    type: Object,
                    notify: true,
                },
                tip: {
                    type: Object,
                    notify: true
                },
                total: {
                    type: String,
                    notify: true,
                    computed: 'getTotal(tab.articles.*, tip)'
                },
                tax: {
                    type: String,
                    notify: true,
                    computed: 'getTax(tab.articles.*)'
                },
                active: {
                    type: Boolean,
                    notify: true,
                    computed: 'isActive(total)'
                },
            },
            observers: [
                'totalChange(total)',
            ],
            ready: function () {
            },
            attached: function () {
                PubSub.subscribe('Tab.article.add', this.onTabArticleAdd.bind(this));
            },
            onBusinessChange: function () {
                this.tip = this.findTip(this.business.defaultTip);
                this.set('tab', CommonModule.modules.tab.current.get());
            },
            onTabArticleAdd: function (msg, data) {
                this.debounce('onTabChange', function () {
                    var lastIndex = this.tab.articles.length;
                    if (lastIndex) {
                        this.notifySplices('tab.articles', [{
                            index: lastIndex-1,
                            addedCount: 1,
                            removed: [],
                            object: data.article
                        }]);
                    }
                }.bind(this), 100);
            },
            onTipSelectionChanged: function (event) {
                this.tip = this.findTip(event.target.text);
            },
            findTip: function (tipText) {
                return _.find(this.TIPS, function (tip) {
                    return tip.text == tipText;
                }.bind(this));
            },
            activateSpinner: function (active) {
                this.$.spinner.active = active;
                this.$.spinner.hidden = !active;
            },
            onDeleteArticle: function (event) {
                this.stopPropogation(event);
                var index = _.findIndex(this.tab.articles, function (article) {
                    return article.sku == event.target.tag;
                }.bind(this));
                var articleToRemove = this.tab.articles[index];
                CommonModule.modules.tab.removeArticle(this.business, articleToRemove);
                this.notifySplices('tab.articles', [{
                    index: index,
                    addedCount: 0,
                    removed: [articleToRemove],
                }]);
            },
            getTotal: function () {
                return CommonModule.modules.tab.computePrice(1 + this.tip.value / 100, this.tab.articles);
            },
            getTax: function () {
                return CommonModule.modules.tab.computePrice(TAX / (1 + TAX), this.tab.articles);
            },
            isActive: function () {
                return this.total != "";
            },
            stopPropogation: function (event) {
                event.dontFireCheckClick = true;
            },
            totalChange: function (total) {
                var tab = CommonModule.modules.tab.current.get();
                if (tab) {
                    tab.total = total;
                    tab.tip = CommonModule.modules.tab.computePrice(this.tip.value / 100, this.tab.articles);
                }
            }
        });
    </script>
</dom-module>
<dom-module id="animated-grid" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
.grid {
    padding: 0;
    -webkit-flex-wrap: wrap; /* Safari 6.1+ */
    display: flex;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    -ms-flex-direction: row;
    -webkit-flex-direction: row;
    flex-direction: row;
    -ms-align-content: flex-start;
    -webkit-align-content: flex-start;
    align-content: flex-start;
    justify-content: flex-start;
}

.grid-item-size {
    min-width: 100px;
    width: 100px;
    max-width: 140px;
    min-height: 155px;
    height: 155px;
    max-height: 155px;
}

.grid-item{
        -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
        margin: 1px 1px 5px;
    cursor: pointer;
    -ms-flex: 1 1 100px;
    -webkit-flex: 1 1 100px;
    flex: 1 1 100px;
}



@media (min-width: 641px) {
    .grid-item {
        min-width: 100px;
        margin: 5px;
    }

    .grid {
        padding: 10px;
    }
}

.map-info-window {
    min-width: 150px;
    min-height: 150px;
    max-width: 300px;
    max-height: 300px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}


paper-card {
    text-align: center;
    --paper-card-header-text: {
    text-transform: uppercase;
    -ms-text-overflow: ellipsis;
    -o-text-overflow: ellipsis;
    text-overflow: ellipsis;
    font-size: xx-small;
    padding: 5px 0 0;
    margin: 0;
    vertical-align: central;
    font-family: Tahoma;
    font-weight: bold;
    background: linear-gradient(rgba(0,0,0, 0.3),rgba(0,0,0, 0.3));
    width: auto;
    height: 35px;
    bottom: 4px;
    left: 0;
    right: 0;
    color: white;
}

--paper-card-header-image: {
    height: 90px;
    --iron-image-height: 100%;
}

--paper-card-actions: {
    height: 80%;
}

}

.stars, .stars span {
    display: block;
    background: url("../../public/images/small-stars.png") 0 -12px repeat-x;
    width: 60px;
    height: 12px;
}

    .stars span {
        background-position: 0 0;
    }

.stars-div {
    position: absolute;
    top: -0.5px;
}

</style>
        <style>
            :host {
                overflow:hidden;
            }

            #map{
                height: 40vh;
            }
            
            div:empty {
                height: 0;
                min-height: 0;
                padding: 0;
                margin-top: 0;
                margin-bottom: 0;
                border: none;
            }
            paper-material {
                margin: 20px 0;
                padding:0;
            }
            @media (max-width: 600px) {
                paper-material {
                    margin: 20px;
                }
            }

            @media (min-width: 601px) {
                #businessGrid{
                    background:white;
                    box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.4);
                }
            }
        </style>
        <paper-material id="map" class="hidden-animation" elevation="2"></paper-material>
        <div id="businessGrid">
            <div class="layout vertical center-justified">
                <div style="display:block">
                    <div class="grid">
                        <template is="dom-repeat" items="{{places}}">
                            <paper-card class="grid-item-size grid-item" heading="{{item.name}}" on-click="_onClick" on-mouseover="onMouseOverCard" on-mouseout="onMouseOutOfCard" image="{{item.photo.thumbnail}}" animated-shadow="" elevation="1">
                                <div class="card-content" style="text-align:justify; font-size:xx-small; margin:0; padding: 2px">
                                    <div class="stars-div">
                                        <template is="dom-if" if="{{item.rating}}">
                                            <span class="stars">
                                                <span class="stars" style$="{{getStarRating(item.rating)}}"></span>
                                            </span>
                                        </template>
                                    </div>
                                    <div style="direction:rtl">
                                        <span>{{getDistanceFormat(item.distance)}}</span>
                                    </div>
                                </div>
                                <div class="card-actions" style="margin:0; padding: 0">
                                    <paper-icon-button icon="favorite" toggles="true" title="mark as favorite" active="false"></paper-icon-button>
                                    <paper-icon-button icon="bookmark" title="bookmark for later" active="false"></paper-icon-button>
                                </div>
                            </paper-card>
                        </template>
                        <template is="dom-repeat" items="{{PLACEHOLDERS}}">
                            <div class="grid-item-size grid-item"></div>
                        </template>
                    </div>
                </div>
                <paper-button class="hidden-animation standard blue-300" style$="{{getStyleButton(displayShowMoreButton)}}" raised="" animated="" on-click="onShowMore">Show more</paper-button>
            </div>
        </div>
    </template>
    <script>
        var mapCallbacked = false;
        var initMap = function () {
            mapCallbacked = true;
            PubSub.publish('GooglePlaces.mapCallback');
            window.dispatchEvent(new Event('GoogleMapsReady'));
        }
    </script>
    <!-- TODO: check if sync defer can be changed to nonsync -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDE2bm63ERPDoikiKQd96pd4AQ0_641K2s&amp;callback=initMap">
    </script>
    <script>

        var map;
        var center;
        var bounds;

        const CARD_HOVER_ELEVATION = 3;
        const CARD_ELEVATION = 1;
        const MAX_WIDTH_STAR_RATING = 60;
        const OUT_OF_TOTAL_STARS = 5;
        const UPPER_THRESHOLD_FOR_SHORT_METER_DISPLAY = 950;
        const INFO_WINDOW_MAX_WIDTH = 300;
        var placeids = [];
        var markers = [];
        Polymer({

            is: 'animated-grid',

            behaviors: [
              Polymer.NeonAnimatableBehavior
            ],

            properties: {

                places: {
                    type: Array,
                    notify: true,
                    value: function () { return []; }

                },
                displayShowMoreButton: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                PLACEHOLDERS: {
                    type: Array,
                    notify: true,
                    value: function () { return new Array(20); }
                }

            },
            ready: function () {
                PubSub.subscribe('Business.received', this.onNewItemReceived.bind(this));
                PubSub.subscribe('Business.error', this.onNearBySearchServerError.bind(this));
                PubSub.subscribe('Business.fetch.end', this.onSearchEnded.bind(this));
                PubSub.subscribe('Business.fetch.start', this.onSearchStarted.bind(this));
                PubSub.subscribe('Business.noMoreResults', this.onNoMoreResults.bind(this));

                if (mapCallbacked)
                    this.onMapGoogleCallback();

                PubSub.subscribe('GooglePlaces.mapCallback', this.onMapGoogleCallback.bind(this));
            },
            attached: function () {
            },
            onMapGoogleCallback: function () {
                center = new google.maps.LatLng(32.08, 34.56);
                bounds = new google.maps.LatLngBounds();

                map = new google.maps.Map(this.$.map, {
                    center: center,
                    zoom: 15,
                    zoomControl: true,
                    mapTypeControl: false,
                    scaleControl: false,
                    streetViewControl: false,
                    rotateControl: false
                });
            },
            onNewItemReceived: function (msg, item) {
                if (_.includes(placeids, item.placeid)) return;

                placeids.push(item.placeid);
                this.addToMap(item);
                this.addToGrid(item);
            },
            addToMap: function (item) {
                var latLng = new google.maps.LatLng(item.location[0], item.location[1]);
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map,
                    animation: google.maps.Animation.DROP,
                    title: item.name
                });
                var infowindow = new google.maps.InfoWindow({
                    content: this.createInfoWindow(item),
                    maxWidth: INFO_WINDOW_MAX_WIDTH
                });

                marker.addListener('click', function () {
                    infowindow.open(map, marker);
                });

                markers.push({ marker: marker, data: item });

                bounds.extend(marker.getPosition());
                this.refreshMap();
            },
            refreshMap: function () {
                if (map && bounds) {
                    var center = map.getCenter();
                    google.maps.event.trigger(map, "resize");
                    map.setCenter(center);
                    map.fitBounds(bounds);
                }
            },
            createInfoWindow: function (business) {
                var address = business.address || '';
                var phoneNumber = business.phoneNumber || '';
                var rating = '', phoneNumber = '', image = '';
                if (business.rating)
                    rating = '<span class="stars">'
                                + '<span class="stars" style="' + this.getStarRating(business.rating) + '"></span>'
                             + '</span>';
                if (business.photo.image)
                    image = 'image = "' + business.photo.image + '"';

                return '<paper-card class="map-info-window"'
                    + 'heading="' + business.name + '" ' + image + ' animated-shadow elevation=1>'
                    + '<div class="card-content">'
                        + '<strong>' + address + '</strong>'
                        + '<p>' + phoneNumber + '</p>'
                        + rating
                    + '</div>'
                    + '<div class="card-actions">'
                        + '<paper-button animated on-click="onMenuShortcut">Menu</paper-button>'
                        + '<paper-button animated on-click="onReviewsShortcut">Reviews</paper-button>'
                        + '<paper-button animated on-click="onPhotosShortcut">Photos</paper-button>'
                    + '</div>'
                + '</paper-card>';
            },
            onMenuShortcut: function (e) {
                this.fire('on-tile', e);
            },
            addToGrid: function (item) {
                var index = _.find(this.places, function (place) {
                    place.distance < item.distance;
                });
                if (!index)
                    this.push('places', item);
                else
                    this.splice('places', index, 0, item);
            },
            onNearBySearchServerError: function (msg) {
                console.log('Server error fetching items');
            },
            onSearchStarted: function (msg, location) {
                placeids.length = 0;
                this.displayShowMoreButton = false;
                this.clearGrid();
                this.clearMap();
                center = new google.maps.LatLng(location.lat, location.lon);
                if (map)
                    map.panTo(center);
            },
            clearGrid: function () {
                this.splice('places', 0, this.places.length);
            },
            clearMap: function () {
                _.forEach(markers, function (marker) {
                    marker.marker.setMap(null);
                });
                markers.length = 0;
                if (google)
                    bounds = new google.maps.LatLngBounds();
            },
            onSearchEnded: function () {
                this.displayShowMoreButton = true;
            },
            onShowMore: function () {
                this.displayShowMoreButton = false;
                PubSub.publish('Business.request.moreResult');
            },
            onNoMoreResults: function () {
                this.displayShowMoreButton = false;
            },
            getDistanceFormat: function (meters) {
                var result = Math.ceil(meters / 25) * 25;
                if (meters > UPPER_THRESHOLD_FOR_SHORT_METER_DISPLAY)
                    return (Math.round(result / 100) / 10) + ' קמ';
                return result + ' מ';
            },
            getStarRating: function (rating) {
                var stars = MAX_WIDTH_STAR_RATING * rating / OUT_OF_TOTAL_STARS;
                var val = "width: " + stars + "px";
                return val;
            },
            _computeTileClass: function (color) {
                return 'tile ' + color + '-300';
            },
            onMouseOverCard: function (event) {
                event.currentTarget.attributes.elevation.value = CARD_HOVER_ELEVATION;
            },
            onMouseOutOfCard: function (event) {
                event.currentTarget.attributes.elevation.value = CARD_ELEVATION;
            },
            _onClick: function (event) {
                var target = event.target;
                if (target.nodeName == "PAPER-ICON-BUTTON" || target.nodeName == "PAPER-RIPPLE")
                    return;
                while (target !== this && !target._templateInstance) {
                    target = target.parentNode;
                }

                var business = target._templateInstance.item

                page('/places/' + business.placeid);
            },
            getStyleButton: function (displayShowMoreButton) {
                if (!displayShowMoreButton)
                    return 'display:none';
                else
                    return 'display:block';
            }

        });
    </script>
</dom-module>
<dom-module id="error-card" assetpath="../../web.common/elements/">
    <style>
        :host {
            display: block;
        }

        .fixed {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 100vw;
        }

        .card {
            position: relative;
            margin: 200px 100px 0;
            height: 700px;
        }
    </style>
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <paper-material animated="true" elevation="1" id="card" style="width:100%;height:100%">
            <div style="left:20vw; top:20vh">
                <h2 class="page-title">{{title}}</h2>
                <p>{{message}}</p>
            </div>
        </paper-material>
    </template>
    <script>

        Polymer({

            is: 'error-card',

            behaviors: [
              Polymer.NeonAnimatableBehavior
            ],

            properties: {

                title: {
                    type: String,
                    notify: true
                },
                message: {
                    type: String,
                    notify: true
                },
                animationConfig: {
                    type: Object,
                    value: function () {
                        return {
                            'entry': [{
                                name: 'scale-up-animation',
                                node: this.$.card
                            }],
                            'exit': [{
                                name: 'scale-down-animation',
                                node: this.$.card
                            }]
                        };
                    }
                }

            }
        });

    </script>
</dom-module>
<dom-module id="menu-section" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿.menu-image {
    position: absolute;
    cursor: pointer;
    height: 150px;
    width: 120px;
    margin: 0;
    padding: 0;
    border: outset 3px goldenrod;
}


.inset-text {
    position: relative;
    top: 10px;
    color: rgba(0,0,0, 0.8);
    font-size: xx-small;
    text-align: center;
    letter-spacing: 3px;
    font-stretch: extra-expanded;
}

.menu-name {
    margin-top: 5px;
    color: gray;
    font-size: medium;
    text-transform: uppercase;
    font-family: 'Fjalla One', sans-serif;
    text-align: center;
}

.message-in-3d {
    position:absolute;
    -moz-transform: rotateX(-30deg);
    -ms-transform: rotateX(-30deg);
    -o-transform: rotateX(-30deg);
    -webkit-transform: rotateX(-30deg);
    transform: rotateX(-30deg);
    text-transform:uppercase;
    color:white;
    font-size:small;
    font-weight:bold;
    left:0;
    right:0;
    margin:auto;
}

.menu-picture {
    position: relative;
    top: 0;
    left: 0;
    right: 0;
    margin: auto;
    padding: 0;
    text-align: center;
    background-repeat: no-repeat;
    border: 1px solid gold;
    min-width: 100px;
    -webkit-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -moz-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -o-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
}

.animatedmenu {
    -moz-transition: background-color .2s ease-in;
    -o-transition: background-color .2s ease-in;
    -webkit-transition: background-color .2s ease-in;
    transition: background-color .2s ease-in;
}

a:link {
    text-decoration: none;
    color: black;
}

a:visited {
    text-decoration: none;
    color: black;
}

a:hover {
    text-decoration: none;
    color: green;
}

a:active {
    text-decoration: none;
    color: green;
}
</style>
        <style>
﻿div.stage {
    -moz-perspective: 600px;
    -ms-perspective: 600px;
    -webkit-perspective: 600px;
    perspective: 600px;
}

.css3d {
    -moz-transition-property: transform;
    -o-transition-property: transform;
    -webkit-transition-property: transform;
    transition-property: transform;
    -moz-transition-duration: 0.7s;
    -o-transition-duration: 0.7s;
    -webkit-transition-duration: 0.7s;
    transition-duration: 0.7s;
    -moz-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -ms-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -o-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -webkit-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
}

    .css3d:hover {
        z-index: 1;
        -moz-transition-property: transform;
        -o-transition-property: transform;
        -webkit-transition-property: transform;
        transition-property: transform;
        -moz-transition-duration: 0.7s;
        -o-transition-duration: 0.7s;
        -webkit-transition-duration: 0.7s;
        transition-duration: 0.7s;
        -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -ms-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -o-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-backface-visibility: hidden;
        -webkit-transform: scale(1);
    }

/*
 * Animation for webkit
*/
@-webkit-keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -webkit-transform: translateY(0);
    }

    40% {
        -webkit-transform: translateY(-30px);
    }

    60% {
        -webkit-transform: translateY(-15px);
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -moz-transform: translateY(0);
        -ms-transform: translateY(0);
        -o-transform: translateY(0);
        -webkit-transform: translateY(0);
        transform: translateY(0);
    }

    40% {
        -moz-transform: translateY(-30px);
        -ms-transform: translateY(-30px);
        -o-transform: translateY(-30px);
        -webkit-transform: translateY(-30px);
        transform: translateY(-30px);
    }

    60% {
        -moz-transform: translateY(-15px);
        -ms-transform: translateY(-15px);
        -o-transform: translateY(-15px);
        -webkit-transform: translateY(-15px);
        transform: translateY(-15px);
    }
}

/*
 * Adding the animation to our element
*/
.bounce {
    -webkit-animation-name: bounce;
    -moz-animation-name: bounce;
    -o-animation-name: bounce;
    animation-name: bounce;
}


.glossy {
    -webkit-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -moz-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 20px;
}

    .glossy:after {
        position: absolute;
        content: ' ';
        width: 100%;
        height: 50%;
        top: 0;
        left: 0;
        -webkit-border-radius: 20px;
        -moz-border-radius: 20px;
        border-radius: 20px;
        background: -moz-linear-gradient(top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,.1) 100%);
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.7)), color-stop(100%,rgba(255,255,255,.1)));
        background: linear-gradient(top, rgba(255,255,255,0.7) 0%,rgba(255,255,255,.1) 100%);
    }

</style>
        <style>
            :host {
                display: block;
                text-align: center;
                height: calc(100vh - 64px);
            }

            paper-button {
                display: inline;
                max-width: 50vw;
            }
        </style>
        <div class="fullbleed layout vertical center" style="height:100%">
            <div class="inset-text">
                <a href="javascript:void(0)" on-click="onBreakfast">BREAKFAST</a> | <a href="javascript:void(0)" on-click="onBreakfast">LUNCH</a> | <a href="javascript:void(0)" on-click="onBreakfast">DINNER</a> | <a href="javascript:void(0)" on-click="onBreakfast">DRINKS</a>
            </div>
            <div id="stage" style="margin-top:10vh; width:90%; max-width:600px; height:130px; position:relative">
                <template is="dom-repeat" items="{{business.menus}}" as="menu">
                    <img class="menu-image css3d glossy hidden-animation" src="{{menu.pages.0.thumbnail}}" style$="{{getStyle(index)}}" on-click="onMenuClick">
                </template>
            </div>
            <div id="menuShelf" style="position:relative; z-index:-1; width:90%;max-width:600px">
                <div class="message-in-3d" hidden$="{{!noMenus}}">SORRY, NO MENUS FOUND</div>
                <img id="shelfImage" src="/public/images/table.png" style="width:100%">
            </div>
            <br>
            <span>May we suggest</span>
            <paper-button animated="" raised="" class="hidden-animation" style="color:cornflowerblue" on-click="onSuggestionClick">{{getMenuSuggestion()}}</paper-button>
        </div>
    </template>
    <script>
        Polymer({

            is: 'menu-section',
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    observer: 'onBusinessChange'
                },
                suggestion: {
                    type: Object,
                    notify: true
                },
                noMenus: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                }

            },
            ready: function () {
            },
            attached: function () {
            },
            onBusinessChange: function () {
                this.noMenus = this.business.menus && !this.business.menus.length;
            },
            getStyle: function (index) {
                var parentWidth = Math.min(document.querySelector('#mainContainer').clientWidth * 0.9, 600);
                return CommonModule.modules.menu.visual.getMenuSectionItemPosition(parentWidth, this.business.menus.length, index);
            },
            onMenuClick: function (event) {
                CommonModule.modules.business.getBusinessUrl(function (url) {
                    page(url + '/menus/' + event.model.menu.name);
                });
            },
            getMenuSuggestion: function () {
                return 'DYNAMIC MENU SUGGESTION GOES HERE';
            },
            onSuggestionClick: function () {
            },
        });

    </script>
</dom-module>
<dom-module id="article-details" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
        </style>
        <div class="layout horizontal center-justified">
            <paper-button raised="" class="smaller-button blue-300" animated="" on-click="onAddToOrder">
                <iron-icon icon="add-shopping-cart"></iron-icon>
                Add to order
            </paper-button>
            <paper-button raised="" class="smaller-button" style="background:lightgray" animated="" on-click="onBackClick">BACK</paper-button>
        </div>
    </template>
    <script>
        
        Polymer({
            is: "article-details",
            properties: {
                article: {
                    type: Object,
                    notify: true,
                },
            },
            ready: function () {
            },
            onAddToOrder: function () {
                this.addToOrder();
            },
            addToOrder: function () {
                CommonModule.modules.tab.addArticle(this.article);
                this.fire('animate');
            },
            onConfirmNewTabClosed: function(event){
                if (this.$.confirmNewTab.closingReason.confirmed)
                    this.addToOrder();

            },
            onBackClick: function () {
                this.fire('section-back-click');
            },
        });
    </script>
</dom-module>
<dom-module id="menu-browser" assetpath="/">
    <style>
﻿.menu-image {
    position: absolute;
    cursor: pointer;
    height: 150px;
    width: 120px;
    margin: 0;
    padding: 0;
    border: outset 3px goldenrod;
}


.inset-text {
    position: relative;
    top: 10px;
    color: rgba(0,0,0, 0.8);
    font-size: xx-small;
    text-align: center;
    letter-spacing: 3px;
    font-stretch: extra-expanded;
}

.menu-name {
    margin-top: 5px;
    color: gray;
    font-size: medium;
    text-transform: uppercase;
    font-family: 'Fjalla One', sans-serif;
    text-align: center;
}

.message-in-3d {
    position:absolute;
    -moz-transform: rotateX(-30deg);
    -ms-transform: rotateX(-30deg);
    -o-transform: rotateX(-30deg);
    -webkit-transform: rotateX(-30deg);
    transform: rotateX(-30deg);
    text-transform:uppercase;
    color:white;
    font-size:small;
    font-weight:bold;
    left:0;
    right:0;
    margin:auto;
}

.menu-picture {
    position: relative;
    top: 0;
    left: 0;
    right: 0;
    margin: auto;
    padding: 0;
    text-align: center;
    background-repeat: no-repeat;
    border: 1px solid gold;
    min-width: 100px;
    -webkit-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -moz-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    -o-transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
    transition: height .5s ease-in, max-height .5s ease-in, max-width .5s ease-in, background-position .5s ease-in, background-size .5s ease-in, background-image 0.5s ease-in-out, background 0.5s ease-in-out;
}

.animatedmenu {
    -moz-transition: background-color .2s ease-in;
    -o-transition: background-color .2s ease-in;
    -webkit-transition: background-color .2s ease-in;
    transition: background-color .2s ease-in;
}

a:link {
    text-decoration: none;
    color: black;
}

a:visited {
    text-decoration: none;
    color: black;
}

a:hover {
    text-decoration: none;
    color: green;
}

a:active {
    text-decoration: none;
    color: green;
}
</style>
    <style>
﻿div.stage {
    -moz-perspective: 600px;
    -ms-perspective: 600px;
    -webkit-perspective: 600px;
    perspective: 600px;
}

.css3d {
    -moz-transition-property: transform;
    -o-transition-property: transform;
    -webkit-transition-property: transform;
    transition-property: transform;
    -moz-transition-duration: 0.7s;
    -o-transition-duration: 0.7s;
    -webkit-transition-duration: 0.7s;
    transition-duration: 0.7s;
    -moz-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -ms-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -o-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    -webkit-transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
    transform: matrix3d(0.7109, 0, -0.703279, 0, 0, 1, 0, 0, 0.703279, 0, 0.7109, 0, 0, 0, 0, 1);
}

    .css3d:hover {
        z-index: 1;
        -moz-transition-property: transform;
        -o-transition-property: transform;
        -webkit-transition-property: transform;
        transition-property: transform;
        -moz-transition-duration: 0.7s;
        -o-transition-duration: 0.7s;
        -webkit-transition-duration: 0.7s;
        transition-duration: 0.7s;
        -moz-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -ms-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -o-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        transform: matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 200, 1);
        -webkit-backface-visibility: hidden;
        -webkit-transform: scale(1);
    }

/*
 * Animation for webkit
*/
@-webkit-keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -webkit-transform: translateY(0);
    }

    40% {
        -webkit-transform: translateY(-30px);
    }

    60% {
        -webkit-transform: translateY(-15px);
    }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {
        -moz-transform: translateY(0);
        -ms-transform: translateY(0);
        -o-transform: translateY(0);
        -webkit-transform: translateY(0);
        transform: translateY(0);
    }

    40% {
        -moz-transform: translateY(-30px);
        -ms-transform: translateY(-30px);
        -o-transform: translateY(-30px);
        -webkit-transform: translateY(-30px);
        transform: translateY(-30px);
    }

    60% {
        -moz-transform: translateY(-15px);
        -ms-transform: translateY(-15px);
        -o-transform: translateY(-15px);
        -webkit-transform: translateY(-15px);
        transform: translateY(-15px);
    }
}

/*
 * Adding the animation to our element
*/
.bounce {
    -webkit-animation-name: bounce;
    -moz-animation-name: bounce;
    -o-animation-name: bounce;
    animation-name: bounce;
}


.glossy {
    -webkit-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -moz-box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.5);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    border-radius: 20px;
}

    .glossy:after {
        position: absolute;
        content: ' ';
        width: 100%;
        height: 50%;
        top: 0;
        left: 0;
        -webkit-border-radius: 20px;
        -moz-border-radius: 20px;
        border-radius: 20px;
        background: -moz-linear-gradient(top, rgba(255,255,255,0.7) 0%, rgba(255,255,255,.1) 100%);
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.7)), color-stop(100%,rgba(255,255,255,.1)));
        background: linear-gradient(top, rgba(255,255,255,0.7) 0%,rgba(255,255,255,.1) 100%);
    }

</style>
    <style>
﻿.cmn-t-shake {
        -moz-animation: shake .5s ease-in-out;
        -o-animation: shake .5s ease-in-out;
        -webkit-animation: shake .5s ease-in-out;
        animation: shake .5s ease-in-out;
    }

@keyframes shake {
    0% {
        -moz-transform: translateX(0);
        -ms-transform: translateX(0);
        -o-transform: translateX(0);
        -webkit-transform: translateX(0);
        transform: translateX(0);
    }

    20% {
        -moz-transform: translateX(-10px);
        -ms-transform: translateX(-10px);
        -o-transform: translateX(-10px);
        -webkit-transform: translateX(-10px);
        transform: translateX(-10px);
    }

    40% {
        -moz-transform: translateX(10px);
        -ms-transform: translateX(10px);
        -o-transform: translateX(10px);
        -webkit-transform: translateX(10px);
        transform: translateX(10px);
    }

    60% {
        -moz-transform: translateX(-10px);
        -ms-transform: translateX(-10px);
        -o-transform: translateX(-10px);
        -webkit-transform: translateX(-10px);
        transform: translateX(-10px);
    }

    80% {
        -moz-transform: translateX(10px);
        -ms-transform: translateX(10px);
        -o-transform: translateX(10px);
        -webkit-transform: translateX(10px);
        transform: translateX(10px);
    }

    100% {
        -moz-transform: translateX(0);
        -ms-transform: translateX(0);
        -o-transform: translateX(0);
        -webkit-transform: translateX(0);
        transform: translateX(0);
    }
}

</style>
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
            #page-slider {
                color: white;
            }
        </style>
        <div id="menuPictureContainer" class="layout vertical center">
            <div class="menu-name" style="height:20px">
                <span>{{menu.title}}</span>
                <div class="separator"></div>
            </div>
            <br>
            <div class="layout horizontal center">
                <div>
                    <paper-icon-button id="back" icon="zoom-out" on-click="onBackClick" disabled$="{{!section.parent_id}}"></paper-icon-button>
                    <paper-tooltip for="back">Go back a section</paper-tooltip>
                </div>
                <template is="dom-if" if="{{isMultiplePaged(menu)}}">
                    <paper-slider id="page-slider" hidden="{{detailsVisible}}" min="1" max="{{getSliderMax(menu)}}" on-immediate-value-change="onSliderChange" on-value-change="onSliderChange" markers="{{getSliderMarker(menu)}}" snaps="" pin="" expand=""></paper-slider>
                </template>
            </div>
            <br>
            <paper-material id="menuPicture" class$="{{imageClass}}" style$="{{getPictureStyle(section)}}" on-click="onImageClick" elevation="2">
                <paper-spinner id="spinner" hidden=""></paper-spinner>
            </paper-material>
            <br>
            <div hidden="{{!detailsVisible}}" class="hidden-animation" style="text-align:center">
                <article-details id="details" on-animate="animateSelectedItem" on-section-back-click="onBackClick"></article-details>
            </div>
        </div>
        <img id="loading-space" hidden="">
    </template>
    <script>
        const SHAKE_CLASS = 'cmn-t-shake';
        var initialImageClass = "menu-picture glossy";
        Polymer({
            is: 'menu-browser',

            behaviors: [
              Polymer.NeonAnimatableBehavior
            ],

            properties: {
                menu: {
                    type: Object,
                    notify: true,
                    observer: 'onMenuChange'
                },
                page: {
                    type: Object,
                    notify: true,
                    observer: 'onPageChange'
                },
                section: {
                    type: Object,
                    notify: true,
                },
                history: {
                    type: Array,
                    value: function () { return []; }
                },
                detailsVisible: {
                    type: Boolean,
                    value: function () { return false; }
                },
                imageClass: {
                    type: String,
                    value: function () { return initialImageClass; }
                },
                leftEnabled: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                }
            },
            observers: [
                'initializeSection(page)'
            ],
            ready: function () {
            },
            attached: function () {
                this.this = this;
                this.async(function () {
                    this.activateSpinner(true);
                }.bind(this));
            },
            onMenuChange: function () {
                if (!this.menu) return;

                console.log('OBSERVER: menu change');
                this.page = this.menu.pages[0];
            },
            isMultiplePaged: function () {
                return this.menu && this.menu.pages.length > 1;
            },
            onSliderChange: function (event) {
                var val = event.target.immediateValue;
                if (val && this.menu.pages && (val - 1) > -1 && (val - 1) <= this.menu.pages.length) {
                    this.page = this.menu.pages[val - 1];
                }
            },
            onPageChange: function () {
                this.activateSpinner(true);
                $(this.$['loading-space']).attr('src', this.page.jpg).load(function () {
                    this.$.menuPicture.style.backgroundImage = 'url(' + this.page.jpg + ')';
                    this.activateSpinner(false);
                }.bind(this));
            },
            initializeSection: function (page) {
                this.section = this.page;
            },
            onBackClick: function (event) {
                if (this.history.length > 0)
                    return this.section = this.pop('history');
                //return this.fire('back-click', event);
            },
            getImageAlt: function (index) {
                return 'Page No. ' + index + ' from the ' + this.menu.title + ' menu';
            },
            getImageWidth: function (page) {
                return $(this.$['menu-browser-container']).width();
            },
            getImageHeight: function (page) {
                var width = $(this.$['menu-browser-container']).width();
                return page.height * width / page.width;
            },
            onImageClick: function (event) {
                var x = event.offsetX;
                var y = event.offsetY;
                var width = event.currentTarget.clientWidth;
                var height = event.currentTarget.clientHeight;
                var result = CommonModule.modules.menu.visual.getClickSectionPosition(x / width, y / height, this.section);
                if (result) {
                    this.push('history', this.section);
                    this.section = result;
                }
            },
            activateSpinner: function (active) {
                this.$.spinner.active = active;
                this.$.spinner.hidden = !active;
            },
            getPictureStyle: function (activeSection) {
                this.showDetails(this.section.final);
                var value = CommonModule.modules.menu.visual.getPictureStyle(this.section, this.page, $('#mainContainer').width());
                return value.size.text + value.bg;
            },
            showDetails: function (show) {
                if (show) {
                    this.$.details.article = this.section;
                    PubSub.publish('app.scrollToTop');
                }
                this.detailsVisible = show;
            },
            animateSelectedItem: function () {
                this.toggleClass(SHAKE_CLASS, true, this.$.menuPicture);
                setTimeout(function () {
                    this.toggleClass(SHAKE_CLASS, false, this.$.menuPicture);
                }.bind(this), 600)
            },
            getSliderMax: function (menu) {
                if (menu && menu.pages)
                    return menu.pages.length;
                else
                    return 1;
            },
            getSliderMarker: function () {
                return this.menu ? _.map(this.menu.pages || [], function (page) { return page.marker; }) : [];
            },
            isInZoom: function (section) {
                return section && section != this.page && !section.final;
            },
            isSliderTooltipVisible: function (detailsVisible, menu) {
                return !detailsVisible && (menu.pages && menu.pages.length > 1);
            }
        });

    </script>
</dom-module>
<dom-module id="pay-with-paypal" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿paper-button {
    display:block;
    text-align: left;
    width:100%;
    margin:10px 0;
}
paper-button > span{
    margin-left: 20px;
    font-size:1em;
}
</style>
        <style>
        </style>
        <div>
            <paper-button class="hidden-animation yellow-300" disabled$="{{getState(redirectingToPaypal, enabled)}}" raised="" id="paypal-button" alt="" on-click="onPaypalClick">
                <div class="layout horizontal">
                    <paper-spinner hidden="{{!redirectingToPaypal}}" active=""></paper-spinner>
                    <iron-icon src="/public/images/paypal_logo.png"></iron-icon>
                    <span class="flex" style="text-align:center">Pay with paypal</span>
                </div>
            </paper-button>
        </div>
    </template>
    <script>

        Polymer({
            is: "pay-with-paypal",
            properties: {
                redirectingToPaypal: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; },
                },
                enabled: {
                    type: Boolean,
                    notify: true,
                },
            },
            ready: function () {
            },
            onPaypalClick: function () {
                CommonModule.payment.paypal.pay(this.onResponse, this.onError);
                this.redirectingToPaypal = true;
            },
            getState: function(redirectingToPaypal, enabled){
                var disabled = redirectingToPaypal || !enabled;
                return disabled;
            },
            onResponse: function (link, status) {
                if (status == 'success')
                    window.location.replace(link);
            },
            onError: function (data) {
                var message ={
                    header: "Sorry",
                    body: "We're experiencing some issues. Please try again in a few minutes."
                }
                this.fire("message", message);
            }
        });
    </script>
</dom-module>
<dom-module id="credit-card-form" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
            paper-button#paypal-button {
                display: block;
                background-image: url("/public/images/cc-button.png");
                background-size: 100% 100%;
                width: 270px;
                height: 54px;
                padding: 0;
                margin: 10px auto;
            }
            paper-badge{
                --paper-badge-background: gray;
                --paper-badge-opacity: 0.8;
                --paper-badge-text-color: red;
                z-index: 1;
                cursor:pointer;
            }
            paper-spinner#spinner{
                position:absolute;
                left:0;
                right:0;
                margin:auto;
            }
        </style>
        <div class="layout vertical center" style="margin-bottom:20px">
                <form is="iron-form" id="cc" method="post" action="/payments/cc" with-credentials="" on-iron-form-response="onResponse" on-iron-form-error="onError" class="hidden-animation">
                    <paper-badge for="cc-container" label="X" disabled="{{processing}}" on-click="onCloseForm"></paper-badge>
                    <div id="cc-container">
                        <div class="fjalla-caption">PAY</div>
                        <paper-input name="name" label="Name"></paper-input>
                        <paper-input name="id" error-message="Only digits allowed" auto-validate="" pattern="[0-9]*" prevent-invalid-input="" label="ID"></paper-input>
                        <gold-cc-input prevent-invalid-input="" label="CC"></gold-cc-input>
                        <div class="layout horizontal">
                            <gold-cc-expiration-input auto-validate="" prevent-invalid-input="" label="Expiry date"></gold-cc-expiration-input>
                            <div style="min-width:30px; min-height:20px;"></div>
                            <gold-cc-cvc-input auto-validate="" prevent-invalid-input="" label="CVC"></gold-cc-cvc-input>
                        </div>
                        <br>
                        <input type="hidden" name="tab" id="tabPlaceholder">
                        <paper-button class="yellow-300" style="display:block" raised="" on-click="onCCSubmit">
                            <div class="layout horizontal around-justified">
                                <iron-icon icon="lock" style="margin-left:30px"></iron-icon>
                                <span style="margin-right:30px">Order</span>
                            </div>
                            <paper-spinner id="spinner" hidden="{{!processing}}" active=""></paper-spinner>
                        </paper-button>
                    </div>
                </form>
        </div>
        <paper-toast id="toast2" text="{{toastText}}"></paper-toast>
    </template>
    <script>
        Polymer({
            is: "credit-card-form",
            properties: {
                processing: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; },
                },
                toastText: {
                    type: String,
                    notify: true
                }
            },
            ready: function () {
            },
            attached: function(){
            },
            onCCSubmit: function () {
                var tab = CommonModule.modules.tab.current.get();
                this.$.tabPlaceholder.value = JSON.stringify(tab);
                if (this.$.cc.validate()) {
                    this.processing = true;
                    this.$.cc.submit();
                }
            },
            onCloseForm: function () {
                this.$.cc.reset();
                this.fire('close');
            },
            getState: function(processing, enabled){
                var disabled = processing;
                if (disabled)
                    this.$['paypal-button'].style.backgroundImage = 'url("/public/images/cc-button-disabled.png")';
                else
                    this.$['paypal-button'].style.backgroundImage = 'url("/public/images/cc-button.png")';
                return disabled;
            },
            onResponse: function (status) {
                if (status == 200)
                    page('/order');
            },
            onError: function (status) {
                this.toastText = "Card validation failed. Perhaps try another card.";
                this.$.toast2.show();
            }
        });
    </script>
</dom-module>
<dom-module id="pay-with-cc" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿paper-button {
    display:block;
    text-align: left;
    width:100%;
    margin:10px 0;
}
paper-button > span{
    margin-left: 20px;
    font-size:1em;
}
</style>
        <style>
        </style>
        <div>
            <credit-card-form class="hidden-animation" hidden="{{!getButtonState(isCCClick, enabled)}}" on-close="onCCClose"></credit-card-form>
            <paper-button class="hidden-animation yellow-300" raised="" id="cc-button" alt="" on-click="onCCClick" hidden="{{getButtonState(isCCClick, enabled)}}" disabled="{{getDisabledState(enabled)}}">
                <div class="layout horizontal">
                    <iron-icon icon="credit-card"></iron-icon>
                    <span class="flex" style="text-align:center">Pay with credit card</span>
                </div>
            </paper-button>
        </div>
    </template>
    <script>

        Polymer({
            is: "pay-with-cc",
            properties: {
                isCCClick: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                enabled: {
                    type: Boolean,
                    notify: true,
                },
            },
            ready: function () {
            },
            onCCClick: function () {
                this.isCCClick = true;
                this.fire('cc-selected', true);
            },
            onCCClose: function () {
                this.isCCClick = false;
                this.fire('cc-selected', false);
            },
            getButtonState: function () {
                return this.enabled && this.isCCClick;
            },
            getDisabledState: function () {
                var disabled = !this.enabled;
                return disabled;
            }
        });
    </script>
</dom-module>
<dom-module id="checkout-page" assetpath="/">
    
    <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
    <template>
        <style>
            paper-material {
                padding: 15px;
                display:block;
                margin-bottom:15px;
            }
        </style>
            <div style="max-width:400px; width: 100%; left:0;right:0; margin:auto">
                <paper-material>
                    <div class="fjalla-caption">CHECKOUT</div>
                    <br>
                    <guest-check business="{{business}}"></guest-check>
                    <br>
                </paper-material>
                <paper-material>
                    <pay-with-cc enabled="{{!isBasketEmpty}}" on-cc-selected="onCCSelected" on-message="onMessage"></pay-with-cc>
                    <pay-with-paypal id="paypal" enabled="{{!isBasketEmpty}}" on-message="onMessage"></pay-with-paypal>
                </paper-material>
            </div>
    </template>
    <script>
        
        Polymer({
            is: "checkout-page",
            properties: {
                isBasketEmpty: {
                    type: Boolean,
                    notify: true,
                    value: function () { return true;}
                },
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true
                }
            },
            ready: function () {
                PubSub.subscribe('Tab', this.onArticleCountChange.bind(this));
            },
            onArticleCountChange: function () {
                this.isBasketEmpty = !CommonModule.modules.tab.current.count();
            },
            onCCSelected: function (event, value) {
                this.$.paypal.hidden = value;
            },
            onMessage: function (message) {
                this.dialogHeader = message.header;
                this.dialogBody = message.body;
                this.$.msgDlg1.open();
            }
        });
    </script>
</dom-module>
<dom-module id="ssn-input" assetpath="../../web.common/elements/">
    <template>
        <style>
            :host {
                display: inline-block;
            }

            input[is="iron-input"] {
                font: inherit;
                outline: none;
                box-shadow: none;
                border: none;
                width: auto;
                text-align: center;
            }
        </style>
        <div class="horizontal layout" on-click="onInputClick">
            <input class="flex" id="ssn1id" style="margin-left:25%" type="text" is="iron-input" mxlength="{{mxlength}}" bind-value="{{ssn1}}" size="{{mxlength}}" on-input="onSSN1Input">
            <span style="margin: auto 15px"> - </span>
            <input class="flex" id="ssn2id" style="margin-right:25%" type="text" is="iron-input" mxlength="{{mxlength}}" bind-value="{{ssn2}}" size="{{mxlength}}" on-input="onSSN2Input">
        </div>
    </template>
    <script>
        Polymer({
            is: 'ssn-input',

            properties: {
                value: {
                    notify: true,
                    type: String
                },

                ssn1: {
                    type: String,
                    notify: true,

                },

                ssn2: {
                    notify: true,
                    type: String
                },
                mxlength: {
                    notify: true,
                    type: Number
                },
            },

            observers: [
              '_computeValue(ssn1,ssn2)'
            ],
            onSSN1Input: function (event) {
                if (this.ssn1.length > this.mxlength) {
                    var p1 = this.ssn1.substring(0, this.mxlength);
                    var p2 = this.ssn1.substring(this.mxlength);
                    this.ssn1 = p1;
                    this.ssn2 = p2;
                    this.$.ssn2id.focus();
                }
            },
            onSSN2Input: function (event) {
                if (this.ssn2.length == 0)
                    this.$.ssn1id.focus();
                else if (this.ssn2.length > this.mxlength)
                    this.ssn2 = this.ssn2.substring(0, this.mxlength);

            },
            onInputClick: function () {
                idInFocus = document.activeElement.id;
                if (idInFocus != 'ssn1id' && idInFocus != 'ssn2id')
                    this.$.ssn1id.focus();
            },
            _computeValue: function (ssn1, ssn2) {
                this.value = ssn1.trim() + ssn2.trim();
            }
        });
    </script>
</dom-module>
<dom-module id="account-login" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            .login-links {
                text-align: center;
                font-size: medium;
                font-stretch:expanded;
            }

            a:link, a:visited {
                color: cornflowerblue;
            }
            paper-material {
                background-image: radial-gradient(rgba(255,255,255,1), rgba(255,255,255,0.9)), url("/public/images/social-media.jpg");
                background-size: cover;
                margin-left:0;
                margin-right:0;
           }
            paper-button#fb-login-button {
                color:white;
                background-color:rgb(58,86,156);
                background-image: url("/public/images/facebook_logo.png");
                background-repeat:no-repeat;
                background-size:32px 32px;
                background-position:5px center;
            }

            paper-button#gsignin2 {
                background-color:white;
                background-image: url("/public/images/google_logo.png");
                background-repeat:no-repeat;
                background-size:32px 32px;
                background-position:5px center;

            }
            paper-button > span {
                margin-left:28px;
            }
            .g-recaptcha {
                left: 0;
                right: 0;
                margin: auto;
            }
            .login-links > span {
                margin: auto 5px;
                font-size: 0.7em;
            }
        </style>
        <paper-toast id="toast1" text="{{toastText}}"></paper-toast>
        <paper-material elevation="1" style="min-width:300px;">
            <iron-pages id="pages" style="width:100%; height:auto" selected="{{mode}}">
                    <div>
                        <form is="iron-form" id="reset" method="post" action="{{getUserTypedUrl(route, '/reset')}}" with-credentials="" on-iron-form-response="onResetResponse" on-iron-form-error="onResetError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">RESET PASSWORD</div>
                            <paper-input id="username" name="username" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="login" method="post" action="{{getUserTypedUrl(route, '/yummlet')}}" with-credentials="" on-iron-form-response="onLoginResponse" on-iron-form-error="onLoginError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">LOGIN</div>
                            <paper-input id="username" name="username" type="email" error-message="Invalid email address or password" required="" label="Email" readonly="{{requireCodeOnLogin}}"></paper-input>
                            <paper-input name="password" required="" label="Password" type="password" readonly="{{requireCodeOnLogin}}"></paper-input>
                            <paper-input-container id="logincode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnLogin}}" required="{{requireCodeOnLogin}}">
                                <label>Verification code</label>
                                <ssn-input class="paper-input-input" mxlength="3" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                            </paper-input-container>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <input name="code" type="hidden" required="" value="{{code}}">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap" hidden$="{{loginOnly}}">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="register" method="post" action="{{getUserTypedUrl(route, '/register')}}" with-credentials="" on-iron-form-response="onRegisterResponse" on-iron-form-error="onRegisterError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">REGISTER</div>
                            <input hidden="" name="userRoute" value="{{userRoute}}">
                            <paper-input-container id="regcode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnRegistration}}" required="{{requireCodeOnRegistration}}">
                                <label>Registration code</label>
                                <ssn-input class="paper-input-input" mxlength="4" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                            </paper-input-container>
                            <input name="code" type="hidden" required="" value="{{code}}">
                            <paper-input name="username" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <paper-input auto-validate="" id="password" name="password" required="" label="Password" type="password" allowedpattern="[a-zA-Z0-9]" prevent-invalid-input=""></paper-input>
                            <paper-input auto-validate="" id="passwordCheck" required="" label="Repeat password" type="password" allowedpattern="[a-zA-Z0-9]" prevent-invalid-input=""></paper-input>
                            <input name="captcha" class="other-recaptcha" type="hidden" required="">
                            <div class="g-recaptcha" hidden="{{!showCaptcha}}"></div>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <form is="iron-form" id="support" method="post" action="{{getUserTypedUrl(route, '/support')}}" with-credentials="" on-iron-form-response="onSupportResponse" on-iron-form-error="onSupportError" on-iron-form-submit="onSubmitted" class="hidden-animation">
                            <div class="fjalla-caption">SUPPORT</div>
                            <input hidden="" name="userRoute" value="{{userRoute}}">
                            <paper-input name="name" label="Name"></paper-input>
                            <paper-input name="email" type="email" error-message="Invalid email address" required="" label="Email"></paper-input>
                            <gold-phone-input name="phone" label="Phone #" country-code="972" phone-number-pattern="XXX-XXXXXXX">
                            </gold-phone-input>
                            <paper-textarea max-rows="3" required="" name="message" label="How can we help?"></paper-textarea>
                            <div class="login-links layout horizontal wrap">
                                <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                                <span>  |  </span>
                                <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                            </div>
                            <paper-button class="submit-button blue-300" raised="" on-click="onSubmit">Submit</paper-button>
                        </form>
                    </div>
                    <div>
                        <paper-input-container id="socialLoginCode" always-float-label="" attr-for-value="value" hidden="{{!requireCodeOnRegistration}}">
                                <label>Registration code</label>
                                <ssn-input class="paper-input-input" mxlength="4" value="{{code}}"></ssn-input>
                                <paper-input-error>Invalid code. Try again or click support below.</paper-input-error>
                        </paper-input-container>
                        <br>
                        <div class="login-links layout horizontal wrap">
                            <span><a href="javascript:void(0)" class="login-links" on-click="onLogin">Login</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onRegister">Register</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onReset">Forgot password</a></span>
                            <span>  |  </span>
                            <span><a href="javascript:void(0)" class="login-links" on-click="onSupport">Support</a></span>
                        </div>
                    </div>
                </iron-pages>
            <div hidden$="{{disableSocialLogin}}">
                <h1 class="divider">OR</h1>
                <paper-button raised="" class="blue-300" id="gsignin2" alt="Google sign-in" on-click="onGoogleClick"><span>Sign in with Google</span></paper-button>
                <paper-button raised="" class="blue-300" id="fb-login-button" alt="Facebook sign-in" on-click="onFbLoginClick"><span>Sign in with Facebook</span></paper-button>
            </div>
        </paper-material>
    </template>
    <script>
        var me;
  //////////////// FACEBOOK //////////////////////////
        const BASIC_FB_SCOPES = ['email', 'public_profile'];
        window.fbAsyncInit = function () {
            var appId = 1717407078479612;
            if (_.includes(location.hostname, 'localhost'))
                appId = 1723458884541098;
            FB.init({
                appId: appId,
                cookie: true,  // enable cookies to allow the server to access
                // the session
                xfbml: false,  // parse social plugins on this page
                version: 'v2.5', // use version 2.5
                oauth: true,
                status: true, // check login status
            });
            window.dispatchEvent(new Event('FacebookAuthenticationReady'));
        };

        function fb_login(silent, scopes) {
            scopes = BASIC_FB_SCOPES.concat(scopes || []).join(', ');
            if (silent)
                FB.getLoginStatus(function (response) {
                    if (response.status === 'connected') {
                        // the user is logged in and has authenticated your
                        // app, and response.authResponse supplies
                        // the user's ID, a valid access token, a signed
                        // request, and the time the access token 
                        // and signed request each expire
                        //var uid = response.authResponse.userID;
                        //var accessToken = response.authResponse.accessToken;
                        FBUserHasLoggedIn(response);
                    } else
                        fb_login_aux();
                });
            else
                fb_login_aux();

            function fb_login_aux(){
                FB.login(function (response) {
                    FBUserHasLoggedIn(response);
                }, {
                    scope: scopes
                });
            }
        }

        function FBUserHasLoggedIn(response) {
            window.dispatchEvent(new Event('FacebookAuthenticationOK'));

            if (response.authResponse && response.status == 'connected') {
                access_token = response.authResponse.accessToken; //get access token
                user_id = response.authResponse.userID; //get FB UID

                FB.api('/me', function (response) {
                    email = response.email; //get user email
                    name = response.name;
                    username = response.id;
                    FB.api(
                        "/" + username + "/picture?type=large",
                        function (response) {
                            if (response && !response.error) {
                                var image = response.data.url;
                            }
                            CommonModule.modules.user.authenticateSocialLogin({
                                token: access_token,
                                username: username,
                                name: name,
                                email: email,
                                image: image,
                                how: 'fb',
                                route: CommonModule.ROUTE(),
                                code: me.code
                            });
                        }
                    );

                });
            }
        }
    </script>
    <script>
 //////////////// GOOGLE //////////////////////////

        function signInCallback(googleUser) {
            var auth2 = gapi.auth2.getAuthInstance();
            // Listen for sign-in state changes.
            auth2.isSignedIn.listen(signinChanged);

            var profile = googleUser.getBasicProfile();
            profile = {
                username: profile.getId(), // Do not send to your backend! Use an ID token instead.
                token: googleUser.getAuthResponse().id_token,
                name: profile.getName(),
                image: profile.getImageUrl(),
                email: profile.getEmail()
            };
            profile.how = 'google';
            profile.route = CommonModule.ROUTE();
            profile.code = me.code;
            CommonModule.modules.user.authenticateSocialLogin(profile);
        }

        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
            });
        }
        function signinChanged(p1, p2, p3) {
            if (!auth2.isSignedIn.get())
                CommonModule.modules.user.logOutDone();
        }
        function google_login(silent) {
            var options = {};
            if (silent)
                options = { prompt: 'none' };
            auth2.signIn(options).then(function (a) {
                if (auth2.isSignedIn.get()) {
                    var googleUser = auth2.currentUser.get();
                    signInCallback(googleUser);
                }
            });
        }

        function startGoogle() {
            gapi.load('auth2', function () {
                auth2 = gapi.auth2.init({
                    client_id: '910047896261-grc6aga31tgfs50i2h433ubbtt8ijnfa.apps.googleusercontent.com',
                    // Scopes to request in addition to 'profile' and 'email'
                    //scope: 'additional_scope'
                });
                // Listen for sign-in state changes.
                window.dispatchEvent(new Event('GoogleAuthenticationReady'));
            });
        }

        function onFailure(error) {
            console.log(error);
        }
    </script>
    <script>
        //////////// RECAPTCHA ////////////////
        function onRecaptchaLoad() {
            var captchas = document.querySelectorAll('.g-recaptcha');
            _.forEach(captchas, function (captcha) {
                grecaptcha.render(captcha, {
                    sitekey: '6LccpRATAAAAALgLw7C6sFyMjA-3ckACE7ggOEf4',
                    callback: onRecaptchaSuccess,
                    size: getCaptchaSize()
                });
            });
            window.dispatchEvent(new Event('RecaptchaReady'));
        }
        function onRecaptchaSuccess(response) {
            var captchas = document.querySelectorAll('.other-recaptcha');
            _.forEach(captchas, function (captcha) {
                captcha.value = response;
            });

            hideAllRecaptchas();
            var elem = $('account-login');
            elem[0].onSubmit();
        }

        function hideAllRecaptchas() {
            var captchas = document.querySelectorAll('.g-recaptcha');
            _.forEach(captchas, function (captcha) {
                captcha.hidden = true;
            });
        }
        function getCaptchaSize() {
            return window.innerWidth < 500 ? 'compact' : 'normal';
        }
    </script>
    <script>
        var SOCIAL_LOGIN_ATTEMPT = 'Attempting authentication using ';
        var GOOGLE = 'Google';
        var FACEBOOK = 'Facebook';
        var captcha_activated = false;
        var fb_activated = false;
        var google_activated = false;
        Polymer({
            is: "account-login",
            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],
            properties: {
                mode: {
                    type: Number,
                    notify: true,
                    value: function () { return 1; }
                },
                toastText: {
                    type: String,
                    notify: true
                },
                showCaptcha: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false;}
                },
                requireCodeOnRegistration: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false;}
                },
                requireCodeOnLogin: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                code: {
                    type: String,
                    notify:true
                },
                loginOnly: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                disableSocialLogin: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                bg: {
                    type: String,
                    notify: true,
                    value: function () { return null; }
                },
                route: {
                    type: String,
                    notify:true,
                }
            },
            created: function(){
                ////////// SUBSCRIBE TO SOCIAL LOGINS ////////////
                PubSub.subscribe('Activate.google',function(){ 
                    this.async(function () {
                        //TODO: test this
                        this.onGoogleLogin.apply(this, true);
                    }.bind(this));
                }.bind(this));
                PubSub.subscribe('Activate.fb', function(msg, data){ 
                    this.async(function () {
                        // data = [silent, scopes]
                        this.onFbLogin.apply(this, data);
                    }.bind(this));
                }.bind(this));
                PubSub.publish('SocialLogin.listening');
                /////////////////////////////////////////////////

            },
            ready: function () {
                this.$.password.validate = this.validatePassword.bind(this);
                this.$.passwordCheck.validate = this.validatePasswordCheck.bind(this);
                PubSub.subscribe('User.logged.social.fail', this.onSocialLoginFailed.bind(this));
            },
            attached: function () {
                var children = $("form").children();
                _.forEach(children, function (child) {
                    if (_.includes(child.nodeName.toLowerCase(), 'input'))
                        child.onkeypress = function (event) {
                            if (event.which == 13) {
                                event.preventDefault();
                                this.onSubmit();
                            }
                        }.bind(this);
                }.bind(this));

                me = this;

                if (this.bg) {
                    var i,
                        tags = document.querySelectorAll("paper-material");
                    for (i = 0; i < tags.length; i++) {
                        tags[i].style.background = this.bg;
                    }
                }
                if (CommonModule.modules.user.shouldLoad.fb && !fb_activated)
                    this.onFbLogin(true);
                if (CommonModule.modules.user.shouldLoad.google && !google_activated)
                    this.onGoogleLogin(true);

                var links = this.querySelectorAll('.login-links');
                _.forEach(links, function (link) {
                    link.tabIndex = -1;
                });

                this.route = CommonModule.ROUTE();
                PubSub.publish('account-login.ready');
            },
            getUserTypedUrl: function (route, subroute) {
                if (!route) return;
                return '/login' + route + subroute;
            },
            onFbLoginClick: function () {
                this.onFbLogin(false);
            },
            onFbLogin: function (silent, scopes) {
                window.writeToScreen(SOCIAL_LOGIN_ATTEMPT + FACEBOOK);
                if (!fb_activated) {
                    fb_activated = true;
                    var fsignin = document.createElement('script');
                    fsignin.setAttribute("src", "//connect.facebook.net/en_US/sdk.js");
                    this.appendChild(fsignin);
                    window.addEventListener('FacebookAuthenticationReady', this.onFbLogin.bind(this, silent, scopes));
                }
                else
                    fb_login(silent, scopes);
            },
            activateCaptcha: function (callback) {
                if (captcha_activated) return;
                captcha_activated = true;
                var captcha = document.createElement('script');
                captcha.setAttribute("src", "//www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit");
                this.appendChild(captcha);
                window.addEventListener('RecaptchaReady', callback);
            },
            onGoogleClick: function (event, silent) {
                this.onGoogleLogin(false);
            },
            onGoogleLogin: function (silent) {
                window.writeToScreen(SOCIAL_LOGIN_ATTEMPT + GOOGLE);

                if (!google_activated) {
                    google_activated = true;
                    var gsignin = document.createElement('script');
                    gsignin.setAttribute("src", "//apis.google.com/js/client:platform.js?onload=startGoogle");
                    this.appendChild(gsignin);
                    window.addEventListener('GoogleAuthenticationReady', this.onGoogleLogin.bind(this, silent));
                }
                else
                    google_login(silent);
            },
            onRegister: function () {
                this.mode = 2;
            },
            onLogin: function () {
                this.mode = 1;
            },
            onSupport: function(){
                 this.mode = 3
            },
            onReset: function () {
                this.mode = 0;
            },
            onSubmit: function () {
                var formName = (function () {
                    switch (this.mode) {
                        case 0: return 'reset';
                        case 1: return 'login';
                        case 2: return 'register';
                        case 3: return 'support';
                    }
                }.bind(this))();
                if (this.validateCaptcha(formName)) {
                    document.getElementById(formName).submit();
                }
            },
            onSubmitted:function(){
                this.disableAllSubmitButtons(true);
            },
            validateCaptcha: function (formName) {
                if (!this.showCaptcha)
                    return true;

                switch (formName) {
                    case 'support':
                        return true;
                }


                // all values are set at once therefore there is only need to check one of them
                var valid = document.querySelector('.other-recaptcha').value;
                if (!valid)
                {
                    this.toastText = "Please fill out the captcha";
                    this.$.toast1.show();
                }
                return valid;
            },

            disableAllSubmitButtons: function(disable){
                var buttons = document.querySelectorAll('.submit-button');
                _.forEach(buttons, function (b) {
                    b.disabled = disable;
                });
            },
            onLoginResponse: function (event, data) {
                CommonModule.modules.user.loggedIn(data.response);
                this.disableAllSubmitButtons(false);
            },
            onLoginError: function (event, data) {
                var status = this.handleError(event, data);
                if(status == 401)
                    this.$.username.invalid = true;
                else if(status == 449)
                {
                    this.requireCodeOnLogin = true;
                    this.$.logincode.invalid = true;
                }
            },
            onRegisterResponse: function (event, data) {
                this.toastText = "Thank you! A confirmation mail has been sent to your account.";
                this.$.toast1.show(function () {
                    page('/');
                });
                this.disableAllSubmitButtons(false);
            },
            onRegisterError: function (event, data) {
                var status = this.handleError(event, data);
                if (status == 403) {
                    this.toastText = "Sorry, username taken. Please try another one.";
                    this.$.toast1.show();
                }
            },
            onResetResponse: function (event, data) {
                this.toastText = "Check your inbox for further instructions.";
                this.$.toast1.show(function () {
                    page('/');
                });
                this.disableAllSubmitButtons(false);
            },
            onResetError: function (event, data) {
                this.handleError(event, data);
            },
            onSupportResponse: function (event, data) {
                this.toastText = "Thanks, we'll contact you shortly";
                this.$.toast1.show();
                this.disableAllSubmitButtons(false);
            },
            onSupportError: function (event, data) {
                var status = this.handleError(event, data);
            },
            handleError: function (event, data) {
                var status = data.status || parseInt(data.error.message.match(/(\d+).*/)[1]);

                this.disableAllSubmitButtons(false);

                if (status == 500 || status == 503) {
                    this.toastText = "We encountered a problem. Please try again later.";
                    this.$.toast1.show();
                }
                else if (status == 406) {
                    this.toastText = "There was a reCAPTCHA error. Please try again.";
                    this.$.toast1.show();
                }
                else if (status == 429) {
                    this.showCaptcha = true;
                    this.activateCaptcha(function () {
                        this.validateCaptcha();
                    }.bind(this));
                }

                return status;
            },
            onSocialLoginFailed: function (msg, status) {
                var msg = "Sorry, we're experiencing technical difficulties"
                var requireCode = this.requireCodeOnRegistration
                switch (status) {
                    case 412:
                        msg = "Activation is required";
                        break;
                    case 423:
                        msg = "Expecting password change";
                        requireCode=false;
                        break;
                    case 401:
                        msg = "Incorrect username/password";
                        break;
                    case 403:
                        msg = "Account is inactive";
                        requireCode=false;
                        break;
                    default:
                        msg = "Failed to verify authentication."
                }
                if (requireCode) {
                    this.mode = 4;
                    var valid = !this.requireCodeOnRegistration || this.$.socialLoginCode.value;
                    this.$.socialLoginCode.invalid = !valid;
                }
                this.toastText = msg;
                this.$.toast1.show();
            },
            validatePasswordCheck: function () {
                if (this.$.password.invalid) return false;
                this.$.passwordCheck.errorMessage = "Password mismatch";
                this.$.passwordCheck.invalid = this.$.password.value != this.$.passwordCheck.value;
                return !this.$.passwordCheck.invalid;

            },
            validatePassword: function () {
                var numerals = /(?=.*\d+)/;
                var letters = /(?=.*[a-zA-Z]+)/;
                var length = /.{6,18}/;

                var invalid = true;
                var err;
                if (!numerals.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must contain at least one digit';
                else if (!letters.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must contain at least one letter';
                else if (!length.test(this.$.password.value))
                    this.$.password.errorMessage = 'Must be at between 6-18 characters long';
                else
                    invalid = false;
                this.$.password.invalid = invalid;
                this.disableAllSubmitButtons(!invalid);
                return !invalid;
            },
        });

    </script>
</dom-module>
<dom-module id="account-logout" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
        </style>
        <div class="layout vertical center">
            <iron-image class="circular-avatar-big" sizing="cover" preload="" fade="" src="{{profilePicture}}"></iron-image>
            <paper-material>
                <h4>Welcome <span>{{profile.name}}</span>,</h4>
                <p>{{getConnectionMethod(profile)}}</p>
                <paper-button raised="" class="blue-300" on-click="onLogOut" style="display:block">log out</paper-button>
            </paper-material>
        </div>
    </template>
    <script>
        Polymer({
            is: "account-logout",
            properties: {
                profilePicture: {
                    type: String,
                    notify: true,
                    value: function () { return "";}
                },
                profile: {
                    type: Object,
                    notify: true,
                    value: function () { return {}; }
                }
            },
            ready: function () {
            },
            attached: function () {
                PubSub.subscribe('User.logged.in', this.updateValues.bind(this));
                this.updateValues();
            },
            updateValues: function () {
                if (!CommonModule.modules.user.current.is()) return;
                this.profile = CommonModule.modules.user.current.profile();
                this.profilePicture = CommonModule.modules.user.current.image();
                },
            onLogOut: function(){
                CommonModule.modules.user.logOut();
            },
            getConnectionMethod: function () {
                if (!CommonModule.modules) return;
                return "You're currently signed in using " + CommonModule.modules.user.current.friendlyHow();
            }
        });

    </script>
</dom-module>
<dom-module id="fast-checkout-button" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
        </style>
            <paper-material id="fastCheckout" style="display:block" elevation="1">
                <div id="yellowBG" style="position:absolute; width:100%; left:0; top:0; margin:0; height:100%; background-color:rgba(255,255,102,0.4)"></div>
                <div class="fjalla-caption">SKIP REGISTRATION</div>
                <paper-button class="pay-button yellow-300" raised="" on-click="onSkipRegistration">PAY NOW</paper-button>
            </paper-material>
    </template>
    <script>

        Polymer({
            is: "fast-checkout-button",
            properties: {
            },

            ready: function () {
            },
            attached: function () {
            },
            onSkipRegistration: function () {
                page('/checkout');
            }
        });

    </script>
</dom-module>
<dom-module id="account-manager" assetpath="/">
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>

        </style>
        <div style="max-width:400px; width: 100%; left:0;right:0; margin:auto">
            <div hidden$="{{isLoggedIn}}">
                <div hidden$="{{isBasketEmpty}}" style="display:block">
                    <fast-checkout-button></fast-checkout-button>
                    <h1 id="firstOr" class="divider">OR</h1>
                </div>
                <account-login></account-login>
            </div>
            <div hidden$="{{!isLoggedIn}}"><account-logout></account-logout></div>
        </div>
    </template>
    <script>
        Polymer({
            is: "account-manager",
            properties: {
                isLoggedIn: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; }
                },
                isBasketEmpty: {
                    type: Boolean,
                    notify: true,
                    value: function () { return true; }
                }
            },
            ready: function () {
            },
            attached: function () {
                PubSub.subscribe('User.logged', this.onSessionChange.bind(this))
                PubSub.subscribe('Tab.article.count', this.onArticleCountChange.bind(this));
                this.onArticleCountChange();
                this.onSessionChange();
            },
            onArticleCountChange: function () {
                    this.isBasketEmpty = !CommonModule.modules.tab.current.count();
            },
            onSessionChange: function () {
                this.isLoggedIn = CommonModule.modules.user.current.is();
            },
        });

    </script>
</dom-module>
<dom-module id="cafe-view" assetpath="/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿paper-fab {
    width:10vw;
    height:10vw;
    max-width:50px;
    max-height:50px;
    margin:40px 0 0;
    position:relative;
    pointer-events:all;
}

.menu{
    background-color:rgba(129,199,132,0.6);
}
.gallery{
    background-color:rgba(79,195,247,0.6);
}
.review{
    background-color:rgba(77,208,225,0.6);
}

.friend{
    background-color:rgba(77,182,172,0.6);
}

.menu-button{
    background-color:rgb(129,199,132);
}
.gallery-button{
    background-color:rgb(79,195,247);
}
.review-button{
    background-color:rgb(77,208,225);
}

.friend-button{
    background-color:rgb(77,182,172);
}

.page-caption {
    pointer-events:none;
    color: white;
    position: fixed;
    top: 0;
    left: 1%;
    width: 10vw;
    max-width: 50px;
    top:64px;
    height: 100vh;
    z-index: 4;
    -moz-transition: all 1.5s ease;
    -o-transition: all 1.5s ease;
    -webkit-transition: all 1.5s ease;
    transition: all 1.5s ease;
}

@media (min-width: 601px){
    .page-caption{
        left: 210px !important;
    }
}
.vertical-text {
    position: absolute;
    left:0;
    right:0;
    margin:auto;
    top: 80vh;
    text-transform:uppercase;
    -moz-transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -o-transform: rotate(-90deg);
    -webkit-transform: rotate(-90deg);
    transform: rotate(-90deg);
}
</style>

        <style>
            @media (min-width: 601px) {
                .padded {
                    padding: 48px 62px;
                }
            }

            :host {
                display: block;
            }

            paper-fab.backbutton {
                width: 32px;
                height: 32px;
                color: white !important;
                opacity: 0.6;
                --paper-fab-background: var(--paper-blue-300);
            }

            paper-fab.backbutton[disabled] {
                color: gray !important;
                --paper-fab-disabled-background: var(--paper-gray-700);
            }

            .padding-bottom:after{
                padding-bottom: 40px !important;
            }
        </style>
        <paper-spinner id="spinner" hidden=""></paper-spinner>
        <neon-animated-pages class="fixed" id="pages" selected="[[selection]]" entry-animation="{{entryAnimation}}" exit-animation="{{exitAnimation}}" on-iron-deselect="onDeselected">
            <div class="padded">
                <animated-grid id="places-id" class="padding-bottom"></animated-grid>
            </div>
            <div class="padded">
                <error-card id="error-card-id"></error-card>
            </div>
            <div id="menu-section-ph" class="padding-bottom"></div>
            <div id="menu-browser-ph" class="padding-bottom"></div>
            <div class="padded">
                <account-manager id="account-id" class="padding-bottom" on-back-click="_onBackClick"></account-manager>
            </div>
            <div class="padded">
                <checkout-page id="checkout-id" class="padding-bottom" on-back-click="_onBackClick"></checkout-page>
            </div>
            <div id="gallery-section-ph" class="padding-bottom"></div>
            <div id="review-section-ph" class="padding-bottom"></div>
        </neon-animated-pages>
    </template>
    <script>

        var i = 0;
        const GRID_PAGE = i++;
        const ERROR_PAGE = i++;
        const MENU_SECTION_PAGE = i++;
        const MENU_BROWSER_PAGE = i++;
        const ACCOUNT_PAGE = i++;
        const CHECKOUT_PAGE = i++;
        const GALLERY_SECTION_PAGE = i++;
        const REVIEW_SECTION_PAGE = i++;

        const ENTRY = "slide-from-right-animation";
        const EXIT = "slide-left-animation";
        const BACK_ENTRY = "slide-from-left-animation";
        const BACK_EXIT = "slide-right-animation";
        var wasBackClick = false;
        Polymer({
            is: "cafe-view",
            properties: {
                selection: {
                    type: Number,
                    notify: true,
                    value: function () { return 0; },
                    observer: 'onSelectionChanged'
                },
                entryAnimation: {
                    type: String,
                    notify: true,
                    value: function () { return ENTRY; }
                },
                exitAnimation: {
                    type: String,
                    notify: true,
                    value: function () { return EXIT; }
                },
                backHistory: {
                    type: Array,
                    notify: true,
                    value: function () { return []; },
                },
            },
            observers: [
                //'isBackEnabled(backHistory.length)'
            ],
            ready: function () {
                PubSub.subscribe('Geolocation.notAvailable', this.onGeolocationNotAvailable.bind(this));
                PubSub.subscribe('Business.fetch.end', this.onSearchEnded.bind(this));

                PubSub.subscribe('neonpages.MenuSection', this.onSelectionChange.bind(this, MENU_SECTION_PAGE));
                PubSub.subscribe('neonpages.GallerySection', this.onSelectionChange.bind(this, GALLERY_SECTION_PAGE));
                PubSub.subscribe('neonpages.ReviewSection', this.onSelectionChange.bind(this, REVIEW_SECTION_PAGE));
                PubSub.subscribe('neonpages.MenuBrowser', this.onSelectionChange.bind(this, MENU_BROWSER_PAGE));
                PubSub.subscribe('neonpages.Checkout', this.onSelectionChange.bind(this, CHECKOUT_PAGE));
                PubSub.subscribe('neonpages.Account', this.onSelectionChange.bind(this, ACCOUNT_PAGE));
                PubSub.subscribe('neonpages.Grid', function (msg, name) {
                    this.onSelectionChange(GRID_PAGE);
                    this.$['places-id'].refreshMap();
                }.bind(this));
            },
            attached: function () {
                this.async(function () { window.dispatchEvent(new Event('PolymerElementsLoaded')) }.bind(this));
                PubSub.subscribe('Business.current', this.onCurrentBusinessReceived.bind(this));
            },
            onCurrentBusinessReceived: function (msg, business) {
                this.business = business;
                var menuSection = this.querySelector('#menuSection');
                if (menuSection) {
                    menuSection.business = this.business;
                }
                var menuBrowser = this.querySelector('#menuBrowser');
                if (menuBrowser) {
                    menuBrowser.menu = CommonModule.modules.menu.current.get();
                }
                var gallerySection = this.querySelector('#gallerySection');
                if (gallerySection) {
                    gallerySection.business = this.business;
                }
                var reviewSection = this.querySelector('#reviewSection');
                if (reviewSection) {
                    reviewSection.business = this.business;
                }

                this.$['checkout-id'].business = this.business;
            },
            onSearchEnded: function () {
                if (this.$['places-id'].places.length < 1) {
                    this.$['error-card-id'].title = 'No nearby places found';
                    this.$['error-card-id'].message = 'Try extending your search radius.';
                    this.onSelectionChange(ERROR_PAGE);
                }
            },
            onGeolocationNotAvailable: function () {
                this.$['error-card-id'].title = 'Geolocation not available';
                this.$['error-card-id'].message = 'Check application permission or internet connectivity.';
                this.onSelectionChange(ERROR_PAGE);
            },
            onSelectionChange: function (selection) {
                if (this.selected == selection && this.$.pages.items[selection].innerHTML) return;

                this.clearAll();
                switch(selection)
                {
                    case MENU_SECTION_PAGE:
                        this.injectMenuSection();
                        break;
                    case MENU_BROWSER_PAGE:
                        this.injectMenuBrowser();
                        break;
                    case GALLERY_SECTION_PAGE:
                        this.injectGallerySection();
                        break;
                    case REVIEW_SECTION_PAGE:
                        this.injectReviewSection();
                        break;
                }
                this.selection = selection;
            },
            injectReviewSection(){
                var elem = document.createElement("review-section");
                elem.id = 'reviewSection';
                elem.business = CommonModule.modules.business.current.get();
                this.$["review-section-ph"].appendChild(elem);
            },
            injectMenuSection() {
                var elem = document.createElement("menu-section");
                elem.id = 'menuSection';
                elem.business = CommonModule.modules.business.current.get();
                this.$["menu-section-ph"].appendChild(elem);
            },
            injectMenuBrowser() {
                var elem = document.createElement("menu-browser");
                elem.id = 'menuBrowser';
                elem.menu = CommonModule.modules.menu.current.get();
                this.$["menu-browser-ph"].appendChild(elem);
            },
            injectGallerySection() {
                var elem = document.createElement("photo-gallery");
                elem.id = 'gallerySection';
                elem.client = true;
                elem.business = CommonModule.modules.business.current.get();
                this.$["gallery-section-ph"].appendChild(elem);
            },
            clearAll() {
                clearElement.bind(this, "menu-section-ph")();
                clearElement.bind(this, "menu-browser-ph")();
                clearElement.bind(this, "gallery-section-ph")();
                clearElement.bind(this, "review-section-ph")();

                function clearElement(id) {
                    var myNode = this.$[id];
                    while (myNode.firstChild) {
                        myNode.removeChild(myNode.firstChild);
                    }
                }
            },
            //isBackEnabled: function (value) {
            //    this.$.backButton.disabled = !value;
            //},
            onBackClick: function (event) {
                var customBack = this.$.pages.selectedItem.onBackClick;
                if (customBack)
                    return (customBack.bind(this.$.pages.selectedItem.this))();

                this._onBackClick(event);
            },
            _onBackClick: function (event) {
                if (!this.backHistory.length) return;
                this.entryAnimation = BACK_ENTRY;
                this.exitAnimation = BACK_EXIT;

                wasBackClick = true;
                this.selection = this.pop('backHistory');

                setTimeout(function () {
                    this.entryAnimation = ENTRY;
                    this.exitAnimation = EXIT;
                }.bind(this), 500);
            },
            onSelectionChanged: function () {
                PubSub.publish('app.scrollToTop');
                switch (this.selection) {
                    case MENU_SECTION_PAGE:
                        return enableScroll(false);
                    default:
                        enableScroll(true);
                }
            },
            onDeselected: function (event, moreinfo) {
                var prev = event.target._prevSelected;
                if (!wasBackClick)
                    this.push('backHistory', prev);
                wasBackClick = false;
            },
            onNavClick: function (event) {
                this.onNavClickAux(event.currentTarget)
            }
        });

        function enableScroll(enable) {
            $('#mainContainer').css('overflow', enable ? 'auto' : 'hidden');
        }

    </script>
</dom-module>
<dom-module id="photo-gallery" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
﻿            .image {
                min-width: 200px;
                max-width: 300px;
                width: 200px;
                position: relative;
                -ms-flex: 1 1 auto;
                -webkit-flex: 1 1 auto;
                flex: 1 1 auto;
            }
            
            paper-material.image {
                margin: 10px 5px;
                display: inline;
                min-width: 0;
                border-radius: 10px;
                max-width: 230px;
            }

                paper-material.image:hover {
                    box-shadow: 0 0 10px blue;
                }

            .chip {
                font-size: xx-small;
                height: 40px;
                width: auto;
                margin: 1px 0 !important;
                text-align: right;
                border-radius: 10px;
                font-weight: bolder;
                min-width: 80px;
                -webkit-flex: 1 1 auto;
                -ms-flex: 1 1 auto;
                flex: 1 1 auto;
            }

            
            paper-fab{
                color:white;
                background:cornflowerblue;
            }
            .badge{
                cursor:pointer;
            }
</style>
        <style>
﻿paper-fab {
    width:10vw;
    height:10vw;
    max-width:50px;
    max-height:50px;
    margin:40px 0 0;
    position:relative;
    pointer-events:all;
}

.menu{
    background-color:rgba(129,199,132,0.6);
}
.gallery{
    background-color:rgba(79,195,247,0.6);
}
.review{
    background-color:rgba(77,208,225,0.6);
}

.friend{
    background-color:rgba(77,182,172,0.6);
}

.menu-button{
    background-color:rgb(129,199,132);
}
.gallery-button{
    background-color:rgb(79,195,247);
}
.review-button{
    background-color:rgb(77,208,225);
}

.friend-button{
    background-color:rgb(77,182,172);
}

.page-caption {
    pointer-events:none;
    color: white;
    position: fixed;
    top: 0;
    left: 1%;
    width: 10vw;
    max-width: 50px;
    top:64px;
    height: 100vh;
    z-index: 4;
    -moz-transition: all 1.5s ease;
    -o-transition: all 1.5s ease;
    -webkit-transition: all 1.5s ease;
    transition: all 1.5s ease;
}

@media (min-width: 601px){
    .page-caption{
        left: 210px !important;
    }
}
.vertical-text {
    position: absolute;
    left:0;
    right:0;
    margin:auto;
    top: 80vh;
    text-transform:uppercase;
    -moz-transform: rotate(-90deg);
    -ms-transform: rotate(-90deg);
    -o-transform: rotate(-90deg);
    -webkit-transform: rotate(-90deg);
    transform: rotate(-90deg);
}
</style>

        <style>
            :host {
                overflow: hidden;
                position: relative;
            }

            paper-button {
                display: block;
                width: 100%;
                text-align: left;
            }

            .section-name {
                margin-left: 50px;
                font-size: large;
                color: darkgray;
                font-weight: bolder;
            }


            .context-menu {
                background-color: whitesmoke;
                position: fixed;
                z-index: 2;
                visibility: hidden;
                box-shadow: 5px 5px 2.5px #888888;
                -moz-transition: visibility .2s ease-in-out;
                -o-transition: visibility .2s ease-in-out;
                -webkit-transition: visibility .2s ease-in-out;
                transition: visibility .2s ease-in-out;
            }

                .context-menu paper-icon-item {
                    font-size: xx-small;
                }

            .selectable {
                cursor: pointer;
            }

                .selectable:hover {
                    background: rgba(0,0,255,0.2);
                }
            .leaveContextMenuOpen {
            }
        </style>
        <div style="position:relative; overflow-y:auto">
            <template is="dom-repeat" items="{{sections}}" as="section">
                <template is="dom-if" if="{{!client}}">
                    <paper-button on-click="onToggle">
                        <iron-icon icon="{{getSectionIcon(section.open)}}"></iron-icon>
                        <span class="section-name">{{section.name}}</span>
                    </paper-button>
                </template>
                <iron-collapse opened="{{section.open}}">
                    <template is="dom-if" if="{{!section.photos.length}}">
                    </template>
                    <div class="layout horizontal center-justified wrap">
                        <template is="dom-repeat" items="{{section.photos}}" as="photo">
                            <template is="dom-if" if="{{isImageValid(photo.type, photo.removed)}}">
                                <paper-material class="image layout vertical center" on-contextmenu="onRightClick" style$="{{getPhotoStyle(photo.visible)}}">
                                    <iron-image src="{{photo.image}}" width="200" height$="{{getPhotoHeight(photo)}}" placeholder="/public/images/loading-small.gif" preload="" fade="" on-click="onPictureClick" sizing="cover"></iron-image>
                                    <paper-textarea label="Photo label" readonly$="{{canEdit(photo)}}" max-rows="3" value="{{photo.title}}" style="display:block; width:100%"></paper-textarea>
                                    <div class="layout horizontal wrap">
                                        <template is="dom-repeat" items="{{photo.tags}}" as="tagtext">
                                            <div class="chip layout horizontal center center-justified" style$="{{getRandomColor(tagtext)}}">
                                                <div style="white-space:nowrap; margin:2px 0">{{tagtext}}</div>
                                                <paper-icon-button icon="remove-circle" hidden$="{{canEdit(photo)}}" on-click="onDeleteTag" style="color:hotpink"></paper-icon-button>
                                            </div>
                                        </template>
                                    </div>
                                </paper-material>
                                <template is="dom-if" if="{{!photo.visible}}">
                                    <iron-icon icon="visibility-off" style="position:absolute; top:10%; left:10%"></iron-icon>
                                </template>
                            </template>
                        </template>
                    </div>
                    <template is="dom-if" if="{{canUpload(section)}}">
                        <div class="fullbleed layout vertical">
                            <div class="layout horizontal center-justified wrap">
                                <template is="dom-repeat" items="{{previews}}" as="preview">
                                    <div>
                                        <paper-material class="image layout vertical center" style="background:cornflowerblue">
                                            <iron-image src="{{preview.image}}" placeholder="/public/images/loading-small.gif" preload="" width="200" height$="{{getPhotoHeight(preview.image)}}" sizing="cover" fade="" style="margin:20px"></iron-image>
                                            <paper-badge class="badge" label="X" on-click="removeFile"></paper-badge>
                                        </paper-material>
                                    </div>
                                </template>
                            </div>
                            <div id="uploadControls" class="layout horizontal center-justified">
                                <paper-fab id="addPhotos" style="margin:10px" src="/public/images/ic_add_a_photo_white_24px.svg" on-click="onAddPhotosClick"></paper-fab>
                                <paper-fab id="uploadPhotos" disabled="{{!files.length}}" style="margin:10px" icon="file-upload" on-click="onUploadPhotosClick"></paper-fab>
                            </div>
                        </div>
                    </template>
                </iron-collapse>
            </template>
        </div>
        <paper-menu id="contextMenu" class="context-menu" selectable=".selectable">
            <paper-icon-item class="selectable">
                <iron-icon icon="add" item-icon=""></iron-icon>
                Add tag
            </paper-icon-item>
            <paper-icon-item hidden$="{{client}}" class="selectable" on-click="onChangeVisibility">
                <iron-icon icon="{{getPhotoVisibilityIcon(selectedPhoto.visible)}}" item-icon=""></iron-icon>
                <span>{{getPhotoVisibilityText(selectedPhoto.visible)}}</span>
            </paper-icon-item>
            <paper-icon-item hidden$="{{!canDelete(photo}}" class="selectable" on-click="onDeletePhoto">
                <iron-icon icon="remove-circle" item-icon=""></iron-icon>
                Delete
            </paper-icon-item>
            <template is="dom-if" if="{{!client}}">
                <div class="separator" style="width:80%;left:0;right:0; margin:auto"></div>
                <paper-icon-item class="leaveContextMenuOpen">
                    <paper-checkbox id="facebook-check"></paper-checkbox>
                    <iron-icon src="/public/images/facebook_icon_small.jpg" item-icon=""></iron-icon>
                    Upload to Facebook
                </paper-icon-item>
            </template>
        </paper-menu>
        <input id="uglyinput2" type="file" name="files" multiple="" accept="image/*" hidden="" on-change="handleFiles">
        <paper-dialog id="bigPicture" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
            <div style="position:relative">
                <img id="bigPictureImage" style="max-width:100%">
            </div>
        </paper-dialog>
    </template>
    <script>
        function getIndexByRoute(route) {
            switch(route)
            {
                case '/chefs':
                    return 1;
                case '/diners':
                    return 0;
                default:
                    return undefined;
            }
        }
        Polymer({
            is: "photo-gallery",
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange'
                },
                sections: {
                    type: Array,
                    notify: true,
                    observer: 'onSectionsChange'
                },
                previews: {
                    type: Array,
                    notify: true,
                    value: function () { return [] }
                },
                files: {
                    type: Array,
                    notify: true,
                    value: function () { return [] }
                },
                client: {
                    type: Boolean,
                    notify: true,
                    value: function () { return false; },
                    observer: 'onClientToggle'
                },
                selectedPhoto: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                }
            },
            ready: function () {
            },
            attached: function () {
                $('html').click(function (event) { // this is so that menus are closed automatically on click elsewhere
                    this.onClickEvent(event);
                }.bind(this));

            },
            onBusinessChange: function () {
                if(this.business.placeid)
                this.sections = this.getSections(this.business);
            },
            onSectionsChange: function () {
                //if (this.sections && this.sections.length)
            },
            onClientToggle: function () {
                this.style.marginLeft = '50px';
            },
            getSections: function (business) {
                var sections = [
                    {
                        name: 'User photos',
                        photos: business.media.client.photoLinks || [],
                        upload: this.client
                    },
                    {
                        name: 'My photos',
                        photos: business.media.pos.photoLinks || [],
                        upload: !this.client
                    },
                    {
                        name: 'Photos from across the web',
                        photos: (business.googlePhotos || []).concat(business.webPhotos || [])
                    },
                    {
                        name: 'Pdfs from across the web',
                        photos: business.webPdfs || []
                    },
                ];

                sections.forEach(function (s) {
                    s.photos.forEach(defineMissingPhotoProperties);
                    s.open = !!s.photos.length || s.upload;
                });

                return sections;
            },
            onToggle: function (event) {
                var index = _.findIndex(this.sections, function (s) {
                    return s.name == event.model.section.name;
                });
                this.set('sections.' + index + '.open', !event.model.section.open);
            },
            getPhotoHeight: function (photo) {
                return (300 + ~~(Math.random() * 200));
            },
            isImageValid: function (type, removed) {
                return type != 'PDF' && !removed;
            },
            getSectionIcon: function (open) {
                return open ? "arrow-drop-up" : "arrow-drop-down-circle";
            },
            getRandomColor: function (tagtext) {
                var letters = '0123456789ABCDEF'.split('');
                var color = '#';
                for (var i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                var fgColor = parseInt(color, 16) > Math.pow(16, 3) / 2 ? 'black' : 'white';
                var width = (60 + 5 * tagtext.length);
                return 'background-color: ' + color + '; color: ' + fgColor + '; width: ' + width + 'px; max-width: ' + width + 'px;';
            },
            onDeleteTag: function (event) {

            },
            onRightClick: function (event) {
                var photo = event.model.photo;
                if (!this.canEdit(photo))
                    return;

                event.preventDefault();

                defineMissingPhotoProperties(photo); // define missing visible property

                this.selectedPhoto = photo;
                this.$.contextMenu.style.top = event.clientY + 'px';
                this.$.contextMenu.style.left = event.clientX + 'px';
                this.$.contextMenu.style.visibility = 'visible';
            },
            onClickEvent: function (event) {
                if (_.findIndex(event.originalEvent.path, function (elem) {
                    return _.includes(elem.className, 'leaveContextMenuOpen');
                }) > -1) return;
                if (!this.$.bigPicture.opened)
                    this.$.bigPicture.close();
                this.$.contextMenu.style.visibility = 'hidden';
            },
            onPictureClick: function (event) {
                event.preventDefault();
                event.stopPropagation();
                this.$.bigPictureImage.src = event.model.photo.image;
                if (!this.$.bigPicture.opened)
                    this.$.bigPicture.open();
            },
            onChangeVisibility: function (event) {
                var sectionIndex, photoIndex;
                var photo = this.$.contextMenu.dataPhoto;
                sectionIndex = _.findIndex(this.sections, function (s) {
                    photoIndex = _.findIndex(s.photos, function (p) {
                        return p === photo;
                    });
                    return photoIndex > -1;
                });
                if (sectionIndex < 0) return;

                this.set('sections.' + sectionIndex + '.photos.' + photoIndex + '.visible', !photo.visible);
            },
            getPhotoStyle: function (visible) {
                return 'opacity: ' + (visible ? 1 : 0.3);
            },
            getPhotoVisibilityIcon: function (photo) {
                return photo.visible ? 'visibility-off' : 'visibility';
            },
            getPhotoVisibilityText: function (photo) {
                return photo.visible ? 'Hide' : 'Show';
            },
            onAddPhotosClick: function (event) {
                if (this.$.uglyinput2) {
                    this.$.uglyinput2.click();
                }
            },
            onUploadPhotosClick: function (event) {
                if (!CommonModule.utils.validateFiles(this.files)) return false;

                this.disableControls(true);

                var form = this.$.addMenuForm;
                var formData = new FormData(form);

                _.forEach(this.files, function (file) {
                    formData.append('files', file, file.name);
                });
                formData.append('placeid', this.business.placeid);
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                var base = this.client ? '/diners' : '/chefs';
                xhr.open('POST', base + '/access/add/photos', true);
                xhr.onload = function () {
                    this.disableControls(false);

                    if (xhr.status === 200) {
                        // File(s) uploaded.
                        window.writeToScreen('Files uploaded successfully');
                        var responsePhotos = JSON.parse(xhr.response);
                        _.forEach(responsePhotos, defineMissingPhotoProperties);
                        var photos = responsePhotos;
                        var index = getIndexByRoute(photos[0].route);
                        this.splice.apply(this, ['sections.' + index + '.photos', this.sections[index].photos.length, 0].concat(photos))
                        this.clearAll();
                    }
                    else if (xhr.status === 401) {
                        // File(s) uploaded.
                        window.writeToScreen('You must be registered to upload files.', 'Login here', '/account');
                    } else {
                        window.writeToScreen('Service is currently unavailable. Please try again later.');
                    }
                }.bind(this);
                xhr.send(formData);
                return true;
            },
            handleFiles: function (event) {
                var files = _.filter(event.target.files, function (file) {
                    return file.type.startsWith('image/') && !_.find(this.files, function (f) {
                        return f.name == file.name;
                    });
                }.bind(this));

                _.forEach(files, function (file) {
                    file.id = 'id' + Math.random().toString(36).substr(5);
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        this.push('previews', { image: e.target.result, browserId: Math.random(), file: file });
                    }.bind(this);

                    reader.readAsDataURL(file);
                }.bind(this));
                if (files.length)
                    this.splice.apply(this, ['files', this.files.length, 0].concat(files));
            },
            removeFile: function (event) {
                this.$.uglyinput2.value = ""; //deletes everything but we don't need it anyway
                var fileIndex = _.findIndex(this.files, function (file) { return file === this.previews[event.model.index].file }.bind(this));
                this.splice('previews', event.model.index, 1);
                this.splice('files', fileIndex, 1);
                this.updateFileBadgePosition();
            },
            clearAll: function () {
                this.$.uglyinput2.value = "";
                this.splice('previews', 0);
                this.splice('files', 0);
            },
            canUpload: function (section) {
                return section && section.upload;
            },
            canDelete: function(photo){
                return this.canEdit(photo, true) || (!this.client && photo.placeid == this.business.placeid);
            },
            updateFileBadgePosition: function () {
                setTimeout(function () {
                    console.log('in updateFileBadgePosition');
                    var elems = this.querySelectorAll('.badge');
                    _.forEach(elems, function (elem) {
                        if (elem.updatePosition)
                            elem.updatePosition();
                    });
                }.bind(this), 50);
            },
            disableControls: function (disable) {
                _.forEach(this.querySelectorAll('paper-fab'), function (node) {
                    node.disabled = disable;
                });
            },
            canEdit: function (photo, ignoreClient) { //ignoreClient basically nullifies the !this.client condition
                return (!this.client && !ignoreClient) ||
                    (photo.username && CommonModule.modules.user.current.is() && photo.username == CommonModule.modules.user.current.profile().username);
            },
            onDeletePhoto: function () {
                $.ajax({
                    type: "POST",
                    url: '/diners/access/delete/photo',
                    data: {photo: JSON.stringify(this.selectedPhoto)},
                    success: function (a) {
                        console.log('success');
                        this.set('selectedPhoto.removed', true);
                    }.bind(this)
                });
            }
        });

        function defineMissingPhotoProperties(photo) {
            if (_.isUndefined(photo.visible))
                photo.visible = true;
            if (_.isUndefined(photo.removed))
                photo.removed = false;
        }
    </script>
</dom-module>
<dom-module id="review-section" assetpath="../../web.common/elements/">

    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>

        <style>
            .review-info{
                color:gray;
            }

            .review-info span{
                margin: auto 10px;
                font-size:xx-small;
            }
            .star{
                --iron-icon-stroke-color: darkgray;
                --iron-icon-fill-color: gold;
            }
        </style>
        <div style="display:block; width:100%; text-align:center">
            <template is="dom-repeat" items="{{getStars(business.rating)}}" as="star">
                <iron-icon class="star" icon="{{star}}" style="width:50px; height:50px"></iron-icon>
            </template>
        </div>
        <template is="dom-repeat" items="{{reviews}}" as="review">
            <paper-material class="with-margins">
                <div style="display:block; text-align:center;margin-bottom:20px;">
                    <template is="dom-repeat" items="{{getStars(review.rating)}}" as="star">
                        <iron-icon class="star" icon="{{star}}"></iron-icon>
                    </template>
                </div>
                <div class="full layout horizontal">
                    <paper-material class="circular-avatar-xsmall" style$="{{getImageStyle(review.avatar)}}"></paper-material>
                    <div class="full layout vertical">
                        <div class="full layout horizontal">
                            <a href="{{review.author_url}}" target="_blank">{{review.author_name}}</a>
                            <span class="flex"></span>
                            <div class="layout vertical" style="float:right">
                                <div class="review-info layout horizontal">
                                    <iron-icon icon="device:access-time"></iron-icon>
                                    <span>{{formatTime(review.time)}}</span>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 10px 10px 10px 30px">{{review.text}}</div>
                    </div>
                </div>
            </paper-material>
        </template>
    </template>
    <script>
        var MAX_RATING = 5;
        Polymer({
            is: "review-section",
            properties: {
                business: {
                    type: Object,
                    notify: true,
                    reflectToAttribute: true,
                    observer: 'onBusinessChange'
                },
                reviews: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true
                }
            },
            ready: function () {
            },
            attached: function () {
            },
            onBusinessChange: function () {
                this.populateReviews();
            },
            getImageStyle: function (avatar) {
                avatar = avatar || '/public/images/unknown_user.png';
                return 'background: center center /cover no-repeat url(' + avatar + ');';
            },
            getStars: function (rating) {
                var result = [];
                for (var i = 0; i < ~~rating; i++)
                    result.push('star');
                if (rating % 1) //fraction
                    result.push('star-half');
                while (result.length < MAX_RATING)
                    result.push('star-border');
                return result;
            },
            populateReviews: function () {
                this.reviews = [].concat(this.business.googleReviews || [], this.business.reviews || []);
            },
            formatTime: function (time) {
                return (new Date(time)).toDateString();
            },
            formatLanguage: function (lang) {
                return lang.toUpperCase();
            }
        });

    </script>
</dom-module>
<dom-module id="search-bar" assetpath="../../web.common/elements/">
    <style>
        :host {
            display: block;
        }
    </style>
    <template>
        <style>
.red-100 {
    background: var(--google-red-100);
}

.yellow-100 {
    background: var(--google-yellow-100);
}

.blue-100 {
    background: var(--google-blue-100);
}

.green-100 {
    background: var(--google-green-100);
}

.red-300 {
    background: var(--google-red-300);
}

.yellow-300, .checkout-button {
    background: var(--google-yellow-300);
}

.blue-300 {
    background: var(--google-blue-300);
}

.green-300 {
    background: var(--google-green-300);
}

.gray-700{
    background: var(--google-grey-700);
}
paper-material{
    background-color:white;
}
@media (min-width: 601px) {
    paper-material {
        padding: 20px;
    }

    paper-material.with-margins {
        margin: 15px 40px;
    }
}

@media (max-width: 600px) {
    paper-material {
        padding: 10px;
    }
    
    paper-material.with-margins {
        margin: 0;
    }
}

.hidden-animation {
    -webkit-animation: fadein 0.5s; /* Safari, Chrome and Opera > 12.1 */
    -moz-animation: fadein 0.5s; /* Firefox < 16 */
    -o-animation: fadein 0.5s; /* Opera < 12.1 */
    animation: fadein 0.5s;
}

@keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Firefox < 16 */
@-moz-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* Opera < 12.1 */
@-o-keyframes fadein {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

</style>
        <style>
            .suggestionBg{
                position:absolute; 
                z-index:1; 
                width:100%; 
                background:rgba(200, 200, 255, 0.6);
                font-size:xx-small;
            }
            #searchInput{
                display:block; font-size:medium; height:35px;width:100%;
            }
            #searchInput:hover{
                background:lightblue;
            }
        </style>
        <input id="searchInput" type="search" on-blur="onSearchBlur" on-input="onSearchInput">
        <div class="suggestionBg">
            <template is="dom-repeat" items="{{suggestions}}" as="suggestion">
                <paper-item class="suggestion" on-click="onSuggestionSelect">{{suggestion.fullname}}</paper-item>
            </template>
        </div>
    </template>
    <script>

        Polymer({

            is: 'search-bar',

            properties: {
                data: {
                    type: Array,
                    notify: true,
                    reflectToAttribute: true
                },
                maxSuggestions: {
                    type: Number,
                    notify: true,
                    relfectToAttribute: true
                },
                suggestions: {
                    type: Array,
                    notify: true
                }
            },
            ready:function(){
            },
            attached:function(){
            },
            onSearchBlur: function (event) {
                if (event.relatedTarget && _.includes(event.relatedTarget.className, 'suggestion')) return;
                this.suggestions = [];
                this.fire('lost-focus');
            },
            onSuggestionSelect: function (event, data) {
                this.suggestions = [];
                this.fire('selected', event.model.suggestion);
            },
            onSearchInput: function (event) {
                this.debounce('onSearchInput', function () {
                    var results = [];
                    var i = 1;
                    _.forEach(this.data, function (d) {
                        if (i++ > this.maxSuggestions) return false;
                        if (_.includes(d.fullname, event.srcElement.value))
                            results.push(d);
                    });
                    this.suggestions = results;
                }.bind(this), 50);
            },
        });

    </script>
</dom-module>
</div></body></html>